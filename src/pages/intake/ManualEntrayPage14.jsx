import React, { useState, useEffect, useRef } from "react";
import { useParams, useNavigate, useSearchParams  } from "react-router-dom";
import {
  Check,
  Award,
  Eye,
  PlusCircle,
  User,
  ExternalLink,
  Briefcase,
  Fingerprint,
  Calendar,
  FileText,
  CheckCircle,
  MapPin,
  Loader2,
  Plus,
  Trash2,
  Layers,
  Cpu,
  Database,
  Globe,
  ShieldCheck,
  History,
  X,
  Edit3,
  LinkIcon,
  FileUp,
  ChevronRight,
  ChevronLeft,
  ChevronDown,
} from "lucide-react";
import toast from "react-hot-toast";
import { candidateService } from "../../services/candidateService";
import { departmentService } from "../../services/department.service";

const FormField = ({ label, required, error, children }) => (
  <div className="space-y-1 w-full">
    <label className="text-[10px] md:text-[11px] font-black text-slate-500 uppercase tracking-widest ml-1 flex justify-between items-center">
      <span>{label}</span>
      <span
        className={`font-bold normal-case ${required ? "text-red-500" : "text-slate-300"}`}
      >
        {required ? "Required" : "Optional"}
      </span>
    </label>
    {children}
    {error && (
      <p className="text-[9px] text-red-500 font-bold uppercase tracking-tighter ml-1">
        {error}
      </p>
    )}
  </div>
);

const ManualEntryPage = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const [searchParams] = useSearchParams();
  const effectiveId = id || "666";
  const ASSET_OPTIONS = [
    "Laptop",
    "Mouse",
    "Keyboard",
    "Monitor",
    "Headset",
    "Mobile",
    "ID Card",
    "SIM Card",
  ];
  // Professional Enterprise Input Style
  const inputStyle =
    "w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-[13px] font-bold outline-none focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-500/5 transition-all shadow-sm";

  // 1. INITIALIZE ALL STATES
  const [step, setStep] = useState(1);
  const [loading, setLoading] = useState(false);
  const [fetchingData, setFetchingData] = useState(false);
  const [errors, setErrors] = useState({});
  const [isFetchingPincode, setIsFetchingPincode] = useState(false);
  const [cityOptions, setCityOptions] = useState([]);
  const [resumeMode, setResumeMode] = useState("file");
  const [skillInput, setSkillInput] = useState("");
  const [assetInput, setAssetInput] = useState("");
  const [isFresher, setIsFresher] = useState(null);
  const [deptSearch, setDeptSearch] = useState("");
  const [eduSearch, setEduSearch] = useState("");
  const [dynamicSkills, setDynamicSkills] = useState([]);
  const [existingResume, setExistingResume] = useState("");
const [industrySearch, setIndustrySearch] = useState("");
const [showIndustryDrop, setShowIndustryDrop] = useState(false);
  const [dynamicAssets, setDynamicAssets] = useState([]);
  const [showSkillDrop, setShowSkillDrop] = useState(false);
  const [showAssetDrop, setShowAssetDrop] = useState(false);
  const [skillFocused, setSkillFocused] = useState(false);
  const [departments, setDepartments] = useState([]);
  const dropdownContainerRef = useRef(null);
  const [existingCertificates, setExistingCertificates] = useState([]);
  const [editingCertId, setEditingCertId] = useState(null);
  const [editingCertValue, setEditingCertValue] = useState("");
  const [showExpModal, setShowExpModal] = useState(false);
const [currentEditingIndex, setCurrentEditingIndex] = useState(null);
const [newExperiences, setNewExperiences] = useState([]);



//**********************************certiificate and resume*********************************** */

const [docType, setDocType] = useState("resume"); 
// "resume" | "certificate"

const [showCertEditModal, setShowCertEditModal] = useState(false);
const [editingCertificate, setEditingCertificate] = useState(null);

const [certForm, setCertForm] = useState({
  name: "",
  certificate_file: null,
  certificate_link: "",
  uploadMode: "file", // file | link
});


//**********************************certiificate and resume end*********************************** */

//**********************************eduction*********************************** */

const [showEduModal, setShowEduModal] = useState(false);
const [masterEducations, setMasterEducations] = useState([]);
const [eduDropdownOpen, setEduDropdownOpen] = useState(false);
const [isEditingEdu, setIsEditingEdu] = useState(false);
const [currentEduId, setCurrentEduId] = useState(null);
const [newEdu, setNewEdu] = useState({
  education_id: 0,
  institution_name: "",
  start_year: "",
  end_year: "",
  education_name: "" // For display in dropdown
});

//**********************************eduction  end*********************************** */
  const careerStepRef = useRef(null);

  const [formData, setFormData] = useState({
    name: "",
    email: "",
    phone: "",
    address: "",
    address2: "",
    location: "",
    pincode: "",
    state: "",
    city: "",
    district: "",
    country: "India",
    position: "",
    gender: "",
    dob: "",
    education: [], 
    experience: "",
    about_me: "",
    languages_spoken: [],
    skills: [],
    assets: [],
    department: "",
    cvFile: null,
    resume_link: "",
    certificateFiles: [],
    certificateLinks: [""],
    experiences: [],
  });

  const totalSteps = 6;

  const educationOptions = [
    "SSC / 10th",
    "HSC / 12th",
    "ITI",
    "Diploma",
    "Polytechnic",

    "B.A",
    "B.Com",
    "B.Sc",
    "BCA",
    "BBA",
    "B.Tech",
    "BE",
    "B.Pharm",
    "B.Ed",

    "M.A",
    "M.Com",
    "M.Sc",
    "MCA",
    "MBA",
    "M.Tech",
    "ME",
    "M.Pharm",
    "M.Ed",

    "PGDM",
    "Post Graduate Diploma",

    "PhD / Doctorate",
  ];

  const POSITION_OPTIONS = [
    // IT / Software
    "Frontend Developer",
    "Backend Developer",
    "Full Stack Developer",
    "Software Engineer",
    "Senior Software Engineer",
    "Lead Developer",
    "DevOps Engineer",
    "QA Engineer",
    "Automation Tester",
    "Manual Tester",
    "UI/UX Designer",
    "Mobile App Developer",
    "Android Developer",
    "iOS Developer",
    "Data Analyst",
    "Data Scientist",
    "Machine Learning Engineer",
    "AI Engineer",
    "Cloud Engineer",
    "System Administrator",
    "Network Engineer",
    "Cyber Security Analyst",

    // Management / Office
    "Project Manager",
    "Product Manager",
    "Operations Manager",
    "Team Lead",
    "Business Analyst",
    "HR Executive",
    "HR Manager",
    "Recruiter",
    "Office Administrator",

    // Non-IT / General
    "Accountant",
    "Finance Executive",
    "Sales Executive",
    "Marketing Executive",
    "Digital Marketing Specialist",
    "Customer Support Executive",
    "Technical Support Engineer",
    "Field Executive",
    "Supervisor",
    "Store Manager",
    "Warehouse Executive",

    // Fresher / Entry
    "Intern",
    "Trainee",
    "Graduate Engineer Trainee",
    "Apprentice",
  ];

  const filteredEducation = educationOptions.filter((e) =>
    e.toLowerCase().includes(eduSearch.toLowerCase()),
  );
  const filteredDepartments = departments.filter((d) =>
    (d.name || "").toLowerCase().includes(deptSearch.toLowerCase()),
  );
  const isStep1Valid =
    formData.name && /^\S+@\S+\.\S+$/.test(formData.email) && formData.phone;

  // 2. HYDRATION LOGIC (GET API)
  useEffect(() => {
   
    hydrateNode();
  }, [effectiveId]);

   const hydrateNode = async () => {
      setFetchingData(true);
      try {
        const response = await fetch(
          `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
        );
        if (!response.ok) throw new Error();
        const data = await response.json();

        if (data) {
          setExistingResume(data.resume_path || "");

          setExistingCertificates(
            Array.isArray(data.certificates) ? data.certificates : [],
          );

          const safeParse = (value) => {
            if (!value) return [];

            try {
              // Already array â†’ fix broken JSON pieces
              if (Array.isArray(value)) {
                const joined = value.join("");
                if (joined.startsWith("[")) {
                  return JSON.parse(joined);
                }
                return value;
              }

              // If string JSON
              if (typeof value === "string" && value.startsWith("[")) {
                return JSON.parse(value);
              }

              // If CSV string â†’ convert to array
              if (typeof value === "string") {
                return value
                  .split(",")
                  .map((s) => s.trim())
                  .filter(Boolean);
              }

              return [];
            } catch {
              return [];
            }
          };

          setFormData((prev) => ({
            ...prev,
            name: data.full_name || "",
            email: data.email || "",
            phone: data.phone || "",
            gender: data.gender || "",
            dob: data.dob || "",
            address: data.address || "",
            address2: data.address2 || "",
            location: data.location || "",
            pincode: data.pincode || "",
            city: data.city || "",
            state: data.state || "",
            district: data.district || "",
            country: data.country || "India",
            position: data.position || "",
            experience: data.experience || "",
           education: Array.isArray(data.educations) 
      ? data.educations.map(edu => ({
          id: edu.id,
          education_id: edu.education_id,
          institution_name: edu.institution_name,
          start_year: edu.start_year,
          end_year: edu.end_year,
          // Extract the name from education_master for the UI
          education_name: edu.education_master?.name || "Unknown Degree"
        }))
      : [],


            department: data.department || "",
            about_me: data.about_me || "",
            resume_link: data.resume_path || "",
            languages_spoken: safeParse(data.languages_spoken),
            experiences: data.experiences || [],
            skills: safeParse(data.skills),
            assets: safeParse(data.assets),
          }));

          setIsFresher(!data.experiences || data.experiences.length === 0);
        }

        const deptData = await departmentService.getAll();
        setDepartments(deptData || []);
        await fetchSkills();
        await fetchAssets(effectiveId);
      } catch (err) {
        console.warn("Initializing Empty Node");
      } finally {
        setFetchingData(false);
      }
    };

    const INDUSTRY_OPTIONS = [
  "Information Technology",
  "Software Development",
  "Banking & Finance",
  "Healthcare",
  "Education",
  "Manufacturing",
  "Retail",
  "Telecom",
  "Construction",
  "Logistics",
  "Marketing & Advertising",
  "HR / Recruitment",
  "Government",
  "Automobile",
  "Pharmaceutical",
  "E-Commerce",
  "Media & Entertainment",
  "Real Estate",
  "Hospitality",
  "Other",
];

  // Click Outside to close dropdowns
  useEffect(() => {
    const handleClickOutside = (event) => {
      if (
        dropdownContainerRef.current &&
        !dropdownContainerRef.current.contains(event.target)
      ) {
        setShowSkillDrop(false);
        setShowAssetDrop(false);
        setSkillFocused(false);
      }
    };
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);

  // READ STEP FROM URL (?step=3)
useEffect(() => {
  const stepFromUrl = Number(searchParams.get("step"));

  if (stepFromUrl && stepFromUrl >= 1 && stepFromUrl <= totalSteps) {
    setStep(stepFromUrl);
  }
}, [searchParams]);


  // 3. HANDLERS
  const fetchSkills = async () => {
    try {
      const res = await fetch(
        "https://apihrr.goelectronix.co.in/masters/skills",
      );
      const data = await res.json();
      setDynamicSkills(data.map((item) => item.name || item));
    } catch {}
  };

  const fetchAssets = async (cId) => {
    try {
      const res = await fetch(
        `https://apihrr.goelectronix.co.in/candidates/${cId}/assets`,
      );
      const data = await res.json();
      setDynamicAssets(Array.isArray(data) ? data.map((a) => a.name) : []);
    } catch {}
  };

  const handleManualAddSkill = async () => {
    const name = skillInput.trim();
    if (!name) {
      await fetchSkills();
      return;
    }
    const success = await handleCreateMaster("skills", name);
    if (success) {
      if (!formData.skills.includes(name))
        setFormData((p) => ({ ...p, skills: [...p.skills, name] }));
      setSkillInput("");
      await fetchSkills();
    }
  };

  const handleCreateMaster = async (type, name) => {
    try {
      const res = await fetch(
        `https://apihrr.goelectronix.co.in/masters/${type}`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name: name.trim() }),
        },
      );
      return res.ok;
    } catch {
      return false;
    }
  };

  const handleAddAssetAPI = async (assetName) => {
    if (!assetName.trim()) return;
    const loadingToast = toast.loading(`Linking asset...`);
    try {
      const res = await fetch(
        `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/assets`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name: assetName.trim() }),
        },
      );
      if (res.ok) {
        toast.success("Linked", { id: loadingToast });
        await fetchAssets(effectiveId);
        return true;
      }
    } catch {
      toast.error("Sync failed", { id: loadingToast });
    }
    return false;
  };

  const filteredIndustries = INDUSTRY_OPTIONS.filter((ind) =>
  ind.toLowerCase().includes(industrySearch.toLowerCase())
);

const handleSaveOrUpdateExperience = async (i) => {
  const exp = newExperiences[i];

  if (!exp.company_name || !exp.job_title || !exp.start_date || !exp.end_date) {
    toast.error("Company, Role, Start Date, End Date required");
    return;
  }

  const loadingToast = toast.loading(
    currentEditingIndex !== null ? "Updating experience..." : "Saving experience..."
  );

  try {
    const fd = new FormData();

    fd.append("company_name", exp.company_name);
    fd.append("job_title", exp.job_title);
    fd.append("start_date", exp.start_date);
    fd.append("end_date", exp.end_date);
    fd.append("previous_ctc", exp.previous_ctc || "");
    fd.append("location", exp.location || "");
    fd.append("description", exp.description || "");
    fd.append("industry", exp.industry || "");

    if (exp.uploadMode === "link") {
      fd.append("exp_letter_link", exp.exp_letter_link || "");
    } else if (exp.expLetterFile instanceof File) {
      fd.append("exp_letter_file", exp.expLetterFile);
    }

    // =========================
    // UPDATE (PATCH)
    // =========================
    if (currentEditingIndex !== null && exp.id) {
      const res = await fetch(
        `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/experiences/${exp.id}`,
        {
          method: "PUT",
          body: fd,
        }
      );

      if (!res.ok) throw new Error(await res.text());

      // Update UI instantly
      const updated = [...formData.experiences];
      updated[currentEditingIndex] = exp;

      setFormData((prev) => ({
        ...prev,
        experiences: updated,
      }));

      toast.success("Experience Updated âœ…", { id: loadingToast });
    }

    // =========================
    // ADD NEW (POST)
    // =========================
    else {
      const res = await fetch(
        `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/experiences`,
        {
          method: "POST",
          body: fd,
        }
      );

      if (!res.ok) throw new Error(await res.text());

      await hydrateNode(); // reload from backend

      toast.success("Experience Added âœ…", { id: loadingToast });
    }

    setNewExperiences([]);
    setCurrentEditingIndex(null);
    setShowExpModal(false);

  } catch (err) {
    console.error(err);
    toast.error("Failed âŒ", { id: loadingToast });
  }
};


// Fetch Master Education List
const fetchMasterEducations = async () => {
  try {
    const res = await fetch("https://apihrr.goelectronix.co.in/masters?types=educations&skip=0&limit=100");
    const data = await res.json();
    setMasterEducations(data.educations || []);
  } catch (err) { console.error("Master Load Error", err); }
};

// Save or Update Education
const handleSaveEducation = async () => {
  const loadingToast = toast.loading(isEditingEdu ? "Updating Node..." : "Syncing Education...");
  const url = isEditingEdu 
    ? `https://apihrr.goelectronix.co.in/education/${currentEduId}?user_type=candidate`
    : `https://apihrr.goelectronix.co.in/education/${effectiveId}?user_type=candidate`;

  try {
    const res = await fetch(url, {
      method: isEditingEdu ? "PATCH" : "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        education_id: newEdu.education_id,
        institution_name: newEdu.institution_name,
        start_year: newEdu.start_year,
        end_year: newEdu.end_year
      }),
    });

    if (res.ok) {
      toast.success("Education Node Synchronized", { id: loadingToast });
      setShowEduModal(false);
      // Logic to refresh your formData.education from GET API here
      // ðŸ”¥ REFRESH LOGIC: Trigger hydration to pull the updated 'educations' array
      await hydrateNode(); 
      
      // Reset Search state
      setEduSearch("");
    }
  } catch (err) { toast.error("Sync Failed", { id: loadingToast }); }
};

// const updateCertificate = async () => {
//   try {
//     const fd = new FormData();

//     fd.append("name", certForm.name);

//     if (certForm.uploadMode === "file" && certForm.certificate_file) {
//       fd.append("certificate_file", certForm.certificate_file);
//     }

//     if (certForm.uploadMode === "link" && certForm.certificate_link) {
//       fd.append("certificate_link", certForm.certificate_link);
//     }

//     await fetch(
//       `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/certificates/${editingCertificate.id}`,
//       {
//         method: "PUT",
//         body: fd,
//       }
//     );

//     toast.success("Certificate Updated");
//     setShowCertEditModal(false);
//     hydrateNode();

//   } catch (err) {
//     toast.error("Update failed");
//   }
// };

  const fetchPincodeDetails = async (pincode) => {
    if (!/^\d{6}$/.test(pincode)) return;

    setIsFetchingPincode(true);

    try {
      const res = await fetch(
        `https://api.postalpincode.in/pincode/${pincode}`,
      );
      const data = await res.json();

      if (data[0]?.Status === "Success" && data[0].PostOffice?.length > 0) {
        const postOffices = data[0].PostOffice;

        setCityOptions(postOffices); // â­ store full objects

        const first = postOffices[0];

        setFormData((prev) => ({
          ...prev,
          city: first.Name || "",
          district: first.District || "",
          state: first.State || "",
          country: first.Country || "India",
        }));
      } else {
        setCityOptions([]);
      }
    } catch (err) {
      console.error(err);
      setCityOptions([]);
    } finally {
      setIsFetchingPincode(false);
    }
  };

  // ---------- STEP VALIDATION ----------


  const STEP_FIELDS = {
  1: [
    "name",
    "email",
    "phone",
    "gender",
    "dob",
    "position",
    "experience",
    "education",
    "department",
    "about_me",
    "languages_spoken",
  ],

  2: [
    "address",
    "address2",
    "location",
    "pincode",
    "city",
    "district",
    "state",
    "country",
  ],

  // âœ… NEW EDUCATION STEP
  3: ["education"],

  // âœ… EXPERIENCE SHIFTED TO 4
  4: ["experiences"],

  // âœ… SKILLS & ASSETS SHIFTED TO 5
  5: ["skills", "assets"],

  // âœ… DOCUMENTS SHIFTED TO 6
  6: ["resume_link", "cvFile", "certificateFiles", "certificateLinks"],
};



// STEP 1 â†’ Personal
const isStep1Incomplete = () => {
  return !(
    formData.name &&
    formData.email &&
    formData.phone &&
    formData.gender &&
    formData.dob &&
    (formData.languages_spoken || []).length > 0 &&
    formData.about_me
  );
};

// STEP 2 â†’ Location
const isStep2Incomplete = () => {
  return !(
    formData.address &&
    formData.city &&
    formData.state &&
    formData.pincode
  );
};

// STEP 3 â†’ Education
const isStep3Incomplete = () => {
  return !(
    Array.isArray(formData.education) &&
    formData.education.length > 0
  );
};

// STEP 4 â†’ Experience
const isStep4Incomplete = () => {
  if (isFresher) return false; // Fresher doesn't require experience

  return !(
    Array.isArray(formData.experiences) &&
    formData.experiences.length > 0
  );
};

// STEP 5 â†’ Skills & Assets
const isStep5Incomplete = () => {
  return !(
    (formData.skills && formData.skills.length > 0) ||
    (formData.assets && formData.assets.length > 0)
  );
};

// STEP 6 â†’ Documents
const isStep6Incomplete = () => {
  return !(
    existingResume ||
    formData.cvFile ||
    (formData.certificateFiles && formData.certificateFiles.length > 0) ||
    (existingCertificates && existingCertificates.length > 0)
  );
};


  const fixResumeUrl = (url) => {
    if (!url) return "";

    // remove wrong https//
    let clean = url.replace(/^https\/\//, "");

    // if already full valid http/https â†’ keep it
    if (clean.startsWith("http://") || clean.startsWith("https://")) {
      return clean;
    }

    // attach correct base URL
    return `https://apihrr.goelectronix.co.in/${clean.replace(/^\/+/, "")}`;
  };

  const fixResumeUrl2 = (url) => {
    if (!url) return "";

    let clean = url.trim();

    // Fix broken https//
    clean = clean.replace(/^https\/\//, "https://");

    // ðŸ”´ If URL is https://uploads/... â†’ replace domain
    if (clean.startsWith("https://uploads")) {
      return clean.replace(
        "https://uploads",
        "https://apihrr.goelectronix.co.in/uploads",
      );
    }

    // Already full valid URL â†’ return
    if (clean.startsWith("http://") || clean.startsWith("https://")) {
      return clean;
    }

    // Remove starting slash
    clean = clean.replace(/^\/+/, "");

    // Attach backend base
    return `https://apihrr.goelectronix.co.in/${clean}`;
  };

  const hasExistingExperience =
    Array.isArray(formData.experiences) && formData.experiences.length > 0;


const saveStepData = async (stepNumber) => {
  try {
    const apiData = new FormData();
    const fields = STEP_FIELDS[stepNumber] || [];

    fields.forEach((key) => {

      // LANGUAGES
      if (key === "languages_spoken") {
        apiData.append(
          "languages_spoken",
          (formData.languages_spoken || []).join(",")
        );
      }

      // SKILLS / ASSETS
      else if (key === "skills" || key === "assets") {
        apiData.append(key, (formData[key] || []).join(","));
      }

      // EDUCATION (Step 3)
      else if (key === "education") {
        apiData.append(
          "education_details",
          JSON.stringify(formData.education || [])
        );
      }

      // EXPERIENCE (Step 4)
      else if (key === "experiences") {
        apiData.append(
          "experience_details",
          JSON.stringify(formData.experiences || [])
        );
      }

      // RESUME FILE
      else if (key === "cvFile" && formData.cvFile) {
        apiData.append("resumepdf", formData.cvFile);
      }

      // RESUME LINK
      else if (key === "resume_link" && formData.resume_link) {
        apiData.append("resume_link", formData.resume_link);
      }

      // CERTIFICATE FILES
      else if (key === "certificateFiles") {
        formData.certificateFiles.forEach((file) => {
          apiData.append("certificates", file);
        });
      }

      // DEFAULT
      else {
        apiData.append(key, formData[key] ?? "");
      }
    });

    // ===========================
    // FORCE CERTIFICATES FOR STEP 6 (Documents)
    // ===========================
    // if (stepNumber === 6) {
    //   // FILES
    //   formData.certificateFiles.forEach((file) => {
    //     apiData.append("certificates", file);
    //   });

    //   // LINKS
    //   formData.certificateLinks
    //     .filter((link) => link && link.trim())
    //     .forEach((link) => {
    //       apiData.append("certificate_links", link);
    //     });
    // }

    // Inside saveStepData(stepNumber)...
if (stepNumber === 6) {
  // Master Resume logic
  if (formData.cvFile) {
    apiData.append("resumepdf", formData.cvFile);
  } else if (formData.resume_link) {
    apiData.append("resume_link", formData.resume_link);
  }

  // CERTIFICATE FILES PAIRING
  formData.certificateFiles.forEach((file, idx) => {
    apiData.append("certificate_files", file); // Binary
    apiData.append("certificate_names", formData.certificateNames[idx]); // Metadata name
  });

  // CERTIFICATE LINKS PAIRING
  formData.certificateLinks.filter(l => l && l.trim()).forEach((link, idx) => {
    apiData.append("certificate_links", link); // String
    apiData.append("certificate_link_names", formData.certificateLinkNames[idx]); // Metadata name
  });
}

    apiData.append("full_name", formData.name || "");

    await fetch(
      `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
      {
        method: "PATCH",
        body: apiData,
      }
    );

    // ðŸ”¥ CLEAR CERTIFICATES AFTER DOCUMENT SAVE
    if (stepNumber === 6) {
      setFormData((prev) => ({
        ...prev,
        certificateFiles: [],
        certificateLinks: [""],
      }));
    }

    toast.success(`Step ${stepNumber} saved`);
  } catch (err) {
    console.error(err);
    toast.error("Auto save failed");
  }
};

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);

    const loadingToast = toast.loading("Executing Final PATCH Sync...");

    try {
      const apiData = new FormData();

      // ðŸ”¹ Append ALL simple fields (NO skipping empty)
      for (const key in formData) {
        if (
          ![
            "experiences",
            "certificateFiles",
            "languages_spoken",
            "cvFile",
            "skills",
            "assets",
          ].includes(key)
        ) {
          apiData.append(key, formData[key] ?? "");
        }
      }

      // ðŸ”¹ Required backend fields
      apiData.append("full_name", formData.name || "");

      apiData.append(
        "languages_spoken",
        (formData.languages_spoken || []).join(","),
      );

      apiData.append("skills", (formData.skills || []).join(","));
      apiData.append("assets", (formData.assets || []).join(","));

      // CASE 1: Upload PDF
      if (formData.cvFile) {
        apiData.append("resumepdf", formData.cvFile); // âœ… correct key
      }

      // CASE 2: Resume Link
      else if (formData.resume_link) {
        apiData.append("resume_link", formData.resume_link); // âœ… correct key
      }

      // CASE 3: Keep existing resume (no change)
      else if (existingResume) {
        apiData.append("resume_link", existingResume);
      }

      // ðŸ”¹ Certificates FILES
      formData.certificateFiles.forEach((file) => {
        apiData.append("certificates", file);
      });

      // ðŸ”¹ Certificate LINKS
      apiData.append(
        "certificate_links",
        JSON.stringify(formData.certificateLinks.filter((l) => l && l.trim())),
      );

      // ðŸ”¹ Debug â€” SEE WHAT GOES TO API
      for (let pair of apiData.entries()) {
        console.log(pair[0], pair[1]);
      }

      const response = await fetch(
        `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
        {
          method: "PATCH",
          body: apiData,
        },
      );

      if (!response.ok) {
        const err = await response.text();
        console.error(err);
        throw new Error("API Failed");
      }

      toast.success("Candidate Synchronized ðŸŽ‰", { id: loadingToast });
    } catch (err) {
      console.error(err);
      toast.error("Commit failed âŒ", { id: loadingToast });
    } finally {
      setLoading(false);
    }
  };


// --- ADD NEW CERTIFICATE (PATCH Candidate) ---
// const handleAddCertificate = async () => {
//   if (!certForm.name.trim()) return toast.error("Artifact Label is compulsory");
  
//   const loadingToast = toast.loading("Deploying new credential node...");
//   try {
//     const fd = new FormData();
    
//     // âœ… 1. Send the Name
//     fd.append("name", certForm.name);
    
//     if (certForm.uploadMode === "file") {
//       if (!certForm.certificate_file) {
//         toast.error("Please select a PDF file");
//         toast.dismiss(loadingToast);
//         return;
//       }
//       // âœ… 2. Send the File (using 'certificates' key as per your previous setup)
//       // fd.append("certificates", certForm.certificate_file);
//       fd.append("certificate_file", certForm.certificate_file);

//     } else {
//       if (!certForm.certificate_link) {
//         toast.error("Please enter a URI link");
//         toast.dismiss(loadingToast);
//         return;
//       }
//       // âœ… 3. Send the Link as a simple string, NOT a JSON array with escaped brackets
//       fd.append("certificate_links", certForm.certificate_link.trim());
//     }

//     const res = await fetch(`https://apihrr.goelectronix.co.in/candidates/${effectiveId}`, {
//       method: "PATCH",
//       body: fd,
//     });

//     if (res.ok) {
//       toast.success("Credential Synchronized", { id: loadingToast });
//       setShowCertEditModal(false);
//       hydrateNode(); 
//     } else {
//       throw new Error("Add Failed");
//     }
//   } catch (err) {
//     toast.error("Deployment failed", { id: loadingToast });
//   }
// };

// --- ADD NEW CERTIFICATE (Local State Update) ---
const handleAddCertificate = () => {
  if (!certForm.name.trim()) return toast.error("Artifact Label is compulsory");
  
  if (certForm.uploadMode === "file" && !certForm.certificate_file) {
    return toast.error("Please select a PDF file");
  }
  if (certForm.uploadMode === "link" && !certForm.certificate_link) {
    return toast.error("Please enter a URI link");
  }

  // Update formData so it shows in the list on the background
  if (certForm.uploadMode === "file") {
    setFormData(prev => ({
      ...prev,
      certificateFiles: [...prev.certificateFiles, certForm.certificate_file],
      // Store the name associated with this file for Step 6 API pairing
      certificateNames: [...(prev.certificateNames || []), certForm.name]
    }));
  } else {
    setFormData(prev => ({
      ...prev,
      certificateLinks: [...prev.certificateLinks, certForm.certificate_link],
      certificateLinkNames: [...(prev.certificateLinkNames || []), certForm.name]
    }));
  }

  toast.success("Artifact added to pending queue");
  setShowCertEditModal(false);
};

// --- UPDATE EXISTING CERTIFICATE (Direct PUT) ---
const updateCertificate = async () => {
  if (!certForm.name.trim()) return toast.error("Artifact Label is compulsory");

  const loadingToast = toast.loading("Updating Node Artifact...");
  try {
    const fd = new FormData();
    fd.append("name", certForm.name.trim());

    if (certForm.uploadMode === "file" && certForm.certificate_file) {
      fd.append("certificate_file", certForm.certificate_file);
    } else if (certForm.uploadMode === "link" && certForm.certificate_link) {
      fd.append("certificate_link", certForm.certificate_link.trim());
    }

    const res = await fetch(
      `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/certificates/${editingCertificate.id}`,
      { method: "PUT", body: fd }
    );

    if (res.ok) {
      toast.success("Artifact Updated âœ…", { id: loadingToast });
      setShowCertEditModal(false);
      hydrateNode(); 
    }
  } catch (err) {
    toast.error("Sync Error", { id: loadingToast });
  }
};

// --- UPDATE EXISTING CERTIFICATE (PUT Certificate) ---
// const updateCertificate = async () => {
//   if (!certForm.name.trim()) return toast.error("Artifact Label is compulsory");

//   const loadingToast = toast.loading("Updating Node Artifact...");
//   try {
//     const fd = new FormData();
    
//     // âœ… 1. Send the Name
//     fd.append("certificate_names", certForm.name);

//     if (certForm.uploadMode === "file") {
//       if (certForm.certificate_file) {
//         // âœ… 2. Send the new File
//         fd.append("certificate_files", certForm.certificate_file);
//       }
//     } else {
//       // âœ… 3. Send the Link as a simple string
//       fd.append("certificate_link", certForm.certificate_link.trim());
//     }

//     const res = await fetch(
//       `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/certificates/${editingCertificate.id}`,
//       {
//         method: "PUT",
//         body: fd,
//       }
//     );

//     if (res.ok) {
//       toast.success("Artifact Updated âœ…", { id: loadingToast });
//       setShowCertEditModal(false);
//       hydrateNode(); 
//     } else {
//       throw new Error("Update Failed");
//     }
//   } catch (err) {
//     toast.error("Sync Error", { id: loadingToast });
//   }
// };

  const numberToIndianWords = (num) => {
    if (!num || isNaN(num)) return "";

    const ones = [
      "",
      "One",
      "Two",
      "Three",
      "Four",
      "Five",
      "Six",
      "Seven",
      "Eight",
      "Nine",
      "Ten",
      "Eleven",
      "Twelve",
      "Thirteen",
      "Fourteen",
      "Fifteen",
      "Sixteen",
      "Seventeen",
      "Eighteen",
      "Nineteen",
    ];

    const tens = [
      "",
      "",
      "Twenty",
      "Thirty",
      "Forty",
      "Fifty",
      "Sixty",
      "Seventy",
      "Eighty",
      "Ninety",
    ];

    const twoDigits = (n) =>
      n < 20
        ? ones[n]
        : tens[Math.floor(n / 10)] + (n % 10 ? " " + ones[n % 10] : "");

    const threeDigits = (n) => {
      if (n === 0) return "";
      if (n < 100) return twoDigits(n);
      return (
        ones[Math.floor(n / 100)] +
        " Hundred" +
        (n % 100 ? " " + twoDigits(n % 100) : "")
      );
    };

    const crore = Math.floor(num / 10000000);
    const lakh = Math.floor((num % 10000000) / 100000);
    const thousand = Math.floor((num % 100000) / 1000);
    const hundred = num % 1000;

    let result = "";

    if (crore) result += twoDigits(crore) + " Crore ";
    if (lakh) result += twoDigits(lakh) + " Lakh ";
    if (thousand) result += twoDigits(thousand) + " Thousand ";
    if (hundred) result += threeDigits(hundred);

    return result.trim() + " per annum";
  };

  const today = new Date();

  // 18 years ago (max allowed DOB)
  const maxDate = new Date(
    today.getFullYear() - 18,
    today.getMonth(),
    today.getDate(),
  )
    .toISOString()
    .split("T")[0];

  // 70 years ago (min allowed DOB)
  const minDate = new Date(
    today.getFullYear() - 70,
    today.getMonth(),
    today.getDate(),
  )
    .toISOString()
    .split("T")[0];

  const [dobError, setDobError] = useState("");

  const handleDobChange = (value) => {
    setFormData({ ...formData, dob: value });

    if (!value) {
      setDobError("Date of Birth is required");
      return;
    }

    const selected = new Date(value);

    if (selected > new Date(maxDate)) {
      setDobError("Age must be at least 18 years");
    } else if (selected < new Date(minDate)) {
      setDobError("Age must be below 70 years");
    } else {
      setDobError("");
    }
  };

  

  if (fetchingData)
    return (
      <div className="min-h-screen flex flex-col items-center justify-center bg-slate-50 gap-4">
        <Loader2 className="h-10 w-10 animate-spin text-blue-600" />
        <p className="text-[11px] font-black uppercase tracking-[0.2em] text-slate-400">
          Loading Data Load {effectiveId}...
        </p>
      </div>
    );

  return (
    <div className="min-h-screen bg-[#F8FAFC] p-4 md:p-12 antialiased">
      <div className="max-w-6xl mx-auto space-y-8" ref={dropdownContainerRef}>
        {/* ROADMAP HEADER */}
        <div className="flex flex-col lg:flex-row justify-between items-center bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 gap-8">
          <div className="flex items-center gap-6">
            <div className="h-16 w-16 bg-slate-900 rounded-[1.5rem] flex items-center justify-center text-white shadow-2xl">
              <Database size={32} />
            </div>
            <div>
              <h2 className="text-2xl font-black text-slate-900 tracking-tight leading-none">
                {id ? "Profile" : "Manual Registry"}
              </h2>
              <div className="flex items-center gap-2 mt-1 text-blue-600">
                <ShieldCheck size={14} />
              </div>
            </div>
          </div>

          <div className="flex-1 max-w-2xl w-full px-4">
            <div className="relative flex justify-between items-center w-full">
              <div className="absolute top-1/2 left-0 w-full h-0.5 bg-slate-100 -translate-y-1/2 z-0" />
              <div
                className="absolute top-1/2 left-0 h-0.5 bg-blue-600 -translate-y-1/2 z-0 transition-all duration-700"
                style={{ width: `${((step - 1) / (totalSteps - 1)) * 100}%` }}
              />
              {/* {[1, 2, 3, 4, 5].map((num) => ( */}
              {[1, 2, 3, 4, 5, 6].map((num) => (
                <div
                  key={num}
                  className="relative z-10 flex flex-col items-center gap-2"
                >
                 
                  <div
  className={`h-8 w-8 rounded-full flex items-center justify-center text-[10px] font-black transition-all border-4
  ${
    step === num
      ? "bg-blue-600 text-white border-blue-100 scale-110 shadow-lg"
      : step > num
      ? "bg-emerald-500 text-white border-emerald-50"
      : (
          (num === 1 && isStep1Incomplete()) ||
          (num === 2 && isStep2Incomplete()) ||
          (num === 3 && isStep3Incomplete()) ||
          (num === 4 && isStep4Incomplete()) ||
          (num === 5 && isStep5Incomplete())
        )
      ? "bg-yellow-400 text-white border-yellow-100"
      : "bg-white text-slate-300 border-slate-50"
  }`}
>
  {step > num ? <Check size={14} strokeWidth={4} /> : num}
</div>

                  <span
                    className={`absolute -bottom-6 text-[8px] font-black uppercase tracking-tighter transition-colors duration-300 ${step === num ? "text-blue-600" : "text-slate-300"}`}
                  >
                    {/* {num === 1 && "Personal"} {num === 2 && "Location"}{" "}
                    {num === 3 && "Experience"} {num === 4 && "Assets & skill"}{" "}
                    {num === 5 && "Documents"} */}
                    {num === 1 && "Personal"}
{num === 2 && "Location"}
{num === 3 && "Education"}    
{num === 4 && "Experience"}
{num === 5 && "Assets & Skill"}
{num === 6 && "Documents"}

                  </span>
                </div>
              ))}
            </div>
          </div>
          <div className="bg-slate-50 border border-slate-200 rounded-2xl px-6 py-3 flex items-center gap-3 shadow-inner">
            <div className="text-right">
              <p className="text-[8px] font-black text-slate-400 uppercase leading-none">
                Status
              </p>
              <p className="text-sm font-black text-slate-900 mt-1">
                {Math.round((step / totalSteps) * 100)}%
              </p>
            </div>
            <div className="h-8 w-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center">
              <Check size={18} />
            </div>
          </div>
        </div>

        <form onSubmit={handleSubmit}>
          <div className="space-y-12">
            {/* STEP 1: IDENTITY & CAREER */}
            {step === 1 && (
              <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8 duration-500">
                <div className="flex items-center gap-4 pb-4 border-b border-slate-100">
                  <User size={18} className="text-blue-600" />
                  <h3 className="text-sm font-black text-slate-800 uppercase tracking-widest">
                    Basic Candidate profile
                  </h3>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                  <FormField label="Full Name" required>
                    <input
                      placeholder="Legal Name"
                      value={formData.name}
                      onChange={(e) =>
                        setFormData({ ...formData, name: e.target.value })
                      }
                      className={inputStyle}
                    />
                  </FormField>
                  <FormField label="Email" required>
                    <input
                      type="email"
                      placeholder="name@domain.com"
                      value={formData.email}
                      onChange={(e) =>
                        setFormData({ ...formData, email: e.target.value })
                      }
                      className={inputStyle}
                    />
                  </FormField>
                  <FormField label="Phone" required>
                    <div className="flex items-center bg-slate-50 border border-slate-200 rounded-xl overflow-hidden focus-within:bg-white focus-within:border-blue-500 transition-all shadow-sm">
                      <span className="px-3 text-[11px] font-black text-slate-400">
                        +91
                      </span>
                      <input
                        maxLength={10}
                        value={formData.phone}
                        onChange={(e) =>
                          setFormData({ ...formData, phone: e.target.value })
                        }
                        className="w-full px-3 py-2 bg-transparent text-[13px] font-bold outline-none"
                      />
                    </div>
                  </FormField>
                  <FormField label="Gender">
                    <select
                      value={formData.gender}
                      onChange={(e) =>
                        setFormData({ ...formData, gender: e.target.value })
                      }
                      className={inputStyle}
                    >
                      <option value="">Select</option>
                      <option value="male">Male</option>
                      <option value="female">Female</option>
                      <option value="transgender">Transgender</option>
                      <option value="prefer_not_to_say">
                        Prefer not to say
                      </option>
                    </select>
                  </FormField>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-8 pt-4">
                  <FormField label="Date of Birth">
                    <input
                      type="date"
                      min={minDate}
                      max={maxDate}
                      value={formData.dob}
                      onChange={(e) =>
                        setFormData({ ...formData, dob: e.target.value })
                      }
                      className={inputStyle}
                    />
                  </FormField>
                  <FormField label="Languages">
                    <div className="bg-slate-50 border border-slate-200 rounded-xl p-3 max-h-32 overflow-y-auto grid grid-cols-2 gap-3 shadow-inner">
                      {[
                        "English",
                        "Hindi",
                        "Marathi",
                        "Gujarati",
                        "Tamil",
                        "Telugu",
                      ].map((lang) => (
                        <label
                          key={lang}
                          className="flex items-center gap-2 text-[11px] font-medium text-slate-600 cursor-pointer hover:text-blue-600 transition-colors"
                        >
                          <input
                            type="checkbox"
                            checked={formData.languages_spoken.includes(lang)}
                            onChange={() => {
                              const u = formData.languages_spoken.includes(lang)
                                ? formData.languages_spoken.filter(
                                    (l) => l !== lang,
                                  )
                                : [...formData.languages_spoken, lang];
                              setFormData({ ...formData, languages_spoken: u });
                            }}
                            className="w-3.5 h-3.5 accent-blue-600 rounded"
                          />{" "}
                          {lang}
                        </label>
                      ))}
                    </div>
                  </FormField>
                </div>
                <FormField label="Bio Summary">
                  <textarea
                    rows={3}
                    value={formData.about_me}
                    onChange={(e) =>
                      setFormData({ ...formData, about_me: e.target.value })
                    }
                    className={inputStyle + " resize-none"}
                  />
                </FormField>
                <div className="flex justify-end pt-4">
                  <button
                    type="button"
                    // onClick={() => setStep(2)}
                    onClick={async () => {
                      await saveStepData(1);
                      setStep(2);
                    }}
                    className={`px-12 py-3 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest shadow-xl active:scale-95 transition-all`}
                  >
                    Next Phase â†’
                  </button>
                </div>
              </div>
            )}

            {/* STEP 2: GEOGRAPHY */}
            {step === 2 && (
              <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8">
                <div className="flex items-center gap-3 pb-4 border-b border-slate-100">
                  <MapPin size={18} className="text-blue-600" />
                  <h3 className="text-xs font-black text-slate-800 uppercase tracking-widest">
                    location Data
                  </h3>
                </div>
                <div className="space-y-8">
                  <FormField label="Address 1" required>
                    <input
                      value={formData.address}
                      onChange={(e) =>
                        setFormData({ ...formData, address: e.target.value })
                      }
                      className={inputStyle}
                    />
                  </FormField>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
                    <FormField label="Address 2" required>
                      <input
                        value={formData.location}
                        onChange={(e) =>
                          setFormData({ ...formData, location: e.target.value })
                        }
                        className={inputStyle}
                      />
                    </FormField>
                    <FormField label="Pincode" required>
                      <input
                        maxLength={6}
                        placeholder="000000"
                        value={formData.pincode}
                        onChange={(e) => {
                          setFormData({ ...formData, pincode: e.target.value });
                          if (e.target.value.length === 6)
                            fetchPincodeDetails(e.target.value);
                        }}
                        className={inputStyle}
                      />
                    </FormField>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
                    
                    <FormField label="City">
                      {isFetchingPincode ? (
                        <input
                          value="Fetching..."
                          readOnly
                          className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-400 shadow-inner"
                        />
                      ) : cityOptions.length > 1 ? (
                        <select
                          value={formData.city}
                          onChange={(e) => {
                            const selected = cityOptions.find(
                              (c) => c.Name === e.target.value,
                            );

                            setFormData((prev) => ({
                              ...prev,
                              city: selected?.Name || "",
                              district: selected?.District || "",
                              state: selected?.State || "",
                              country: selected?.Country || "India",
                            }));
                          }}
                          className="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl text-xs font-bold text-slate-700 shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100"
                        >
                          {cityOptions.map((c, i) => (
                            <option key={i} value={c.Name}>
                              {c.Name}
                            </option>
                          ))}
                        </select>
                      ) : (
                        <input
                          value={formData.city || ""}
                          readOnly
                          className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
                        />
                      )}
                    </FormField>

                    <FormField label="District">
                      <input
                        // value={formData.district}
                        value={
                          isFetchingPincode ? "Fetching..." : formData.district
                        }
                        readOnly
                        className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
                      />
                    </FormField>
                    <FormField label="State">
                      <input
                        // value={formData.state}
                        value={
                          isFetchingPincode ? "Fetching..." : formData.state
                        }
                        readOnly
                        className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
                      />
                    </FormField>
                    <FormField label="Country">
                      <input
                        value={
                          isFetchingPincode ? "Fetching..." : formData.country
                        }
                        readOnly
                        onChange={(e) =>
                          setFormData({ ...formData, country: e.target.value })
                        }
                        className={inputStyle}
                      />
                    </FormField>
                  </div>
                </div>
                <div className="flex justify-between pt-8 border-t border-slate-50">
                  <button
                    onClick={() => setStep(1)}
                    type="button"
                    className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase hover:text-slate-900 transition-all shadow-sm"
                  >
                    â† Back
                  </button>
                  <button
                    //  onClick={() => setStep(3)}
                    onClick={async () => {
                      await saveStepData(2);
                      setStep(3);
                    }}
                    type="button"
                    className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase shadow-xl transition-all"
                  >
                    Continue â†’
                  </button>
                </div>
              </div>
            )}


            {/* STEP 3: EDUCATION */}


{step === 3 && (
  <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
    <div className="bg-white p-8 rounded-[3.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 space-y-10 relative overflow-hidden">
      <div className="flex flex-col sm:flex-row justify-between items-center border-b border-slate-50 pb-8 relative z-10">
        <div className="flex items-center gap-4">
          <div className="h-10 w-10 rounded-xl bg-slate-900 flex items-center justify-center text-white shadow-lg">
            <Award size={20} />
          </div>
          <h3 className="text-sm font-black text-slate-900 uppercase tracking-widest">Education Registry</h3>
        </div>
        <button
          type="button"
          onClick={() => {
            setIsEditingEdu(false);
            setNewEdu({ education_id: 0, institution_name: "", start_year: "", end_year: "", education_name: "" });
            fetchMasterEducations();
            setShowEduModal(true);
          }}
          className="px-6 py-3 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl shadow-blue-200 hover:bg-blue-700 transition-all flex items-center gap-2"
        >
          <Plus size={14} strokeWidth={3} /> Add Education
        </button>
      </div>

{/* VERIFIED EDUCATION LIST */}
<div className="space-y-4 relative z-10">
  {formData.education && formData.education.length > 0 ? (
    formData.education.map((edu, i) => (
      <div key={i} className="group relative flex flex-col md:flex-row items-center gap-6 p-6 bg-slate-50/50 border border-slate-100 rounded-[2rem] hover:bg-white  transition-all border-l-4 border-l-blue-600">
        
        {/* Node Index */}
        <div className="w-12 h-12 flex-shrink-0 bg-white border border-slate-200 rounded-xl flex items-center justify-center text-[11px] font-black text-slate-900 shadow-sm">
          0{i + 1}
        </div>

        {/* Content Node */}
        <div className="flex-1 min-w-0">
          <div className="flex items-center gap-3 mb-1">
            <h4 className="text-sm font-black text-slate-900 uppercase tracking-tight truncate">
              {edu.institution_name}
            </h4>
            <span className="h-1 w-1 rounded-full bg-slate-300" />
            <div className="px-2 py-0.5 bg-blue-50 text-blue-700 rounded-md text-[9px] font-black uppercase tracking-widest border border-blue-100/50">
              {edu.education_name} {/* Displays "Btech", "HSC", etc. */}
            </div>
          </div>
          
          <div className="flex items-center gap-4 text-slate-400">
            <div className="flex items-center gap-1.5">
              <Calendar size={12} className="text-slate-300" />
              <span className="text-[10px] font-black uppercase tracking-widest">
                {edu.start_year} <span className="text-slate-200 mx-1">â€”</span> {edu.end_year}
              </span>
            </div>
          </div>
        </div>

        {/* Action Node */}
        <button 
          type="button" 
          onClick={() => {
            setIsEditingEdu(true);
            setCurrentEduId(edu.id);
            // Pre-fill modal
            setNewEdu({
              education_id: edu.education_id,
              institution_name: edu.institution_name,
              start_year: edu.start_year,
              end_year: edu.end_year,
              education_name: edu.education_name
            });
            setEduSearch(edu.education_name);
            setShowEduModal(true);
          }}
          className="p-3 bg-white border border-slate-200 rounded-xl text-slate-400 hover:text-blue-600 hover:border-blue-600 transition-all shadow-sm active:scale-90"
        >
          <Edit3 size={16} />
        </button>
      </div>
    ))
  ) : (
    <div className="text-center py-16 bg-slate-50/30 border-2 border-dashed border-slate-100 rounded-[2.5rem]">
      <Database className="mx-auto text-slate-200 mb-4" size={32} />
      <p className="text-[10px] font-black text-slate-300 uppercase tracking-[0.2em]">Zero Academic Nodes Registered</p>
    </div>
  )}
</div>
    </div>

    {/* NAVIGATION */}
    <div className="flex justify-between pt-6">
      <button type="button" onClick={() => setStep(2)} className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[10px] font-black uppercase shadow-sm">â† Back</button>
      <button
        type="button"
        onClick={async () => { await saveStepData(3); setStep(4); }}
        className="px-12 py-4 rounded-2xl text-[10px] font-black uppercase shadow-xl bg-blue-600 text-white shadow-blue-200 hover:bg-blue-700"
      >Commit & Continue â†’</button>
    </div>

    {/* EDUCATION MODAL */}
  {/* 2. Updated Modal Content */}
{showEduModal && (
  <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 md:p-8 bg-slate-900/60 backdrop-blur-md animate-in fade-in duration-300">
    <div className="bg-white w-full max-w-4xl rounded-[3rem] shadow-2xl border border-slate-200 flex flex-col overflow-hidden animate-in zoom-in-95">
      
      {/* Modal Header */}
      <div className="px-10 py-8 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
        <div className="flex items-center gap-4">
          <div className="w-14 h-14 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-2xl shadow-blue-200">
            <Award size={28} strokeWidth={2.5} />
          </div>
          <div>
            <h2 className="text-base font-black text-slate-900 uppercase tracking-[0.2em]">Education Terminal</h2>
            <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Authorized Academic Entry</p>
          </div>
        </div>
        <button onClick={() => { setShowEduModal(false); setEduDropdownOpen(false); }} className="w-12 h-12 flex items-center justify-center bg-white border border-slate-100 hover:bg-red-50 hover:text-red-500 rounded-full transition-all shadow-sm">
          <X size={24} />
        </button>
      </div>

      <div className="p-10 space-y-8 bg-white overflow-visible">
        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 overflow-visible">
          
          {/* SEARCHABLE DROPDOWN */}
          <div className="space-y-2 relative" ref={dropdownContainerRef}>
            <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1 leading-none">
              Degree Specification
            </label>
            <div className="relative group">
              <input 
                placeholder="Search node (HSC, Btech, SSC...)" 
                value={eduSearch} 
                onFocus={() => {
                  setEduDropdownOpen(true);
                  if (masterEducations.length === 0) fetchMasterEducations();
                }}
                onChange={(e) => {
                  setEduSearch(e.target.value);
                  setEduDropdownOpen(true);
                }}
                className={inputStyle + " pr-10 focus:border-blue-600 transition-all"} 
              />
              <div className="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400">
                {fetchingData ? <Loader2 size={16} className="animate-spin" /> : <ChevronDown size={16} />}
              </div>
            </div>

            {/* Dropdown Result Panel */}
            {eduDropdownOpen && (
              <div className="absolute z-[110] w-full mt-2 bg-white border border-slate-200 rounded-2xl shadow-2xl overflow-hidden animate-in fade-in slide-in-from-top-2">
                <div className="max-h-[220px] overflow-y-auto custom-scrollbar-professional p-2 space-y-1 bg-white">
                  {masterEducations.filter(m => 
                    (m.name || "").toLowerCase().includes(eduSearch.toLowerCase())
                  ).length > 0 ? (
                    masterEducations
                      .filter(m => (m.name || "").toLowerCase().includes(eduSearch.toLowerCase()))
                      .slice(0, 20)
                      .map((m) => (
                        <button
                          key={m.id}
                          type="button"
                          onClick={() => {
                            setNewEdu({ ...newEdu, education_id: m.id, education_name: m.name });
                            setEduSearch(m.name);
                            setEduDropdownOpen(false);
                          }}
                          className={`w-full text-left px-4 py-3 rounded-xl text-xs font-bold transition-all flex items-center justify-between group/item ${
                            newEdu.education_id === m.id 
                              ? "bg-blue-600 text-white" 
                              : "text-slate-700 hover:bg-slate-50 hover:text-blue-600"
                          }`}
                        >
                          <span className="uppercase tracking-tight">{m.name}</span>
                          {newEdu.education_id === m.id ? (
                            <CheckCircle size={14} className="text-white" />
                          ) : (
                            <ChevronRight size={14} className="opacity-0 group-hover/item:opacity-100 transition-opacity" />
                          )}
                        </button>
                      ))
                  ) : (
                    <div className="py-8 text-center bg-slate-50/50 rounded-xl">
                       <p className="text-[10px] font-black text-slate-300 uppercase tracking-widest">No matching degree nodes</p>
                    </div>
                  )}
                </div>
              </div>
            )}
          </div>

          <FormField label="Institution Name">
            <input 
              placeholder="e.g. Mumbai University" 
              value={newEdu.institution_name} 
              onChange={(e) => setNewEdu({ ...newEdu, institution_name: e.target.value })} 
              className={inputStyle} 
            />
          </FormField>
        </div>

        <div className="grid grid-cols-2 gap-8">
  {/* START YEAR NODE */}
  <FormField label="Commencement Year">
    <div className="relative group">
      <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-600 transition-colors">
        <Calendar size={16} />
      </div>
      <input 
        type="number" 
        placeholder="YYYY" 
        min="1970"
        max="2030"
        value={newEdu.start_year} 
        onChange={(e) => setNewEdu({ ...newEdu, start_year: e.target.value })} 
        className={inputStyle + " pl-12 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"} 
      />
    </div>
  </FormField>

  {/* END YEAR NODE */}
  <FormField label="Completion Year">
    <div className="relative group">
      <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-600 transition-colors">
        <Calendar size={16} />
      </div>
      <input 
        type="number" 
        placeholder="YYYY" 
        min="1970"
        max="2030"
        value={newEdu.end_year} 
        onChange={(e) => setNewEdu({ ...newEdu, end_year: e.target.value })} 
        className={inputStyle + " pl-12 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"} 
      />
    </div>
  </FormField>
</div>

        <div className="flex justify-end pt-6 border-t border-slate-100">
          <button
            type="button"
            onClick={handleSaveEducation}
            className="px-10 py-4 bg-slate-900 text-white rounded-2xl text-[11px] font-black uppercase tracking-widest shadow-2xl active:scale-95 transition-all flex items-center gap-3 hover:bg-slate-800"
          >
            <CheckCircle size={18} /> {isEditingEdu ? "Commit Update" : "Synchronize Node"}
          </button>
        </div>
      </div>
    </div>
  </div>
)}
  </div>
)}


            {/* STEP 4: EXPERIENCE */}
           

{step === 4 && (
  <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
    {/* STATUS SELECTOR CARD */}
    <div className="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-sm overflow-hidden relative group">
      <Fingerprint className="absolute -right-6 -bottom-6 text-slate-50 opacity-[0.4] -rotate-12 pointer-events-none" size={100} />
      <div className="flex flex-col md:flex-row items-center justify-between gap-6 relative z-10">
        <div className="flex items-center gap-4 text-slate-900 font-black">
          <div className="w-12 h-12 bg-blue-50 rounded-2xl flex items-center justify-center text-blue-600 shadow-inner">
            <Briefcase size={22} strokeWidth={2.5} />
          </div>
          <div>
            <h3 className="text-sm uppercase tracking-[0.15em]">Are you Fresher?</h3>
            <p className="text-[10px] font-bold text-slate-400 mt-1 uppercase tracking-widest">Career status determines validation protocol</p>
          </div>
        </div>
        <div className="flex bg-slate-100 p-1.5 rounded-[1.5rem] border border-slate-200 w-full md:w-auto">
          <button
            type="button"
            disabled={hasExistingExperience}
            onClick={() => {
              if (hasExistingExperience) return;
              setIsFresher(true);
              setFormData({ ...formData, experiences: [] });
            }}
            className={`px-10 py-3 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === true ? "bg-white text-blue-600 shadow-sm border border-slate-200" : "text-slate-400"}`}
          >YES</button>
          <button
            type="button"
            onClick={() => setIsFresher(false)}
            className={`px-10 py-3 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === false ? "bg-white text-blue-600 shadow-sm border border-slate-200" : "text-slate-400"}`}
          >NO</button>
        </div>
      </div>
    </div>

    {/* EXPERIENCE TIMELINE DISPLAY */}
    {isFresher === false && (
      <div className="bg-white p-8 rounded-[3.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 space-y-10 relative overflow-hidden">
        <div className="flex flex-col sm:flex-row justify-between items-center border-b border-slate-50 pb-8 relative z-10">
          <div className="flex items-center gap-4">
            <div className="h-10 w-10 rounded-xl bg-slate-900 flex items-center justify-center text-white shadow-lg">
              <History size={20} />
            </div>
            <h3 className="text-sm font-black text-slate-900 uppercase tracking-widest">Job Experience History</h3>
          </div>
          <button
            type="button"
            onClick={() => {
              if (newExperiences.length === 0) {
                setNewExperiences([{ company_name: "", job_title: "", start_date: "", end_date: "", previous_ctc: "", location: "", description: "" }]);
              }
              setShowExpModal(true);
            }}
            className="px-6 py-3 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl shadow-blue-200 hover:bg-blue-700 active:scale-95 transition-all flex items-center gap-2"
          >
            <Plus size={14} strokeWidth={3} /> Add Experience
          </button>
        </div>

        {/* VERIFIED DATA LIST (Shows existing records from formData) */}
      
        <div className="space-y-4 relative z-10 animate-in fade-in slide-in-from-bottom-4 duration-700">
  {formData.experiences && formData.experiences.length > 0 ? (
    formData.experiences.map((exp, i) => (
      <div 
        key={i} 
        className="group relative flex flex-col md:flex-row items-stretch gap-0 bg-white border border-slate-200 rounded-[1.5rem] hover:border-blue-400 hover:shadow-xl hover:shadow-blue-500/5 transition-all duration-300 overflow-hidden"
      >
        {/* SIDE BRANDING BAR: Denotes 'Verified Node' status */}
        <div className="w-1.5 bg-blue-600 group-hover:w-2 transition-all duration-300" />

        {/* INDEX NODE: Terminal Style */}
        <div className="flex items-center justify-center px-6 bg-slate-50/50 border-r border-slate-100">
          <div className="w-10 h-10 rounded-xl bg-white border border-slate-200 flex flex-col items-center justify-center shadow-sm group-hover:border-blue-200 transition-colors">
            <span className="text-[10px] font-black text-slate-400 leading-none uppercase tracking-tighter">exp</span>
            <span className="text-sm font-black text-slate-900 leading-none mt-1">0{i + 1}</span>
          </div>
        </div>

        {/* MAIN CONTENT STRIP */}
        <div className="flex-1 p-5 md:p-6 flex flex-col md:flex-row md:items-center justify-between gap-6">
          <div className="min-w-0 space-y-2">
            {/* Entity & Role */}
            <div className="flex items-center gap-3">
              <h4 className="text-sm font-black text-slate-900 uppercase tracking-tight truncate group-hover:text-blue-600 transition-colors">
                {exp.company_name || "Unidentified Entity"}
              </h4>
              <div className="h-1 w-1 rounded-full bg-slate-300" />
              <div className="px-2 py-0.5 bg-blue-50 text-blue-700 rounded-md text-[9px] font-black uppercase tracking-widest border border-blue-100/50">
                {exp.job_title || "Role Pending"}
              </div>
            </div>

            {/* Deployment Meta-Data */}
            <div className="flex flex-wrap items-center gap-x-6 gap-y-2">
              <div className="flex items-center gap-2 text-slate-400">
                <Calendar size={13} className="text-slate-300" />
                <span className="text-[10px] font-bold uppercase tracking-widest">
                  {exp.start_date || "----"} <span className="text-slate-200 mx-1">â€”</span> {exp.end_date || "Present"}
                </span>
              </div>
              <div className="flex items-center gap-2 text-slate-400">
                <MapPin size={13} className="text-slate-300" />
                <span className="text-[10px] font-bold uppercase tracking-widest">{exp.location || "Global Node"}</span>
              </div>
            </div>
          </div>

          {/* FINANCIAL NODE: High Contrast Badge */}
          <div className="flex items-center gap-6">
            <div className="flex flex-col items-end border-r border-slate-100 pr-6">
              <span className="text-[8px] font-black text-slate-400 uppercase tracking-[0.2em] mb-1">Previous CTC</span>
              <div className="flex items-center gap-1.5 text-emerald-600">
                <div className="h-1.5 w-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]" />
                <span className="text-[12px] font-black uppercase tracking-tight">
                  â‚¹{exp.previous_ctc ? `${(exp.previous_ctc / 100000).toFixed(2)} LPA` : "0.00"}
                </span>
              </div>
            </div>

            {/* ACTION INTERFACE */}
            <div className="flex items-center gap-2">
              <button 
                type="button" 
                
onClick={() => {
  const existing = formData.experiences[i];

  setCurrentEditingIndex(i);

  setNewExperiences([
    {
      ...existing,
      uploadMode: existing.exp_letter_link ? "link" : "file",
      expLetterFile: null, // important
    },
  ]);

  setShowExpModal(true);
}}



                className="p-3 bg-slate-50 text-slate-400 hover:bg-blue-600 hover:text-white rounded-xl transition-all duration-300 border border-slate-100 active:scale-90"
              >
                <Edit3 size={16} strokeWidth={2.5} />
              </button>
            </div>
          </div>
        </div>

        {/* Decorative Watermark for Enterprise Feel */}
        <History className="absolute -right-4 -bottom-4 text-slate-900 opacity-[0.02] -rotate-12 pointer-events-none group-hover:opacity-[0.05] transition-opacity" size={100} />
      </div>
    ))
  ) : (
    /* EMPTY STATE: Audit-Empty Pattern */
    <div className="relative group flex flex-col items-center justify-center py-20 bg-slate-50/30 border-2 border-dashed border-slate-200 rounded-[2.5rem] transition-colors hover:bg-slate-50">
      <div className="relative z-10 flex flex-col items-center">
        <div className="w-16 h-16 bg-white rounded-[1.5rem] shadow-sm border border-slate-100 flex items-center justify-center text-slate-200 mb-6 group-hover:scale-110 transition-transform duration-500">
          <Database size={32} strokeWidth={1.5} />
        </div>
        <h4 className="text-[11px] font-black text-slate-400 uppercase tracking-[0.3em] mb-2">
          Zero Nodes Synchronized
        </h4>
        <p className="text-[10px] font-bold text-slate-300 uppercase tracking-widest text-center max-w-xs">
          Professional history registry currently empty. Initialize a new experience node to begin.
        </p>
      </div>
      <div className="absolute inset-0 overflow-hidden pointer-events-none rounded-[2.5rem]">
         <ShieldCheck className="absolute -right-8 -bottom-8 text-slate-900 opacity-[0.02] -rotate-12" size={200} />
      </div>
    </div>
  )}
</div>
      </div>
    )}

    {/* NAVIGATION */}
    <div className="flex justify-between pt-6">
      <button type="button" onClick={() => setStep(3)} className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[10px] font-black uppercase shadow-sm transition-all hover:text-slate-900">â† Back</button>
      <button
        type="button"
        onClick={async () => { await saveStepData(4); setStep(5); }}
        disabled={isFresher === null}
        className={`px-12 py-4 rounded-2xl text-[10px] font-black uppercase shadow-xl transition-all ${isFresher !== null ? "bg-blue-600 text-white shadow-blue-200" : "bg-slate-200 text-slate-300 cursor-not-allowed"}`}
      >Commit & Continue â†’</button>
    </div>

    {/* MODAL: ADDING NEW RECORDS ONLY (Upload Logic Removed) */}
   
    {showExpModal && (
  <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 md:p-8 bg-slate-900/60 backdrop-blur-md animate-in fade-in duration-300">
    <div className="bg-white w-full max-w-6xl h-full max-h-[85vh] rounded-[3rem] shadow-2xl border border-slate-200 flex flex-col overflow-hidden animate-in zoom-in-95 duration-300">
      
      {/* Modal Header */}
      <div className="px-10 py-8 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
        <div className="flex items-center gap-4">
          <div className="w-14 h-14 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-xl shadow-blue-200">
            <Plus size={28} strokeWidth={3} />
          </div>
          <div>
            {/* <h2 className="text-base font-black text-slate-900 uppercase tracking-[0.2em]">New Experience</h2> */}
            <h2 className="text-base font-black text-slate-900 uppercase tracking-[0.2em]">
                {currentEditingIndex !== null ? "Edit Experience" : "New Experience"}
            </h2>
            <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Add new Experience Records</p>
          </div>
        </div>
        <button onClick={() => setShowExpModal(false)} className="w-12 h-12 flex items-center justify-center bg-white border border-slate-100 hover:bg-red-50 hover:text-red-500 rounded-full transition-all shadow-sm">
          <X size={24} />
        </button>
      </div>

      {/* Modal Content */}
      <div className="flex-1 overflow-y-auto p-10 space-y-12 custom-scrollbar-professional bg-white">
        {newExperiences.map((exp, i) => (
          <div key={i} className="relative bg-slate-50/50 border border-slate-200 p-8 rounded-[2.5rem] space-y-8 animate-in slide-in-from-bottom-4 group hover:bg-white hover:border-blue-200 transition-all">
            {/* Remove Entry */}
            <button
              type="button"
              onClick={() => setNewExperiences(newExperiences.filter((_, idx) => idx !== i))}
              className="absolute -top-3 -right-3 h-10 w-10 bg-white border border-slate-200 text-red-500 rounded-full flex items-center justify-center shadow-lg opacity-0 group-hover:opacity-100 transition-all z-20 hover:bg-red-500 hover:text-white"
            >
              <Trash2 size={18} />
            </button>

            {/* GRID 1: IDENTITY */}
            <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
              <FormField label="Employer">
                <input placeholder="Company Name" value={exp.company_name} onChange={(e) => { const u = [...newExperiences]; u[i].company_name = e.target.value; setNewExperiences(u); }} className={inputStyle} />
              </FormField>
              <FormField label="Designation">
                <input placeholder="Job Title" value={exp.job_title} onChange={(e) => { const u = [...newExperiences]; u[i].job_title = e.target.value; setNewExperiences(u); }} className={inputStyle} />
              </FormField>
              <FormField label="Location">
                <input placeholder="City" value={exp.location} onChange={(e) => { const u = [...newExperiences]; u[i].location = e.target.value; setNewExperiences(u); }} className={inputStyle} />
              </FormField>
              
             <FormField label="Industry">
  <div className="relative">

    {/* INPUT BOX */}
    <input
      value={exp.industry || ""}
      placeholder="Search or select industry..."
      onFocus={() => setShowIndustryDrop(true)}
      onChange={(e) => {
        const value = e.target.value;
        setIndustrySearch(value);

        const u = [...newExperiences];
        u[i].industry = value;
        setNewExperiences(u);
      }}
      className={inputStyle}
    />

    {/* DROPDOWN */}
    {showIndustryDrop && (
      <div className="absolute z-50 mt-2 w-full bg-white border border-slate-200 rounded-xl shadow-lg overflow-hidden">

        {/* LIST â€” SHOW 4 ITEMS HEIGHT */}
        <div className="max-h-44 overflow-y-auto">

          {filteredIndustries.length > 0 ? (
            filteredIndustries.map((ind) => (
              <div
                key={ind}
                onClick={() => {
                  const u = [...newExperiences];
                  u[i].industry = ind;
                  setNewExperiences(u);

                  setIndustrySearch("");
                  setShowIndustryDrop(false);
                }}
                className="px-4 py-2 text-[13px] font-bold text-slate-700 hover:bg-blue-50 hover:text-blue-600 cursor-pointer transition"
              >
                {ind}
              </div>
            ))
          ) : (
            <div className="px-4 py-3 text-xs text-slate-400">
              No match found
            </div>
          )}
        </div>
      </div>
    )}
  </div>
</FormField>


            </div>

            {/* GRID 2: TIMELINE & CTC */}
            <div className="grid grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
              <FormField label="Start Date">
                <input type="date" value={exp.start_date} onChange={(e) => { const u = [...newExperiences]; u[i].start_date = e.target.value; setNewExperiences(u); }} className={inputStyle} />
              </FormField>
              <FormField label="End Date">
                <input type="date" value={exp.end_date} onChange={(e) => { const u = [...newExperiences]; u[i].end_date = e.target.value; setNewExperiences(u); }} className={inputStyle} />
              </FormField>
              <FormField label="Annual CTC">
                <div className="flex items-center bg-white border border-slate-200 rounded-2xl overflow-hidden focus-within:border-blue-500 transition-all">
                  <div className="px-4 text-blue-600 font-black italic">â‚¹</div>
                  <input type="number" placeholder="0.00" value={exp.previous_ctc} onChange={(e) => { const u = [...newExperiences]; u[i].previous_ctc = e.target.value; setNewExperiences(u); }} className="w-full py-3 bg-transparent text-[12px] font-bold outline-none" />
                  <div className="pr-4 text-[9px] font-black text-slate-400">LPA</div>
                </div>
              </FormField>
            </div>

            {/* GRID 3: DESCRIPTION & ARTIFACT UPLOAD */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
              <FormField label="Professional Summary">
                <textarea rows={4} placeholder="Briefly describe your role..." value={exp.description} onChange={(e) => { const u = [...newExperiences]; u[i].description = e.target.value; setNewExperiences(u); }} className={inputStyle + " resize-none"} />
              </FormField>
              
              <div className="space-y-4">
                <div className="flex justify-between items-center px-1">
                  <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Experience Artifact</p>
                  <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200 scale-90">
                    <button
                      type="button"
                      onClick={() => { const u = [...newExperiences]; u[i].uploadMode = "file"; setNewExperiences(u); }}
                      className={`px-4 py-1 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode !== "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
                    >FILE</button>
                    <button
                      type="button"
                      onClick={() => { const u = [...newExperiences]; u[i].uploadMode = "link"; setNewExperiences(u); }}
                      className={`px-4 py-1 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
                    >URL</button>
                  </div>
                </div>

                <div className="bg-white/50 border-2 border-dashed border-slate-200 rounded-[2rem] p-6 min-h-[140px] flex flex-col justify-center items-center group/upload hover:bg-blue-50/30 transition-all">
                  {exp.uploadMode !== "link" ? (
                    <label className="flex flex-col items-center cursor-pointer w-full">
                      <FileUp size={24} className="text-slate-300 group-hover/upload:text-blue-500 mb-2 transition-colors" />
                      <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest text-center px-4">
                        {exp.expLetterFile ? exp.expLetterFile.name : "Select Validation PDF"}
                      </span>
                      <input 
                        type="file" 
                        accept=".pdf" 
                        className="hidden" 
                        onChange={(e) => { const u = [...newExperiences]; u[i].expLetterFile = e.target.files[0]; setNewExperiences(u); }} 
                      />
                    </label>
                  ) : (
                    <div className="w-full px-4 relative">
                      <LinkIcon size={16} className="absolute left-7 top-1/2 -translate-y-1/2 text-slate-300" />
                      <input 
                        placeholder="Public Storage URI (https://...)" 
                        value={exp.exp_letter_link || ""} 
                        onChange={(e) => { const u = [...newExperiences]; u[i].exp_letter_link = e.target.value; setNewExperiences(u); }} 
                        className={inputStyle + " pl-12"} 
                      />
                    </div>
                  )}
                </div>
              </div>
            </div>

            {/* SAVE ACTION */}
            <div className="flex justify-end pt-4 border-t border-slate-100">
              <button
                type="button"
                // onClick={() => handleSaveExperienceAPI(i)} 
                onClick={() => handleSaveOrUpdateExperience(i)}
                className="flex items-center gap-2 px-8 py-3 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl shadow-blue-200 transition-all hover:bg-blue-700 active:scale-95"
              >
                {/* <CheckCircle size={16} /> Save */}
                <CheckCircle size={16} />
{currentEditingIndex !== null ? "Update" : "Save"}

              </button>
            </div>
          </div>
        ))}

       
        {currentEditingIndex === null && (
  <button
    type="button"
    onClick={() =>
      setNewExperiences([
        ...newExperiences,
        {
          company_name: "",
          job_title: "",
          start_date: "",
          end_date: "",
          previous_ctc: "",
          location: "",
          description: "",
          industry: "",
          uploadMode: "file",
          expLetterFile: null,
          exp_letter_link: "",
          candidate_id: effectiveId,
        },
      ])
    }
    className="w-full py-8 border-2 border-dashed border-slate-400 rounded-[2.5rem] text-slate-500 hover:text-blue-600 hover:border-blue-200 hover:bg-blue-50/20 transition-all text-[11px] font-black uppercase tracking-[0.3em]"
  >
    + Add New Row
  </button>
)}

      </div>

      {/* Modal Footer */}
     
    </div>
  </div>
)} 
  </div>
)}


            {/* STEP 5: asset and skill */}
            {step === 5 && (
              <div className="space-y-8 animate-in slide-in-from-right-8 overflow-visible">
                <div className="bg-white border border-slate-200 rounded-[3.5rem] shadow-xl overflow-visible shadow-slate-200/50">
                  <div className="bg-slate-50/50 px-10 py-6 border-b border-slate-200 flex items-center justify-between rounded-t-[3.5rem]">
                    <div className="flex items-center gap-4">
                      <div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg">
                        <Cpu size={20} />
                      </div>
                      <div>
                        <h3 className="text-sm font-black text-slate-900 uppercase tracking-widest leading-none">
                          Skills & Assets
                        </h3>
                      </div>
                    </div>
                  </div>
                  <div className="p-8 md:p-12 space-y-12 overflow-visible">
                    <FormField label="Skills">
                      <div className="space-y-6">
                        <div className="flex flex-col sm:flex-row gap-4 items-end">
                          <div className="relative max-w-md w-full">
                            <Plus
                              size={16}
                              className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
                            />
                            <input
                              value={skillInput}
                              onChange={(e) => setSkillInput(e.target.value)}
                              onKeyDown={(e) => {
                                if (e.key === "Enter") {
                                  e.preventDefault();
                                  const name = skillInput.trim();
                                  if (!name) return;

                                  // prevent duplicate
                                  if (!formData.skills.includes(name)) {
                                    setFormData((prev) => ({
                                      ...prev,
                                      skills: [...prev.skills, name],
                                    }));
                                  }

                                  setSkillInput("");
                                }
                              }}
                              placeholder="Register skill..."
                              className={inputStyle + " pl-12"}
                            />
                          </div>
                        </div>

                        <div className="flex flex-wrap gap-3 p-1 w-full min-h-[40px]">
                          {[
                            ...new Set([...dynamicSkills, ...formData.skills]),
                          ].map((skill) => {
                            const isSelected = formData.skills.includes(skill);

                            return (
                              <button
                                key={skill}
                                type="button"
                                onClick={() =>
                                  setFormData({
                                    ...formData,
                                    skills: isSelected
                                      ? formData.skills.filter(
                                          (s) => s !== skill,
                                        )
                                      : [...formData.skills, skill],
                                  })
                                }
                                className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${
                                  isSelected
                                    ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200"
                                    : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"
                                }`}
                              >
                                {skill}
                                {isSelected && (
                                  <Check size={14} strokeWidth={3} />
                                )}
                              </button>
                            );
                          })}
                        </div>
                      </div>
                    </FormField>
                    {/* <FormField label="Enterprise Hardware Matrix"><div className="space-y-6 pt-8 border-t border-slate-100"><div className="relative max-w-md w-full"><Layers size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={assetInput} onChange={(e) => setAssetInput(e.target.value)} onKeyDown={async (e) => { if(e.key === 'Enter') { e.preventDefault(); const v = assetInput.trim(); if(v && !formData.assets.includes(v)) { const ok = await handleAddAssetAPI(v); if(ok) { setFormData({...formData, assets: [...formData.assets, v]}); setAssetInput(""); } } } }} placeholder="Link hardware..." className={inputStyle + " pl-12"} /></div><div className="flex flex-wrap gap-3 p-1">{dynamicAssets.map((asset) => { const isSelected = formData.assets.includes(asset); return (<button key={asset} type="button" onClick={async () => { if(!isSelected) { const ok = await handleAddAssetAPI(asset); if(ok) setFormData({...formData, assets: [...formData.assets, asset]}); } else { setFormData({...formData, assets: formData.assets.filter(a => a !== asset)}); } }} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${isSelected ? "bg-slate-900 border-slate-900 text-white shadow-lg shadow-slate-200" : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`}>{asset} {isSelected && <Check size={14} strokeWidth={3} className="animate-in zoom-in" />}</button>); })}</div></div></FormField> */}
                    <div className="space-y-6 pt-8 border-t border-slate-100">
                      <FormField label="Assets">
                        <div className="space-y-6">
                          {/* Search & Manual Add Input */}
                          <div className="relative max-w-md">
                            <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">
                              <Layers size={16} />
                            </div>
                            <input
                              value={assetInput}
                              onChange={(e) => setAssetInput(e.target.value)}
                              
                              onKeyDown={(e) => {
                                if (e.key === "Enter") {
                                  e.preventDefault();
                                  const v = assetInput.trim();
                                  if (!v) return;

                                  // Prevent duplicate
                                  if (!formData.assets.includes(v)) {
                                    setFormData((prev) => ({
                                      ...prev,
                                      assets: [...prev.assets, v],
                                    }));
                                  }

                                  setAssetInput("");
                                }
                              }}
                              placeholder="Type hardware name and press Enter..."
                              className="w-full pl-12 pr-4 py-3.5 bg-slate-50 border border-slate-200 rounded-2xl text-xs font-bold outline-none focus:bg-white focus:border-slate-900 focus:ring-4 focus:ring-slate-900/5 transition-all shadow-inner"
                            />
                          </div>

                          <div className="flex flex-wrap gap-3 p-1 w-full min-h-[40px]">
                            {[
                              ...new Set([
                                ...dynamicAssets,
                                ...formData.assets,
                              ]),
                            ].filter(
                              (a) => typeof a === "string" && a.trim() !== "",
                            ).length === 0 ? (
                              /* âŒ NO ASSETS */
                              <div className="w-full text-center py-6 bg-slate-50 border border-dashed border-slate-200 rounded-2xl">
                                <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">
                                  No assets available
                                </p>
                              </div>
                            ) : (
                              /* âœ… ASSET CHIPS */
                              [
                                ...new Set([
                                  ...dynamicAssets,
                                  ...formData.assets,
                                ]),
                              ]
                                .filter(
                                  (a) =>
                                    typeof a === "string" && a.trim() !== "",
                                )
                                .map((asset) => {
                                  const isSelected =
                                    formData.assets.includes(asset);

                                  return (
                                    <button
                                      key={asset}
                                      type="button"
                                      onClick={() =>
                                        setFormData((prev) => ({
                                          ...prev,
                                          assets: isSelected
                                            ? prev.assets.filter(
                                                (a) => a !== asset,
                                              )
                                            : [...prev.assets, asset],
                                        }))
                                      }
                                      className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90
            ${
              isSelected
                ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200"
                : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"
            }`}
                                    >
                                      {asset}
                                      {isSelected && (
                                        <Check size={14} strokeWidth={3} />
                                      )}
                                    </button>
                                  );
                                })
                            )}
                          </div>
                        </div>
                      </FormField>
                    </div>
                  </div>
                </div>
                <div className="flex justify-between items-center pt-4">
                  <button
                    onClick={() => setStep(4)}
                    type="button"
                    className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[11px] font-black uppercase transition-all shadow-sm hover:text-slate-900 flex items-center gap-2 transition-all"
                  >
                    <ChevronLeft size={16} /> Back
                  </button>

                  <button
                    onClick={async () => {
                      await saveStepData(5);
                      setStep(6);
                    }}
                    type="button"
                    className="px-12 py-4 bg-blue-600 text-white rounded-xl text-[11px] font-black uppercase shadow-xl active:scale-95 transition-all flex items-center gap-2 whitespace-nowrap"
                  >
                    Next Phase <ChevronRight size={14} />
                  </button>
                </div>
              </div>
            )}

            {/* STEP 6: DOCUMENT VAULT */}  


              {/* {step === 6 && (
              <div className="space-y-8 animate-in slide-in-from-bottom-8 duration-500">
                <div className="bg-white rounded-[2rem] shadow-2xl shadow-slate-200/50 border border-slate-200 overflow-hidden relative">
                
                  <div className="bg-slate-50 px-8 py-6 border-b border-slate-200 flex items-center justify-between">
                    <div className="flex items-center gap-5">
                      <div className="h-12 w-12 bg-slate-900 rounded-2xl flex items-center justify-center text-white shadow-lg">
                        <ShieldCheck size={24} />
                      </div>
                      <div>
                        <h3 className="text-lg font-bold text-slate-900 tracking-tight">
                          Document upload
                        </h3>

                        <div className="px-8 pt-6">
  <select
    value={docType}
    onChange={(e) => setDocType(e.target.value)}
    className="w-60 px-4 py-2 border border-slate-200 rounded-xl text-sm font-bold bg-white"
  >
    <option value="resume">Resume</option>
    <option value="certificate">Certificate</option>
  </select>
</div>

                        <p className="text-[11px] font-semibold text-slate-500 uppercase tracking-widest">
                          Document Verification
                        </p>
                      </div>
                    </div>
                    <div className="hidden md:flex items-center gap-2 px-4 py-1.5 bg-blue-50 border border-blue-100 rounded-full">
                      <div className="h-1.5 w-1.5 rounded-full bg-blue-500 animate-pulse" />
                      <span className="text-[10px] font-bold text-blue-600 uppercase tracking-tighter">
                        ready to save
                      </span>
                    </div>
                  </div>

                  <div className="p-8 md:p-12 space-y-12">
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-12">
              
                      <div className="space-y-6">
                        <div className="flex justify-between items-center px-1">
                          <div className="flex items-center gap-2">
                            <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">
                              01. Resume
                            </span>
                          </div>
                          <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200 scale-90">
                            <button
                              type="button"
                              onClick={() => setResumeMode("file")}
                              className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === "file" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500 hover:text-slate-700"}`}
                            >
                              FILE
                            </button>
                            <button
                              type="button"
                              onClick={() => setResumeMode("link")}
                              className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
                            >
                              URL
                            </button>
                          </div>
                        </div>

                        {resumeMode === "file" ? (
                          <label className="flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-slate-200 rounded-3xl bg-slate-50/50 hover:bg-white hover:border-blue-500 transition-all cursor-pointer group">
                            <div className="flex flex-col items-center gap-3">
                              <div className="p-4 bg-white rounded-2xl shadow-sm border border-slate-100 group-hover:scale-110 transition-transform duration-500">
                                <FileUp
                                  size={28}
                                  className="text-slate-400 group-hover:text-blue-500"
                                />
                              </div>
                              <span className="text-[11px] font-bold text-slate-500 uppercase tracking-widest">
                                {formData.cvFile
                                  ? formData.cvFile.name
                                  : existingResume
                                    ? "Existing Resume Available"
                                    : "Commit Resume PDF"}
                              </span>

                         
                              {existingResume && !formData.cvFile && (
                                <a
                                  href={fixResumeUrl2(existingResume)}
                                  target="_blank"
                                  rel="noreferrer"
                                  className="text-blue-600 text-xs underline mt-1"
                                >
                                  View Current Resume
                                </a>
                              )}
                            </div>
                            <input
                              type="file"
                              accept=".pdf"
                              className="hidden"
                              onChange={(e) =>
                                setFormData({
                                  ...formData,
                                  cvFile: e.target.files[0],
                                  resume_link: "",
                                })
                              }
                            />
                          </label>
                        ) : (
                          <div className="relative">
                            <LinkIcon
                              size={18}
                              className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
                            />
                            <input
                              placeholder="Enter Public Storage URI..."
                              value={formData.resume_link}
                              onChange={(e) =>
                                setFormData({
                                  ...formData,
                                  resume_link: e.target.value,
                                  cvFile: null,
                                })
                              }
                              className={inputStyle + " pl-12"}
                            />
                          </div>
                        )}
                      </div>

                 
                      <div className="space-y-6">
                        <div className="flex justify-between items-center px-1">
                          <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">
                            02. certificate
                          </span>
                          <div className="flex gap-2">
                            <label className="cursor-pointer h-10 w-10 bg-slate-900 text-white rounded-xl hover:bg-blue-600 active:scale-90 transition-all flex items-center justify-center shadow-lg shadow-slate-200">
                              <Plus size={18} />
                              <input
                                type="file"
                                multiple
                                accept=".pdf"
                                className="hidden"
                                onChange={(e) =>
                                  setFormData({
                                    ...formData,
                                    certificateFiles: [
                                      ...formData.certificateFiles,
                                      ...Array.from(e.target.files),
                                    ],
                                  })
                                }
                              />
                            </label>
                            <button
                              type="button"
                              onClick={() =>
                                setFormData({
                                  ...formData,
                                  certificateLinks: [
                                    ...formData.certificateLinks,
                                    "",
                                  ],
                                })
                              }
                              className="h-10 w-10 bg-white text-slate-600 rounded-xl border border-slate-200 hover:border-blue-500 hover:text-blue-500 active:scale-90 transition-all flex items-center justify-center shadow-sm"
                            >
                              <LinkIcon size={18} />
                            </button>
                          </div>
                        </div>

                        <div className="grid grid-cols-1 gap-4 max-h-[220px] overflow-y-auto no-scrollbar pr-1">
                   
                          {existingCertificates.map((url, idx) => (
                            <div
                              key={`existing-${idx}`}
                              className="flex justify-between items-center bg-blue-50 p-4 rounded-2xl border border-blue-100"
                            >
                              <div className="flex items-center gap-3">
                                <div className="h-2 w-2 rounded-full bg-blue-500" />

                                <a
                                  href={url}
                                  target="_blank"
                                  rel="noreferrer"
                                  className="text-[12px] font-bold text-blue-700 underline truncate max-w-[200px]"
                                >
                                  Existing Certificate {idx + 1}
                                </a>
                              </div>

                              <X
                                size={16}
                                className="text-red-400 hover:text-red-600 cursor-pointer"
                                onClick={() =>
                                  setExistingCertificates((prev) =>
                                    prev.filter((_, i) => i !== idx),
                                  )
                                }
                              />
                            </div>
                          ))}

                          {formData.certificateFiles.map((file, idx) => (
                            <div
                              key={idx}
                              className="flex justify-between items-center bg-slate-50 p-4 rounded-2xl border border-slate-100 hover:border-blue-300 transition-colors"
                            >
                              <div className="flex items-center gap-3">
                                <div className="h-2 w-2 rounded-full bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)]" />
                                <span className="text-[12px] font-bold text-slate-700 truncate max-w-[200px]">
                                  {file.name}
                                </span>
                              </div>
                              <X
                                size={16}
                                className="text-slate-300 hover:text-red-500 cursor-pointer transition-all hover:rotate-90"
                                onClick={() =>
                                  setFormData({
                                    ...formData,
                                    certificateFiles:
                                      formData.certificateFiles.filter(
                                        (_, i) => i !== idx,
                                      ),
                                  })
                                }
                              />
                            </div>
                          ))}
                          {formData.certificateLinks.map((link, idx) => (
                            <div
                              key={idx}
                              className="flex gap-3 animate-in slide-in-from-right-4"
                            >
                              <div className="relative flex-1">
                                <Globe
                                  size={16}
                                  className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
                                />
                                <input
                                  value={link}
                                  placeholder="Public URI..."
                                  onChange={(e) => {
                                    const u = [...formData.certificateLinks];
                                    u[idx] = e.target.value;
                                    setFormData({
                                      ...formData,
                                      certificateLinks: u,
                                    });
                                  }}
                                  className={inputStyle + " pl-11 !py-2.5"}
                                />
                              </div>
                              <button
                                type="button"
                                onClick={() =>
                                  setFormData({
                                    ...formData,
                                    certificateLinks:
                                      formData.certificateLinks.filter(
                                        (_, i) => i !== idx,
                                      ),
                                  })
                                }
                                className="text-slate-300 hover:text-red-500 bg-slate-50 h-10 w-10 rounded-xl border border-slate-200 flex items-center justify-center"
                              >
                                <Trash2 size={16} />
                              </button>
                            </div>
                          ))}
                          {formData.certificateFiles.length === 0 &&
                            formData.certificateLinks.filter((l) => l)
                              .length === 0 && (
                              <div className="py-8 text-center bg-slate-50/50 border border-dashed border-slate-200 rounded-2xl">
                                <p className="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">
                                  No secondary artifacts registered
                                </p>
                              </div>
                            )}
                        </div>
                      </div>
                    </div>

                    <div className="bg-slate-50 rounded-3xl p-6 flex flex-col md:flex-row items-center justify-between gap-6 ">
                      <div className="flex items-center gap-4">
                        <div className="h-10 w-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400">
                          <History size={20} />
                        </div>
                        <div>
                          <p className="text-slate-800 text-xs font-bold tracking-wide uppercase">
                             Final Review
                          </p>
                          <p className="text-slate-400 text-[10px] uppercase font-semibold tracking-tighter">
                            Employee Id {effectiveId} â€¢ Ready to submit
                          </p>
                        </div>
                      </div>
                      <button
                        // type="submit"
                        type="button" 
                        // onClick={handleSubmit}
                        onClick={async () => {
                          setLoading(true);

                          await saveStepData(6); // ðŸ”¥ FINAL API CALL HERE

                          setLoading(false);

                          toast.success("Candidate Saved âœ”");

                          navigate("/candidate"); // redirect after save
                        }}
                        className="w-full md:w-auto px-10 py-3.5 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl text-[11px] font-black uppercase tracking-widest transition-all shadow-xl shadow-blue-600/20 active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3"
                      >
                        {loading ? (
                          <Loader2 className="animate-spin" size={18} />
                        ) : (
                          <>
                            <Database size={18} />
                            <span>Submit data</span>
                          </>
                        )}
                      </button>
                    </div>
                  </div>

               
                  <div className="flex justify-center pt-2 pb-8">
                    <button
                      type="button"
                      onClick={() => setStep(5)}
                      className="text-[10px] font-bold text-slate-400 uppercase tracking-widest hover:text-slate-900 transition-colors flex items-center gap-2 group"
                    >
                      <ChevronLeft
                        size={16}
                        className="group-hover:-translate-x-1 transition-transform"
                      />
                      Return to back page
                    </button>
                  </div>
                </div>
              </div>
            )} */}


            {/* {step === 6 && (
  <div className="space-y-8 animate-in slide-in-from-bottom-8 duration-700">
    <div className="bg-white rounded-[2.5rem] border border-slate-200 shadow-2xl shadow-slate-200/50 overflow-hidden relative">
    
      <div className="bg-slate-900 px-10 py-8 border-b border-slate-800 flex items-center justify-between">
        <div className="flex items-center gap-5">
          <div className="h-14 w-14 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-xl shadow-blue-500/20">
            <ShieldCheck size={28} strokeWidth={2.5} />
          </div>
          <div>
            <h3 className="text-xl font-black text-white tracking-tight uppercase">Document Control Vault</h3>
            <p className="text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em] mt-1">Identity & Credential Verification</p>
          </div>
        </div>
      </div>

      <div className="p-10 space-y-12">
      
        <div className="space-y-6">
          <div className="flex items-center gap-3 px-2">
            <div className="w-1.5 h-4 bg-blue-600 rounded-full" />
            <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">01. Master Identity Node (Resume)</h3>
          </div>

          {existingResume ? (
           
            <div className="flex items-center justify-between p-6 bg-emerald-50/50 border border-emerald-100 rounded-3xl group">
              <div className="flex items-center gap-5">
                <div className="h-12 w-12 bg-white rounded-xl flex items-center justify-center text-emerald-500 shadow-sm border border-emerald-100">
                  <CheckCircle size={24} strokeWidth={2.5} />
                </div>
                <div>
                  <p className="text-[11px] font-black text-emerald-700 uppercase tracking-widest">Document Synchronized</p>
                  <p className="text-[9px] font-bold text-slate-400 uppercase mt-1">Status: Active Registry</p>
                </div>
              </div>
              <div className="flex gap-3">
                <a href={fixResumeUrl2(existingResume)} target="_blank" rel="noreferrer" className="flex items-center gap-2 px-6 py-2.5 bg-white border border-emerald-200 text-emerald-600 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-emerald-600 hover:text-white transition-all shadow-sm">
                  <Eye size={14} /> Preview
                </a>
                <button onClick={() => setExistingResume("")} className="p-2.5 text-slate-300 hover:text-rose-500 transition-colors">
                  <Trash2 size={18} />
                </button>
              </div>
            </div>
          ) : (
         
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
              <div className="space-y-4">
                <div className="flex bg-slate-100 p-1 rounded-2xl border border-slate-200 w-fit scale-90">
                  <button type="button" onClick={() => setResumeMode("file")} className={`px-6 py-2 text-[10px] font-black rounded-xl transition-all ${resumeMode === "file" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}>FILE</button>
                  <button type="button" onClick={() => setResumeMode("link")} className={`px-6 py-2 text-[10px] font-black rounded-xl transition-all ${resumeMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}>URL</button>
                </div>
                {resumeMode === "file" ? (
                  <label className="flex flex-col items-center justify-center w-full h-40 border-2 border-dashed border-slate-200 rounded-[2rem] bg-slate-50 hover:bg-white hover:border-blue-500 transition-all cursor-pointer group">
                    <FileUp size={24} className="text-slate-300 group-hover:text-blue-500 mb-2" />
                    <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">{formData.cvFile ? formData.cvFile.name : "Select Resume PDF"}</span>
                    <input type="file" accept=".pdf" className="hidden" onChange={(e) => setFormData({...formData, cvFile: e.target.files[0]})} />
                  </label>
                ) : (
                  <div className="relative group">
                    <LinkIcon size={18} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-600" />
                    <input placeholder="Public Storage URI (HTTPS)" value={formData.resume_link} onChange={(e) => setFormData({...formData, resume_link: e.target.value})} className={inputStyle + " pl-12 h-14"} />
                  </div>
                )}
              </div>
              <div className="bg-blue-50/50 p-6 rounded-3xl border border-blue-100/50 flex items-start gap-4">
                 <AlertCircle className="text-blue-500 shrink-0" size={20} />
                 <p className="text-[11px] text-blue-700 font-bold leading-relaxed">Identity Protocol: Only one master CV node can be active. Selection of a new file will overwrite any pending unsaved URI links.</p>
              </div>
            </div>
          )}
        </div>

     
        <div className="space-y-6">
          <div className="flex items-center justify-between px-2">
            <div className="flex items-center gap-3">
              <div className="w-1.5 h-4 bg-emerald-500 rounded-full" />
              <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">02. Verified Credentials List</h3>
            </div>
           
            <button 
  type="button"
  onClick={() => {
    setEditingCertificate(null); // Clear editing state for fresh add
    setCertForm({ name: "", certificate_file: null, certificate_link: "", uploadMode: "file" });
    setShowCertEditModal(true);
  }}
  className="flex items-center gap-2 px-6 py-2.5 bg-slate-900 text-white rounded-xl text-[10px] font-black uppercase tracking-widest shadow-xl active:scale-95 transition-all"
>
  <PlusCircle size={14} strokeWidth={2.5} /> 
  Initialize New Artifact
</button>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            {existingCertificates.length > 0 ? (
              existingCertificates.map((cert) => (
                <div key={cert.id} className="flex items-center justify-between p-4 bg-white border border-slate-200 rounded-2xl hover:border-emerald-400 transition-all group shadow-sm">
                  <div className="flex items-center gap-4 min-w-0">
                    <div className="p-3 bg-emerald-50 text-emerald-600 rounded-xl group-hover:bg-emerald-500 group-hover:text-white transition-all">
                      <Award size={20} />
                    </div>
                    <div className="min-w-0">
                      <p className="text-[11px] font-black text-slate-900 uppercase truncate">{cert.name || "External Artifact"}</p>
                      <p className="text-[9px] font-bold text-slate-400 uppercase tracking-tighter mt-0.5">Verified on Registry</p>
                    </div>
                  </div>
                  <div className="flex items-center gap-2">
                     <a href={fixResumeUrl2(cert.file_path)} target="_blank" className="p-2 hover:bg-slate-50 text-slate-400 hover:text-blue-600 rounded-lg"><ExternalLink size={16} /></a>
                     <button 
                        type="button"
                        onClick={() => {
                          setEditingCertificate(cert);
                          setCertForm({ name: cert.name, uploadMode: "file", certificate_file: null, certificate_link: "" });
                          setShowCertEditModal(true);
                        }}
                        className="p-2 hover:bg-slate-50 text-slate-400 hover:text-emerald-600 rounded-lg"
                      >
                        <Edit3 size={16} />
                     </button>
                  </div>
                </div>
              ))
            ) : (
              <div className="col-span-full py-12 text-center bg-slate-50/50 border-2 border-dashed border-slate-200 rounded-[2.5rem]">
                <Database className="mx-auto text-slate-200 mb-4" size={40} />
                <p className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">Zero Accredited Artifacts Found</p>
              </div>
            )}
          </div>
        </div>
      </div>

      <div className="p-10 bg-slate-900 flex flex-col md:flex-row items-center justify-between gap-6">
        <div className="flex items-center gap-4">
          <div className="h-10 w-10 bg-white/10 rounded-xl flex items-center justify-center text-blue-400">
            <History size={20} />
          </div>
          <div>
            <p className="text-white text-xs font-black uppercase tracking-widest">Final Registry Sync</p>
            <p className="text-slate-500 text-[10px] font-bold uppercase tracking-tighter mt-0.5">Node ID: {effectiveId} â€¢ Encrypted Tunnel Ready</p>
          </div>
        </div>
        <button
          type="button"
          onClick={async () => {
            setLoading(true);
            await saveStepData(6);
            setLoading(false);
            toast.success("Registry Commit Complete âœ”");
            navigate("/candidate");
          }}
          className="w-full md:w-auto px-12 py-4 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl text-[11px] font-black uppercase tracking-widest shadow-2xl shadow-blue-500/20 active:scale-95 transition-all flex items-center justify-center gap-3"
        >
          {loading ? <Loader2 className="animate-spin" size={18} /> : <> <Database size={18} /> <span>Commit & Synchronize</span> </>}
        </button>
      </div>
    </div>
    
    <div className="flex justify-center pb-10">
      <button type="button" onClick={() => setStep(5)} className="flex items-center gap-2 text-[10px] font-black text-slate-400 uppercase tracking-widest hover:text-slate-900 transition-all">
        <ChevronLeft size={16} /> Return to previous sector
      </button>
    </div>
  </div>
)} */}


{step === 6 && (
  <div className="space-y-8 animate-in slide-in-from-bottom-8 duration-500">
    <div className="bg-white rounded-[2.5rem] border border-slate-200  overflow-hidden relative">
      <div className=" px-10 py-8  flex items-center justify-between">
        <div className="flex items-center gap-5">
          <div className="h-14 w-14 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-xl">
            <ShieldCheck size={28} strokeWidth={2.5} />
          </div>
          <div>
            <h3 className="text-xl font-black text-black tracking-tight uppercase">Document</h3>
            <p className="text-[10px] font-bold text-slate-800 uppercase tracking-[0.2em] mt-1">Resume & Certificate Upload</p>
          </div>
        </div>
      </div>

      <div className="p-10 space-y-12">
        {/* RESUME SECTION */}
        <div className="space-y-6">
          <div className="flex items-center gap-3 px-2">
            <div className="w-1.5 h-4 bg-blue-600 rounded-full" />
            <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">01. Master Identity Node (Resume)</h3>
          </div>
          {existingResume ? (
            <div className="flex items-center justify-between p-6 bg-emerald-50/50 border border-emerald-100 rounded-3xl">
              <div className="flex items-center gap-5">
                <div className="h-12 w-12 bg-white rounded-xl flex items-center justify-center text-emerald-500 border border-emerald-100 shadow-sm"><CheckCircle size={24} /></div>
                <div>
                  <p className="text-[11px] font-black text-emerald-700 uppercase">Document Synchronized</p>
                  <p className="text-[9px] font-bold text-slate-400 uppercase">Status: Active Registry</p>
                </div>
              </div>
              <a href={fixResumeUrl2(existingResume)} target="_blank" rel="noreferrer" className="flex items-center gap-2 px-6 py-2.5 bg-white border border-emerald-200 text-emerald-600 rounded-xl text-[10px] font-black uppercase hover:bg-emerald-600 hover:text-white transition-all">
                <Eye size={14} /> Preview
              </a>
            </div>
          ) : (
             <div className="p-6 border-2 border-dashed border-slate-100 rounded-3xl bg-slate-50 flex flex-col items-center gap-3">
                <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">No Active Identity Node</p>
                <button type="button" onClick={() => setResumeMode("file")} className="text-[10px] font-black text-blue-600 uppercase underline">Upload Master CV</button>
             </div>
          )}
        </div>

        {/* CERTIFICATE REGISTRY SECTION */}
        <div className="space-y-6">
          <div className="flex items-center justify-between px-2">
            <div className="flex items-center gap-3">
              <div className="w-1.5 h-4 bg-emerald-500 rounded-full" />
              <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">02. Verified Credentials List</h3>
            </div>
            <button 
              type="button"
              onClick={() => { setEditingCertificate(null); setCertForm({ name: "", certificate_file: null, certificate_link: "", uploadMode: "file" }); setShowCertEditModal(true); }}
              className="flex items-center gap-2 px-6 py-2.5 bg-slate-900 text-white rounded-xl text-[10px] font-black uppercase tracking-widest shadow-xl active:scale-95 transition-all"
            >
              <PlusCircle size={14} /> Initialize New Artifact
            </button>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            {/* 1. Show existing from API */}
            {existingCertificates.map((cert) => (
              <div key={cert.id} className="flex items-center justify-between p-4 bg-white border border-slate-200 rounded-2xl hover:border-emerald-400 transition-all shadow-sm">
                <div className="flex items-center gap-4">
                  <div className="p-3 bg-emerald-50 text-emerald-600 rounded-xl"><Award size={20} /></div>
                  <div className="min-w-0">
                    <p className="text-[11px] font-black text-slate-900 uppercase truncate max-w-[150px]">{cert.name}</p>
                    <p className="text-[8px] font-black text-emerald-500 uppercase tracking-tighter mt-0.5">Verified</p>
                  </div>
                </div>
                <div className="flex items-center gap-2">
                   <a href={fixResumeUrl2(cert.file_path)} target="_blank" className="p-2 text-slate-400 hover:text-blue-600 transition-colors"><ExternalLink size={16} /></a>
                   <button type="button" onClick={() => { setEditingCertificate(cert); setCertForm({ name: cert.name, uploadMode: "file", certificate_file: null, certificate_link: "" }); setShowCertEditModal(true); }} className="p-2 text-slate-400 hover:text-emerald-600 transition-colors"><Edit3 size={16} /></button>
                </div>
              </div>
            ))}

            {/* 2. Show Pending Files from local state */}
            {formData.certificateFiles.map((file, idx) => (
               <div key={`pending-${idx}`} className="flex items-center justify-between p-4 bg-blue-50/50 border border-blue-100 border-dashed rounded-2xl animate-pulse">
                  <div className="flex items-center gap-4">
                    <div className="p-3 bg-blue-600 text-white rounded-xl"><FileText size={20} /></div>
                    <div>
                      <p className="text-[11px] font-black text-slate-900 uppercase truncate max-w-[150px]">{formData.certificateNames[idx]}</p>
                      <p className="text-[8px] font-black text-blue-600 uppercase tracking-tighter mt-0.5">Pending Sync</p>
                    </div>
                  </div>
                  <button type="button" onClick={() => {
                    const newFiles = [...formData.certificateFiles]; newFiles.splice(idx, 1);
                    const newNames = [...formData.certificateNames]; newNames.splice(idx, 1);
                    setFormData({...formData, certificateFiles: newFiles, certificateNames: newNames});
                  }} className="text-slate-300 hover:text-rose-500 transition-colors px-2"><Trash2 size={16}/></button>
               </div>
            ))}
          </div>
        </div>
      </div>

      {/* FINAL COMMIT FOOTER */}
      <div className="p-10  flex flex-col md:flex-row items-center justify-between gap-6">
        <div className="flex items-center gap-4">
           {/* NAVIGATION FOOTER: RETURN TO PREVIOUS SECTOR */}
    <div className="flex justify-center pb-10">
      <button
        type="button"
        onClick={() => setStep(5)}
        className="group flex items-center gap-3 px-8 py-3 bg-white border border-slate-200 text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] rounded-2xl hover:text-slate-900 hover:border-slate-400 transition-all shadow-sm active:scale-95"
      >
        <ChevronLeft size={16} className="group-hover:-translate-x-1 transition-transform" />
        Return to Assets & Skills
      </button>
    </div>
        </div>
        <button
          type="button"
          onClick={async () => {
            setLoading(true);
            await saveStepData(6);
            setLoading(false);
            toast.success("Final Registry Sync Complete âœ”");
            navigate("/candidate");
          }}
          className="w-full md:w-auto px-12 py-4 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl text-[11px] font-black uppercase tracking-widest shadow-2xl active:scale-95 transition-all flex items-center justify-center gap-3"
        >
          {loading ? <Loader2 className="animate-spin" size={18} /> : <><Database size={18} /> <span>Submit & Close Registry</span></>}
        </button>
      </div>
    </div>
   
  </div>
)}
          </div>
        </form>
      </div>

      {/* {showCertEditModal && (
  <div className="fixed inset-0 z-[250] flex items-center justify-center p-4">
    <div className="absolute inset-0 bg-slate-950/60 backdrop-blur-md animate-in fade-in duration-300" onClick={() => setShowCertEditModal(false)} />
    <div className="relative bg-white w-full max-w-md rounded-[2.5rem] shadow-2xl border border-slate-200 overflow-hidden animate-in zoom-in-95">
      <div className="px-8 py-6 border-b border-slate-100 flex items-center justify-between bg-slate-50/50">
        <div className="flex items-center gap-3">
          <div className="p-2 bg-emerald-500 rounded-lg text-white shadow-lg shadow-emerald-200">
            <Award size={18} />
          </div>
          <h3 className="text-xs font-black text-slate-900 uppercase tracking-widest">Edit Node Artifact</h3>
        </div>
        <button onClick={() => setShowCertEditModal(false)} className="text-slate-400 hover:text-slate-900"><X size={20}/></button>
      </div>

      <div className="p-8 space-y-6">
        <FormField label="Artifact Label">
          <input value={certForm.name} onChange={(e) => setCertForm({ ...certForm, name: e.target.value })} className={inputStyle} placeholder="e.g. AWS Solution Architect" />
        </FormField>

        <div className="space-y-3">
          <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Validation Source</label>
          <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200 w-full">
            <button type="button" onClick={() => setCertForm({ ...certForm, uploadMode: "file" })} className={`flex-1 py-2 text-[10px] font-black rounded-lg transition-all ${certForm.uploadMode === "file" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}>LOCAL FILE</button>
            <button type="button" onClick={() => setCertForm({ ...certForm, uploadMode: "link" })} className={`flex-1 py-2 text-[10px] font-black rounded-lg transition-all ${certForm.uploadMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}>GLOBAL URI</button>
          </div>
        </div>

        {certForm.uploadMode === "file" ? (
          <div className="border-2 border-dashed border-slate-200 rounded-2xl p-6 text-center hover:bg-slate-50 transition-all">
            <label className="cursor-pointer">
              <Upload className="mx-auto text-slate-300 mb-2" size={20} />
              <span className="text-[10px] font-bold text-slate-500 uppercase">{certForm.certificate_file ? certForm.certificate_file.name : "Select New PDF"}</span>
              <input type="file" className="hidden" accept=".pdf" onChange={(e) => setCertForm({...certForm, certificate_file: e.target.files[0]})} />
            </label>
          </div>
        ) : (
          <div className="relative">
            <LinkIcon className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" size={14} />
            <input value={certForm.certificate_link} onChange={(e) => setCertForm({ ...certForm, certificate_link: e.target.value })} className={inputStyle + " pl-10"} placeholder="https://external-storage.com/cert.pdf" />
          </div>
        )}

        <button onClick={updateCertificate} className="w-full bg-slate-900 text-white py-4 rounded-2xl text-[11px] font-black uppercase tracking-[0.2em] shadow-xl hover:bg-black active:scale-[0.98] transition-all mt-4">
          Commit Artifact Update
        </button>
      </div>
    </div>
  </div>
)} */}

      {/* {showCertEditModal && (
  <div className="fixed inset-0 bg-black/50 flex items-center justify-center">
    <div className="bg-white p-6 rounded-2xl w-[420px] space-y-4">

      <h3 className="font-bold">Edit Certificate</h3>

      <input
        value={certForm.name}
        onChange={(e) =>
          setCertForm({ ...certForm, name: e.target.value })
        }
        className="border p-2 rounded-xl w-full"
        placeholder="Certificate Name"
      />

      {certForm.uploadMode === "file" ? (
        <input
          type="file"
          accept=".pdf"
          onChange={(e) =>
            setCertForm({
              ...certForm,
              certificate_file: e.target.files[0],
            })
          }
        />
      ) : (
        <input
          value={certForm.certificate_link}
          onChange={(e) =>
            setCertForm({
              ...certForm,
              certificate_link: e.target.value,
            })
          }
          className="border p-2 rounded-xl w-full"
        />
      )}

      <button
        onClick={updateCertificate}
        className="w-full bg-blue-600 text-white py-2 rounded-xl"
      >
        Update Certificate
      </button>

      <button
        onClick={() => setShowCertEditModal(false)}
        className="w-full border py-2 rounded-xl"
      >
        Cancel
      </button>
    </div>
  </div>
)} */}

{/* CERTIFICATE TERMINAL (ADD/EDIT MODAL) */}
{showCertEditModal && (
  <div className="fixed inset-0 z-[250] flex items-center justify-center p-4">
    <div 
      className="absolute inset-0 bg-slate-950/60 backdrop-blur-md animate-in fade-in duration-300" 
      onClick={() => setShowCertEditModal(false)} 
    />
    <div className="relative bg-white w-full max-w-lg rounded-[3rem] shadow-2xl border border-slate-200 overflow-hidden animate-in zoom-in-95 duration-300">
      {/* Header Protocol */}
      <div className="px-10 py-8 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
        <div className="flex items-center gap-4">
          <div className="w-12 h-12 bg-emerald-500 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-emerald-200">
            {editingCertificate ? <Edit3 size={22} /> : <PlusCircle size={22} />}
          </div>
          <div>
            <h2 className="text-sm font-black text-slate-900 uppercase tracking-[0.2em]">
              {editingCertificate ? "Edit Artifact" : "New Artifact"}
            </h2>
            <p className="text-[9px] font-bold text-slate-400 uppercase tracking-widest mt-1">Credential Registry Protocol</p>
          </div>
        </div>
        <button onClick={() => setShowCertEditModal(false)} className="w-10 h-10 flex items-center justify-center bg-white border border-slate-100 hover:bg-red-50 hover:text-red-500 rounded-full transition-all">
          <X size={20} />
        </button>
      </div>

      <div className="p-10 space-y-8 bg-white">
        {/* Compulsory Name Input */}
        <FormField label="Artifact Name" required>
          <input 
            placeholder="e.g. Google Cloud Professional"
            value={certForm.name} 
            onChange={(e) => setCertForm({ ...certForm, name: e.target.value })} 
            className={inputStyle} 
          />
        </FormField>

        {/* Upload Mode Toggle */}
        <div className="space-y-3">
          <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Validation Method</label>
          <div className="flex bg-slate-100 p-1.5 rounded-2xl border border-slate-200 w-full">
            <button 
              type="button" 
              onClick={() => setCertForm({ ...certForm, uploadMode: "file" })} 
              className={`flex-1 py-2.5 text-[10px] font-black rounded-xl transition-all ${certForm.uploadMode === "file" ? "bg-white text-blue-600 shadow-sm border border-slate-100" : "text-slate-500"}`}
            >LOCAL PDF</button>
            <button 
              type="button" 
              onClick={() => setCertForm({ ...certForm, uploadMode: "link" })} 
              className={`flex-1 py-2.5 text-[10px] font-black rounded-xl transition-all ${certForm.uploadMode === "link" ? "bg-white text-blue-600 shadow-sm border border-slate-100" : "text-slate-500"}`}
            >REMOTE URI</button>
          </div>
        </div>

        {/* Conditional Input Box */}
        <div className="animate-in fade-in slide-in-from-top-2 duration-300">
          {certForm.uploadMode === "file" ? (
            <div className="border-2 border-dashed border-slate-200 rounded-[2rem] p-8 text-center bg-slate-50/30 hover:bg-white hover:border-emerald-500 transition-all group/up">
              <label className="cursor-pointer block">
                <FileUp className="mx-auto text-slate-300 group-hover/up:text-emerald-500 mb-3 transition-colors" size={32} />
                <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest block">
                  {certForm.certificate_file ? certForm.certificate_file.name : "Commit Source PDF"}
                </span>
                <input 
                  type="file" 
                  className="hidden" 
                  accept=".pdf" 
                  onChange={(e) => setCertForm({...certForm, certificate_file: e.target.files[0]})} 
                />
              </label>
            </div>
          ) : (
            <div className="relative group">
              <LinkIcon className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-600 transition-colors" size={18} />
              <input 
                placeholder="https://credential-verify.com/id..." 
                value={certForm.certificate_link} 
                onChange={(e) => setCertForm({ ...certForm, certificate_link: e.target.value })} 
                className={inputStyle + " pl-12 h-14"} 
              />
            </div>
          )}
        </div>

        {/* Commit Action */}
        <button 
          type="button"
          onClick={editingCertificate ? updateCertificate : handleAddCertificate}
          className="w-full bg-slate-900 text-white py-5 rounded-[1.5rem] text-[11px] font-black uppercase tracking-[0.2em] shadow-2xl hover:bg-black active:scale-[0.98] transition-all flex items-center justify-center gap-3"
        >
          <Database size={16} />
          {editingCertificate ? "Commit Artifact Update" : "Synchronize New Artifact"}
        </button>
      </div>
    </div>
  </div>
)}

      <style
        dangerouslySetInnerHTML={{
          __html: `.custom-scrollbar-professional::-webkit-scrollbar { width: 6px; }.custom-scrollbar-professional::-webkit-scrollbar-track { background: transparent; }.custom-scrollbar-professional::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 20px; }.custom-scrollbar-professional::-webkit-scrollbar-thumb:hover { background: #CBD5E1; }`,
        }}
      />
    </div>
  );
};

export default ManualEntryPage;
//**************************************************working code phase 4 20/02/26 3:26**************************************************************** */
// import React, { useState, useEffect, useRef } from "react";
// import { useParams, useNavigate, useSearchParams  } from "react-router-dom";
// import {
//   Check,
//   Award,
//   User,
//   Briefcase,
//   Fingerprint,
//   Calendar,
//   FileText,
//   CheckCircle,
//   MapPin,
//   Loader2,
//   Plus,
//   Trash2,
//   Layers,
//   Cpu,
//   Database,
//   Globe,
//   ShieldCheck,
//   History,
//   X,
//   Edit3,
//   LinkIcon,
//   FileUp,
//   ChevronRight,
//   ChevronLeft,
//   ChevronDown,
// } from "lucide-react";
// import toast from "react-hot-toast";
// import { candidateService } from "../../services/candidateService";
// import { departmentService } from "../../services/department.service";

// const FormField = ({ label, required, error, children }) => (
//   <div className="space-y-1 w-full">
//     <label className="text-[10px] md:text-[11px] font-black text-slate-500 uppercase tracking-widest ml-1 flex justify-between items-center">
//       <span>{label}</span>
//       <span
//         className={`font-bold normal-case ${required ? "text-red-500" : "text-slate-300"}`}
//       >
//         {required ? "Required" : "Optional"}
//       </span>
//     </label>
//     {children}
//     {error && (
//       <p className="text-[9px] text-red-500 font-bold uppercase tracking-tighter ml-1">
//         {error}
//       </p>
//     )}
//   </div>
// );

// const ManualEntryPage = () => {
//   const { id } = useParams();
//   const navigate = useNavigate();
//   const [searchParams] = useSearchParams();
//   const effectiveId = id || "666";
//   const ASSET_OPTIONS = [
//     "Laptop",
//     "Mouse",
//     "Keyboard",
//     "Monitor",
//     "Headset",
//     "Mobile",
//     "ID Card",
//     "SIM Card",
//   ];
//   // Professional Enterprise Input Style
//   const inputStyle =
//     "w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-[13px] font-bold outline-none focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-500/5 transition-all shadow-sm";

//   // 1. INITIALIZE ALL STATES
//   const [step, setStep] = useState(1);
//   const [loading, setLoading] = useState(false);
//   const [fetchingData, setFetchingData] = useState(false);
//   const [errors, setErrors] = useState({});
//   const [isFetchingPincode, setIsFetchingPincode] = useState(false);
//   const [cityOptions, setCityOptions] = useState([]);
//   const [resumeMode, setResumeMode] = useState("file");
//   const [skillInput, setSkillInput] = useState("");
//   const [assetInput, setAssetInput] = useState("");
//   const [isFresher, setIsFresher] = useState(null);
//   const [deptSearch, setDeptSearch] = useState("");
//   const [eduSearch, setEduSearch] = useState("");
//   const [dynamicSkills, setDynamicSkills] = useState([]);
//   const [existingResume, setExistingResume] = useState("");
// const [industrySearch, setIndustrySearch] = useState("");
// const [showIndustryDrop, setShowIndustryDrop] = useState(false);
//   const [dynamicAssets, setDynamicAssets] = useState([]);
//   const [showSkillDrop, setShowSkillDrop] = useState(false);
//   const [showAssetDrop, setShowAssetDrop] = useState(false);
//   const [skillFocused, setSkillFocused] = useState(false);
//   const [departments, setDepartments] = useState([]);
//   const dropdownContainerRef = useRef(null);
//   const [existingCertificates, setExistingCertificates] = useState([]);
//   const [editingCertId, setEditingCertId] = useState(null);
//   const [editingCertValue, setEditingCertValue] = useState("");
//   const [showExpModal, setShowExpModal] = useState(false);
// const [currentEditingIndex, setCurrentEditingIndex] = useState(null);
// const [newExperiences, setNewExperiences] = useState([]);



// //**********************************certiificate and resume*********************************** */

// const [docType, setDocType] = useState("resume"); 
// // "resume" | "certificate"

// const [showCertEditModal, setShowCertEditModal] = useState(false);
// const [editingCertificate, setEditingCertificate] = useState(null);

// const [certForm, setCertForm] = useState({
//   name: "",
//   certificate_file: null,
//   certificate_link: "",
//   uploadMode: "file", // file | link
// });


// //**********************************certiificate and resume end*********************************** */

// //**********************************eduction*********************************** */

// const [showEduModal, setShowEduModal] = useState(false);
// const [masterEducations, setMasterEducations] = useState([]);
// const [eduDropdownOpen, setEduDropdownOpen] = useState(false);
// const [isEditingEdu, setIsEditingEdu] = useState(false);
// const [currentEduId, setCurrentEduId] = useState(null);
// const [newEdu, setNewEdu] = useState({
//   education_id: 0,
//   institution_name: "",
//   start_year: "",
//   end_year: "",
//   education_name: "" // For display in dropdown
// });

// //**********************************eduction  end*********************************** */
//   const careerStepRef = useRef(null);

//   const [formData, setFormData] = useState({
//     name: "",
//     email: "",
//     phone: "",
//     address: "",
//     address2: "",
//     location: "",
//     pincode: "",
//     state: "",
//     city: "",
//     district: "",
//     country: "India",
//     position: "",
//     gender: "",
//     dob: "",
//     education: [], 
//     experience: "",
//     about_me: "",
//     languages_spoken: [],
//     skills: [],
//     assets: [],
//     department: "",
//     cvFile: null,
//     resume_link: "",
//     certificateFiles: [],
//     certificateLinks: [""],
//     experiences: [],
//   });

//   const totalSteps = 6;

//   const educationOptions = [
//     "SSC / 10th",
//     "HSC / 12th",
//     "ITI",
//     "Diploma",
//     "Polytechnic",

//     "B.A",
//     "B.Com",
//     "B.Sc",
//     "BCA",
//     "BBA",
//     "B.Tech",
//     "BE",
//     "B.Pharm",
//     "B.Ed",

//     "M.A",
//     "M.Com",
//     "M.Sc",
//     "MCA",
//     "MBA",
//     "M.Tech",
//     "ME",
//     "M.Pharm",
//     "M.Ed",

//     "PGDM",
//     "Post Graduate Diploma",

//     "PhD / Doctorate",
//   ];

//   const POSITION_OPTIONS = [
//     // IT / Software
//     "Frontend Developer",
//     "Backend Developer",
//     "Full Stack Developer",
//     "Software Engineer",
//     "Senior Software Engineer",
//     "Lead Developer",
//     "DevOps Engineer",
//     "QA Engineer",
//     "Automation Tester",
//     "Manual Tester",
//     "UI/UX Designer",
//     "Mobile App Developer",
//     "Android Developer",
//     "iOS Developer",
//     "Data Analyst",
//     "Data Scientist",
//     "Machine Learning Engineer",
//     "AI Engineer",
//     "Cloud Engineer",
//     "System Administrator",
//     "Network Engineer",
//     "Cyber Security Analyst",

//     // Management / Office
//     "Project Manager",
//     "Product Manager",
//     "Operations Manager",
//     "Team Lead",
//     "Business Analyst",
//     "HR Executive",
//     "HR Manager",
//     "Recruiter",
//     "Office Administrator",

//     // Non-IT / General
//     "Accountant",
//     "Finance Executive",
//     "Sales Executive",
//     "Marketing Executive",
//     "Digital Marketing Specialist",
//     "Customer Support Executive",
//     "Technical Support Engineer",
//     "Field Executive",
//     "Supervisor",
//     "Store Manager",
//     "Warehouse Executive",

//     // Fresher / Entry
//     "Intern",
//     "Trainee",
//     "Graduate Engineer Trainee",
//     "Apprentice",
//   ];

//   const filteredEducation = educationOptions.filter((e) =>
//     e.toLowerCase().includes(eduSearch.toLowerCase()),
//   );
//   const filteredDepartments = departments.filter((d) =>
//     (d.name || "").toLowerCase().includes(deptSearch.toLowerCase()),
//   );
//   const isStep1Valid =
//     formData.name && /^\S+@\S+\.\S+$/.test(formData.email) && formData.phone;

//   // 2. HYDRATION LOGIC (GET API)
//   useEffect(() => {
   
//     hydrateNode();
//   }, [effectiveId]);

//    const hydrateNode = async () => {
//       setFetchingData(true);
//       try {
//         const response = await fetch(
//           `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//         );
//         if (!response.ok) throw new Error();
//         const data = await response.json();

//         if (data) {
//           setExistingResume(data.resume_path || "");

//           setExistingCertificates(
//             Array.isArray(data.certificates) ? data.certificates : [],
//           );

//           const safeParse = (value) => {
//             if (!value) return [];

//             try {
//               // Already array â†’ fix broken JSON pieces
//               if (Array.isArray(value)) {
//                 const joined = value.join("");
//                 if (joined.startsWith("[")) {
//                   return JSON.parse(joined);
//                 }
//                 return value;
//               }

//               // If string JSON
//               if (typeof value === "string" && value.startsWith("[")) {
//                 return JSON.parse(value);
//               }

//               // If CSV string â†’ convert to array
//               if (typeof value === "string") {
//                 return value
//                   .split(",")
//                   .map((s) => s.trim())
//                   .filter(Boolean);
//               }

//               return [];
//             } catch {
//               return [];
//             }
//           };

//           setFormData((prev) => ({
//             ...prev,
//             name: data.full_name || "",
//             email: data.email || "",
//             phone: data.phone || "",
//             gender: data.gender || "",
//             dob: data.dob || "",
//             address: data.address || "",
//             address2: data.address2 || "",
//             location: data.location || "",
//             pincode: data.pincode || "",
//             city: data.city || "",
//             state: data.state || "",
//             district: data.district || "",
//             country: data.country || "India",
//             position: data.position || "",
//             experience: data.experience || "",
//            education: Array.isArray(data.educations) 
//       ? data.educations.map(edu => ({
//           id: edu.id,
//           education_id: edu.education_id,
//           institution_name: edu.institution_name,
//           start_year: edu.start_year,
//           end_year: edu.end_year,
//           // Extract the name from education_master for the UI
//           education_name: edu.education_master?.name || "Unknown Degree"
//         }))
//       : [],


//             department: data.department || "",
//             about_me: data.about_me || "",
//             resume_link: data.resume_path || "",
//             languages_spoken: safeParse(data.languages_spoken),
//             experiences: data.experiences || [],
//             skills: safeParse(data.skills),
//             assets: safeParse(data.assets),
//           }));

//           setIsFresher(!data.experiences || data.experiences.length === 0);
//         }

//         const deptData = await departmentService.getAll();
//         setDepartments(deptData || []);
//         await fetchSkills();
//         await fetchAssets(effectiveId);
//       } catch (err) {
//         console.warn("Initializing Empty Node");
//       } finally {
//         setFetchingData(false);
//       }
//     };

//     const INDUSTRY_OPTIONS = [
//   "Information Technology",
//   "Software Development",
//   "Banking & Finance",
//   "Healthcare",
//   "Education",
//   "Manufacturing",
//   "Retail",
//   "Telecom",
//   "Construction",
//   "Logistics",
//   "Marketing & Advertising",
//   "HR / Recruitment",
//   "Government",
//   "Automobile",
//   "Pharmaceutical",
//   "E-Commerce",
//   "Media & Entertainment",
//   "Real Estate",
//   "Hospitality",
//   "Other",
// ];

// //***********************************************eduction*************************************************** */
// // Update your useEffect to trigger this
// // useEffect(() => {
// //   if (effectiveId) {
// //     fetchCandidateEducation();
// //   }
// // }, [effectiveId]);


// // const fetchCandidateEducation = async () => {
// //   setFetchingData(true);
// //   try {
// //     const res = await fetch(`https://apihrr.goelectronix.co.in/education/${effectiveId}?user_type=candidate`);
// //     const data = await res.json();
    
// //     // Ensure we update the formData with the retrieved array
// //     if (Array.isArray(data)) {
// //       setFormData(prev => ({
// //         ...prev,
// //         education: data // Map API response to your state
// //       }));
// //     }
// //   } catch (err) {
// //     console.error("Failed to fetch academic history", err);
// //   } finally {
// //     setFetchingData(false);
// //   }
// // };



// //**********************************************eduction end**************************************************** */


//   // Click Outside to close dropdowns
//   useEffect(() => {
//     const handleClickOutside = (event) => {
//       if (
//         dropdownContainerRef.current &&
//         !dropdownContainerRef.current.contains(event.target)
//       ) {
//         setShowSkillDrop(false);
//         setShowAssetDrop(false);
//         setSkillFocused(false);
//       }
//     };
//     document.addEventListener("mousedown", handleClickOutside);
//     return () => document.removeEventListener("mousedown", handleClickOutside);
//   }, []);

//   // READ STEP FROM URL (?step=3)
// useEffect(() => {
//   const stepFromUrl = Number(searchParams.get("step"));

//   if (stepFromUrl && stepFromUrl >= 1 && stepFromUrl <= totalSteps) {
//     setStep(stepFromUrl);
//   }
// }, [searchParams]);


//   // 3. HANDLERS
//   const fetchSkills = async () => {
//     try {
//       const res = await fetch(
//         "https://apihrr.goelectronix.co.in/masters/skills",
//       );
//       const data = await res.json();
//       setDynamicSkills(data.map((item) => item.name || item));
//     } catch {}
//   };

//   const fetchAssets = async (cId) => {
//     try {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${cId}/assets`,
//       );
//       const data = await res.json();
//       setDynamicAssets(Array.isArray(data) ? data.map((a) => a.name) : []);
//     } catch {}
//   };

//   const handleManualAddSkill = async () => {
//     const name = skillInput.trim();
//     if (!name) {
//       await fetchSkills();
//       return;
//     }
//     const success = await handleCreateMaster("skills", name);
//     if (success) {
//       if (!formData.skills.includes(name))
//         setFormData((p) => ({ ...p, skills: [...p.skills, name] }));
//       setSkillInput("");
//       await fetchSkills();
//     }
//   };

//   const handleCreateMaster = async (type, name) => {
//     try {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/masters/${type}`,
//         {
//           method: "POST",
//           headers: { "Content-Type": "application/json" },
//           body: JSON.stringify({ name: name.trim() }),
//         },
//       );
//       return res.ok;
//     } catch {
//       return false;
//     }
//   };

//   const handleAddAssetAPI = async (assetName) => {
//     if (!assetName.trim()) return;
//     const loadingToast = toast.loading(`Linking asset...`);
//     try {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/assets`,
//         {
//           method: "POST",
//           headers: { "Content-Type": "application/json" },
//           body: JSON.stringify({ name: assetName.trim() }),
//         },
//       );
//       if (res.ok) {
//         toast.success("Linked", { id: loadingToast });
//         await fetchAssets(effectiveId);
//         return true;
//       }
//     } catch {
//       toast.error("Sync failed", { id: loadingToast });
//     }
//     return false;
//   };

//   const filteredIndustries = INDUSTRY_OPTIONS.filter((ind) =>
//   ind.toLowerCase().includes(industrySearch.toLowerCase())
// );

// const handleSaveOrUpdateExperience = async (i) => {
//   const exp = newExperiences[i];

//   if (!exp.company_name || !exp.job_title || !exp.start_date || !exp.end_date) {
//     toast.error("Company, Role, Start Date, End Date required");
//     return;
//   }

//   const loadingToast = toast.loading(
//     currentEditingIndex !== null ? "Updating experience..." : "Saving experience..."
//   );

//   try {
//     const fd = new FormData();

//     fd.append("company_name", exp.company_name);
//     fd.append("job_title", exp.job_title);
//     fd.append("start_date", exp.start_date);
//     fd.append("end_date", exp.end_date);
//     fd.append("previous_ctc", exp.previous_ctc || "");
//     fd.append("location", exp.location || "");
//     fd.append("description", exp.description || "");
//     fd.append("industry", exp.industry || "");

//     if (exp.uploadMode === "link") {
//       fd.append("exp_letter_link", exp.exp_letter_link || "");
//     } else if (exp.expLetterFile instanceof File) {
//       fd.append("exp_letter_file", exp.expLetterFile);
//     }

//     // =========================
//     // UPDATE (PATCH)
//     // =========================
//     if (currentEditingIndex !== null && exp.id) {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/experiences/${exp.id}`,
//         {
//           method: "PUT",
//           body: fd,
//         }
//       );

//       if (!res.ok) throw new Error(await res.text());

//       // Update UI instantly
//       const updated = [...formData.experiences];
//       updated[currentEditingIndex] = exp;

//       setFormData((prev) => ({
//         ...prev,
//         experiences: updated,
//       }));

//       toast.success("Experience Updated âœ…", { id: loadingToast });
//     }

//     // =========================
//     // ADD NEW (POST)
//     // =========================
//     else {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/experiences`,
//         {
//           method: "POST",
//           body: fd,
//         }
//       );

//       if (!res.ok) throw new Error(await res.text());

//       await hydrateNode(); // reload from backend

//       toast.success("Experience Added âœ…", { id: loadingToast });
//     }

//     setNewExperiences([]);
//     setCurrentEditingIndex(null);
//     setShowExpModal(false);

//   } catch (err) {
//     console.error(err);
//     toast.error("Failed âŒ", { id: loadingToast });
//   }
// };


// // Fetch Master Education List
// const fetchMasterEducations = async () => {
//   try {
//     const res = await fetch("https://apihrr.goelectronix.co.in/masters?types=educations&skip=0&limit=100");
//     const data = await res.json();
//     setMasterEducations(data.educations || []);
//   } catch (err) { console.error("Master Load Error", err); }
// };

// // Save or Update Education
// const handleSaveEducation = async () => {
//   const loadingToast = toast.loading(isEditingEdu ? "Updating Node..." : "Syncing Education...");
//   const url = isEditingEdu 
//     ? `https://apihrr.goelectronix.co.in/education/${currentEduId}?user_type=candidate`
//     : `https://apihrr.goelectronix.co.in/education/${effectiveId}?user_type=candidate`;

//   try {
//     const res = await fetch(url, {
//       method: isEditingEdu ? "PATCH" : "POST",
//       headers: { "Content-Type": "application/json" },
//       body: JSON.stringify({
//         education_id: newEdu.education_id,
//         institution_name: newEdu.institution_name,
//         start_year: newEdu.start_year,
//         end_year: newEdu.end_year
//       }),
//     });

//     if (res.ok) {
//       toast.success("Education Node Synchronized", { id: loadingToast });
//       setShowEduModal(false);
//       // Logic to refresh your formData.education from GET API here
//       // ðŸ”¥ REFRESH LOGIC: Trigger hydration to pull the updated 'educations' array
//       await hydrateNode(); 
      
//       // Reset Search state
//       setEduSearch("");
//     }
//   } catch (err) { toast.error("Sync Failed", { id: loadingToast }); }
// };

// const updateCertificate = async () => {
//   try {
//     const fd = new FormData();

//     fd.append("name", certForm.name);

//     if (certForm.uploadMode === "file" && certForm.certificate_file) {
//       fd.append("certificate_file", certForm.certificate_file);
//     }

//     if (certForm.uploadMode === "link" && certForm.certificate_link) {
//       fd.append("certificate_link", certForm.certificate_link);
//     }

//     await fetch(
//       `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/certificates/${editingCertificate.id}`,
//       {
//         method: "PUT",
//         body: fd,
//       }
//     );

//     toast.success("Certificate Updated");
//     setShowCertEditModal(false);
//     hydrateNode();

//   } catch (err) {
//     toast.error("Update failed");
//   }
// };

//   const fetchPincodeDetails = async (pincode) => {
//     if (!/^\d{6}$/.test(pincode)) return;

//     setIsFetchingPincode(true);

//     try {
//       const res = await fetch(
//         `https://api.postalpincode.in/pincode/${pincode}`,
//       );
//       const data = await res.json();

//       if (data[0]?.Status === "Success" && data[0].PostOffice?.length > 0) {
//         const postOffices = data[0].PostOffice;

//         setCityOptions(postOffices); // â­ store full objects

//         const first = postOffices[0];

//         setFormData((prev) => ({
//           ...prev,
//           city: first.Name || "",
//           district: first.District || "",
//           state: first.State || "",
//           country: first.Country || "India",
//         }));
//       } else {
//         setCityOptions([]);
//       }
//     } catch (err) {
//       console.error(err);
//       setCityOptions([]);
//     } finally {
//       setIsFetchingPincode(false);
//     }
//   };

//   // const STEP_FIELDS = {
//   //   1: [
//   //     "name",
//   //     "email",
//   //     "phone",
//   //     "gender",
//   //     "dob",
//   //     "position",
//   //     "experience",
//   //     "education",
//   //     "department",
//   //     "about_me",
//   //     "languages_spoken",
//   //   ],

//   //   2: [
//   //     "address",
//   //     "address2",
//   //     "location",
//   //     "pincode",
//   //     "city",
//   //     "district",
//   //     "state",
//   //     "country",
//   //   ],

//   //     3: ["educations"],

//   //   4: ["experiences"],

//   //   5: ["skills", "assets"],

//   //   6: ["resume_link", "cvFile", "certificateFiles", "certificateLinks"],
//   // };


//   // ---------- STEP VALIDATION ----------


//   const STEP_FIELDS = {
//   1: [
//     "name",
//     "email",
//     "phone",
//     "gender",
//     "dob",
//     "position",
//     "experience",
//     "education",
//     "department",
//     "about_me",
//     "languages_spoken",
//   ],

//   2: [
//     "address",
//     "address2",
//     "location",
//     "pincode",
//     "city",
//     "district",
//     "state",
//     "country",
//   ],

//   // âœ… NEW EDUCATION STEP
//   3: ["education"],

//   // âœ… EXPERIENCE SHIFTED TO 4
//   4: ["experiences"],

//   // âœ… SKILLS & ASSETS SHIFTED TO 5
//   5: ["skills", "assets"],

//   // âœ… DOCUMENTS SHIFTED TO 6
//   6: ["resume_link", "cvFile", "certificateFiles", "certificateLinks"],
// };



// // const isStep1Incomplete = () => {
// //   return !(
// //     formData.full_name &&
// //     formData.email &&
// //     formData.phone &&
// //     formData.gender &&
// //     formData.dob &&
// //     (formData.languages_spoken || []).length > 0 &&
// //     formData.about_me
// //   );
// // };

// // const isStep2Incomplete = () => {
// //   return !(
// //     formData.address &&
// //     formData.city &&
// //     formData.state &&
// //     formData.pincode
// //   );
// // };

// // const isStep3Incomplete = () => {
// //   return !(
// //     formData.experiences &&
// //     formData.experiences.length > 0
// //   );
// // };

// // const isStep4Incomplete = () => {
// //   return !(
// //     (formData.skills && formData.skills.length > 0) ||
// //     (formData.assets && formData.assets.length > 0)
// //   );
// // };

// // const isStep5Incomplete = () => {
// //   return !(
// //     formData.resume_path ||
// //     formData.cvFile ||
// //     (formData.certificateFiles && formData.certificateFiles.length > 0) ||
// //     (formData.certificates && formData.certificates.length > 0)
// //   );
// // };


// // STEP 1 â†’ Personal
// const isStep1Incomplete = () => {
//   return !(
//     formData.name &&
//     formData.email &&
//     formData.phone &&
//     formData.gender &&
//     formData.dob &&
//     (formData.languages_spoken || []).length > 0 &&
//     formData.about_me
//   );
// };

// // STEP 2 â†’ Location
// const isStep2Incomplete = () => {
//   return !(
//     formData.address &&
//     formData.city &&
//     formData.state &&
//     formData.pincode
//   );
// };

// // STEP 3 â†’ Education
// const isStep3Incomplete = () => {
//   return !(
//     Array.isArray(formData.education) &&
//     formData.education.length > 0
//   );
// };

// // STEP 4 â†’ Experience
// const isStep4Incomplete = () => {
//   if (isFresher) return false; // Fresher doesn't require experience

//   return !(
//     Array.isArray(formData.experiences) &&
//     formData.experiences.length > 0
//   );
// };

// // STEP 5 â†’ Skills & Assets
// const isStep5Incomplete = () => {
//   return !(
//     (formData.skills && formData.skills.length > 0) ||
//     (formData.assets && formData.assets.length > 0)
//   );
// };

// // STEP 6 â†’ Documents
// const isStep6Incomplete = () => {
//   return !(
//     existingResume ||
//     formData.cvFile ||
//     (formData.certificateFiles && formData.certificateFiles.length > 0) ||
//     (existingCertificates && existingCertificates.length > 0)
//   );
// };


//   const fixResumeUrl = (url) => {
//     if (!url) return "";

//     // remove wrong https//
//     let clean = url.replace(/^https\/\//, "");

//     // if already full valid http/https â†’ keep it
//     if (clean.startsWith("http://") || clean.startsWith("https://")) {
//       return clean;
//     }

//     // attach correct base URL
//     return `https://apihrr.goelectronix.co.in/${clean.replace(/^\/+/, "")}`;
//   };

//   const fixResumeUrl2 = (url) => {
//     if (!url) return "";

//     let clean = url.trim();

//     // Fix broken https//
//     clean = clean.replace(/^https\/\//, "https://");

//     // ðŸ”´ If URL is https://uploads/... â†’ replace domain
//     if (clean.startsWith("https://uploads")) {
//       return clean.replace(
//         "https://uploads",
//         "https://apihrr.goelectronix.co.in/uploads",
//       );
//     }

//     // Already full valid URL â†’ return
//     if (clean.startsWith("http://") || clean.startsWith("https://")) {
//       return clean;
//     }

//     // Remove starting slash
//     clean = clean.replace(/^\/+/, "");

//     // Attach backend base
//     return `https://apihrr.goelectronix.co.in/${clean}`;
//   };

//   const hasExistingExperience =
//     Array.isArray(formData.experiences) && formData.experiences.length > 0;

// //   const saveStepData = async (stepNumber) => {
// //     try {
// //       const apiData = new FormData();
// //       const fields = STEP_FIELDS[stepNumber] || [];

// //       fields.forEach((key) => {
// //         if (key === "languages_spoken") {
// //           apiData.append(
// //             "languages_spoken",
// //             (formData.languages_spoken || []).join(","),
// //           );
// //         } else if (key === "skills" || key === "assets") {
// //           // apiData.append(key, JSON.stringify(formData[key] || []));
// //           apiData.append(key, (formData[key] || []).join(","));
// //         } else if (key === "experiences") {
// //           apiData.append(
// //             "experience_details",
// //             JSON.stringify(formData.experiences || []),
// //           );
// //         } else if (key === "cvFile" && formData.cvFile) {
// //           apiData.append("resumepdf", formData.cvFile);
// //         }
// //         else if (key === "education") {
// //   apiData.append(
// //     "education_details",
// //     JSON.stringify(formData.education || [])
// //   );
// // }

// //         // CASE 2: Resume LINK
// //         else if (key === "resume_link" && formData.resume_link) {
// //           apiData.append("resume_link", formData.resume_link);
// //         } else if (key === "certificateFiles") {
// //           formData.certificateFiles.forEach((file) => {
// //             apiData.append("certificates", file);
// //           });
// //         }else {
// //           apiData.append(key, formData[key] ?? "");
// //         }
// //       });

// //           // ===========================
// //     // FORCE CERTIFICATES FOR STEP 5
// //     // ===========================
// //     if (stepNumber === 5) {

// //       // FILES
// //       formData.certificateFiles.forEach((file) => {
// //         apiData.append("certificates", file);
// //       });

// //       // LINKS (append one by one, NOT JSON)
// //       formData.certificateLinks
// //         .filter((link) => link && link.trim())
// //         .forEach((link) => {
// //           apiData.append("certificate_links", link);
// //         });
// //     }

// //       apiData.append("full_name", formData.name || "");

// //       await fetch(
// //         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
// //         {
// //           method: "PATCH",
// //           body: apiData,
// //         },
// //       );

// //       // ðŸ”¥ FIX-2: Clear uploaded certificates after Step 5 save
// // if (stepNumber === 5) {
// //   setFormData((prev) => ({
// //     ...prev,
// //     certificateFiles: [],
// //     certificateLinks: [""],   // reset to empty input
// //   }));
// // }

// //       toast.success(`Step ${stepNumber} saved`);
// //     } catch (err) {
// //       console.error(err);
// //       toast.error("Auto save failed");
// //     }
// //   };


// const saveStepData = async (stepNumber) => {
//   try {
//     const apiData = new FormData();
//     const fields = STEP_FIELDS[stepNumber] || [];

//     fields.forEach((key) => {

//       // LANGUAGES
//       if (key === "languages_spoken") {
//         apiData.append(
//           "languages_spoken",
//           (formData.languages_spoken || []).join(",")
//         );
//       }

//       // SKILLS / ASSETS
//       else if (key === "skills" || key === "assets") {
//         apiData.append(key, (formData[key] || []).join(","));
//       }

//       // EDUCATION (Step 3)
//       else if (key === "education") {
//         apiData.append(
//           "education_details",
//           JSON.stringify(formData.education || [])
//         );
//       }

//       // EXPERIENCE (Step 4)
//       else if (key === "experiences") {
//         apiData.append(
//           "experience_details",
//           JSON.stringify(formData.experiences || [])
//         );
//       }

//       // RESUME FILE
//       else if (key === "cvFile" && formData.cvFile) {
//         apiData.append("resumepdf", formData.cvFile);
//       }

//       // RESUME LINK
//       else if (key === "resume_link" && formData.resume_link) {
//         apiData.append("resume_link", formData.resume_link);
//       }

//       // CERTIFICATE FILES
//       else if (key === "certificateFiles") {
//         formData.certificateFiles.forEach((file) => {
//           apiData.append("certificates", file);
//         });
//       }

//       // DEFAULT
//       else {
//         apiData.append(key, formData[key] ?? "");
//       }
//     });

//     // ===========================
//     // FORCE CERTIFICATES FOR STEP 6 (Documents)
//     // ===========================
//     if (stepNumber === 6) {
//       // FILES
//       formData.certificateFiles.forEach((file) => {
//         apiData.append("certificates", file);
//       });

//       // LINKS
//       formData.certificateLinks
//         .filter((link) => link && link.trim())
//         .forEach((link) => {
//           apiData.append("certificate_links", link);
//         });
//     }

//     apiData.append("full_name", formData.name || "");

//     await fetch(
//       `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//       {
//         method: "PATCH",
//         body: apiData,
//       }
//     );

//     // ðŸ”¥ CLEAR CERTIFICATES AFTER DOCUMENT SAVE
//     if (stepNumber === 6) {
//       setFormData((prev) => ({
//         ...prev,
//         certificateFiles: [],
//         certificateLinks: [""],
//       }));
//     }

//     toast.success(`Step ${stepNumber} saved`);
//   } catch (err) {
//     console.error(err);
//     toast.error("Auto save failed");
//   }
// };

//   const handleSubmit = async (e) => {
//     e.preventDefault();
//     setLoading(true);

//     const loadingToast = toast.loading("Executing Final PATCH Sync...");

//     try {
//       const apiData = new FormData();

//       // ðŸ”¹ Append ALL simple fields (NO skipping empty)
//       for (const key in formData) {
//         if (
//           ![
//             "experiences",
//             "certificateFiles",
//             "languages_spoken",
//             "cvFile",
//             "skills",
//             "assets",
//           ].includes(key)
//         ) {
//           apiData.append(key, formData[key] ?? "");
//         }
//       }

//       // ðŸ”¹ Required backend fields
//       apiData.append("full_name", formData.name || "");

//       apiData.append(
//         "languages_spoken",
//         (formData.languages_spoken || []).join(","),
//       );

//       apiData.append("skills", (formData.skills || []).join(","));
//       apiData.append("assets", (formData.assets || []).join(","));

//       // CASE 1: Upload PDF
//       if (formData.cvFile) {
//         apiData.append("resumepdf", formData.cvFile); // âœ… correct key
//       }

//       // CASE 2: Resume Link
//       else if (formData.resume_link) {
//         apiData.append("resume_link", formData.resume_link); // âœ… correct key
//       }

//       // CASE 3: Keep existing resume (no change)
//       else if (existingResume) {
//         apiData.append("resume_link", existingResume);
//       }

//       // ðŸ”¹ Certificates FILES
//       formData.certificateFiles.forEach((file) => {
//         apiData.append("certificates", file);
//       });

//       // ðŸ”¹ Certificate LINKS
//       apiData.append(
//         "certificate_links",
//         JSON.stringify(formData.certificateLinks.filter((l) => l && l.trim())),
//       );

//       // ðŸ”¹ Debug â€” SEE WHAT GOES TO API
//       for (let pair of apiData.entries()) {
//         console.log(pair[0], pair[1]);
//       }

//       const response = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//         {
//           method: "PATCH",
//           body: apiData,
//         },
//       );

//       if (!response.ok) {
//         const err = await response.text();
//         console.error(err);
//         throw new Error("API Failed");
//       }

//       toast.success("Candidate Synchronized ðŸŽ‰", { id: loadingToast });
//     } catch (err) {
//       console.error(err);
//       toast.error("Commit failed âŒ", { id: loadingToast });
//     } finally {
//       setLoading(false);
//     }
//   };

//   const numberToIndianWords = (num) => {
//     if (!num || isNaN(num)) return "";

//     const ones = [
//       "",
//       "One",
//       "Two",
//       "Three",
//       "Four",
//       "Five",
//       "Six",
//       "Seven",
//       "Eight",
//       "Nine",
//       "Ten",
//       "Eleven",
//       "Twelve",
//       "Thirteen",
//       "Fourteen",
//       "Fifteen",
//       "Sixteen",
//       "Seventeen",
//       "Eighteen",
//       "Nineteen",
//     ];

//     const tens = [
//       "",
//       "",
//       "Twenty",
//       "Thirty",
//       "Forty",
//       "Fifty",
//       "Sixty",
//       "Seventy",
//       "Eighty",
//       "Ninety",
//     ];

//     const twoDigits = (n) =>
//       n < 20
//         ? ones[n]
//         : tens[Math.floor(n / 10)] + (n % 10 ? " " + ones[n % 10] : "");

//     const threeDigits = (n) => {
//       if (n === 0) return "";
//       if (n < 100) return twoDigits(n);
//       return (
//         ones[Math.floor(n / 100)] +
//         " Hundred" +
//         (n % 100 ? " " + twoDigits(n % 100) : "")
//       );
//     };

//     const crore = Math.floor(num / 10000000);
//     const lakh = Math.floor((num % 10000000) / 100000);
//     const thousand = Math.floor((num % 100000) / 1000);
//     const hundred = num % 1000;

//     let result = "";

//     if (crore) result += twoDigits(crore) + " Crore ";
//     if (lakh) result += twoDigits(lakh) + " Lakh ";
//     if (thousand) result += twoDigits(thousand) + " Thousand ";
//     if (hundred) result += threeDigits(hundred);

//     return result.trim() + " per annum";
//   };

//   const today = new Date();

//   // 18 years ago (max allowed DOB)
//   const maxDate = new Date(
//     today.getFullYear() - 18,
//     today.getMonth(),
//     today.getDate(),
//   )
//     .toISOString()
//     .split("T")[0];

//   // 70 years ago (min allowed DOB)
//   const minDate = new Date(
//     today.getFullYear() - 70,
//     today.getMonth(),
//     today.getDate(),
//   )
//     .toISOString()
//     .split("T")[0];

//   const [dobError, setDobError] = useState("");

//   const handleDobChange = (value) => {
//     setFormData({ ...formData, dob: value });

//     if (!value) {
//       setDobError("Date of Birth is required");
//       return;
//     }

//     const selected = new Date(value);

//     if (selected > new Date(maxDate)) {
//       setDobError("Age must be at least 18 years");
//     } else if (selected < new Date(minDate)) {
//       setDobError("Age must be below 70 years");
//     } else {
//       setDobError("");
//     }
//   };

  

//   if (fetchingData)
//     return (
//       <div className="min-h-screen flex flex-col items-center justify-center bg-slate-50 gap-4">
//         <Loader2 className="h-10 w-10 animate-spin text-blue-600" />
//         <p className="text-[11px] font-black uppercase tracking-[0.2em] text-slate-400">
//           Loading Data Load {effectiveId}...
//         </p>
//       </div>
//     );

//   return (
//     <div className="min-h-screen bg-[#F8FAFC] p-4 md:p-12 antialiased">
//       <div className="max-w-6xl mx-auto space-y-8" ref={dropdownContainerRef}>
//         {/* ROADMAP HEADER */}
//         <div className="flex flex-col lg:flex-row justify-between items-center bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 gap-8">
//           <div className="flex items-center gap-6">
//             <div className="h-16 w-16 bg-slate-900 rounded-[1.5rem] flex items-center justify-center text-white shadow-2xl">
//               <Database size={32} />
//             </div>
//             <div>
//               <h2 className="text-2xl font-black text-slate-900 tracking-tight leading-none">
//                 {id ? "Profile" : "Manual Registry"}
//               </h2>
//               <div className="flex items-center gap-2 mt-1 text-blue-600">
//                 <ShieldCheck size={14} />
//               </div>
//             </div>
//           </div>

//           <div className="flex-1 max-w-2xl w-full px-4">
//             <div className="relative flex justify-between items-center w-full">
//               <div className="absolute top-1/2 left-0 w-full h-0.5 bg-slate-100 -translate-y-1/2 z-0" />
//               <div
//                 className="absolute top-1/2 left-0 h-0.5 bg-blue-600 -translate-y-1/2 z-0 transition-all duration-700"
//                 style={{ width: `${((step - 1) / (totalSteps - 1)) * 100}%` }}
//               />
//               {/* {[1, 2, 3, 4, 5].map((num) => ( */}
//               {[1, 2, 3, 4, 5, 6].map((num) => (
//                 <div
//                   key={num}
//                   className="relative z-10 flex flex-col items-center gap-2"
//                 >
                 
//                   <div
//   className={`h-8 w-8 rounded-full flex items-center justify-center text-[10px] font-black transition-all border-4
//   ${
//     step === num
//       ? "bg-blue-600 text-white border-blue-100 scale-110 shadow-lg"
//       : step > num
//       ? "bg-emerald-500 text-white border-emerald-50"
//       : (
//           (num === 1 && isStep1Incomplete()) ||
//           (num === 2 && isStep2Incomplete()) ||
//           (num === 3 && isStep3Incomplete()) ||
//           (num === 4 && isStep4Incomplete()) ||
//           (num === 5 && isStep5Incomplete())
//         )
//       ? "bg-yellow-400 text-white border-yellow-100"
//       : "bg-white text-slate-300 border-slate-50"
//   }`}
// >
//   {step > num ? <Check size={14} strokeWidth={4} /> : num}
// </div>

//                   <span
//                     className={`absolute -bottom-6 text-[8px] font-black uppercase tracking-tighter transition-colors duration-300 ${step === num ? "text-blue-600" : "text-slate-300"}`}
//                   >
//                     {/* {num === 1 && "Personal"} {num === 2 && "Location"}{" "}
//                     {num === 3 && "Experience"} {num === 4 && "Assets & skill"}{" "}
//                     {num === 5 && "Documents"} */}
//                     {num === 1 && "Personal"}
// {num === 2 && "Location"}
// {num === 3 && "Education"}    
// {num === 4 && "Experience"}
// {num === 5 && "Assets & Skill"}
// {num === 6 && "Documents"}

//                   </span>
//                 </div>
//               ))}
//             </div>
//           </div>
//           <div className="bg-slate-50 border border-slate-200 rounded-2xl px-6 py-3 flex items-center gap-3 shadow-inner">
//             <div className="text-right">
//               <p className="text-[8px] font-black text-slate-400 uppercase leading-none">
//                 Status
//               </p>
//               <p className="text-sm font-black text-slate-900 mt-1">
//                 {Math.round((step / totalSteps) * 100)}%
//               </p>
//             </div>
//             <div className="h-8 w-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center">
//               <Check size={18} />
//             </div>
//           </div>
//         </div>

//         <form onSubmit={handleSubmit}>
//           <div className="space-y-12">
//             {/* STEP 1: IDENTITY & CAREER */}
//             {step === 1 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8 duration-500">
//                 <div className="flex items-center gap-4 pb-4 border-b border-slate-100">
//                   <User size={18} className="text-blue-600" />
//                   <h3 className="text-sm font-black text-slate-800 uppercase tracking-widest">
//                     Basic Candidate profile
//                   </h3>
//                 </div>
//                 <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
//                   <FormField label="Full Name" required>
//                     <input
//                       placeholder="Legal Name"
//                       value={formData.name}
//                       onChange={(e) =>
//                         setFormData({ ...formData, name: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <FormField label="Email" required>
//                     <input
//                       type="email"
//                       placeholder="name@domain.com"
//                       value={formData.email}
//                       onChange={(e) =>
//                         setFormData({ ...formData, email: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <FormField label="Phone" required>
//                     <div className="flex items-center bg-slate-50 border border-slate-200 rounded-xl overflow-hidden focus-within:bg-white focus-within:border-blue-500 transition-all shadow-sm">
//                       <span className="px-3 text-[11px] font-black text-slate-400">
//                         +91
//                       </span>
//                       <input
//                         maxLength={10}
//                         value={formData.phone}
//                         onChange={(e) =>
//                           setFormData({ ...formData, phone: e.target.value })
//                         }
//                         className="w-full px-3 py-2 bg-transparent text-[13px] font-bold outline-none"
//                       />
//                     </div>
//                   </FormField>
//                   <FormField label="Gender">
//                     <select
//                       value={formData.gender}
//                       onChange={(e) =>
//                         setFormData({ ...formData, gender: e.target.value })
//                       }
//                       className={inputStyle}
//                     >
//                       <option value="">Select</option>
//                       <option value="male">Male</option>
//                       <option value="female">Female</option>
//                       <option value="transgender">Transgender</option>
//                       <option value="prefer_not_to_say">
//                         Prefer not to say
//                       </option>
//                     </select>
//                   </FormField>
//                 </div>

//                 <div className="grid grid-cols-1 md:grid-cols-2 gap-8 pt-4">
//                   <FormField label="Date of Birth">
//                     <input
//                       type="date"
//                       min={minDate}
//                       max={maxDate}
//                       value={formData.dob}
//                       onChange={(e) =>
//                         setFormData({ ...formData, dob: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <FormField label="Languages">
//                     <div className="bg-slate-50 border border-slate-200 rounded-xl p-3 max-h-32 overflow-y-auto grid grid-cols-2 gap-3 shadow-inner">
//                       {[
//                         "English",
//                         "Hindi",
//                         "Marathi",
//                         "Gujarati",
//                         "Tamil",
//                         "Telugu",
//                       ].map((lang) => (
//                         <label
//                           key={lang}
//                           className="flex items-center gap-2 text-[11px] font-medium text-slate-600 cursor-pointer hover:text-blue-600 transition-colors"
//                         >
//                           <input
//                             type="checkbox"
//                             checked={formData.languages_spoken.includes(lang)}
//                             onChange={() => {
//                               const u = formData.languages_spoken.includes(lang)
//                                 ? formData.languages_spoken.filter(
//                                     (l) => l !== lang,
//                                   )
//                                 : [...formData.languages_spoken, lang];
//                               setFormData({ ...formData, languages_spoken: u });
//                             }}
//                             className="w-3.5 h-3.5 accent-blue-600 rounded"
//                           />{" "}
//                           {lang}
//                         </label>
//                       ))}
//                     </div>
//                   </FormField>
//                 </div>
//                 <FormField label="Bio Summary">
//                   <textarea
//                     rows={3}
//                     value={formData.about_me}
//                     onChange={(e) =>
//                       setFormData({ ...formData, about_me: e.target.value })
//                     }
//                     className={inputStyle + " resize-none"}
//                   />
//                 </FormField>
//                 <div className="flex justify-end pt-4">
//                   <button
//                     type="button"
//                     // onClick={() => setStep(2)}
//                     onClick={async () => {
//                       await saveStepData(1);
//                       setStep(2);
//                     }}
//                     className={`px-12 py-3 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest shadow-xl active:scale-95 transition-all`}
//                   >
//                     Next Phase â†’
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 2: GEOGRAPHY */}
//             {step === 2 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8">
//                 <div className="flex items-center gap-3 pb-4 border-b border-slate-100">
//                   <MapPin size={18} className="text-blue-600" />
//                   <h3 className="text-xs font-black text-slate-800 uppercase tracking-widest">
//                     location Data
//                   </h3>
//                 </div>
//                 <div className="space-y-8">
//                   <FormField label="Address 1" required>
//                     <input
//                       value={formData.address}
//                       onChange={(e) =>
//                         setFormData({ ...formData, address: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                     <FormField label="Address 2" required>
//                       <input
//                         value={formData.location}
//                         onChange={(e) =>
//                           setFormData({ ...formData, location: e.target.value })
//                         }
//                         className={inputStyle}
//                       />
//                     </FormField>
//                     <FormField label="Pincode" required>
//                       <input
//                         maxLength={6}
//                         placeholder="000000"
//                         value={formData.pincode}
//                         onChange={(e) => {
//                           setFormData({ ...formData, pincode: e.target.value });
//                           if (e.target.value.length === 6)
//                             fetchPincodeDetails(e.target.value);
//                         }}
//                         className={inputStyle}
//                       />
//                     </FormField>
//                   </div>
//                   <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
                    
//                     <FormField label="City">
//                       {isFetchingPincode ? (
//                         <input
//                           value="Fetching..."
//                           readOnly
//                           className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-400 shadow-inner"
//                         />
//                       ) : cityOptions.length > 1 ? (
//                         <select
//                           value={formData.city}
//                           onChange={(e) => {
//                             const selected = cityOptions.find(
//                               (c) => c.Name === e.target.value,
//                             );

//                             setFormData((prev) => ({
//                               ...prev,
//                               city: selected?.Name || "",
//                               district: selected?.District || "",
//                               state: selected?.State || "",
//                               country: selected?.Country || "India",
//                             }));
//                           }}
//                           className="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl text-xs font-bold text-slate-700 shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100"
//                         >
//                           {cityOptions.map((c, i) => (
//                             <option key={i} value={c.Name}>
//                               {c.Name}
//                             </option>
//                           ))}
//                         </select>
//                       ) : (
//                         <input
//                           value={formData.city || ""}
//                           readOnly
//                           className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                         />
//                       )}
//                     </FormField>

//                     <FormField label="District">
//                       <input
//                         // value={formData.district}
//                         value={
//                           isFetchingPincode ? "Fetching..." : formData.district
//                         }
//                         readOnly
//                         className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                       />
//                     </FormField>
//                     <FormField label="State">
//                       <input
//                         // value={formData.state}
//                         value={
//                           isFetchingPincode ? "Fetching..." : formData.state
//                         }
//                         readOnly
//                         className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                       />
//                     </FormField>
//                     <FormField label="Country">
//                       <input
//                         // value={formData.country}
//                         value={
//                           isFetchingPincode ? "Fetching..." : formData.country
//                         }
//                         readOnly
//                         onChange={(e) =>
//                           setFormData({ ...formData, country: e.target.value })
//                         }
//                         className={inputStyle}
//                       />
//                     </FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-between pt-8 border-t border-slate-50">
//                   <button
//                     onClick={() => setStep(1)}
//                     type="button"
//                     className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase hover:text-slate-900 transition-all shadow-sm"
//                   >
//                     â† Back
//                   </button>
//                   <button
//                     //  onClick={() => setStep(3)}
//                     onClick={async () => {
//                       await saveStepData(2);
//                       setStep(3);
//                     }}
//                     type="button"
//                     className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase shadow-xl transition-all"
//                   >
//                     Continue â†’
//                   </button>
//                 </div>
//               </div>
//             )}


//             {/* STEP 3: EDUCATION */}
// {/* {step === 3 && (
//   <div className="bg-white p-10 rounded-[3rem] border border-slate-200 space-y-8">

//     <h3 className="text-sm font-black uppercase tracking-widest text-slate-800">
//       Education Details
//     </h3>

  
//     {Array.isArray(formData.education) &&
//   formData.education.map((edu, i) => (
//       <div key={i} className="grid grid-cols-1 md:grid-cols-3 gap-6">

//         <input
//           placeholder="Degree"
//           value={edu.degree}
//           onChange={(e) => {
//             const updated = [...formData.education];
//             updated[i].degree = e.target.value;
//             setFormData({ ...formData, education: updated });
//           }}
//           className={inputStyle}
//         />

//         <input
//           placeholder="Institute"
//           value={edu.institute}
//           onChange={(e) => {
//             const updated = [...formData.education];
//             updated[i].institute = e.target.value;
//             setFormData({ ...formData, education: updated });
//           }}
//           className={inputStyle}
//         />

//         <input
//           type="number"
//           placeholder="Year"
//           value={edu.year}
//           onChange={(e) => {
//             const updated = [...formData.education];
//             updated[i].year = e.target.value;
//             setFormData({ ...formData, education: updated });
//           }}
//           className={inputStyle}
//         />

//       </div>
//     ))}

//     <button
//       type="button"
//       onClick={() =>
//         setFormData({
//           ...formData,
//           education: [
//             ...formData.education,
//             { degree: "", institute: "", year: "" },
//           ],
//         })
//       }
//       className="px-6 py-3 bg-blue-600 text-white rounded-xl text-xs font-bold"
//     >
//       + Add Education
//     </button>

//     <div className="flex justify-between pt-6">
//       <button onClick={() => setStep(2)} type="button">Back</button>
//       <button
//         type="button"
//         onClick={async () => {
//           await saveStepData(3);
//           setStep(4);
//         }}
//       >
//         Continue â†’
//       </button>
//     </div>
//   </div>
// )} */}


// {step === 3 && (
//   <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
//     <div className="bg-white p-8 rounded-[3.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 space-y-10 relative overflow-hidden">
//       <div className="flex flex-col sm:flex-row justify-between items-center border-b border-slate-50 pb-8 relative z-10">
//         <div className="flex items-center gap-4">
//           <div className="h-10 w-10 rounded-xl bg-slate-900 flex items-center justify-center text-white shadow-lg">
//             <Award size={20} />
//           </div>
//           <h3 className="text-sm font-black text-slate-900 uppercase tracking-widest">Education Registry</h3>
//         </div>
//         <button
//           type="button"
//           onClick={() => {
//             setIsEditingEdu(false);
//             setNewEdu({ education_id: 0, institution_name: "", start_year: "", end_year: "", education_name: "" });
//             fetchMasterEducations();
//             setShowEduModal(true);
//           }}
//           className="px-6 py-3 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl shadow-blue-200 hover:bg-blue-700 transition-all flex items-center gap-2"
//         >
//           <Plus size={14} strokeWidth={3} /> Add Education
//         </button>
//       </div>

//       {/* VERIFIED EDUCATION LIST */}
//       {/* <div className="space-y-4 relative z-10">
//         {formData.education && formData.education.length > 0 ? (
//           formData.education.map((edu, i) => (
//             <div key={i} className="group relative flex flex-col md:flex-row items-center gap-6 p-6 bg-slate-50/50 border border-slate-100 rounded-[2rem] hover:bg-white hover:border-blue-300 transition-all">
//               <div className="w-12 h-12 flex-shrink-0 bg-white border border-slate-200 rounded-xl flex items-center justify-center text-[11px] font-black text-slate-900 shadow-sm">
//                 0{i + 1}
//               </div>
//               <div className="flex-1 min-w-0">
//                 <div className="flex items-center gap-3 mb-1">
//                   <h4 className="text-sm font-black text-slate-900 uppercase tracking-tight truncate">{edu.institution_name}</h4>
//                   <span className="h-1 w-1 rounded-full bg-slate-300" />
//                   <span className="text-[10px] font-bold text-blue-600 uppercase tracking-widest">{edu.education_name || "Degree Node"}</span>
//                 </div>
//                 <div className="flex items-center gap-4 text-slate-400">
//                   <div className="flex items-center gap-1.5">
//                     <Calendar size={12} />
//                     <span className="text-[10px] font-black uppercase">{edu.start_year} â€” {edu.end_year}</span>
//                   </div>
//                 </div>
//               </div>
//               <button 
//                 type="button" 
//                 onClick={() => {
//                   setIsEditingEdu(true);
//                   setCurrentEduId(edu.id);
//                   setNewEdu(edu);
//                   fetchMasterEducations();
//                   setShowEduModal(true);
//                 }}
//                 className="p-3 bg-white border border-slate-200 rounded-xl text-slate-400 hover:text-blue-600 hover:border-blue-600 transition-all shadow-sm"
//               >
//                 <Edit3 size={16} />
//               </button>
//             </div>
//           ))
//         ) : (
//           <div className="text-center py-16 bg-slate-50/30 border-2 border-dashed border-slate-100 rounded-[2.5rem]">
//             <Database className="mx-auto text-slate-200 mb-4" size={32} />
//             <p className="text-[10px] font-black text-slate-300 uppercase tracking-[0.2em]">No Academic Nodes Recorded</p>
//           </div>
//         )}
//       </div> */}
//       {/* VERIFIED EDUCATION LIST */}
// {/* VERIFIED EDUCATION LIST */}
// <div className="space-y-4 relative z-10">
//   {formData.education && formData.education.length > 0 ? (
//     formData.education.map((edu, i) => (
//       <div key={i} className="group relative flex flex-col md:flex-row items-center gap-6 p-6 bg-slate-50/50 border border-slate-100 rounded-[2rem] hover:bg-white  transition-all border-l-4 border-l-blue-600">
        
//         {/* Node Index */}
//         <div className="w-12 h-12 flex-shrink-0 bg-white border border-slate-200 rounded-xl flex items-center justify-center text-[11px] font-black text-slate-900 shadow-sm">
//           0{i + 1}
//         </div>

//         {/* Content Node */}
//         <div className="flex-1 min-w-0">
//           <div className="flex items-center gap-3 mb-1">
//             <h4 className="text-sm font-black text-slate-900 uppercase tracking-tight truncate">
//               {edu.institution_name}
//             </h4>
//             <span className="h-1 w-1 rounded-full bg-slate-300" />
//             <div className="px-2 py-0.5 bg-blue-50 text-blue-700 rounded-md text-[9px] font-black uppercase tracking-widest border border-blue-100/50">
//               {edu.education_name} {/* Displays "Btech", "HSC", etc. */}
//             </div>
//           </div>
          
//           <div className="flex items-center gap-4 text-slate-400">
//             <div className="flex items-center gap-1.5">
//               <Calendar size={12} className="text-slate-300" />
//               <span className="text-[10px] font-black uppercase tracking-widest">
//                 {edu.start_year} <span className="text-slate-200 mx-1">â€”</span> {edu.end_year}
//               </span>
//             </div>
//           </div>
//         </div>

//         {/* Action Node */}
//         <button 
//           type="button" 
//           onClick={() => {
//             setIsEditingEdu(true);
//             setCurrentEduId(edu.id);
//             // Pre-fill modal
//             setNewEdu({
//               education_id: edu.education_id,
//               institution_name: edu.institution_name,
//               start_year: edu.start_year,
//               end_year: edu.end_year,
//               education_name: edu.education_name
//             });
//             setEduSearch(edu.education_name);
//             setShowEduModal(true);
//           }}
//           className="p-3 bg-white border border-slate-200 rounded-xl text-slate-400 hover:text-blue-600 hover:border-blue-600 transition-all shadow-sm active:scale-90"
//         >
//           <Edit3 size={16} />
//         </button>
//       </div>
//     ))
//   ) : (
//     <div className="text-center py-16 bg-slate-50/30 border-2 border-dashed border-slate-100 rounded-[2.5rem]">
//       <Database className="mx-auto text-slate-200 mb-4" size={32} />
//       <p className="text-[10px] font-black text-slate-300 uppercase tracking-[0.2em]">Zero Academic Nodes Registered</p>
//     </div>
//   )}
// </div>
//     </div>

//     {/* NAVIGATION */}
//     <div className="flex justify-between pt-6">
//       <button type="button" onClick={() => setStep(2)} className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[10px] font-black uppercase shadow-sm">â† Back</button>
//       <button
//         type="button"
//         onClick={async () => { await saveStepData(3); setStep(4); }}
//         className="px-12 py-4 rounded-2xl text-[10px] font-black uppercase shadow-xl bg-blue-600 text-white shadow-blue-200 hover:bg-blue-700"
//       >Commit & Continue â†’</button>
//     </div>

//     {/* EDUCATION MODAL */}
//   {/* 2. Updated Modal Content */}
// {showEduModal && (
//   <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 md:p-8 bg-slate-900/60 backdrop-blur-md animate-in fade-in duration-300">
//     <div className="bg-white w-full max-w-4xl rounded-[3rem] shadow-2xl border border-slate-200 flex flex-col overflow-hidden animate-in zoom-in-95">
      
//       {/* Modal Header */}
//       <div className="px-10 py-8 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
//         <div className="flex items-center gap-4">
//           <div className="w-14 h-14 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-2xl shadow-blue-200">
//             <Award size={28} strokeWidth={2.5} />
//           </div>
//           <div>
//             <h2 className="text-base font-black text-slate-900 uppercase tracking-[0.2em]">Education Terminal</h2>
//             <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Authorized Academic Entry</p>
//           </div>
//         </div>
//         <button onClick={() => { setShowEduModal(false); setEduDropdownOpen(false); }} className="w-12 h-12 flex items-center justify-center bg-white border border-slate-100 hover:bg-red-50 hover:text-red-500 rounded-full transition-all shadow-sm">
//           <X size={24} />
//         </button>
//       </div>

//       <div className="p-10 space-y-8 bg-white overflow-visible">
//         <div className="grid grid-cols-1 md:grid-cols-2 gap-8 overflow-visible">
          
//           {/* SEARCHABLE DROPDOWN */}
//           <div className="space-y-2 relative" ref={dropdownContainerRef}>
//             <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1 leading-none">
//               Degree Specification
//             </label>
//             <div className="relative group">
//               <input 
//                 placeholder="Search node (HSC, Btech, SSC...)" 
//                 value={eduSearch} 
//                 onFocus={() => {
//                   setEduDropdownOpen(true);
//                   if (masterEducations.length === 0) fetchMasterEducations();
//                 }}
//                 onChange={(e) => {
//                   setEduSearch(e.target.value);
//                   setEduDropdownOpen(true);
//                 }}
//                 className={inputStyle + " pr-10 focus:border-blue-600 transition-all"} 
//               />
//               <div className="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400">
//                 {fetchingData ? <Loader2 size={16} className="animate-spin" /> : <ChevronDown size={16} />}
//               </div>
//             </div>

//             {/* Dropdown Result Panel */}
//             {eduDropdownOpen && (
//               <div className="absolute z-[110] w-full mt-2 bg-white border border-slate-200 rounded-2xl shadow-2xl overflow-hidden animate-in fade-in slide-in-from-top-2">
//                 <div className="max-h-[220px] overflow-y-auto custom-scrollbar-professional p-2 space-y-1 bg-white">
//                   {masterEducations.filter(m => 
//                     (m.name || "").toLowerCase().includes(eduSearch.toLowerCase())
//                   ).length > 0 ? (
//                     masterEducations
//                       .filter(m => (m.name || "").toLowerCase().includes(eduSearch.toLowerCase()))
//                       .slice(0, 20)
//                       .map((m) => (
//                         <button
//                           key={m.id}
//                           type="button"
//                           onClick={() => {
//                             setNewEdu({ ...newEdu, education_id: m.id, education_name: m.name });
//                             setEduSearch(m.name);
//                             setEduDropdownOpen(false);
//                           }}
//                           className={`w-full text-left px-4 py-3 rounded-xl text-xs font-bold transition-all flex items-center justify-between group/item ${
//                             newEdu.education_id === m.id 
//                               ? "bg-blue-600 text-white" 
//                               : "text-slate-700 hover:bg-slate-50 hover:text-blue-600"
//                           }`}
//                         >
//                           <span className="uppercase tracking-tight">{m.name}</span>
//                           {newEdu.education_id === m.id ? (
//                             <CheckCircle size={14} className="text-white" />
//                           ) : (
//                             <ChevronRight size={14} className="opacity-0 group-hover/item:opacity-100 transition-opacity" />
//                           )}
//                         </button>
//                       ))
//                   ) : (
//                     <div className="py-8 text-center bg-slate-50/50 rounded-xl">
//                        <p className="text-[10px] font-black text-slate-300 uppercase tracking-widest">No matching degree nodes</p>
//                     </div>
//                   )}
//                 </div>
//               </div>
//             )}
//           </div>

//           <FormField label="Institution Name">
//             <input 
//               placeholder="e.g. Mumbai University" 
//               value={newEdu.institution_name} 
//               onChange={(e) => setNewEdu({ ...newEdu, institution_name: e.target.value })} 
//               className={inputStyle} 
//             />
//           </FormField>
//         </div>

//         {/* <div className="grid grid-cols-2 gap-8">
//           <FormField label="Commencement Year">
//             <input type="number" placeholder="YYYY" value={newEdu.start_year} onChange={(e) => setNewEdu({ ...newEdu, start_year: e.target.value })} className={inputStyle} />
//           </FormField>
//           <FormField label="Completion Year">
//             <input type="number" placeholder="YYYY" value={newEdu.end_year} onChange={(e) => setNewEdu({ ...newEdu, end_year: e.target.value })} className={inputStyle} />
//           </FormField>
//         </div> */}

//         <div className="grid grid-cols-2 gap-8">
//   {/* START YEAR NODE */}
//   <FormField label="Commencement Year">
//     <div className="relative group">
//       <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-600 transition-colors">
//         <Calendar size={16} />
//       </div>
//       <input 
//         type="number" 
//         placeholder="YYYY" 
//         min="1970"
//         max="2030"
//         value={newEdu.start_year} 
//         onChange={(e) => setNewEdu({ ...newEdu, start_year: e.target.value })} 
//         className={inputStyle + " pl-12 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"} 
//       />
//     </div>
//   </FormField>

//   {/* END YEAR NODE */}
//   <FormField label="Completion Year">
//     <div className="relative group">
//       <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-600 transition-colors">
//         <Calendar size={16} />
//       </div>
//       <input 
//         type="number" 
//         placeholder="YYYY" 
//         min="1970"
//         max="2030"
//         value={newEdu.end_year} 
//         onChange={(e) => setNewEdu({ ...newEdu, end_year: e.target.value })} 
//         className={inputStyle + " pl-12 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"} 
//       />
//     </div>
//   </FormField>
// </div>

//         <div className="flex justify-end pt-6 border-t border-slate-100">
//           <button
//             type="button"
//             onClick={handleSaveEducation}
//             className="px-10 py-4 bg-slate-900 text-white rounded-2xl text-[11px] font-black uppercase tracking-widest shadow-2xl active:scale-95 transition-all flex items-center gap-3 hover:bg-slate-800"
//           >
//             <CheckCircle size={18} /> {isEditingEdu ? "Commit Update" : "Synchronize Node"}
//           </button>
//         </div>
//       </div>
//     </div>
//   </div>
// )}
//   </div>
// )}


//             {/* STEP 4: EXPERIENCE */}
           

// {step === 4 && (
//   <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
//     {/* STATUS SELECTOR CARD */}
//     <div className="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-sm overflow-hidden relative group">
//       <Fingerprint className="absolute -right-6 -bottom-6 text-slate-50 opacity-[0.4] -rotate-12 pointer-events-none" size={100} />
//       <div className="flex flex-col md:flex-row items-center justify-between gap-6 relative z-10">
//         <div className="flex items-center gap-4 text-slate-900 font-black">
//           <div className="w-12 h-12 bg-blue-50 rounded-2xl flex items-center justify-center text-blue-600 shadow-inner">
//             <Briefcase size={22} strokeWidth={2.5} />
//           </div>
//           <div>
//             <h3 className="text-sm uppercase tracking-[0.15em]">Are you Fresher?</h3>
//             <p className="text-[10px] font-bold text-slate-400 mt-1 uppercase tracking-widest">Career status determines validation protocol</p>
//           </div>
//         </div>
//         <div className="flex bg-slate-100 p-1.5 rounded-[1.5rem] border border-slate-200 w-full md:w-auto">
//           <button
//             type="button"
//             disabled={hasExistingExperience}
//             onClick={() => {
//               if (hasExistingExperience) return;
//               setIsFresher(true);
//               setFormData({ ...formData, experiences: [] });
//             }}
//             className={`px-10 py-3 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === true ? "bg-white text-blue-600 shadow-sm border border-slate-200" : "text-slate-400"}`}
//           >YES</button>
//           <button
//             type="button"
//             onClick={() => setIsFresher(false)}
//             className={`px-10 py-3 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === false ? "bg-white text-blue-600 shadow-sm border border-slate-200" : "text-slate-400"}`}
//           >NO</button>
//         </div>
//       </div>
//     </div>

//     {/* EXPERIENCE TIMELINE DISPLAY */}
//     {isFresher === false && (
//       <div className="bg-white p-8 rounded-[3.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 space-y-10 relative overflow-hidden">
//         <div className="flex flex-col sm:flex-row justify-between items-center border-b border-slate-50 pb-8 relative z-10">
//           <div className="flex items-center gap-4">
//             <div className="h-10 w-10 rounded-xl bg-slate-900 flex items-center justify-center text-white shadow-lg">
//               <History size={20} />
//             </div>
//             <h3 className="text-sm font-black text-slate-900 uppercase tracking-widest">Job Experience History</h3>
//           </div>
//           <button
//             type="button"
//             onClick={() => {
//               if (newExperiences.length === 0) {
//                 setNewExperiences([{ company_name: "", job_title: "", start_date: "", end_date: "", previous_ctc: "", location: "", description: "" }]);
//               }
//               setShowExpModal(true);
//             }}
//             className="px-6 py-3 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl shadow-blue-200 hover:bg-blue-700 active:scale-95 transition-all flex items-center gap-2"
//           >
//             <Plus size={14} strokeWidth={3} /> Add Experience
//           </button>
//         </div>

//         {/* VERIFIED DATA LIST (Shows existing records from formData) */}
      
//         <div className="space-y-4 relative z-10 animate-in fade-in slide-in-from-bottom-4 duration-700">
//   {formData.experiences && formData.experiences.length > 0 ? (
//     formData.experiences.map((exp, i) => (
//       <div 
//         key={i} 
//         className="group relative flex flex-col md:flex-row items-stretch gap-0 bg-white border border-slate-200 rounded-[1.5rem] hover:border-blue-400 hover:shadow-xl hover:shadow-blue-500/5 transition-all duration-300 overflow-hidden"
//       >
//         {/* SIDE BRANDING BAR: Denotes 'Verified Node' status */}
//         <div className="w-1.5 bg-blue-600 group-hover:w-2 transition-all duration-300" />

//         {/* INDEX NODE: Terminal Style */}
//         <div className="flex items-center justify-center px-6 bg-slate-50/50 border-r border-slate-100">
//           <div className="w-10 h-10 rounded-xl bg-white border border-slate-200 flex flex-col items-center justify-center shadow-sm group-hover:border-blue-200 transition-colors">
//             <span className="text-[10px] font-black text-slate-400 leading-none uppercase tracking-tighter">exp</span>
//             <span className="text-sm font-black text-slate-900 leading-none mt-1">0{i + 1}</span>
//           </div>
//         </div>

//         {/* MAIN CONTENT STRIP */}
//         <div className="flex-1 p-5 md:p-6 flex flex-col md:flex-row md:items-center justify-between gap-6">
//           <div className="min-w-0 space-y-2">
//             {/* Entity & Role */}
//             <div className="flex items-center gap-3">
//               <h4 className="text-sm font-black text-slate-900 uppercase tracking-tight truncate group-hover:text-blue-600 transition-colors">
//                 {exp.company_name || "Unidentified Entity"}
//               </h4>
//               <div className="h-1 w-1 rounded-full bg-slate-300" />
//               <div className="px-2 py-0.5 bg-blue-50 text-blue-700 rounded-md text-[9px] font-black uppercase tracking-widest border border-blue-100/50">
//                 {exp.job_title || "Role Pending"}
//               </div>
//             </div>

//             {/* Deployment Meta-Data */}
//             <div className="flex flex-wrap items-center gap-x-6 gap-y-2">
//               <div className="flex items-center gap-2 text-slate-400">
//                 <Calendar size={13} className="text-slate-300" />
//                 <span className="text-[10px] font-bold uppercase tracking-widest">
//                   {exp.start_date || "----"} <span className="text-slate-200 mx-1">â€”</span> {exp.end_date || "Present"}
//                 </span>
//               </div>
//               <div className="flex items-center gap-2 text-slate-400">
//                 <MapPin size={13} className="text-slate-300" />
//                 <span className="text-[10px] font-bold uppercase tracking-widest">{exp.location || "Global Node"}</span>
//               </div>
//             </div>
//           </div>

//           {/* FINANCIAL NODE: High Contrast Badge */}
//           <div className="flex items-center gap-6">
//             <div className="flex flex-col items-end border-r border-slate-100 pr-6">
//               <span className="text-[8px] font-black text-slate-400 uppercase tracking-[0.2em] mb-1">Previous CTC</span>
//               <div className="flex items-center gap-1.5 text-emerald-600">
//                 <div className="h-1.5 w-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]" />
//                 <span className="text-[12px] font-black uppercase tracking-tight">
//                   â‚¹{exp.previous_ctc ? `${(exp.previous_ctc / 100000).toFixed(2)} LPA` : "0.00"}
//                 </span>
//               </div>
//             </div>

//             {/* ACTION INTERFACE */}
//             <div className="flex items-center gap-2">
//               <button 
//                 type="button" 
                
// onClick={() => {
//   const existing = formData.experiences[i];

//   setCurrentEditingIndex(i);

//   setNewExperiences([
//     {
//       ...existing,
//       uploadMode: existing.exp_letter_link ? "link" : "file",
//       expLetterFile: null, // important
//     },
//   ]);

//   setShowExpModal(true);
// }}



//                 className="p-3 bg-slate-50 text-slate-400 hover:bg-blue-600 hover:text-white rounded-xl transition-all duration-300 border border-slate-100 active:scale-90"
//               >
//                 <Edit3 size={16} strokeWidth={2.5} />
//               </button>
//             </div>
//           </div>
//         </div>

//         {/* Decorative Watermark for Enterprise Feel */}
//         <History className="absolute -right-4 -bottom-4 text-slate-900 opacity-[0.02] -rotate-12 pointer-events-none group-hover:opacity-[0.05] transition-opacity" size={100} />
//       </div>
//     ))
//   ) : (
//     /* EMPTY STATE: Audit-Empty Pattern */
//     <div className="relative group flex flex-col items-center justify-center py-20 bg-slate-50/30 border-2 border-dashed border-slate-200 rounded-[2.5rem] transition-colors hover:bg-slate-50">
//       <div className="relative z-10 flex flex-col items-center">
//         <div className="w-16 h-16 bg-white rounded-[1.5rem] shadow-sm border border-slate-100 flex items-center justify-center text-slate-200 mb-6 group-hover:scale-110 transition-transform duration-500">
//           <Database size={32} strokeWidth={1.5} />
//         </div>
//         <h4 className="text-[11px] font-black text-slate-400 uppercase tracking-[0.3em] mb-2">
//           Zero Nodes Synchronized
//         </h4>
//         <p className="text-[10px] font-bold text-slate-300 uppercase tracking-widest text-center max-w-xs">
//           Professional history registry currently empty. Initialize a new experience node to begin.
//         </p>
//       </div>
//       <div className="absolute inset-0 overflow-hidden pointer-events-none rounded-[2.5rem]">
//          <ShieldCheck className="absolute -right-8 -bottom-8 text-slate-900 opacity-[0.02] -rotate-12" size={200} />
//       </div>
//     </div>
//   )}
// </div>
//       </div>
//     )}

//     {/* NAVIGATION */}
//     <div className="flex justify-between pt-6">
//       <button type="button" onClick={() => setStep(3)} className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[10px] font-black uppercase shadow-sm transition-all hover:text-slate-900">â† Back</button>
//       <button
//         type="button"
//         onClick={async () => { await saveStepData(4); setStep(5); }}
//         disabled={isFresher === null}
//         className={`px-12 py-4 rounded-2xl text-[10px] font-black uppercase shadow-xl transition-all ${isFresher !== null ? "bg-blue-600 text-white shadow-blue-200" : "bg-slate-200 text-slate-300 cursor-not-allowed"}`}
//       >Commit & Continue â†’</button>
//     </div>

//     {/* MODAL: ADDING NEW RECORDS ONLY (Upload Logic Removed) */}
   
//     {showExpModal && (
//   <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 md:p-8 bg-slate-900/60 backdrop-blur-md animate-in fade-in duration-300">
//     <div className="bg-white w-full max-w-6xl h-full max-h-[85vh] rounded-[3rem] shadow-2xl border border-slate-200 flex flex-col overflow-hidden animate-in zoom-in-95 duration-300">
      
//       {/* Modal Header */}
//       <div className="px-10 py-8 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
//         <div className="flex items-center gap-4">
//           <div className="w-14 h-14 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-xl shadow-blue-200">
//             <Plus size={28} strokeWidth={3} />
//           </div>
//           <div>
//             {/* <h2 className="text-base font-black text-slate-900 uppercase tracking-[0.2em]">New Experience</h2> */}
//             <h2 className="text-base font-black text-slate-900 uppercase tracking-[0.2em]">
//                 {currentEditingIndex !== null ? "Edit Experience" : "New Experience"}
//             </h2>
//             <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Add new Experience Records</p>
//           </div>
//         </div>
//         <button onClick={() => setShowExpModal(false)} className="w-12 h-12 flex items-center justify-center bg-white border border-slate-100 hover:bg-red-50 hover:text-red-500 rounded-full transition-all shadow-sm">
//           <X size={24} />
//         </button>
//       </div>

//       {/* Modal Content */}
//       <div className="flex-1 overflow-y-auto p-10 space-y-12 custom-scrollbar-professional bg-white">
//         {newExperiences.map((exp, i) => (
//           <div key={i} className="relative bg-slate-50/50 border border-slate-200 p-8 rounded-[2.5rem] space-y-8 animate-in slide-in-from-bottom-4 group hover:bg-white hover:border-blue-200 transition-all">
//             {/* Remove Entry */}
//             <button
//               type="button"
//               onClick={() => setNewExperiences(newExperiences.filter((_, idx) => idx !== i))}
//               className="absolute -top-3 -right-3 h-10 w-10 bg-white border border-slate-200 text-red-500 rounded-full flex items-center justify-center shadow-lg opacity-0 group-hover:opacity-100 transition-all z-20 hover:bg-red-500 hover:text-white"
//             >
//               <Trash2 size={18} />
//             </button>

//             {/* GRID 1: IDENTITY */}
//             <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
//               <FormField label="Employer">
//                 <input placeholder="Company Name" value={exp.company_name} onChange={(e) => { const u = [...newExperiences]; u[i].company_name = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//               </FormField>
//               <FormField label="Designation">
//                 <input placeholder="Job Title" value={exp.job_title} onChange={(e) => { const u = [...newExperiences]; u[i].job_title = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//               </FormField>
//               <FormField label="Location">
//                 <input placeholder="City" value={exp.location} onChange={(e) => { const u = [...newExperiences]; u[i].location = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//               </FormField>
              
//              <FormField label="Industry">
//   <div className="relative">

//     {/* INPUT BOX */}
//     <input
//       value={exp.industry || ""}
//       placeholder="Search or select industry..."
//       onFocus={() => setShowIndustryDrop(true)}
//       onChange={(e) => {
//         const value = e.target.value;
//         setIndustrySearch(value);

//         const u = [...newExperiences];
//         u[i].industry = value;
//         setNewExperiences(u);
//       }}
//       className={inputStyle}
//     />

//     {/* DROPDOWN */}
//     {showIndustryDrop && (
//       <div className="absolute z-50 mt-2 w-full bg-white border border-slate-200 rounded-xl shadow-lg overflow-hidden">

//         {/* LIST â€” SHOW 4 ITEMS HEIGHT */}
//         <div className="max-h-44 overflow-y-auto">

//           {filteredIndustries.length > 0 ? (
//             filteredIndustries.map((ind) => (
//               <div
//                 key={ind}
//                 onClick={() => {
//                   const u = [...newExperiences];
//                   u[i].industry = ind;
//                   setNewExperiences(u);

//                   setIndustrySearch("");
//                   setShowIndustryDrop(false);
//                 }}
//                 className="px-4 py-2 text-[13px] font-bold text-slate-700 hover:bg-blue-50 hover:text-blue-600 cursor-pointer transition"
//               >
//                 {ind}
//               </div>
//             ))
//           ) : (
//             <div className="px-4 py-3 text-xs text-slate-400">
//               No match found
//             </div>
//           )}
//         </div>
//       </div>
//     )}
//   </div>
// </FormField>


//             </div>

//             {/* GRID 2: TIMELINE & CTC */}
//             <div className="grid grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
//               <FormField label="Start Date">
//                 <input type="date" value={exp.start_date} onChange={(e) => { const u = [...newExperiences]; u[i].start_date = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//               </FormField>
//               <FormField label="End Date">
//                 <input type="date" value={exp.end_date} onChange={(e) => { const u = [...newExperiences]; u[i].end_date = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//               </FormField>
//               <FormField label="Annual CTC">
//                 <div className="flex items-center bg-white border border-slate-200 rounded-2xl overflow-hidden focus-within:border-blue-500 transition-all">
//                   <div className="px-4 text-blue-600 font-black italic">â‚¹</div>
//                   <input type="number" placeholder="0.00" value={exp.previous_ctc} onChange={(e) => { const u = [...newExperiences]; u[i].previous_ctc = e.target.value; setNewExperiences(u); }} className="w-full py-3 bg-transparent text-[12px] font-bold outline-none" />
//                   <div className="pr-4 text-[9px] font-black text-slate-400">LPA</div>
//                 </div>
//               </FormField>
//             </div>

//             {/* GRID 3: DESCRIPTION & ARTIFACT UPLOAD */}
//             <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
//               <FormField label="Professional Summary">
//                 <textarea rows={4} placeholder="Briefly describe your role..." value={exp.description} onChange={(e) => { const u = [...newExperiences]; u[i].description = e.target.value; setNewExperiences(u); }} className={inputStyle + " resize-none"} />
//               </FormField>
              
//               <div className="space-y-4">
//                 <div className="flex justify-between items-center px-1">
//                   <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Experience Artifact</p>
//                   <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200 scale-90">
//                     <button
//                       type="button"
//                       onClick={() => { const u = [...newExperiences]; u[i].uploadMode = "file"; setNewExperiences(u); }}
//                       className={`px-4 py-1 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode !== "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                     >FILE</button>
//                     <button
//                       type="button"
//                       onClick={() => { const u = [...newExperiences]; u[i].uploadMode = "link"; setNewExperiences(u); }}
//                       className={`px-4 py-1 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                     >URL</button>
//                   </div>
//                 </div>

//                 <div className="bg-white/50 border-2 border-dashed border-slate-200 rounded-[2rem] p-6 min-h-[140px] flex flex-col justify-center items-center group/upload hover:bg-blue-50/30 transition-all">
//                   {exp.uploadMode !== "link" ? (
//                     <label className="flex flex-col items-center cursor-pointer w-full">
//                       <FileUp size={24} className="text-slate-300 group-hover/upload:text-blue-500 mb-2 transition-colors" />
//                       <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest text-center px-4">
//                         {exp.expLetterFile ? exp.expLetterFile.name : "Select Validation PDF"}
//                       </span>
//                       <input 
//                         type="file" 
//                         accept=".pdf" 
//                         className="hidden" 
//                         onChange={(e) => { const u = [...newExperiences]; u[i].expLetterFile = e.target.files[0]; setNewExperiences(u); }} 
//                       />
//                     </label>
//                   ) : (
//                     <div className="w-full px-4 relative">
//                       <LinkIcon size={16} className="absolute left-7 top-1/2 -translate-y-1/2 text-slate-300" />
//                       <input 
//                         placeholder="Public Storage URI (https://...)" 
//                         value={exp.exp_letter_link || ""} 
//                         onChange={(e) => { const u = [...newExperiences]; u[i].exp_letter_link = e.target.value; setNewExperiences(u); }} 
//                         className={inputStyle + " pl-12"} 
//                       />
//                     </div>
//                   )}
//                 </div>
//               </div>
//             </div>

//             {/* SAVE ACTION */}
//             <div className="flex justify-end pt-4 border-t border-slate-100">
//               <button
//                 type="button"
//                 // onClick={() => handleSaveExperienceAPI(i)} 
//                 onClick={() => handleSaveOrUpdateExperience(i)}
//                 className="flex items-center gap-2 px-8 py-3 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl shadow-blue-200 transition-all hover:bg-blue-700 active:scale-95"
//               >
//                 {/* <CheckCircle size={16} /> Save */}
//                 <CheckCircle size={16} />
// {currentEditingIndex !== null ? "Update" : "Save"}

//               </button>
//             </div>
//           </div>
//         ))}

       
//         {currentEditingIndex === null && (
//   <button
//     type="button"
//     onClick={() =>
//       setNewExperiences([
//         ...newExperiences,
//         {
//           company_name: "",
//           job_title: "",
//           start_date: "",
//           end_date: "",
//           previous_ctc: "",
//           location: "",
//           description: "",
//           industry: "",
//           uploadMode: "file",
//           expLetterFile: null,
//           exp_letter_link: "",
//           candidate_id: effectiveId,
//         },
//       ])
//     }
//     className="w-full py-8 border-2 border-dashed border-slate-400 rounded-[2.5rem] text-slate-500 hover:text-blue-600 hover:border-blue-200 hover:bg-blue-50/20 transition-all text-[11px] font-black uppercase tracking-[0.3em]"
//   >
//     + Add New Row
//   </button>
// )}

//       </div>

//       {/* Modal Footer */}
     
//     </div>
//   </div>
// )} 
//   </div>
// )}


//             {/* STEP 4: INVENTORY */}
//             {step === 5 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 overflow-visible">
//                 <div className="bg-white border border-slate-200 rounded-[3.5rem] shadow-xl overflow-visible shadow-slate-200/50">
//                   <div className="bg-slate-50/50 px-10 py-6 border-b border-slate-200 flex items-center justify-between rounded-t-[3.5rem]">
//                     <div className="flex items-center gap-4">
//                       <div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg">
//                         <Cpu size={20} />
//                       </div>
//                       <div>
//                         <h3 className="text-sm font-black text-slate-900 uppercase tracking-widest leading-none">
//                           Skills & Assets
//                         </h3>
//                       </div>
//                     </div>
//                   </div>
//                   <div className="p-8 md:p-12 space-y-12 overflow-visible">
//                     <FormField label="Skills">
//                       <div className="space-y-6">
//                         <div className="flex flex-col sm:flex-row gap-4 items-end">
//                           <div className="relative max-w-md w-full">
//                             <Plus
//                               size={16}
//                               className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                             />
//                             <input
//                               value={skillInput}
//                               onChange={(e) => setSkillInput(e.target.value)}
//                               onKeyDown={(e) => {
//                                 if (e.key === "Enter") {
//                                   e.preventDefault();
//                                   const name = skillInput.trim();
//                                   if (!name) return;

//                                   // prevent duplicate
//                                   if (!formData.skills.includes(name)) {
//                                     setFormData((prev) => ({
//                                       ...prev,
//                                       skills: [...prev.skills, name],
//                                     }));
//                                   }

//                                   setSkillInput("");
//                                 }
//                               }}
//                               placeholder="Register skill..."
//                               className={inputStyle + " pl-12"}
//                             />
//                           </div>
//                         </div>

//                         <div className="flex flex-wrap gap-3 p-1 w-full min-h-[40px]">
//                           {[
//                             ...new Set([...dynamicSkills, ...formData.skills]),
//                           ].map((skill) => {
//                             const isSelected = formData.skills.includes(skill);

//                             return (
//                               <button
//                                 key={skill}
//                                 type="button"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     skills: isSelected
//                                       ? formData.skills.filter(
//                                           (s) => s !== skill,
//                                         )
//                                       : [...formData.skills, skill],
//                                   })
//                                 }
//                                 className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${
//                                   isSelected
//                                     ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200"
//                                     : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"
//                                 }`}
//                               >
//                                 {skill}
//                                 {isSelected && (
//                                   <Check size={14} strokeWidth={3} />
//                                 )}
//                               </button>
//                             );
//                           })}
//                         </div>
//                       </div>
//                     </FormField>
//                     {/* <FormField label="Enterprise Hardware Matrix"><div className="space-y-6 pt-8 border-t border-slate-100"><div className="relative max-w-md w-full"><Layers size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={assetInput} onChange={(e) => setAssetInput(e.target.value)} onKeyDown={async (e) => { if(e.key === 'Enter') { e.preventDefault(); const v = assetInput.trim(); if(v && !formData.assets.includes(v)) { const ok = await handleAddAssetAPI(v); if(ok) { setFormData({...formData, assets: [...formData.assets, v]}); setAssetInput(""); } } } }} placeholder="Link hardware..." className={inputStyle + " pl-12"} /></div><div className="flex flex-wrap gap-3 p-1">{dynamicAssets.map((asset) => { const isSelected = formData.assets.includes(asset); return (<button key={asset} type="button" onClick={async () => { if(!isSelected) { const ok = await handleAddAssetAPI(asset); if(ok) setFormData({...formData, assets: [...formData.assets, asset]}); } else { setFormData({...formData, assets: formData.assets.filter(a => a !== asset)}); } }} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${isSelected ? "bg-slate-900 border-slate-900 text-white shadow-lg shadow-slate-200" : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`}>{asset} {isSelected && <Check size={14} strokeWidth={3} className="animate-in zoom-in" />}</button>); })}</div></div></FormField> */}
//                     <div className="space-y-6 pt-8 border-t border-slate-100">
//                       <FormField label="Assets">
//                         <div className="space-y-6">
//                           {/* Search & Manual Add Input */}
//                           <div className="relative max-w-md">
//                             <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">
//                               <Layers size={16} />
//                             </div>
//                             <input
//                               value={assetInput}
//                               onChange={(e) => setAssetInput(e.target.value)}
                              
//                               onKeyDown={(e) => {
//                                 if (e.key === "Enter") {
//                                   e.preventDefault();
//                                   const v = assetInput.trim();
//                                   if (!v) return;

//                                   // Prevent duplicate
//                                   if (!formData.assets.includes(v)) {
//                                     setFormData((prev) => ({
//                                       ...prev,
//                                       assets: [...prev.assets, v],
//                                     }));
//                                   }

//                                   setAssetInput("");
//                                 }
//                               }}
//                               placeholder="Type hardware name and press Enter..."
//                               className="w-full pl-12 pr-4 py-3.5 bg-slate-50 border border-slate-200 rounded-2xl text-xs font-bold outline-none focus:bg-white focus:border-slate-900 focus:ring-4 focus:ring-slate-900/5 transition-all shadow-inner"
//                             />
//                           </div>

//                           <div className="flex flex-wrap gap-3 p-1 w-full min-h-[40px]">
//                             {[
//                               ...new Set([
//                                 ...dynamicAssets,
//                                 ...formData.assets,
//                               ]),
//                             ].filter(
//                               (a) => typeof a === "string" && a.trim() !== "",
//                             ).length === 0 ? (
//                               /* âŒ NO ASSETS */
//                               <div className="w-full text-center py-6 bg-slate-50 border border-dashed border-slate-200 rounded-2xl">
//                                 <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">
//                                   No assets available
//                                 </p>
//                               </div>
//                             ) : (
//                               /* âœ… ASSET CHIPS */
//                               [
//                                 ...new Set([
//                                   ...dynamicAssets,
//                                   ...formData.assets,
//                                 ]),
//                               ]
//                                 .filter(
//                                   (a) =>
//                                     typeof a === "string" && a.trim() !== "",
//                                 )
//                                 .map((asset) => {
//                                   const isSelected =
//                                     formData.assets.includes(asset);

//                                   return (
//                                     <button
//                                       key={asset}
//                                       type="button"
//                                       onClick={() =>
//                                         setFormData((prev) => ({
//                                           ...prev,
//                                           assets: isSelected
//                                             ? prev.assets.filter(
//                                                 (a) => a !== asset,
//                                               )
//                                             : [...prev.assets, asset],
//                                         }))
//                                       }
//                                       className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90
//             ${
//               isSelected
//                 ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200"
//                 : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"
//             }`}
//                                     >
//                                       {asset}
//                                       {isSelected && (
//                                         <Check size={14} strokeWidth={3} />
//                                       )}
//                                     </button>
//                                   );
//                                 })
//                             )}
//                           </div>
//                         </div>
//                       </FormField>
//                     </div>
//                   </div>
//                 </div>
//                 <div className="flex justify-between items-center pt-4">
//                   <button
//                     onClick={() => setStep(4)}
//                     type="button"
//                     className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[11px] font-black uppercase transition-all shadow-sm hover:text-slate-900 flex items-center gap-2 transition-all"
//                   >
//                     <ChevronLeft size={16} /> Back
//                   </button>

//                   <button
//                     onClick={async () => {
//                       await saveStepData(5);
//                       setStep(6);
//                     }}
//                     type="button"
//                     className="px-12 py-4 bg-blue-600 text-white rounded-xl text-[11px] font-black uppercase shadow-xl active:scale-95 transition-all flex items-center gap-2 whitespace-nowrap"
//                   >
//                     Next Phase <ChevronRight size={14} />
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 5: DOCUMENT VAULT */}

//             {/* {step === 5 && (
//               <div className="space-y-8 animate-in slide-in-from-bottom-8 duration-500">
//                 <div className="bg-white rounded-[2rem] shadow-2xl shadow-slate-200/50 border border-slate-200 overflow-hidden relative">
                
//                   <div className="bg-slate-50 px-8 py-6 border-b border-slate-200 flex items-center justify-between">
//                     <div className="flex items-center gap-5">
//                       <div className="h-12 w-12 bg-slate-900 rounded-2xl flex items-center justify-center text-white shadow-lg">
//                         <ShieldCheck size={24} />
//                       </div>
//                       <div>
//                         <h3 className="text-lg font-bold text-slate-900 tracking-tight">
//                           Document upload
//                         </h3>

//                         <div className="px-8 pt-6">
//   <select
//     value={docType}
//     onChange={(e) => setDocType(e.target.value)}
//     className="w-60 px-4 py-2 border border-slate-200 rounded-xl text-sm font-bold bg-white"
//   >
//     <option value="resume">Resume</option>
//     <option value="certificate">Certificate</option>
//   </select>
// </div>

//                         <p className="text-[11px] font-semibold text-slate-500 uppercase tracking-widest">
//                           Document Verification
//                         </p>
//                       </div>
//                     </div>
//                     <div className="hidden md:flex items-center gap-2 px-4 py-1.5 bg-blue-50 border border-blue-100 rounded-full">
//                       <div className="h-1.5 w-1.5 rounded-full bg-blue-500 animate-pulse" />
//                       <span className="text-[10px] font-bold text-blue-600 uppercase tracking-tighter">
//                         ready to save
//                       </span>
//                     </div>
//                   </div>

//                   <div className="p-8 md:p-12 space-y-12">
//                     <div className="grid grid-cols-1 lg:grid-cols-2 gap-12">
                 
//                       <div className="space-y-6">
//                         <div className="flex justify-between items-center px-1">
//                           <div className="flex items-center gap-2">
//                             <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">
//                               01. Resume
//                             </span>
//                           </div>
//                           <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200 scale-90">
//                             <button
//                               type="button"
//                               onClick={() => setResumeMode("file")}
//                               className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === "file" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500 hover:text-slate-700"}`}
//                             >
//                               FILE
//                             </button>
//                             <button
//                               type="button"
//                               onClick={() => setResumeMode("link")}
//                               className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                             >
//                               URL
//                             </button>
//                           </div>
//                         </div>

//                         {resumeMode === "file" ? (
//                           <label className="flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-slate-200 rounded-3xl bg-slate-50/50 hover:bg-white hover:border-blue-500 transition-all cursor-pointer group">
//                             <div className="flex flex-col items-center gap-3">
//                               <div className="p-4 bg-white rounded-2xl shadow-sm border border-slate-100 group-hover:scale-110 transition-transform duration-500">
//                                 <FileUp
//                                   size={28}
//                                   className="text-slate-400 group-hover:text-blue-500"
//                                 />
//                               </div>
//                               <span className="text-[11px] font-bold text-slate-500 uppercase tracking-widest">
//                                 {formData.cvFile
//                                   ? formData.cvFile.name
//                                   : existingResume
//                                     ? "Existing Resume Available"
//                                     : "Commit Resume PDF"}
//                               </span>

                         
//                               {existingResume && !formData.cvFile && (
//                                 <a
//                                   href={fixResumeUrl2(existingResume)}
//                                   target="_blank"
//                                   rel="noreferrer"
//                                   className="text-blue-600 text-xs underline mt-1"
//                                 >
//                                   View Current Resume
//                                 </a>
//                               )}
//                             </div>
//                             <input
//                               type="file"
//                               accept=".pdf"
//                               className="hidden"
//                               onChange={(e) =>
//                                 setFormData({
//                                   ...formData,
//                                   cvFile: e.target.files[0],
//                                   resume_link: "",
//                                 })
//                               }
//                             />
//                           </label>
//                         ) : (
//                           <div className="relative">
//                             <LinkIcon
//                               size={18}
//                               className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                             />
//                             <input
//                               placeholder="Enter Public Storage URI..."
//                               value={formData.resume_link}
//                               onChange={(e) =>
//                                 setFormData({
//                                   ...formData,
//                                   resume_link: e.target.value,
//                                   cvFile: null,
//                                 })
//                               }
//                               className={inputStyle + " pl-12"}
//                             />
//                           </div>
//                         )}
//                       </div>

                      

                   











                   
//                       <div className="space-y-6">
//                         <div className="flex justify-between items-center px-1">
//                           <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">
//                             02. certificate
//                           </span>
//                           <div className="flex gap-2">
//                             <label className="cursor-pointer h-10 w-10 bg-slate-900 text-white rounded-xl hover:bg-blue-600 active:scale-90 transition-all flex items-center justify-center shadow-lg shadow-slate-200">
//                               <Plus size={18} />
//                               <input
//                                 type="file"
//                                 multiple
//                                 accept=".pdf"
//                                 className="hidden"
//                                 onChange={(e) =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateFiles: [
//                                       ...formData.certificateFiles,
//                                       ...Array.from(e.target.files),
//                                     ],
//                                   })
//                                 }
//                               />
//                             </label>
//                             <button
//                               type="button"
//                               onClick={() =>
//                                 setFormData({
//                                   ...formData,
//                                   certificateLinks: [
//                                     ...formData.certificateLinks,
//                                     "",
//                                   ],
//                                 })
//                               }
//                               className="h-10 w-10 bg-white text-slate-600 rounded-xl border border-slate-200 hover:border-blue-500 hover:text-blue-500 active:scale-90 transition-all flex items-center justify-center shadow-sm"
//                             >
//                               <LinkIcon size={18} />
//                             </button>
//                           </div>
//                         </div>

//                         <div className="grid grid-cols-1 gap-4 max-h-[220px] overflow-y-auto no-scrollbar pr-1">
                   
//                           {existingCertificates.map((url, idx) => (
//                             <div
//                               key={`existing-${idx}`}
//                               className="flex justify-between items-center bg-blue-50 p-4 rounded-2xl border border-blue-100"
//                             >
//                               <div className="flex items-center gap-3">
//                                 <div className="h-2 w-2 rounded-full bg-blue-500" />

//                                 <a
//                                   href={url}
//                                   target="_blank"
//                                   rel="noreferrer"
//                                   className="text-[12px] font-bold text-blue-700 underline truncate max-w-[200px]"
//                                 >
//                                   Existing Certificate {idx + 1}
//                                 </a>
//                               </div>

//                               <X
//                                 size={16}
//                                 className="text-red-400 hover:text-red-600 cursor-pointer"
//                                 onClick={() =>
//                                   setExistingCertificates((prev) =>
//                                     prev.filter((_, i) => i !== idx),
//                                   )
//                                 }
//                               />
//                             </div>
//                           ))}

//                           {formData.certificateFiles.map((file, idx) => (
//                             <div
//                               key={idx}
//                               className="flex justify-between items-center bg-slate-50 p-4 rounded-2xl border border-slate-100 hover:border-blue-300 transition-colors"
//                             >
//                               <div className="flex items-center gap-3">
//                                 <div className="h-2 w-2 rounded-full bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)]" />
//                                 <span className="text-[12px] font-bold text-slate-700 truncate max-w-[200px]">
//                                   {file.name}
//                                 </span>
//                               </div>
//                               <X
//                                 size={16}
//                                 className="text-slate-300 hover:text-red-500 cursor-pointer transition-all hover:rotate-90"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateFiles:
//                                       formData.certificateFiles.filter(
//                                         (_, i) => i !== idx,
//                                       ),
//                                   })
//                                 }
//                               />
//                             </div>
//                           ))}
//                           {formData.certificateLinks.map((link, idx) => (
//                             <div
//                               key={idx}
//                               className="flex gap-3 animate-in slide-in-from-right-4"
//                             >
//                               <div className="relative flex-1">
//                                 <Globe
//                                   size={16}
//                                   className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                                 />
//                                 <input
//                                   value={link}
//                                   placeholder="Public URI..."
//                                   onChange={(e) => {
//                                     const u = [...formData.certificateLinks];
//                                     u[idx] = e.target.value;
//                                     setFormData({
//                                       ...formData,
//                                       certificateLinks: u,
//                                     });
//                                   }}
//                                   className={inputStyle + " pl-11 !py-2.5"}
//                                 />
//                               </div>
//                               <button
//                                 type="button"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateLinks:
//                                       formData.certificateLinks.filter(
//                                         (_, i) => i !== idx,
//                                       ),
//                                   })
//                                 }
//                                 className="text-slate-300 hover:text-red-500 bg-slate-50 h-10 w-10 rounded-xl border border-slate-200 flex items-center justify-center"
//                               >
//                                 <Trash2 size={16} />
//                               </button>
//                             </div>
//                           ))}
//                           {formData.certificateFiles.length === 0 &&
//                             formData.certificateLinks.filter((l) => l)
//                               .length === 0 && (
//                               <div className="py-8 text-center bg-slate-50/50 border border-dashed border-slate-200 rounded-2xl">
//                                 <p className="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">
//                                   No secondary artifacts registered
//                                 </p>
//                               </div>
//                             )}
//                         </div>
//                       </div>
//                     </div>

//                     <div className="bg-slate-50 rounded-3xl p-6 flex flex-col md:flex-row items-center justify-between gap-6 ">
//                       <div className="flex items-center gap-4">
//                         <div className="h-10 w-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400">
//                           <History size={20} />
//                         </div>
//                         <div>
//                           <p className="text-slate-800 text-xs font-bold tracking-wide uppercase">
//                              Final Review
//                           </p>
//                           <p className="text-slate-400 text-[10px] uppercase font-semibold tracking-tighter">
//                             Employee Id {effectiveId} â€¢ Ready to submit
//                           </p>
//                         </div>
//                       </div>
//                       <button
//                         // type="submit"
//                         type="button" 
//                         // onClick={handleSubmit}
//                         onClick={async () => {
//                           setLoading(true);

//                           await saveStepData(5); // ðŸ”¥ FINAL API CALL HERE

//                           setLoading(false);

//                           toast.success("Candidate Saved âœ”");

//                           navigate("/candidate"); // redirect after save
//                         }}
//                         className="w-full md:w-auto px-10 py-3.5 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl text-[11px] font-black uppercase tracking-widest transition-all shadow-xl shadow-blue-600/20 active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3"
//                       >
//                         {loading ? (
//                           <Loader2 className="animate-spin" size={18} />
//                         ) : (
//                           <>
//                             <Database size={18} />
//                             <span>Submit data</span>
//                           </>
//                         )}
//                       </button>
//                     </div>
//                   </div>

               
//                   <div className="flex justify-center pt-2 pb-8">
//                     <button
//                       type="button"
//                       onClick={() => setStep(4)}
//                       className="text-[10px] font-bold text-slate-400 uppercase tracking-widest hover:text-slate-900 transition-colors flex items-center gap-2 group"
//                     >
//                       <ChevronLeft
//                         size={16}
//                         className="group-hover:-translate-x-1 transition-transform"
//                       />
//                       Return to back page
//                     </button>
//                   </div>
//                 </div>
//               </div>
//             )} */}  


//               {step === 6 && (
//               <div className="space-y-8 animate-in slide-in-from-bottom-8 duration-500">
//                 <div className="bg-white rounded-[2rem] shadow-2xl shadow-slate-200/50 border border-slate-200 overflow-hidden relative">
//                   {/* SECTION HEADER: Enterprise Indigo Theme */}
//                   <div className="bg-slate-50 px-8 py-6 border-b border-slate-200 flex items-center justify-between">
//                     <div className="flex items-center gap-5">
//                       <div className="h-12 w-12 bg-slate-900 rounded-2xl flex items-center justify-center text-white shadow-lg">
//                         <ShieldCheck size={24} />
//                       </div>
//                       <div>
//                         <h3 className="text-lg font-bold text-slate-900 tracking-tight">
//                           Document upload
//                         </h3>

//                         <div className="px-8 pt-6">
//   <select
//     value={docType}
//     onChange={(e) => setDocType(e.target.value)}
//     className="w-60 px-4 py-2 border border-slate-200 rounded-xl text-sm font-bold bg-white"
//   >
//     <option value="resume">Resume</option>
//     <option value="certificate">Certificate</option>
//   </select>
// </div>

//                         <p className="text-[11px] font-semibold text-slate-500 uppercase tracking-widest">
//                           Document Verification
//                         </p>
//                       </div>
//                     </div>
//                     <div className="hidden md:flex items-center gap-2 px-4 py-1.5 bg-blue-50 border border-blue-100 rounded-full">
//                       <div className="h-1.5 w-1.5 rounded-full bg-blue-500 animate-pulse" />
//                       <span className="text-[10px] font-bold text-blue-600 uppercase tracking-tighter">
//                         ready to save
//                       </span>
//                     </div>
//                   </div>

//                   <div className="p-8 md:p-12 space-y-12">
//                     <div className="grid grid-cols-1 lg:grid-cols-2 gap-12">
//                       {/* 1. MASTER RESUME SECTION */}
//                       <div className="space-y-6">
//                         <div className="flex justify-between items-center px-1">
//                           <div className="flex items-center gap-2">
//                             <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">
//                               01. Resume
//                             </span>
//                           </div>
//                           <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200 scale-90">
//                             <button
//                               type="button"
//                               onClick={() => setResumeMode("file")}
//                               className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === "file" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500 hover:text-slate-700"}`}
//                             >
//                               FILE
//                             </button>
//                             <button
//                               type="button"
//                               onClick={() => setResumeMode("link")}
//                               className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                             >
//                               URL
//                             </button>
//                           </div>
//                         </div>

//                         {resumeMode === "file" ? (
//                           <label className="flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-slate-200 rounded-3xl bg-slate-50/50 hover:bg-white hover:border-blue-500 transition-all cursor-pointer group">
//                             <div className="flex flex-col items-center gap-3">
//                               <div className="p-4 bg-white rounded-2xl shadow-sm border border-slate-100 group-hover:scale-110 transition-transform duration-500">
//                                 <FileUp
//                                   size={28}
//                                   className="text-slate-400 group-hover:text-blue-500"
//                                 />
//                               </div>
//                               <span className="text-[11px] font-bold text-slate-500 uppercase tracking-widest">
//                                 {formData.cvFile
//                                   ? formData.cvFile.name
//                                   : existingResume
//                                     ? "Existing Resume Available"
//                                     : "Commit Resume PDF"}
//                               </span>

                         
//                               {existingResume && !formData.cvFile && (
//                                 <a
//                                   href={fixResumeUrl2(existingResume)}
//                                   target="_blank"
//                                   rel="noreferrer"
//                                   className="text-blue-600 text-xs underline mt-1"
//                                 >
//                                   View Current Resume
//                                 </a>
//                               )}
//                             </div>
//                             <input
//                               type="file"
//                               accept=".pdf"
//                               className="hidden"
//                               onChange={(e) =>
//                                 setFormData({
//                                   ...formData,
//                                   cvFile: e.target.files[0],
//                                   resume_link: "",
//                                 })
//                               }
//                             />
//                           </label>
//                         ) : (
//                           <div className="relative">
//                             <LinkIcon
//                               size={18}
//                               className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                             />
//                             <input
//                               placeholder="Enter Public Storage URI..."
//                               value={formData.resume_link}
//                               onChange={(e) =>
//                                 setFormData({
//                                   ...formData,
//                                   resume_link: e.target.value,
//                                   cvFile: null,
//                                 })
//                               }
//                               className={inputStyle + " pl-12"}
//                             />
//                           </div>
//                         )}
//                       </div>

                      

                   











//                       {/* 2. CREDENTIALS MATRIX SECTION */}
//                       <div className="space-y-6">
//                         <div className="flex justify-between items-center px-1">
//                           <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">
//                             02. certificate
//                           </span>
//                           <div className="flex gap-2">
//                             <label className="cursor-pointer h-10 w-10 bg-slate-900 text-white rounded-xl hover:bg-blue-600 active:scale-90 transition-all flex items-center justify-center shadow-lg shadow-slate-200">
//                               <Plus size={18} />
//                               <input
//                                 type="file"
//                                 multiple
//                                 accept=".pdf"
//                                 className="hidden"
//                                 onChange={(e) =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateFiles: [
//                                       ...formData.certificateFiles,
//                                       ...Array.from(e.target.files),
//                                     ],
//                                   })
//                                 }
//                               />
//                             </label>
//                             <button
//                               type="button"
//                               onClick={() =>
//                                 setFormData({
//                                   ...formData,
//                                   certificateLinks: [
//                                     ...formData.certificateLinks,
//                                     "",
//                                   ],
//                                 })
//                               }
//                               className="h-10 w-10 bg-white text-slate-600 rounded-xl border border-slate-200 hover:border-blue-500 hover:text-blue-500 active:scale-90 transition-all flex items-center justify-center shadow-sm"
//                             >
//                               <LinkIcon size={18} />
//                             </button>
//                           </div>
//                         </div>

//                         <div className="grid grid-cols-1 gap-4 max-h-[220px] overflow-y-auto no-scrollbar pr-1">
                   
//                           {existingCertificates.map((url, idx) => (
//                             <div
//                               key={`existing-${idx}`}
//                               className="flex justify-between items-center bg-blue-50 p-4 rounded-2xl border border-blue-100"
//                             >
//                               <div className="flex items-center gap-3">
//                                 <div className="h-2 w-2 rounded-full bg-blue-500" />

//                                 <a
//                                   href={url}
//                                   target="_blank"
//                                   rel="noreferrer"
//                                   className="text-[12px] font-bold text-blue-700 underline truncate max-w-[200px]"
//                                 >
//                                   Existing Certificate {idx + 1}
//                                 </a>
//                               </div>

//                               <X
//                                 size={16}
//                                 className="text-red-400 hover:text-red-600 cursor-pointer"
//                                 onClick={() =>
//                                   setExistingCertificates((prev) =>
//                                     prev.filter((_, i) => i !== idx),
//                                   )
//                                 }
//                               />
//                             </div>
//                           ))}

//                           {formData.certificateFiles.map((file, idx) => (
//                             <div
//                               key={idx}
//                               className="flex justify-between items-center bg-slate-50 p-4 rounded-2xl border border-slate-100 hover:border-blue-300 transition-colors"
//                             >
//                               <div className="flex items-center gap-3">
//                                 <div className="h-2 w-2 rounded-full bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)]" />
//                                 <span className="text-[12px] font-bold text-slate-700 truncate max-w-[200px]">
//                                   {file.name}
//                                 </span>
//                               </div>
//                               <X
//                                 size={16}
//                                 className="text-slate-300 hover:text-red-500 cursor-pointer transition-all hover:rotate-90"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateFiles:
//                                       formData.certificateFiles.filter(
//                                         (_, i) => i !== idx,
//                                       ),
//                                   })
//                                 }
//                               />
//                             </div>
//                           ))}
//                           {formData.certificateLinks.map((link, idx) => (
//                             <div
//                               key={idx}
//                               className="flex gap-3 animate-in slide-in-from-right-4"
//                             >
//                               <div className="relative flex-1">
//                                 <Globe
//                                   size={16}
//                                   className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                                 />
//                                 <input
//                                   value={link}
//                                   placeholder="Public URI..."
//                                   onChange={(e) => {
//                                     const u = [...formData.certificateLinks];
//                                     u[idx] = e.target.value;
//                                     setFormData({
//                                       ...formData,
//                                       certificateLinks: u,
//                                     });
//                                   }}
//                                   className={inputStyle + " pl-11 !py-2.5"}
//                                 />
//                               </div>
//                               <button
//                                 type="button"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateLinks:
//                                       formData.certificateLinks.filter(
//                                         (_, i) => i !== idx,
//                                       ),
//                                   })
//                                 }
//                                 className="text-slate-300 hover:text-red-500 bg-slate-50 h-10 w-10 rounded-xl border border-slate-200 flex items-center justify-center"
//                               >
//                                 <Trash2 size={16} />
//                               </button>
//                             </div>
//                           ))}
//                           {formData.certificateFiles.length === 0 &&
//                             formData.certificateLinks.filter((l) => l)
//                               .length === 0 && (
//                               <div className="py-8 text-center bg-slate-50/50 border border-dashed border-slate-200 rounded-2xl">
//                                 <p className="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">
//                                   No secondary artifacts registered
//                                 </p>
//                               </div>
//                             )}
//                         </div>
//                       </div>
//                     </div>

//                     {/* METADATA INFO CARD */}
//                     <div className="bg-slate-50 rounded-3xl p-6 flex flex-col md:flex-row items-center justify-between gap-6 ">
//                       <div className="flex items-center gap-4">
//                         <div className="h-10 w-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400">
//                           <History size={20} />
//                         </div>
//                         <div>
//                           <p className="text-slate-800 text-xs font-bold tracking-wide uppercase">
//                              Final Review
//                           </p>
//                           <p className="text-slate-400 text-[10px] uppercase font-semibold tracking-tighter">
//                             Employee Id {effectiveId} â€¢ Ready to submit
//                           </p>
//                         </div>
//                       </div>
//                       <button
//                         // type="submit"
//                         type="button" 
//                         // onClick={handleSubmit}
//                         onClick={async () => {
//                           setLoading(true);

//                           await saveStepData(6); // ðŸ”¥ FINAL API CALL HERE

//                           setLoading(false);

//                           toast.success("Candidate Saved âœ”");

//                           navigate("/candidate"); // redirect after save
//                         }}
//                         className="w-full md:w-auto px-10 py-3.5 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl text-[11px] font-black uppercase tracking-widest transition-all shadow-xl shadow-blue-600/20 active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3"
//                       >
//                         {loading ? (
//                           <Loader2 className="animate-spin" size={18} />
//                         ) : (
//                           <>
//                             <Database size={18} />
//                             <span>Submit data</span>
//                           </>
//                         )}
//                       </button>
//                     </div>
//                   </div>

//                   {/* FOOTER ACTIONS */}
//                   <div className="flex justify-center pt-2 pb-8">
//                     <button
//                       type="button"
//                       onClick={() => setStep(5)}
//                       className="text-[10px] font-bold text-slate-400 uppercase tracking-widest hover:text-slate-900 transition-colors flex items-center gap-2 group"
//                     >
//                       <ChevronLeft
//                         size={16}
//                         className="group-hover:-translate-x-1 transition-transform"
//                       />
//                       Return to back page
//                     </button>
//                   </div>
//                 </div>
//               </div>
//             )}
//           </div>
//         </form>
//       </div>

//       {showCertEditModal && (
//   <div className="fixed inset-0 bg-black/50 flex items-center justify-center">
//     <div className="bg-white p-6 rounded-2xl w-[420px] space-y-4">

//       <h3 className="font-bold">Edit Certificate</h3>

//       <input
//         value={certForm.name}
//         onChange={(e) =>
//           setCertForm({ ...certForm, name: e.target.value })
//         }
//         className="border p-2 rounded-xl w-full"
//         placeholder="Certificate Name"
//       />

//       {certForm.uploadMode === "file" ? (
//         <input
//           type="file"
//           accept=".pdf"
//           onChange={(e) =>
//             setCertForm({
//               ...certForm,
//               certificate_file: e.target.files[0],
//             })
//           }
//         />
//       ) : (
//         <input
//           value={certForm.certificate_link}
//           onChange={(e) =>
//             setCertForm({
//               ...certForm,
//               certificate_link: e.target.value,
//             })
//           }
//           className="border p-2 rounded-xl w-full"
//         />
//       )}

//       <button
//         onClick={updateCertificate}
//         className="w-full bg-blue-600 text-white py-2 rounded-xl"
//       >
//         Update Certificate
//       </button>

//       <button
//         onClick={() => setShowCertEditModal(false)}
//         className="w-full border py-2 rounded-xl"
//       >
//         Cancel
//       </button>
//     </div>
//   </div>
// )}

//       <style
//         dangerouslySetInnerHTML={{
//           __html: `.custom-scrollbar-professional::-webkit-scrollbar { width: 6px; }.custom-scrollbar-professional::-webkit-scrollbar-track { background: transparent; }.custom-scrollbar-professional::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 20px; }.custom-scrollbar-professional::-webkit-scrollbar-thumb:hover { background: #CBD5E1; }`,
//         }}
//       />
//     </div>
//   );
// };

// export default ManualEntryPage;
//****************************************************working code phase 2********************************************************** */
// import React, { useState, useEffect, useRef } from "react";
// import { useParams, useNavigate, useSearchParams  } from "react-router-dom";
// import {
//   Check,
//   Award,
//   User,
//   Briefcase,
//   Fingerprint,
//   Calendar,
//   FileText,
//   CheckCircle,
//   MapPin,
//   Loader2,
//   Plus,
//   Trash2,
//   Layers,
//   Cpu,
//   Database,
//   Globe,
//   ShieldCheck,
//   History,
//   X,
//   Edit3,
//   LinkIcon,
//   FileUp,
//   ChevronRight,
//   ChevronLeft,
//   ChevronDown,
// } from "lucide-react";
// import toast from "react-hot-toast";
// import { candidateService } from "../../services/candidateService";
// import { departmentService } from "../../services/department.service";

// const FormField = ({ label, required, error, children }) => (
//   <div className="space-y-1 w-full">
//     <label className="text-[10px] md:text-[11px] font-black text-slate-500 uppercase tracking-widest ml-1 flex justify-between items-center">
//       <span>{label}</span>
//       <span
//         className={`font-bold normal-case ${required ? "text-red-500" : "text-slate-300"}`}
//       >
//         {required ? "Required" : "Optional"}
//       </span>
//     </label>
//     {children}
//     {error && (
//       <p className="text-[9px] text-red-500 font-bold uppercase tracking-tighter ml-1">
//         {error}
//       </p>
//     )}
//   </div>
// );

// const ManualEntryPage = () => {
//   const { id } = useParams();
//   const navigate = useNavigate();
//   const [searchParams] = useSearchParams();
//   const effectiveId = id || "666";
//   const ASSET_OPTIONS = [
//     "Laptop",
//     "Mouse",
//     "Keyboard",
//     "Monitor",
//     "Headset",
//     "Mobile",
//     "ID Card",
//     "SIM Card",
//   ];
//   // Professional Enterprise Input Style
//   const inputStyle =
//     "w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-[13px] font-bold outline-none focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-500/5 transition-all shadow-sm";

//   // 1. INITIALIZE ALL STATES
//   const [step, setStep] = useState(1);
//   const [loading, setLoading] = useState(false);
//   const [fetchingData, setFetchingData] = useState(false);
//   const [errors, setErrors] = useState({});
//   const [isFetchingPincode, setIsFetchingPincode] = useState(false);
//   const [cityOptions, setCityOptions] = useState([]);
//   const [resumeMode, setResumeMode] = useState("file");
//   const [skillInput, setSkillInput] = useState("");
//   const [assetInput, setAssetInput] = useState("");
//   const [isFresher, setIsFresher] = useState(null);
//   const [deptSearch, setDeptSearch] = useState("");
//   const [eduSearch, setEduSearch] = useState("");
//   const [dynamicSkills, setDynamicSkills] = useState([]);
//   const [existingResume, setExistingResume] = useState("");
// const [industrySearch, setIndustrySearch] = useState("");
// const [showIndustryDrop, setShowIndustryDrop] = useState(false);
//   const [dynamicAssets, setDynamicAssets] = useState([]);
//   const [showSkillDrop, setShowSkillDrop] = useState(false);
//   const [showAssetDrop, setShowAssetDrop] = useState(false);
//   const [skillFocused, setSkillFocused] = useState(false);
//   const [departments, setDepartments] = useState([]);
//   const dropdownContainerRef = useRef(null);
//   const [existingCertificates, setExistingCertificates] = useState([]);
//   const [editingCertId, setEditingCertId] = useState(null);
//   const [editingCertValue, setEditingCertValue] = useState("");
//   const [showExpModal, setShowExpModal] = useState(false);
// const [currentEditingIndex, setCurrentEditingIndex] = useState(null);
// const [newExperiences, setNewExperiences] = useState([]);


// //**********************************certiificate and resume*********************************** */

// const [docType, setDocType] = useState("resume"); 
// // "resume" | "certificate"

// const [showCertEditModal, setShowCertEditModal] = useState(false);
// const [editingCertificate, setEditingCertificate] = useState(null);

// const [certForm, setCertForm] = useState({
//   name: "",
//   certificate_file: null,
//   certificate_link: "",
//   uploadMode: "file", // file | link
// });


// //**********************************certiificate and resume end*********************************** */


//   const careerStepRef = useRef(null);

//   const [formData, setFormData] = useState({
//     name: "",
//     email: "",
//     phone: "",
//     address: "",
//     address2: "",
//     location: "",
//     pincode: "",
//     state: "",
//     city: "",
//     district: "",
//     country: "India",
//     position: "",
//     education: "",
//     gender: "",
//     dob: "",
//     experience: "",
//     about_me: "",
//     languages_spoken: [],
//     skills: [],
//     assets: [],
//     department: "",
//     cvFile: null,
//     resume_link: "",
//     certificateFiles: [],
//     certificateLinks: [""],
//     experiences: [],
//   });

//   const totalSteps = 5;

//   const educationOptions = [
//     "SSC / 10th",
//     "HSC / 12th",
//     "ITI",
//     "Diploma",
//     "Polytechnic",

//     "B.A",
//     "B.Com",
//     "B.Sc",
//     "BCA",
//     "BBA",
//     "B.Tech",
//     "BE",
//     "B.Pharm",
//     "B.Ed",

//     "M.A",
//     "M.Com",
//     "M.Sc",
//     "MCA",
//     "MBA",
//     "M.Tech",
//     "ME",
//     "M.Pharm",
//     "M.Ed",

//     "PGDM",
//     "Post Graduate Diploma",

//     "PhD / Doctorate",
//   ];

//   const POSITION_OPTIONS = [
//     // IT / Software
//     "Frontend Developer",
//     "Backend Developer",
//     "Full Stack Developer",
//     "Software Engineer",
//     "Senior Software Engineer",
//     "Lead Developer",
//     "DevOps Engineer",
//     "QA Engineer",
//     "Automation Tester",
//     "Manual Tester",
//     "UI/UX Designer",
//     "Mobile App Developer",
//     "Android Developer",
//     "iOS Developer",
//     "Data Analyst",
//     "Data Scientist",
//     "Machine Learning Engineer",
//     "AI Engineer",
//     "Cloud Engineer",
//     "System Administrator",
//     "Network Engineer",
//     "Cyber Security Analyst",

//     // Management / Office
//     "Project Manager",
//     "Product Manager",
//     "Operations Manager",
//     "Team Lead",
//     "Business Analyst",
//     "HR Executive",
//     "HR Manager",
//     "Recruiter",
//     "Office Administrator",

//     // Non-IT / General
//     "Accountant",
//     "Finance Executive",
//     "Sales Executive",
//     "Marketing Executive",
//     "Digital Marketing Specialist",
//     "Customer Support Executive",
//     "Technical Support Engineer",
//     "Field Executive",
//     "Supervisor",
//     "Store Manager",
//     "Warehouse Executive",

//     // Fresher / Entry
//     "Intern",
//     "Trainee",
//     "Graduate Engineer Trainee",
//     "Apprentice",
//   ];

//   const filteredEducation = educationOptions.filter((e) =>
//     e.toLowerCase().includes(eduSearch.toLowerCase()),
//   );
//   const filteredDepartments = departments.filter((d) =>
//     (d.name || "").toLowerCase().includes(deptSearch.toLowerCase()),
//   );
//   const isStep1Valid =
//     formData.name && /^\S+@\S+\.\S+$/.test(formData.email) && formData.phone;

//   // 2. HYDRATION LOGIC (GET API)
//   useEffect(() => {
   
//     hydrateNode();
//   }, [effectiveId]);

//    const hydrateNode = async () => {
//       setFetchingData(true);
//       try {
//         const response = await fetch(
//           `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//         );
//         if (!response.ok) throw new Error();
//         const data = await response.json();

//         if (data) {
//           setExistingResume(data.resume_path || "");

//           setExistingCertificates(
//             Array.isArray(data.certificates) ? data.certificates : [],
//           );

//           const safeParse = (value) => {
//             if (!value) return [];

//             try {
//               // Already array â†’ fix broken JSON pieces
//               if (Array.isArray(value)) {
//                 const joined = value.join("");
//                 if (joined.startsWith("[")) {
//                   return JSON.parse(joined);
//                 }
//                 return value;
//               }

//               // If string JSON
//               if (typeof value === "string" && value.startsWith("[")) {
//                 return JSON.parse(value);
//               }

//               // If CSV string â†’ convert to array
//               if (typeof value === "string") {
//                 return value
//                   .split(",")
//                   .map((s) => s.trim())
//                   .filter(Boolean);
//               }

//               return [];
//             } catch {
//               return [];
//             }
//           };

//           setFormData((prev) => ({
//             ...prev,
//             name: data.full_name || "",
//             email: data.email || "",
//             phone: data.phone || "",
//             gender: data.gender || "",
//             dob: data.dob || "",
//             address: data.address || "",
//             address2: data.address2 || "",
//             location: data.location || "",
//             pincode: data.pincode || "",
//             city: data.city || "",
//             state: data.state || "",
//             district: data.district || "",
//             country: data.country || "India",
//             position: data.position || "",
//             experience: data.experience || "",
//             education: data.education || "",
//             department: data.department || "",
//             about_me: data.about_me || "",
//             resume_link: data.resume_path || "",
//             languages_spoken: safeParse(data.languages_spoken),
//             experiences: data.experiences || [],
//             skills: safeParse(data.skills),
//             assets: safeParse(data.assets),
//           }));

//           setIsFresher(!data.experiences || data.experiences.length === 0);
//         }

//         const deptData = await departmentService.getAll();
//         setDepartments(deptData || []);
//         await fetchSkills();
//         await fetchAssets(effectiveId);
//       } catch (err) {
//         console.warn("Initializing Empty Node");
//       } finally {
//         setFetchingData(false);
//       }
//     };

//     const INDUSTRY_OPTIONS = [
//   "Information Technology",
//   "Software Development",
//   "Banking & Finance",
//   "Healthcare",
//   "Education",
//   "Manufacturing",
//   "Retail",
//   "Telecom",
//   "Construction",
//   "Logistics",
//   "Marketing & Advertising",
//   "HR / Recruitment",
//   "Government",
//   "Automobile",
//   "Pharmaceutical",
//   "E-Commerce",
//   "Media & Entertainment",
//   "Real Estate",
//   "Hospitality",
//   "Other",
// ];


//   // Click Outside to close dropdowns
//   useEffect(() => {
//     const handleClickOutside = (event) => {
//       if (
//         dropdownContainerRef.current &&
//         !dropdownContainerRef.current.contains(event.target)
//       ) {
//         setShowSkillDrop(false);
//         setShowAssetDrop(false);
//         setSkillFocused(false);
//       }
//     };
//     document.addEventListener("mousedown", handleClickOutside);
//     return () => document.removeEventListener("mousedown", handleClickOutside);
//   }, []);

//   // READ STEP FROM URL (?step=3)
// useEffect(() => {
//   const stepFromUrl = Number(searchParams.get("step"));

//   if (stepFromUrl && stepFromUrl >= 1 && stepFromUrl <= totalSteps) {
//     setStep(stepFromUrl);
//   }
// }, [searchParams]);


//   // 3. HANDLERS
//   const fetchSkills = async () => {
//     try {
//       const res = await fetch(
//         "https://apihrr.goelectronix.co.in/masters/skills",
//       );
//       const data = await res.json();
//       setDynamicSkills(data.map((item) => item.name || item));
//     } catch {}
//   };

//   const fetchAssets = async (cId) => {
//     try {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${cId}/assets`,
//       );
//       const data = await res.json();
//       setDynamicAssets(Array.isArray(data) ? data.map((a) => a.name) : []);
//     } catch {}
//   };

//   const handleManualAddSkill = async () => {
//     const name = skillInput.trim();
//     if (!name) {
//       await fetchSkills();
//       return;
//     }
//     const success = await handleCreateMaster("skills", name);
//     if (success) {
//       if (!formData.skills.includes(name))
//         setFormData((p) => ({ ...p, skills: [...p.skills, name] }));
//       setSkillInput("");
//       await fetchSkills();
//     }
//   };

//   const handleCreateMaster = async (type, name) => {
//     try {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/masters/${type}`,
//         {
//           method: "POST",
//           headers: { "Content-Type": "application/json" },
//           body: JSON.stringify({ name: name.trim() }),
//         },
//       );
//       return res.ok;
//     } catch {
//       return false;
//     }
//   };

//   const handleAddAssetAPI = async (assetName) => {
//     if (!assetName.trim()) return;
//     const loadingToast = toast.loading(`Linking asset...`);
//     try {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/assets`,
//         {
//           method: "POST",
//           headers: { "Content-Type": "application/json" },
//           body: JSON.stringify({ name: assetName.trim() }),
//         },
//       );
//       if (res.ok) {
//         toast.success("Linked", { id: loadingToast });
//         await fetchAssets(effectiveId);
//         return true;
//       }
//     } catch {
//       toast.error("Sync failed", { id: loadingToast });
//     }
//     return false;
//   };

//   const filteredIndustries = INDUSTRY_OPTIONS.filter((ind) =>
//   ind.toLowerCase().includes(industrySearch.toLowerCase())
// );

// const handleSaveOrUpdateExperience = async (i) => {
//   const exp = newExperiences[i];

//   if (!exp.company_name || !exp.job_title || !exp.start_date || !exp.end_date) {
//     toast.error("Company, Role, Start Date, End Date required");
//     return;
//   }

//   const loadingToast = toast.loading(
//     currentEditingIndex !== null ? "Updating experience..." : "Saving experience..."
//   );

//   try {
//     const fd = new FormData();

//     fd.append("company_name", exp.company_name);
//     fd.append("job_title", exp.job_title);
//     fd.append("start_date", exp.start_date);
//     fd.append("end_date", exp.end_date);
//     fd.append("previous_ctc", exp.previous_ctc || "");
//     fd.append("location", exp.location || "");
//     fd.append("description", exp.description || "");
//     fd.append("industry", exp.industry || "");

//     if (exp.uploadMode === "link") {
//       fd.append("exp_letter_link", exp.exp_letter_link || "");
//     } else if (exp.expLetterFile instanceof File) {
//       fd.append("exp_letter_file", exp.expLetterFile);
//     }

//     // =========================
//     // UPDATE (PATCH)
//     // =========================
//     if (currentEditingIndex !== null && exp.id) {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/experiences/${exp.id}`,
//         {
//           method: "PUT",
//           body: fd,
//         }
//       );

//       if (!res.ok) throw new Error(await res.text());

//       // Update UI instantly
//       const updated = [...formData.experiences];
//       updated[currentEditingIndex] = exp;

//       setFormData((prev) => ({
//         ...prev,
//         experiences: updated,
//       }));

//       toast.success("Experience Updated âœ…", { id: loadingToast });
//     }

//     // =========================
//     // ADD NEW (POST)
//     // =========================
//     else {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/experiences`,
//         {
//           method: "POST",
//           body: fd,
//         }
//       );

//       if (!res.ok) throw new Error(await res.text());

//       await hydrateNode(); // reload from backend

//       toast.success("Experience Added âœ…", { id: loadingToast });
//     }

//     setNewExperiences([]);
//     setCurrentEditingIndex(null);
//     setShowExpModal(false);

//   } catch (err) {
//     console.error(err);
//     toast.error("Failed âŒ", { id: loadingToast });
//   }
// };


// const updateCertificate = async () => {
//   try {
//     const fd = new FormData();

//     fd.append("name", certForm.name);

//     if (certForm.uploadMode === "file" && certForm.certificate_file) {
//       fd.append("certificate_file", certForm.certificate_file);
//     }

//     if (certForm.uploadMode === "link" && certForm.certificate_link) {
//       fd.append("certificate_link", certForm.certificate_link);
//     }

//     await fetch(
//       `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/certificates/${editingCertificate.id}`,
//       {
//         method: "PUT",
//         body: fd,
//       }
//     );

//     toast.success("Certificate Updated");
//     setShowCertEditModal(false);
//     hydrateNode();

//   } catch (err) {
//     toast.error("Update failed");
//   }
// };




//   const fetchPincodeDetails = async (pincode) => {
//     if (!/^\d{6}$/.test(pincode)) return;

//     setIsFetchingPincode(true);

//     try {
//       const res = await fetch(
//         `https://api.postalpincode.in/pincode/${pincode}`,
//       );
//       const data = await res.json();

//       if (data[0]?.Status === "Success" && data[0].PostOffice?.length > 0) {
//         const postOffices = data[0].PostOffice;

//         setCityOptions(postOffices); // â­ store full objects

//         const first = postOffices[0];

//         setFormData((prev) => ({
//           ...prev,
//           city: first.Name || "",
//           district: first.District || "",
//           state: first.State || "",
//           country: first.Country || "India",
//         }));
//       } else {
//         setCityOptions([]);
//       }
//     } catch (err) {
//       console.error(err);
//       setCityOptions([]);
//     } finally {
//       setIsFetchingPincode(false);
//     }
//   };

//   const STEP_FIELDS = {
//     1: [
//       "name",
//       "email",
//       "phone",
//       "gender",
//       "dob",
//       "position",
//       "experience",
//       "education",
//       "department",
//       "about_me",
//       "languages_spoken",
//     ],

//     2: [
//       "address",
//       "address2",
//       "location",
//       "pincode",
//       "city",
//       "district",
//       "state",
//       "country",
//     ],

//     3: ["experiences"],

//     4: ["skills", "assets"],

//     5: ["resume_link", "cvFile", "certificateFiles", "certificateLinks"],
//   };


//   // ---------- STEP VALIDATION ----------

// const isStep1Incomplete = () => {
//   return !(
//     formData.full_name &&
//     formData.email &&
//     formData.phone &&
//     formData.gender &&
//     formData.dob &&
//     (formData.languages_spoken || []).length > 0 &&
//     formData.about_me
//   );
// };

// const isStep2Incomplete = () => {
//   return !(
//     formData.address &&
//     formData.city &&
//     formData.state &&
//     formData.pincode
//   );
// };

// const isStep3Incomplete = () => {
//   return !(
//     formData.experiences &&
//     formData.experiences.length > 0
//   );
// };

// const isStep4Incomplete = () => {
//   return !(
//     (formData.skills && formData.skills.length > 0) ||
//     (formData.assets && formData.assets.length > 0)
//   );
// };

// const isStep5Incomplete = () => {
//   return !(
//     formData.resume_path ||
//     formData.cvFile ||
//     (formData.certificateFiles && formData.certificateFiles.length > 0) ||
//     (formData.certificates && formData.certificates.length > 0)
//   );
// };


//   const fixResumeUrl = (url) => {
//     if (!url) return "";

//     // remove wrong https//
//     let clean = url.replace(/^https\/\//, "");

//     // if already full valid http/https â†’ keep it
//     if (clean.startsWith("http://") || clean.startsWith("https://")) {
//       return clean;
//     }

//     // attach correct base URL
//     return `https://apihrr.goelectronix.co.in/${clean.replace(/^\/+/, "")}`;
//   };

//   const fixResumeUrl2 = (url) => {
//     if (!url) return "";

//     let clean = url.trim();

//     // Fix broken https//
//     clean = clean.replace(/^https\/\//, "https://");

//     // ðŸ”´ If URL is https://uploads/... â†’ replace domain
//     if (clean.startsWith("https://uploads")) {
//       return clean.replace(
//         "https://uploads",
//         "https://apihrr.goelectronix.co.in/uploads",
//       );
//     }

//     // Already full valid URL â†’ return
//     if (clean.startsWith("http://") || clean.startsWith("https://")) {
//       return clean;
//     }

//     // Remove starting slash
//     clean = clean.replace(/^\/+/, "");

//     // Attach backend base
//     return `https://apihrr.goelectronix.co.in/${clean}`;
//   };

//   const hasExistingExperience =
//     Array.isArray(formData.experiences) && formData.experiences.length > 0;

//   const saveStepData = async (stepNumber) => {
//     try {
//       const apiData = new FormData();
//       const fields = STEP_FIELDS[stepNumber] || [];

//       fields.forEach((key) => {
//         if (key === "languages_spoken") {
//           apiData.append(
//             "languages_spoken",
//             (formData.languages_spoken || []).join(","),
//           );
//         } else if (key === "skills" || key === "assets") {
//           // apiData.append(key, JSON.stringify(formData[key] || []));
//           apiData.append(key, (formData[key] || []).join(","));
//         } else if (key === "experiences") {
//           apiData.append(
//             "experience_details",
//             JSON.stringify(formData.experiences || []),
//           );
//         } else if (key === "cvFile" && formData.cvFile) {
//           apiData.append("resumepdf", formData.cvFile);
//         }
//         // CASE 2: Resume LINK
//         else if (key === "resume_link" && formData.resume_link) {
//           apiData.append("resume_link", formData.resume_link);
//         } else if (key === "certificateFiles") {
//           formData.certificateFiles.forEach((file) => {
//             apiData.append("certificates", file);
//           });
//         }else {
//           apiData.append(key, formData[key] ?? "");
//         }
//       });

//           // ===========================
//     // FORCE CERTIFICATES FOR STEP 5
//     // ===========================
//     if (stepNumber === 5) {

//       // FILES
//       formData.certificateFiles.forEach((file) => {
//         apiData.append("certificates", file);
//       });

//       // LINKS (append one by one, NOT JSON)
//       formData.certificateLinks
//         .filter((link) => link && link.trim())
//         .forEach((link) => {
//           apiData.append("certificate_links", link);
//         });
//     }

//       apiData.append("full_name", formData.name || "");

//       await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//         {
//           method: "PATCH",
//           body: apiData,
//         },
//       );

//       // ðŸ”¥ FIX-2: Clear uploaded certificates after Step 5 save
// if (stepNumber === 5) {
//   setFormData((prev) => ({
//     ...prev,
//     certificateFiles: [],
//     certificateLinks: [""],   // reset to empty input
//   }));
// }

//       toast.success(`Step ${stepNumber} saved`);
//     } catch (err) {
//       console.error(err);
//       toast.error("Auto save failed");
//     }
//   };

//   const handleSubmit = async (e) => {
//     e.preventDefault();
//     setLoading(true);

//     const loadingToast = toast.loading("Executing Final PATCH Sync...");

//     try {
//       const apiData = new FormData();

//       // ðŸ”¹ Append ALL simple fields (NO skipping empty)
//       for (const key in formData) {
//         if (
//           ![
//             "experiences",
//             "certificateFiles",
//             "languages_spoken",
//             "cvFile",
//             "skills",
//             "assets",
//           ].includes(key)
//         ) {
//           apiData.append(key, formData[key] ?? "");
//         }
//       }

//       // ðŸ”¹ Required backend fields
//       apiData.append("full_name", formData.name || "");

//       apiData.append(
//         "languages_spoken",
//         (formData.languages_spoken || []).join(","),
//       );

//       apiData.append("skills", (formData.skills || []).join(","));
//       apiData.append("assets", (formData.assets || []).join(","));

//       // CASE 1: Upload PDF
//       if (formData.cvFile) {
//         apiData.append("resumepdf", formData.cvFile); // âœ… correct key
//       }

//       // CASE 2: Resume Link
//       else if (formData.resume_link) {
//         apiData.append("resume_link", formData.resume_link); // âœ… correct key
//       }

//       // CASE 3: Keep existing resume (no change)
//       else if (existingResume) {
//         apiData.append("resume_link", existingResume);
//       }

//       // ðŸ”¹ Certificates FILES
//       formData.certificateFiles.forEach((file) => {
//         apiData.append("certificates", file);
//       });

//       // ðŸ”¹ Certificate LINKS
//       apiData.append(
//         "certificate_links",
//         JSON.stringify(formData.certificateLinks.filter((l) => l && l.trim())),
//       );

//       // ðŸ”¹ Debug â€” SEE WHAT GOES TO API
//       for (let pair of apiData.entries()) {
//         console.log(pair[0], pair[1]);
//       }

//       const response = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//         {
//           method: "PATCH",
//           body: apiData,
//         },
//       );

//       if (!response.ok) {
//         const err = await response.text();
//         console.error(err);
//         throw new Error("API Failed");
//       }

//       toast.success("Candidate Synchronized ðŸŽ‰", { id: loadingToast });
//     } catch (err) {
//       console.error(err);
//       toast.error("Commit failed âŒ", { id: loadingToast });
//     } finally {
//       setLoading(false);
//     }
//   };

//   const numberToIndianWords = (num) => {
//     if (!num || isNaN(num)) return "";

//     const ones = [
//       "",
//       "One",
//       "Two",
//       "Three",
//       "Four",
//       "Five",
//       "Six",
//       "Seven",
//       "Eight",
//       "Nine",
//       "Ten",
//       "Eleven",
//       "Twelve",
//       "Thirteen",
//       "Fourteen",
//       "Fifteen",
//       "Sixteen",
//       "Seventeen",
//       "Eighteen",
//       "Nineteen",
//     ];

//     const tens = [
//       "",
//       "",
//       "Twenty",
//       "Thirty",
//       "Forty",
//       "Fifty",
//       "Sixty",
//       "Seventy",
//       "Eighty",
//       "Ninety",
//     ];

//     const twoDigits = (n) =>
//       n < 20
//         ? ones[n]
//         : tens[Math.floor(n / 10)] + (n % 10 ? " " + ones[n % 10] : "");

//     const threeDigits = (n) => {
//       if (n === 0) return "";
//       if (n < 100) return twoDigits(n);
//       return (
//         ones[Math.floor(n / 100)] +
//         " Hundred" +
//         (n % 100 ? " " + twoDigits(n % 100) : "")
//       );
//     };

//     const crore = Math.floor(num / 10000000);
//     const lakh = Math.floor((num % 10000000) / 100000);
//     const thousand = Math.floor((num % 100000) / 1000);
//     const hundred = num % 1000;

//     let result = "";

//     if (crore) result += twoDigits(crore) + " Crore ";
//     if (lakh) result += twoDigits(lakh) + " Lakh ";
//     if (thousand) result += twoDigits(thousand) + " Thousand ";
//     if (hundred) result += threeDigits(hundred);

//     return result.trim() + " per annum";
//   };

//   const today = new Date();

//   // 18 years ago (max allowed DOB)
//   const maxDate = new Date(
//     today.getFullYear() - 18,
//     today.getMonth(),
//     today.getDate(),
//   )
//     .toISOString()
//     .split("T")[0];

//   // 70 years ago (min allowed DOB)
//   const minDate = new Date(
//     today.getFullYear() - 70,
//     today.getMonth(),
//     today.getDate(),
//   )
//     .toISOString()
//     .split("T")[0];

//   const [dobError, setDobError] = useState("");

//   const handleDobChange = (value) => {
//     setFormData({ ...formData, dob: value });

//     if (!value) {
//       setDobError("Date of Birth is required");
//       return;
//     }

//     const selected = new Date(value);

//     if (selected > new Date(maxDate)) {
//       setDobError("Age must be at least 18 years");
//     } else if (selected < new Date(minDate)) {
//       setDobError("Age must be below 70 years");
//     } else {
//       setDobError("");
//     }
//   };

  

//   if (fetchingData)
//     return (
//       <div className="min-h-screen flex flex-col items-center justify-center bg-slate-50 gap-4">
//         <Loader2 className="h-10 w-10 animate-spin text-blue-600" />
//         <p className="text-[11px] font-black uppercase tracking-[0.2em] text-slate-400">
//           Loading Data Load {effectiveId}...
//         </p>
//       </div>
//     );

//   return (
//     <div className="min-h-screen bg-[#F8FAFC] p-4 md:p-12 antialiased">
//       <div className="max-w-6xl mx-auto space-y-8" ref={dropdownContainerRef}>
//         {/* ROADMAP HEADER */}
//         <div className="flex flex-col lg:flex-row justify-between items-center bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 gap-8">
//           <div className="flex items-center gap-6">
//             <div className="h-16 w-16 bg-slate-900 rounded-[1.5rem] flex items-center justify-center text-white shadow-2xl">
//               <Database size={32} />
//             </div>
//             <div>
//               <h2 className="text-2xl font-black text-slate-900 tracking-tight leading-none">
//                 {id ? "Profile" : "Manual Registry"}
//               </h2>
//               <div className="flex items-center gap-2 mt-1 text-blue-600">
//                 <ShieldCheck size={14} />
//               </div>
//             </div>
//           </div>

//           <div className="flex-1 max-w-2xl w-full px-4">
//             <div className="relative flex justify-between items-center w-full">
//               <div className="absolute top-1/2 left-0 w-full h-0.5 bg-slate-100 -translate-y-1/2 z-0" />
//               <div
//                 className="absolute top-1/2 left-0 h-0.5 bg-blue-600 -translate-y-1/2 z-0 transition-all duration-700"
//                 style={{ width: `${((step - 1) / (totalSteps - 1)) * 100}%` }}
//               />
//               {[1, 2, 3, 4, 5].map((num) => (
//                 <div
//                   key={num}
//                   className="relative z-10 flex flex-col items-center gap-2"
//                 >
                 
//                   <div
//   className={`h-8 w-8 rounded-full flex items-center justify-center text-[10px] font-black transition-all border-4
//   ${
//     step === num
//       ? "bg-blue-600 text-white border-blue-100 scale-110 shadow-lg"
//       : step > num
//       ? "bg-emerald-500 text-white border-emerald-50"
//       : (
//           (num === 1 && isStep1Incomplete()) ||
//           (num === 2 && isStep2Incomplete()) ||
//           (num === 3 && isStep3Incomplete()) ||
//           (num === 4 && isStep4Incomplete()) ||
//           (num === 5 && isStep5Incomplete())
//         )
//       ? "bg-yellow-400 text-white border-yellow-100"
//       : "bg-white text-slate-300 border-slate-50"
//   }`}
// >
//   {step > num ? <Check size={14} strokeWidth={4} /> : num}
// </div>

//                   <span
//                     className={`absolute -bottom-6 text-[8px] font-black uppercase tracking-tighter transition-colors duration-300 ${step === num ? "text-blue-600" : "text-slate-300"}`}
//                   >
//                     {num === 1 && "Personal"} {num === 2 && "Location"}{" "}
//                     {num === 3 && "Experience"} {num === 4 && "Assets & skill"}{" "}
//                     {num === 5 && "Documents"}
//                   </span>
//                 </div>
//               ))}
//             </div>
//           </div>
//           <div className="bg-slate-50 border border-slate-200 rounded-2xl px-6 py-3 flex items-center gap-3 shadow-inner">
//             <div className="text-right">
//               <p className="text-[8px] font-black text-slate-400 uppercase leading-none">
//                 Status
//               </p>
//               <p className="text-sm font-black text-slate-900 mt-1">
//                 {Math.round((step / totalSteps) * 100)}%
//               </p>
//             </div>
//             <div className="h-8 w-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center">
//               <Check size={18} />
//             </div>
//           </div>
//         </div>

//         <form onSubmit={handleSubmit}>
//           <div className="space-y-12">
//             {/* STEP 1: IDENTITY & CAREER */}
//             {step === 1 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8 duration-500">
//                 <div className="flex items-center gap-4 pb-4 border-b border-slate-100">
//                   <User size={18} className="text-blue-600" />
//                   <h3 className="text-sm font-black text-slate-800 uppercase tracking-widest">
//                     Basic Candidate profile
//                   </h3>
//                 </div>
//                 <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
//                   <FormField label="Full Name" required>
//                     <input
//                       placeholder="Legal Name"
//                       value={formData.name}
//                       onChange={(e) =>
//                         setFormData({ ...formData, name: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <FormField label="Email" required>
//                     <input
//                       type="email"
//                       placeholder="name@domain.com"
//                       value={formData.email}
//                       onChange={(e) =>
//                         setFormData({ ...formData, email: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <FormField label="Phone" required>
//                     <div className="flex items-center bg-slate-50 border border-slate-200 rounded-xl overflow-hidden focus-within:bg-white focus-within:border-blue-500 transition-all shadow-sm">
//                       <span className="px-3 text-[11px] font-black text-slate-400">
//                         +91
//                       </span>
//                       <input
//                         maxLength={10}
//                         value={formData.phone}
//                         onChange={(e) =>
//                           setFormData({ ...formData, phone: e.target.value })
//                         }
//                         className="w-full px-3 py-2 bg-transparent text-[13px] font-bold outline-none"
//                       />
//                     </div>
//                   </FormField>
//                   <FormField label="Gender">
//                     <select
//                       value={formData.gender}
//                       onChange={(e) =>
//                         setFormData({ ...formData, gender: e.target.value })
//                       }
//                       className={inputStyle}
//                     >
//                       <option value="">Select</option>
//                       <option value="male">Male</option>
//                       <option value="female">Female</option>
//                       <option value="transgender">Transgender</option>
//                       <option value="prefer_not_to_say">
//                         Prefer not to say
//                       </option>
//                     </select>
//                   </FormField>
//                 </div>

//                 <div className="grid grid-cols-1 md:grid-cols-2 gap-8 pt-4">
//                   <FormField label="Date of Birth">
//                     <input
//                       type="date"
//                       min={minDate}
//                       max={maxDate}
//                       value={formData.dob}
//                       onChange={(e) =>
//                         setFormData({ ...formData, dob: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <FormField label="Languages">
//                     <div className="bg-slate-50 border border-slate-200 rounded-xl p-3 max-h-32 overflow-y-auto grid grid-cols-2 gap-3 shadow-inner">
//                       {[
//                         "English",
//                         "Hindi",
//                         "Marathi",
//                         "Gujarati",
//                         "Tamil",
//                         "Telugu",
//                       ].map((lang) => (
//                         <label
//                           key={lang}
//                           className="flex items-center gap-2 text-[11px] font-medium text-slate-600 cursor-pointer hover:text-blue-600 transition-colors"
//                         >
//                           <input
//                             type="checkbox"
//                             checked={formData.languages_spoken.includes(lang)}
//                             onChange={() => {
//                               const u = formData.languages_spoken.includes(lang)
//                                 ? formData.languages_spoken.filter(
//                                     (l) => l !== lang,
//                                   )
//                                 : [...formData.languages_spoken, lang];
//                               setFormData({ ...formData, languages_spoken: u });
//                             }}
//                             className="w-3.5 h-3.5 accent-blue-600 rounded"
//                           />{" "}
//                           {lang}
//                         </label>
//                       ))}
//                     </div>
//                   </FormField>
//                 </div>
//                 <FormField label="Bio Summary">
//                   <textarea
//                     rows={3}
//                     value={formData.about_me}
//                     onChange={(e) =>
//                       setFormData({ ...formData, about_me: e.target.value })
//                     }
//                     className={inputStyle + " resize-none"}
//                   />
//                 </FormField>
//                 <div className="flex justify-end pt-4">
//                   <button
//                     type="button"
//                     // onClick={() => setStep(2)}
//                     onClick={async () => {
//                       await saveStepData(1);
//                       setStep(2);
//                     }}
//                     className={`px-12 py-3 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest shadow-xl active:scale-95 transition-all`}
//                   >
//                     Next Phase â†’
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 2: GEOGRAPHY */}
//             {step === 2 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8">
//                 <div className="flex items-center gap-3 pb-4 border-b border-slate-100">
//                   <MapPin size={18} className="text-blue-600" />
//                   <h3 className="text-xs font-black text-slate-800 uppercase tracking-widest">
//                     location Data
//                   </h3>
//                 </div>
//                 <div className="space-y-8">
//                   <FormField label="Address 1" required>
//                     <input
//                       value={formData.address}
//                       onChange={(e) =>
//                         setFormData({ ...formData, address: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                     <FormField label="Address 2" required>
//                       <input
//                         value={formData.location}
//                         onChange={(e) =>
//                           setFormData({ ...formData, location: e.target.value })
//                         }
//                         className={inputStyle}
//                       />
//                     </FormField>
//                     <FormField label="Pincode" required>
//                       <input
//                         maxLength={6}
//                         placeholder="000000"
//                         value={formData.pincode}
//                         onChange={(e) => {
//                           setFormData({ ...formData, pincode: e.target.value });
//                           if (e.target.value.length === 6)
//                             fetchPincodeDetails(e.target.value);
//                         }}
//                         className={inputStyle}
//                       />
//                     </FormField>
//                   </div>
//                   <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
                    
//                     <FormField label="City">
//                       {isFetchingPincode ? (
//                         <input
//                           value="Fetching..."
//                           readOnly
//                           className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-400 shadow-inner"
//                         />
//                       ) : cityOptions.length > 1 ? (
//                         <select
//                           value={formData.city}
//                           onChange={(e) => {
//                             const selected = cityOptions.find(
//                               (c) => c.Name === e.target.value,
//                             );

//                             setFormData((prev) => ({
//                               ...prev,
//                               city: selected?.Name || "",
//                               district: selected?.District || "",
//                               state: selected?.State || "",
//                               country: selected?.Country || "India",
//                             }));
//                           }}
//                           className="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl text-xs font-bold text-slate-700 shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100"
//                         >
//                           {cityOptions.map((c, i) => (
//                             <option key={i} value={c.Name}>
//                               {c.Name}
//                             </option>
//                           ))}
//                         </select>
//                       ) : (
//                         <input
//                           value={formData.city || ""}
//                           readOnly
//                           className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                         />
//                       )}
//                     </FormField>

//                     <FormField label="District">
//                       <input
//                         // value={formData.district}
//                         value={
//                           isFetchingPincode ? "Fetching..." : formData.district
//                         }
//                         readOnly
//                         className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                       />
//                     </FormField>
//                     <FormField label="State">
//                       <input
//                         // value={formData.state}
//                         value={
//                           isFetchingPincode ? "Fetching..." : formData.state
//                         }
//                         readOnly
//                         className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                       />
//                     </FormField>
//                     <FormField label="Country">
//                       <input
//                         // value={formData.country}
//                         value={
//                           isFetchingPincode ? "Fetching..." : formData.country
//                         }
//                         readOnly
//                         onChange={(e) =>
//                           setFormData({ ...formData, country: e.target.value })
//                         }
//                         className={inputStyle}
//                       />
//                     </FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-between pt-8 border-t border-slate-50">
//                   <button
//                     onClick={() => setStep(1)}
//                     type="button"
//                     className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase hover:text-slate-900 transition-all shadow-sm"
//                   >
//                     â† Back
//                   </button>
//                   <button
//                     //  onClick={() => setStep(3)}
//                     onClick={async () => {
//                       await saveStepData(2);
//                       setStep(3);
//                     }}
//                     type="button"
//                     className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase shadow-xl transition-all"
//                   >
//                     Continue â†’
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 3: EXPERIENCE */}
           

// {step === 3 && (
//   <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
//     {/* STATUS SELECTOR CARD */}
//     <div className="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-sm overflow-hidden relative group">
//       <Fingerprint className="absolute -right-6 -bottom-6 text-slate-50 opacity-[0.4] -rotate-12 pointer-events-none" size={100} />
//       <div className="flex flex-col md:flex-row items-center justify-between gap-6 relative z-10">
//         <div className="flex items-center gap-4 text-slate-900 font-black">
//           <div className="w-12 h-12 bg-blue-50 rounded-2xl flex items-center justify-center text-blue-600 shadow-inner">
//             <Briefcase size={22} strokeWidth={2.5} />
//           </div>
//           <div>
//             <h3 className="text-sm uppercase tracking-[0.15em]">Are you Fresher?</h3>
//             <p className="text-[10px] font-bold text-slate-400 mt-1 uppercase tracking-widest">Career status determines validation protocol</p>
//           </div>
//         </div>
//         <div className="flex bg-slate-100 p-1.5 rounded-[1.5rem] border border-slate-200 w-full md:w-auto">
//           <button
//             type="button"
//             disabled={hasExistingExperience}
//             onClick={() => {
//               if (hasExistingExperience) return;
//               setIsFresher(true);
//               setFormData({ ...formData, experiences: [] });
//             }}
//             className={`px-10 py-3 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === true ? "bg-white text-blue-600 shadow-sm border border-slate-200" : "text-slate-400"}`}
//           >YES</button>
//           <button
//             type="button"
//             onClick={() => setIsFresher(false)}
//             className={`px-10 py-3 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === false ? "bg-white text-blue-600 shadow-sm border border-slate-200" : "text-slate-400"}`}
//           >NO</button>
//         </div>
//       </div>
//     </div>

//     {/* EXPERIENCE TIMELINE DISPLAY */}
//     {isFresher === false && (
//       <div className="bg-white p-8 rounded-[3.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 space-y-10 relative overflow-hidden">
//         <div className="flex flex-col sm:flex-row justify-between items-center border-b border-slate-50 pb-8 relative z-10">
//           <div className="flex items-center gap-4">
//             <div className="h-10 w-10 rounded-xl bg-slate-900 flex items-center justify-center text-white shadow-lg">
//               <History size={20} />
//             </div>
//             <h3 className="text-sm font-black text-slate-900 uppercase tracking-widest">Job Experience History</h3>
//           </div>
//           <button
//             type="button"
//             onClick={() => {
//               if (newExperiences.length === 0) {
//                 setNewExperiences([{ company_name: "", job_title: "", start_date: "", end_date: "", previous_ctc: "", location: "", description: "" }]);
//               }
//               setShowExpModal(true);
//             }}
//             className="px-6 py-3 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl shadow-blue-200 hover:bg-blue-700 active:scale-95 transition-all flex items-center gap-2"
//           >
//             <Plus size={14} strokeWidth={3} /> Add Experience
//           </button>
//         </div>

//         {/* VERIFIED DATA LIST (Shows existing records from formData) */}
      
//         <div className="space-y-4 relative z-10 animate-in fade-in slide-in-from-bottom-4 duration-700">
//   {formData.experiences && formData.experiences.length > 0 ? (
//     formData.experiences.map((exp, i) => (
//       <div 
//         key={i} 
//         className="group relative flex flex-col md:flex-row items-stretch gap-0 bg-white border border-slate-200 rounded-[1.5rem] hover:border-blue-400 hover:shadow-xl hover:shadow-blue-500/5 transition-all duration-300 overflow-hidden"
//       >
//         {/* SIDE BRANDING BAR: Denotes 'Verified Node' status */}
//         <div className="w-1.5 bg-blue-600 group-hover:w-2 transition-all duration-300" />

//         {/* INDEX NODE: Terminal Style */}
//         <div className="flex items-center justify-center px-6 bg-slate-50/50 border-r border-slate-100">
//           <div className="w-10 h-10 rounded-xl bg-white border border-slate-200 flex flex-col items-center justify-center shadow-sm group-hover:border-blue-200 transition-colors">
//             <span className="text-[10px] font-black text-slate-400 leading-none uppercase tracking-tighter">exp</span>
//             <span className="text-sm font-black text-slate-900 leading-none mt-1">0{i + 1}</span>
//           </div>
//         </div>

//         {/* MAIN CONTENT STRIP */}
//         <div className="flex-1 p-5 md:p-6 flex flex-col md:flex-row md:items-center justify-between gap-6">
//           <div className="min-w-0 space-y-2">
//             {/* Entity & Role */}
//             <div className="flex items-center gap-3">
//               <h4 className="text-sm font-black text-slate-900 uppercase tracking-tight truncate group-hover:text-blue-600 transition-colors">
//                 {exp.company_name || "Unidentified Entity"}
//               </h4>
//               <div className="h-1 w-1 rounded-full bg-slate-300" />
//               <div className="px-2 py-0.5 bg-blue-50 text-blue-700 rounded-md text-[9px] font-black uppercase tracking-widest border border-blue-100/50">
//                 {exp.job_title || "Role Pending"}
//               </div>
//             </div>

//             {/* Deployment Meta-Data */}
//             <div className="flex flex-wrap items-center gap-x-6 gap-y-2">
//               <div className="flex items-center gap-2 text-slate-400">
//                 <Calendar size={13} className="text-slate-300" />
//                 <span className="text-[10px] font-bold uppercase tracking-widest">
//                   {exp.start_date || "----"} <span className="text-slate-200 mx-1">â€”</span> {exp.end_date || "Present"}
//                 </span>
//               </div>
//               <div className="flex items-center gap-2 text-slate-400">
//                 <MapPin size={13} className="text-slate-300" />
//                 <span className="text-[10px] font-bold uppercase tracking-widest">{exp.location || "Global Node"}</span>
//               </div>
//             </div>
//           </div>

//           {/* FINANCIAL NODE: High Contrast Badge */}
//           <div className="flex items-center gap-6">
//             <div className="flex flex-col items-end border-r border-slate-100 pr-6">
//               <span className="text-[8px] font-black text-slate-400 uppercase tracking-[0.2em] mb-1">Previous CTC</span>
//               <div className="flex items-center gap-1.5 text-emerald-600">
//                 <div className="h-1.5 w-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]" />
//                 <span className="text-[12px] font-black uppercase tracking-tight">
//                   â‚¹{exp.previous_ctc ? `${(exp.previous_ctc / 100000).toFixed(2)} LPA` : "0.00"}
//                 </span>
//               </div>
//             </div>

//             {/* ACTION INTERFACE */}
//             <div className="flex items-center gap-2">
//               <button 
//                 type="button" 
                
// onClick={() => {
//   const existing = formData.experiences[i];

//   setCurrentEditingIndex(i);

//   setNewExperiences([
//     {
//       ...existing,
//       uploadMode: existing.exp_letter_link ? "link" : "file",
//       expLetterFile: null, // important
//     },
//   ]);

//   setShowExpModal(true);
// }}



//                 className="p-3 bg-slate-50 text-slate-400 hover:bg-blue-600 hover:text-white rounded-xl transition-all duration-300 border border-slate-100 active:scale-90"
//               >
//                 <Edit3 size={16} strokeWidth={2.5} />
//               </button>
//             </div>
//           </div>
//         </div>

//         {/* Decorative Watermark for Enterprise Feel */}
//         <History className="absolute -right-4 -bottom-4 text-slate-900 opacity-[0.02] -rotate-12 pointer-events-none group-hover:opacity-[0.05] transition-opacity" size={100} />
//       </div>
//     ))
//   ) : (
//     /* EMPTY STATE: Audit-Empty Pattern */
//     <div className="relative group flex flex-col items-center justify-center py-20 bg-slate-50/30 border-2 border-dashed border-slate-200 rounded-[2.5rem] transition-colors hover:bg-slate-50">
//       <div className="relative z-10 flex flex-col items-center">
//         <div className="w-16 h-16 bg-white rounded-[1.5rem] shadow-sm border border-slate-100 flex items-center justify-center text-slate-200 mb-6 group-hover:scale-110 transition-transform duration-500">
//           <Database size={32} strokeWidth={1.5} />
//         </div>
//         <h4 className="text-[11px] font-black text-slate-400 uppercase tracking-[0.3em] mb-2">
//           Zero Nodes Synchronized
//         </h4>
//         <p className="text-[10px] font-bold text-slate-300 uppercase tracking-widest text-center max-w-xs">
//           Professional history registry currently empty. Initialize a new experience node to begin.
//         </p>
//       </div>
//       <div className="absolute inset-0 overflow-hidden pointer-events-none rounded-[2.5rem]">
//          <ShieldCheck className="absolute -right-8 -bottom-8 text-slate-900 opacity-[0.02] -rotate-12" size={200} />
//       </div>
//     </div>
//   )}
// </div>
//       </div>
//     )}

//     {/* NAVIGATION */}
//     <div className="flex justify-between pt-6">
//       <button type="button" onClick={() => setStep(2)} className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[10px] font-black uppercase shadow-sm transition-all hover:text-slate-900">â† Back</button>
//       <button
//         type="button"
//         onClick={async () => { await saveStepData(3); setStep(4); }}
//         disabled={isFresher === null}
//         className={`px-12 py-4 rounded-2xl text-[10px] font-black uppercase shadow-xl transition-all ${isFresher !== null ? "bg-blue-600 text-white shadow-blue-200" : "bg-slate-200 text-slate-300 cursor-not-allowed"}`}
//       >Commit & Continue â†’</button>
//     </div>

//     {/* MODAL: ADDING NEW RECORDS ONLY (Upload Logic Removed) */}
   
//     {showExpModal && (
//   <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 md:p-8 bg-slate-900/60 backdrop-blur-md animate-in fade-in duration-300">
//     <div className="bg-white w-full max-w-6xl h-full max-h-[85vh] rounded-[3rem] shadow-2xl border border-slate-200 flex flex-col overflow-hidden animate-in zoom-in-95 duration-300">
      
//       {/* Modal Header */}
//       <div className="px-10 py-8 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
//         <div className="flex items-center gap-4">
//           <div className="w-14 h-14 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-xl shadow-blue-200">
//             <Plus size={28} strokeWidth={3} />
//           </div>
//           <div>
//             {/* <h2 className="text-base font-black text-slate-900 uppercase tracking-[0.2em]">New Experience</h2> */}
//             <h2 className="text-base font-black text-slate-900 uppercase tracking-[0.2em]">
//                 {currentEditingIndex !== null ? "Edit Experience" : "New Experience"}
//             </h2>
//             <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Add new Experience Records</p>
//           </div>
//         </div>
//         <button onClick={() => setShowExpModal(false)} className="w-12 h-12 flex items-center justify-center bg-white border border-slate-100 hover:bg-red-50 hover:text-red-500 rounded-full transition-all shadow-sm">
//           <X size={24} />
//         </button>
//       </div>

//       {/* Modal Content */}
//       <div className="flex-1 overflow-y-auto p-10 space-y-12 custom-scrollbar-professional bg-white">
//         {newExperiences.map((exp, i) => (
//           <div key={i} className="relative bg-slate-50/50 border border-slate-200 p-8 rounded-[2.5rem] space-y-8 animate-in slide-in-from-bottom-4 group hover:bg-white hover:border-blue-200 transition-all">
//             {/* Remove Entry */}
//             <button
//               type="button"
//               onClick={() => setNewExperiences(newExperiences.filter((_, idx) => idx !== i))}
//               className="absolute -top-3 -right-3 h-10 w-10 bg-white border border-slate-200 text-red-500 rounded-full flex items-center justify-center shadow-lg opacity-0 group-hover:opacity-100 transition-all z-20 hover:bg-red-500 hover:text-white"
//             >
//               <Trash2 size={18} />
//             </button>

//             {/* GRID 1: IDENTITY */}
//             <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
//               <FormField label="Employer">
//                 <input placeholder="Company Name" value={exp.company_name} onChange={(e) => { const u = [...newExperiences]; u[i].company_name = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//               </FormField>
//               <FormField label="Designation">
//                 <input placeholder="Job Title" value={exp.job_title} onChange={(e) => { const u = [...newExperiences]; u[i].job_title = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//               </FormField>
//               <FormField label="Location">
//                 <input placeholder="City" value={exp.location} onChange={(e) => { const u = [...newExperiences]; u[i].location = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//               </FormField>
              
//              <FormField label="Industry">
//   <div className="relative">

//     {/* INPUT BOX */}
//     <input
//       value={exp.industry || ""}
//       placeholder="Search or select industry..."
//       onFocus={() => setShowIndustryDrop(true)}
//       onChange={(e) => {
//         const value = e.target.value;
//         setIndustrySearch(value);

//         const u = [...newExperiences];
//         u[i].industry = value;
//         setNewExperiences(u);
//       }}
//       className={inputStyle}
//     />

//     {/* DROPDOWN */}
//     {showIndustryDrop && (
//       <div className="absolute z-50 mt-2 w-full bg-white border border-slate-200 rounded-xl shadow-lg overflow-hidden">

//         {/* LIST â€” SHOW 4 ITEMS HEIGHT */}
//         <div className="max-h-44 overflow-y-auto">

//           {filteredIndustries.length > 0 ? (
//             filteredIndustries.map((ind) => (
//               <div
//                 key={ind}
//                 onClick={() => {
//                   const u = [...newExperiences];
//                   u[i].industry = ind;
//                   setNewExperiences(u);

//                   setIndustrySearch("");
//                   setShowIndustryDrop(false);
//                 }}
//                 className="px-4 py-2 text-[13px] font-bold text-slate-700 hover:bg-blue-50 hover:text-blue-600 cursor-pointer transition"
//               >
//                 {ind}
//               </div>
//             ))
//           ) : (
//             <div className="px-4 py-3 text-xs text-slate-400">
//               No match found
//             </div>
//           )}
//         </div>
//       </div>
//     )}
//   </div>
// </FormField>


//             </div>

//             {/* GRID 2: TIMELINE & CTC */}
//             <div className="grid grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
//               <FormField label="Start Date">
//                 <input type="date" value={exp.start_date} onChange={(e) => { const u = [...newExperiences]; u[i].start_date = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//               </FormField>
//               <FormField label="End Date">
//                 <input type="date" value={exp.end_date} onChange={(e) => { const u = [...newExperiences]; u[i].end_date = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//               </FormField>
//               <FormField label="Annual CTC">
//                 <div className="flex items-center bg-white border border-slate-200 rounded-2xl overflow-hidden focus-within:border-blue-500 transition-all">
//                   <div className="px-4 text-blue-600 font-black italic">â‚¹</div>
//                   <input type="number" placeholder="0.00" value={exp.previous_ctc} onChange={(e) => { const u = [...newExperiences]; u[i].previous_ctc = e.target.value; setNewExperiences(u); }} className="w-full py-3 bg-transparent text-[12px] font-bold outline-none" />
//                   <div className="pr-4 text-[9px] font-black text-slate-400">LPA</div>
//                 </div>
//               </FormField>
//             </div>

//             {/* GRID 3: DESCRIPTION & ARTIFACT UPLOAD */}
//             <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
//               <FormField label="Professional Summary">
//                 <textarea rows={4} placeholder="Briefly describe your role..." value={exp.description} onChange={(e) => { const u = [...newExperiences]; u[i].description = e.target.value; setNewExperiences(u); }} className={inputStyle + " resize-none"} />
//               </FormField>
              
//               <div className="space-y-4">
//                 <div className="flex justify-between items-center px-1">
//                   <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Experience Artifact</p>
//                   <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200 scale-90">
//                     <button
//                       type="button"
//                       onClick={() => { const u = [...newExperiences]; u[i].uploadMode = "file"; setNewExperiences(u); }}
//                       className={`px-4 py-1 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode !== "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                     >FILE</button>
//                     <button
//                       type="button"
//                       onClick={() => { const u = [...newExperiences]; u[i].uploadMode = "link"; setNewExperiences(u); }}
//                       className={`px-4 py-1 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                     >URL</button>
//                   </div>
//                 </div>

//                 <div className="bg-white/50 border-2 border-dashed border-slate-200 rounded-[2rem] p-6 min-h-[140px] flex flex-col justify-center items-center group/upload hover:bg-blue-50/30 transition-all">
//                   {exp.uploadMode !== "link" ? (
//                     <label className="flex flex-col items-center cursor-pointer w-full">
//                       <FileUp size={24} className="text-slate-300 group-hover/upload:text-blue-500 mb-2 transition-colors" />
//                       <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest text-center px-4">
//                         {exp.expLetterFile ? exp.expLetterFile.name : "Select Validation PDF"}
//                       </span>
//                       <input 
//                         type="file" 
//                         accept=".pdf" 
//                         className="hidden" 
//                         onChange={(e) => { const u = [...newExperiences]; u[i].expLetterFile = e.target.files[0]; setNewExperiences(u); }} 
//                       />
//                     </label>
//                   ) : (
//                     <div className="w-full px-4 relative">
//                       <LinkIcon size={16} className="absolute left-7 top-1/2 -translate-y-1/2 text-slate-300" />
//                       <input 
//                         placeholder="Public Storage URI (https://...)" 
//                         value={exp.exp_letter_link || ""} 
//                         onChange={(e) => { const u = [...newExperiences]; u[i].exp_letter_link = e.target.value; setNewExperiences(u); }} 
//                         className={inputStyle + " pl-12"} 
//                       />
//                     </div>
//                   )}
//                 </div>
//               </div>
//             </div>

//             {/* SAVE ACTION */}
//             <div className="flex justify-end pt-4 border-t border-slate-100">
//               <button
//                 type="button"
//                 // onClick={() => handleSaveExperienceAPI(i)} 
//                 onClick={() => handleSaveOrUpdateExperience(i)}
//                 className="flex items-center gap-2 px-8 py-3 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl shadow-blue-200 transition-all hover:bg-blue-700 active:scale-95"
//               >
//                 {/* <CheckCircle size={16} /> Save */}
//                 <CheckCircle size={16} />
// {currentEditingIndex !== null ? "Update" : "Save"}

//               </button>
//             </div>
//           </div>
//         ))}

       
//         {currentEditingIndex === null && (
//   <button
//     type="button"
//     onClick={() =>
//       setNewExperiences([
//         ...newExperiences,
//         {
//           company_name: "",
//           job_title: "",
//           start_date: "",
//           end_date: "",
//           previous_ctc: "",
//           location: "",
//           description: "",
//           industry: "",
//           uploadMode: "file",
//           expLetterFile: null,
//           exp_letter_link: "",
//           candidate_id: effectiveId,
//         },
//       ])
//     }
//     className="w-full py-8 border-2 border-dashed border-slate-400 rounded-[2.5rem] text-slate-500 hover:text-blue-600 hover:border-blue-200 hover:bg-blue-50/20 transition-all text-[11px] font-black uppercase tracking-[0.3em]"
//   >
//     + Add New Row
//   </button>
// )}

//       </div>

//       {/* Modal Footer */}
     
//     </div>
//   </div>
// )} 
//   </div>
// )}


//             {/* STEP 4: INVENTORY */}
//             {step === 4 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 overflow-visible">
//                 <div className="bg-white border border-slate-200 rounded-[3.5rem] shadow-xl overflow-visible shadow-slate-200/50">
//                   <div className="bg-slate-50/50 px-10 py-6 border-b border-slate-200 flex items-center justify-between rounded-t-[3.5rem]">
//                     <div className="flex items-center gap-4">
//                       <div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg">
//                         <Cpu size={20} />
//                       </div>
//                       <div>
//                         <h3 className="text-sm font-black text-slate-900 uppercase tracking-widest leading-none">
//                           Skills & Assets
//                         </h3>
//                       </div>
//                     </div>
//                   </div>
//                   <div className="p-8 md:p-12 space-y-12 overflow-visible">
//                     <FormField label="Skills">
//                       <div className="space-y-6">
//                         <div className="flex flex-col sm:flex-row gap-4 items-end">
//                           <div className="relative max-w-md w-full">
//                             <Plus
//                               size={16}
//                               className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                             />
//                             <input
//                               value={skillInput}
//                               onChange={(e) => setSkillInput(e.target.value)}
//                               onKeyDown={(e) => {
//                                 if (e.key === "Enter") {
//                                   e.preventDefault();
//                                   const name = skillInput.trim();
//                                   if (!name) return;

//                                   // prevent duplicate
//                                   if (!formData.skills.includes(name)) {
//                                     setFormData((prev) => ({
//                                       ...prev,
//                                       skills: [...prev.skills, name],
//                                     }));
//                                   }

//                                   setSkillInput("");
//                                 }
//                               }}
//                               placeholder="Register skill..."
//                               className={inputStyle + " pl-12"}
//                             />
//                           </div>
//                         </div>

//                         <div className="flex flex-wrap gap-3 p-1 w-full min-h-[40px]">
//                           {[
//                             ...new Set([...dynamicSkills, ...formData.skills]),
//                           ].map((skill) => {
//                             const isSelected = formData.skills.includes(skill);

//                             return (
//                               <button
//                                 key={skill}
//                                 type="button"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     skills: isSelected
//                                       ? formData.skills.filter(
//                                           (s) => s !== skill,
//                                         )
//                                       : [...formData.skills, skill],
//                                   })
//                                 }
//                                 className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${
//                                   isSelected
//                                     ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200"
//                                     : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"
//                                 }`}
//                               >
//                                 {skill}
//                                 {isSelected && (
//                                   <Check size={14} strokeWidth={3} />
//                                 )}
//                               </button>
//                             );
//                           })}
//                         </div>
//                       </div>
//                     </FormField>
//                     {/* <FormField label="Enterprise Hardware Matrix"><div className="space-y-6 pt-8 border-t border-slate-100"><div className="relative max-w-md w-full"><Layers size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={assetInput} onChange={(e) => setAssetInput(e.target.value)} onKeyDown={async (e) => { if(e.key === 'Enter') { e.preventDefault(); const v = assetInput.trim(); if(v && !formData.assets.includes(v)) { const ok = await handleAddAssetAPI(v); if(ok) { setFormData({...formData, assets: [...formData.assets, v]}); setAssetInput(""); } } } }} placeholder="Link hardware..." className={inputStyle + " pl-12"} /></div><div className="flex flex-wrap gap-3 p-1">{dynamicAssets.map((asset) => { const isSelected = formData.assets.includes(asset); return (<button key={asset} type="button" onClick={async () => { if(!isSelected) { const ok = await handleAddAssetAPI(asset); if(ok) setFormData({...formData, assets: [...formData.assets, asset]}); } else { setFormData({...formData, assets: formData.assets.filter(a => a !== asset)}); } }} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${isSelected ? "bg-slate-900 border-slate-900 text-white shadow-lg shadow-slate-200" : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`}>{asset} {isSelected && <Check size={14} strokeWidth={3} className="animate-in zoom-in" />}</button>); })}</div></div></FormField> */}
//                     <div className="space-y-6 pt-8 border-t border-slate-100">
//                       <FormField label="Assets">
//                         <div className="space-y-6">
//                           {/* Search & Manual Add Input */}
//                           <div className="relative max-w-md">
//                             <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">
//                               <Layers size={16} />
//                             </div>
//                             <input
//                               value={assetInput}
//                               onChange={(e) => setAssetInput(e.target.value)}
                              
//                               onKeyDown={(e) => {
//                                 if (e.key === "Enter") {
//                                   e.preventDefault();
//                                   const v = assetInput.trim();
//                                   if (!v) return;

//                                   // Prevent duplicate
//                                   if (!formData.assets.includes(v)) {
//                                     setFormData((prev) => ({
//                                       ...prev,
//                                       assets: [...prev.assets, v],
//                                     }));
//                                   }

//                                   setAssetInput("");
//                                 }
//                               }}
//                               placeholder="Type hardware name and press Enter..."
//                               className="w-full pl-12 pr-4 py-3.5 bg-slate-50 border border-slate-200 rounded-2xl text-xs font-bold outline-none focus:bg-white focus:border-slate-900 focus:ring-4 focus:ring-slate-900/5 transition-all shadow-inner"
//                             />
//                           </div>

//                           <div className="flex flex-wrap gap-3 p-1 w-full min-h-[40px]">
//                             {[
//                               ...new Set([
//                                 ...dynamicAssets,
//                                 ...formData.assets,
//                               ]),
//                             ].filter(
//                               (a) => typeof a === "string" && a.trim() !== "",
//                             ).length === 0 ? (
//                               /* âŒ NO ASSETS */
//                               <div className="w-full text-center py-6 bg-slate-50 border border-dashed border-slate-200 rounded-2xl">
//                                 <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">
//                                   No assets available
//                                 </p>
//                               </div>
//                             ) : (
//                               /* âœ… ASSET CHIPS */
//                               [
//                                 ...new Set([
//                                   ...dynamicAssets,
//                                   ...formData.assets,
//                                 ]),
//                               ]
//                                 .filter(
//                                   (a) =>
//                                     typeof a === "string" && a.trim() !== "",
//                                 )
//                                 .map((asset) => {
//                                   const isSelected =
//                                     formData.assets.includes(asset);

//                                   return (
//                                     <button
//                                       key={asset}
//                                       type="button"
//                                       onClick={() =>
//                                         setFormData((prev) => ({
//                                           ...prev,
//                                           assets: isSelected
//                                             ? prev.assets.filter(
//                                                 (a) => a !== asset,
//                                               )
//                                             : [...prev.assets, asset],
//                                         }))
//                                       }
//                                       className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90
//             ${
//               isSelected
//                 ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200"
//                 : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"
//             }`}
//                                     >
//                                       {asset}
//                                       {isSelected && (
//                                         <Check size={14} strokeWidth={3} />
//                                       )}
//                                     </button>
//                                   );
//                                 })
//                             )}
//                           </div>
//                         </div>
//                       </FormField>
//                     </div>
//                   </div>
//                 </div>
//                 <div className="flex justify-between items-center pt-4">
//                   <button
//                     onClick={() => setStep(3)}
//                     type="button"
//                     className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[11px] font-black uppercase transition-all shadow-sm hover:text-slate-900 flex items-center gap-2 transition-all"
//                   >
//                     <ChevronLeft size={16} /> Back
//                   </button>

//                   <button
//                     onClick={async () => {
//                       await saveStepData(4);
//                       setStep(5);
//                     }}
//                     type="button"
//                     className="px-12 py-4 bg-blue-600 text-white rounded-xl text-[11px] font-black uppercase shadow-xl active:scale-95 transition-all flex items-center gap-2 whitespace-nowrap"
//                   >
//                     Next Phase <ChevronRight size={14} />
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 5: DOCUMENT VAULT */}

//             {/* {step === 5 && (
//               <div className="space-y-8 animate-in slide-in-from-bottom-8 duration-500">
//                 <div className="bg-white rounded-[2rem] shadow-2xl shadow-slate-200/50 border border-slate-200 overflow-hidden relative">
                
//                   <div className="bg-slate-50 px-8 py-6 border-b border-slate-200 flex items-center justify-between">
//                     <div className="flex items-center gap-5">
//                       <div className="h-12 w-12 bg-slate-900 rounded-2xl flex items-center justify-center text-white shadow-lg">
//                         <ShieldCheck size={24} />
//                       </div>
//                       <div>
//                         <h3 className="text-lg font-bold text-slate-900 tracking-tight">
//                           Document upload
//                         </h3>

//                         <div className="px-8 pt-6">
//   <select
//     value={docType}
//     onChange={(e) => setDocType(e.target.value)}
//     className="w-60 px-4 py-2 border border-slate-200 rounded-xl text-sm font-bold bg-white"
//   >
//     <option value="resume">Resume</option>
//     <option value="certificate">Certificate</option>
//   </select>
// </div>

//                         <p className="text-[11px] font-semibold text-slate-500 uppercase tracking-widest">
//                           Document Verification
//                         </p>
//                       </div>
//                     </div>
//                     <div className="hidden md:flex items-center gap-2 px-4 py-1.5 bg-blue-50 border border-blue-100 rounded-full">
//                       <div className="h-1.5 w-1.5 rounded-full bg-blue-500 animate-pulse" />
//                       <span className="text-[10px] font-bold text-blue-600 uppercase tracking-tighter">
//                         ready to save
//                       </span>
//                     </div>
//                   </div>

//                   <div className="p-8 md:p-12 space-y-12">
//                     <div className="grid grid-cols-1 lg:grid-cols-2 gap-12">
                 
//                       <div className="space-y-6">
//                         <div className="flex justify-between items-center px-1">
//                           <div className="flex items-center gap-2">
//                             <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">
//                               01. Resume
//                             </span>
//                           </div>
//                           <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200 scale-90">
//                             <button
//                               type="button"
//                               onClick={() => setResumeMode("file")}
//                               className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === "file" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500 hover:text-slate-700"}`}
//                             >
//                               FILE
//                             </button>
//                             <button
//                               type="button"
//                               onClick={() => setResumeMode("link")}
//                               className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                             >
//                               URL
//                             </button>
//                           </div>
//                         </div>

//                         {resumeMode === "file" ? (
//                           <label className="flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-slate-200 rounded-3xl bg-slate-50/50 hover:bg-white hover:border-blue-500 transition-all cursor-pointer group">
//                             <div className="flex flex-col items-center gap-3">
//                               <div className="p-4 bg-white rounded-2xl shadow-sm border border-slate-100 group-hover:scale-110 transition-transform duration-500">
//                                 <FileUp
//                                   size={28}
//                                   className="text-slate-400 group-hover:text-blue-500"
//                                 />
//                               </div>
//                               <span className="text-[11px] font-bold text-slate-500 uppercase tracking-widest">
//                                 {formData.cvFile
//                                   ? formData.cvFile.name
//                                   : existingResume
//                                     ? "Existing Resume Available"
//                                     : "Commit Resume PDF"}
//                               </span>

                         
//                               {existingResume && !formData.cvFile && (
//                                 <a
//                                   href={fixResumeUrl2(existingResume)}
//                                   target="_blank"
//                                   rel="noreferrer"
//                                   className="text-blue-600 text-xs underline mt-1"
//                                 >
//                                   View Current Resume
//                                 </a>
//                               )}
//                             </div>
//                             <input
//                               type="file"
//                               accept=".pdf"
//                               className="hidden"
//                               onChange={(e) =>
//                                 setFormData({
//                                   ...formData,
//                                   cvFile: e.target.files[0],
//                                   resume_link: "",
//                                 })
//                               }
//                             />
//                           </label>
//                         ) : (
//                           <div className="relative">
//                             <LinkIcon
//                               size={18}
//                               className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                             />
//                             <input
//                               placeholder="Enter Public Storage URI..."
//                               value={formData.resume_link}
//                               onChange={(e) =>
//                                 setFormData({
//                                   ...formData,
//                                   resume_link: e.target.value,
//                                   cvFile: null,
//                                 })
//                               }
//                               className={inputStyle + " pl-12"}
//                             />
//                           </div>
//                         )}
//                       </div>

                      

                   











                   
//                       <div className="space-y-6">
//                         <div className="flex justify-between items-center px-1">
//                           <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">
//                             02. certificate
//                           </span>
//                           <div className="flex gap-2">
//                             <label className="cursor-pointer h-10 w-10 bg-slate-900 text-white rounded-xl hover:bg-blue-600 active:scale-90 transition-all flex items-center justify-center shadow-lg shadow-slate-200">
//                               <Plus size={18} />
//                               <input
//                                 type="file"
//                                 multiple
//                                 accept=".pdf"
//                                 className="hidden"
//                                 onChange={(e) =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateFiles: [
//                                       ...formData.certificateFiles,
//                                       ...Array.from(e.target.files),
//                                     ],
//                                   })
//                                 }
//                               />
//                             </label>
//                             <button
//                               type="button"
//                               onClick={() =>
//                                 setFormData({
//                                   ...formData,
//                                   certificateLinks: [
//                                     ...formData.certificateLinks,
//                                     "",
//                                   ],
//                                 })
//                               }
//                               className="h-10 w-10 bg-white text-slate-600 rounded-xl border border-slate-200 hover:border-blue-500 hover:text-blue-500 active:scale-90 transition-all flex items-center justify-center shadow-sm"
//                             >
//                               <LinkIcon size={18} />
//                             </button>
//                           </div>
//                         </div>

//                         <div className="grid grid-cols-1 gap-4 max-h-[220px] overflow-y-auto no-scrollbar pr-1">
                   
//                           {existingCertificates.map((url, idx) => (
//                             <div
//                               key={`existing-${idx}`}
//                               className="flex justify-between items-center bg-blue-50 p-4 rounded-2xl border border-blue-100"
//                             >
//                               <div className="flex items-center gap-3">
//                                 <div className="h-2 w-2 rounded-full bg-blue-500" />

//                                 <a
//                                   href={url}
//                                   target="_blank"
//                                   rel="noreferrer"
//                                   className="text-[12px] font-bold text-blue-700 underline truncate max-w-[200px]"
//                                 >
//                                   Existing Certificate {idx + 1}
//                                 </a>
//                               </div>

//                               <X
//                                 size={16}
//                                 className="text-red-400 hover:text-red-600 cursor-pointer"
//                                 onClick={() =>
//                                   setExistingCertificates((prev) =>
//                                     prev.filter((_, i) => i !== idx),
//                                   )
//                                 }
//                               />
//                             </div>
//                           ))}

//                           {formData.certificateFiles.map((file, idx) => (
//                             <div
//                               key={idx}
//                               className="flex justify-between items-center bg-slate-50 p-4 rounded-2xl border border-slate-100 hover:border-blue-300 transition-colors"
//                             >
//                               <div className="flex items-center gap-3">
//                                 <div className="h-2 w-2 rounded-full bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)]" />
//                                 <span className="text-[12px] font-bold text-slate-700 truncate max-w-[200px]">
//                                   {file.name}
//                                 </span>
//                               </div>
//                               <X
//                                 size={16}
//                                 className="text-slate-300 hover:text-red-500 cursor-pointer transition-all hover:rotate-90"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateFiles:
//                                       formData.certificateFiles.filter(
//                                         (_, i) => i !== idx,
//                                       ),
//                                   })
//                                 }
//                               />
//                             </div>
//                           ))}
//                           {formData.certificateLinks.map((link, idx) => (
//                             <div
//                               key={idx}
//                               className="flex gap-3 animate-in slide-in-from-right-4"
//                             >
//                               <div className="relative flex-1">
//                                 <Globe
//                                   size={16}
//                                   className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                                 />
//                                 <input
//                                   value={link}
//                                   placeholder="Public URI..."
//                                   onChange={(e) => {
//                                     const u = [...formData.certificateLinks];
//                                     u[idx] = e.target.value;
//                                     setFormData({
//                                       ...formData,
//                                       certificateLinks: u,
//                                     });
//                                   }}
//                                   className={inputStyle + " pl-11 !py-2.5"}
//                                 />
//                               </div>
//                               <button
//                                 type="button"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateLinks:
//                                       formData.certificateLinks.filter(
//                                         (_, i) => i !== idx,
//                                       ),
//                                   })
//                                 }
//                                 className="text-slate-300 hover:text-red-500 bg-slate-50 h-10 w-10 rounded-xl border border-slate-200 flex items-center justify-center"
//                               >
//                                 <Trash2 size={16} />
//                               </button>
//                             </div>
//                           ))}
//                           {formData.certificateFiles.length === 0 &&
//                             formData.certificateLinks.filter((l) => l)
//                               .length === 0 && (
//                               <div className="py-8 text-center bg-slate-50/50 border border-dashed border-slate-200 rounded-2xl">
//                                 <p className="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">
//                                   No secondary artifacts registered
//                                 </p>
//                               </div>
//                             )}
//                         </div>
//                       </div>
//                     </div>

//                     <div className="bg-slate-50 rounded-3xl p-6 flex flex-col md:flex-row items-center justify-between gap-6 ">
//                       <div className="flex items-center gap-4">
//                         <div className="h-10 w-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400">
//                           <History size={20} />
//                         </div>
//                         <div>
//                           <p className="text-slate-800 text-xs font-bold tracking-wide uppercase">
//                              Final Review
//                           </p>
//                           <p className="text-slate-400 text-[10px] uppercase font-semibold tracking-tighter">
//                             Employee Id {effectiveId} â€¢ Ready to submit
//                           </p>
//                         </div>
//                       </div>
//                       <button
//                         // type="submit"
//                         type="button" 
//                         // onClick={handleSubmit}
//                         onClick={async () => {
//                           setLoading(true);

//                           await saveStepData(5); // ðŸ”¥ FINAL API CALL HERE

//                           setLoading(false);

//                           toast.success("Candidate Saved âœ”");

//                           navigate("/candidate"); // redirect after save
//                         }}
//                         className="w-full md:w-auto px-10 py-3.5 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl text-[11px] font-black uppercase tracking-widest transition-all shadow-xl shadow-blue-600/20 active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3"
//                       >
//                         {loading ? (
//                           <Loader2 className="animate-spin" size={18} />
//                         ) : (
//                           <>
//                             <Database size={18} />
//                             <span>Submit data</span>
//                           </>
//                         )}
//                       </button>
//                     </div>
//                   </div>

               
//                   <div className="flex justify-center pt-2 pb-8">
//                     <button
//                       type="button"
//                       onClick={() => setStep(4)}
//                       className="text-[10px] font-bold text-slate-400 uppercase tracking-widest hover:text-slate-900 transition-colors flex items-center gap-2 group"
//                     >
//                       <ChevronLeft
//                         size={16}
//                         className="group-hover:-translate-x-1 transition-transform"
//                       />
//                       Return to back page
//                     </button>
//                   </div>
//                 </div>
//               </div>
//             )} */}  


//               {step === 5 && (
//               <div className="space-y-8 animate-in slide-in-from-bottom-8 duration-500">
//                 <div className="bg-white rounded-[2rem] shadow-2xl shadow-slate-200/50 border border-slate-200 overflow-hidden relative">
//                   {/* SECTION HEADER: Enterprise Indigo Theme */}
//                   <div className="bg-slate-50 px-8 py-6 border-b border-slate-200 flex items-center justify-between">
//                     <div className="flex items-center gap-5">
//                       <div className="h-12 w-12 bg-slate-900 rounded-2xl flex items-center justify-center text-white shadow-lg">
//                         <ShieldCheck size={24} />
//                       </div>
//                       <div>
//                         <h3 className="text-lg font-bold text-slate-900 tracking-tight">
//                           Document upload
//                         </h3>

//                         <div className="px-8 pt-6">
//   <select
//     value={docType}
//     onChange={(e) => setDocType(e.target.value)}
//     className="w-60 px-4 py-2 border border-slate-200 rounded-xl text-sm font-bold bg-white"
//   >
//     <option value="resume">Resume</option>
//     <option value="certificate">Certificate</option>
//   </select>
// </div>

//                         <p className="text-[11px] font-semibold text-slate-500 uppercase tracking-widest">
//                           Document Verification
//                         </p>
//                       </div>
//                     </div>
//                     <div className="hidden md:flex items-center gap-2 px-4 py-1.5 bg-blue-50 border border-blue-100 rounded-full">
//                       <div className="h-1.5 w-1.5 rounded-full bg-blue-500 animate-pulse" />
//                       <span className="text-[10px] font-bold text-blue-600 uppercase tracking-tighter">
//                         ready to save
//                       </span>
//                     </div>
//                   </div>

//                   <div className="p-8 md:p-12 space-y-12">
//                     <div className="grid grid-cols-1 lg:grid-cols-2 gap-12">
//                       {/* 1. MASTER RESUME SECTION */}
//                       <div className="space-y-6">
//                         <div className="flex justify-between items-center px-1">
//                           <div className="flex items-center gap-2">
//                             <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">
//                               01. Resume
//                             </span>
//                           </div>
//                           <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200 scale-90">
//                             <button
//                               type="button"
//                               onClick={() => setResumeMode("file")}
//                               className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === "file" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500 hover:text-slate-700"}`}
//                             >
//                               FILE
//                             </button>
//                             <button
//                               type="button"
//                               onClick={() => setResumeMode("link")}
//                               className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                             >
//                               URL
//                             </button>
//                           </div>
//                         </div>

//                         {resumeMode === "file" ? (
//                           <label className="flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-slate-200 rounded-3xl bg-slate-50/50 hover:bg-white hover:border-blue-500 transition-all cursor-pointer group">
//                             <div className="flex flex-col items-center gap-3">
//                               <div className="p-4 bg-white rounded-2xl shadow-sm border border-slate-100 group-hover:scale-110 transition-transform duration-500">
//                                 <FileUp
//                                   size={28}
//                                   className="text-slate-400 group-hover:text-blue-500"
//                                 />
//                               </div>
//                               <span className="text-[11px] font-bold text-slate-500 uppercase tracking-widest">
//                                 {formData.cvFile
//                                   ? formData.cvFile.name
//                                   : existingResume
//                                     ? "Existing Resume Available"
//                                     : "Commit Resume PDF"}
//                               </span>

                         
//                               {existingResume && !formData.cvFile && (
//                                 <a
//                                   href={fixResumeUrl2(existingResume)}
//                                   target="_blank"
//                                   rel="noreferrer"
//                                   className="text-blue-600 text-xs underline mt-1"
//                                 >
//                                   View Current Resume
//                                 </a>
//                               )}
//                             </div>
//                             <input
//                               type="file"
//                               accept=".pdf"
//                               className="hidden"
//                               onChange={(e) =>
//                                 setFormData({
//                                   ...formData,
//                                   cvFile: e.target.files[0],
//                                   resume_link: "",
//                                 })
//                               }
//                             />
//                           </label>
//                         ) : (
//                           <div className="relative">
//                             <LinkIcon
//                               size={18}
//                               className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                             />
//                             <input
//                               placeholder="Enter Public Storage URI..."
//                               value={formData.resume_link}
//                               onChange={(e) =>
//                                 setFormData({
//                                   ...formData,
//                                   resume_link: e.target.value,
//                                   cvFile: null,
//                                 })
//                               }
//                               className={inputStyle + " pl-12"}
//                             />
//                           </div>
//                         )}
//                       </div>

                      

                   











//                       {/* 2. CREDENTIALS MATRIX SECTION */}
//                       <div className="space-y-6">
//                         <div className="flex justify-between items-center px-1">
//                           <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">
//                             02. certificate
//                           </span>
//                           <div className="flex gap-2">
//                             <label className="cursor-pointer h-10 w-10 bg-slate-900 text-white rounded-xl hover:bg-blue-600 active:scale-90 transition-all flex items-center justify-center shadow-lg shadow-slate-200">
//                               <Plus size={18} />
//                               <input
//                                 type="file"
//                                 multiple
//                                 accept=".pdf"
//                                 className="hidden"
//                                 onChange={(e) =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateFiles: [
//                                       ...formData.certificateFiles,
//                                       ...Array.from(e.target.files),
//                                     ],
//                                   })
//                                 }
//                               />
//                             </label>
//                             <button
//                               type="button"
//                               onClick={() =>
//                                 setFormData({
//                                   ...formData,
//                                   certificateLinks: [
//                                     ...formData.certificateLinks,
//                                     "",
//                                   ],
//                                 })
//                               }
//                               className="h-10 w-10 bg-white text-slate-600 rounded-xl border border-slate-200 hover:border-blue-500 hover:text-blue-500 active:scale-90 transition-all flex items-center justify-center shadow-sm"
//                             >
//                               <LinkIcon size={18} />
//                             </button>
//                           </div>
//                         </div>

//                         <div className="grid grid-cols-1 gap-4 max-h-[220px] overflow-y-auto no-scrollbar pr-1">
                   
//                           {existingCertificates.map((url, idx) => (
//                             <div
//                               key={`existing-${idx}`}
//                               className="flex justify-between items-center bg-blue-50 p-4 rounded-2xl border border-blue-100"
//                             >
//                               <div className="flex items-center gap-3">
//                                 <div className="h-2 w-2 rounded-full bg-blue-500" />

//                                 <a
//                                   href={url}
//                                   target="_blank"
//                                   rel="noreferrer"
//                                   className="text-[12px] font-bold text-blue-700 underline truncate max-w-[200px]"
//                                 >
//                                   Existing Certificate {idx + 1}
//                                 </a>
//                               </div>

//                               <X
//                                 size={16}
//                                 className="text-red-400 hover:text-red-600 cursor-pointer"
//                                 onClick={() =>
//                                   setExistingCertificates((prev) =>
//                                     prev.filter((_, i) => i !== idx),
//                                   )
//                                 }
//                               />
//                             </div>
//                           ))}

//                           {formData.certificateFiles.map((file, idx) => (
//                             <div
//                               key={idx}
//                               className="flex justify-between items-center bg-slate-50 p-4 rounded-2xl border border-slate-100 hover:border-blue-300 transition-colors"
//                             >
//                               <div className="flex items-center gap-3">
//                                 <div className="h-2 w-2 rounded-full bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)]" />
//                                 <span className="text-[12px] font-bold text-slate-700 truncate max-w-[200px]">
//                                   {file.name}
//                                 </span>
//                               </div>
//                               <X
//                                 size={16}
//                                 className="text-slate-300 hover:text-red-500 cursor-pointer transition-all hover:rotate-90"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateFiles:
//                                       formData.certificateFiles.filter(
//                                         (_, i) => i !== idx,
//                                       ),
//                                   })
//                                 }
//                               />
//                             </div>
//                           ))}
//                           {formData.certificateLinks.map((link, idx) => (
//                             <div
//                               key={idx}
//                               className="flex gap-3 animate-in slide-in-from-right-4"
//                             >
//                               <div className="relative flex-1">
//                                 <Globe
//                                   size={16}
//                                   className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                                 />
//                                 <input
//                                   value={link}
//                                   placeholder="Public URI..."
//                                   onChange={(e) => {
//                                     const u = [...formData.certificateLinks];
//                                     u[idx] = e.target.value;
//                                     setFormData({
//                                       ...formData,
//                                       certificateLinks: u,
//                                     });
//                                   }}
//                                   className={inputStyle + " pl-11 !py-2.5"}
//                                 />
//                               </div>
//                               <button
//                                 type="button"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateLinks:
//                                       formData.certificateLinks.filter(
//                                         (_, i) => i !== idx,
//                                       ),
//                                   })
//                                 }
//                                 className="text-slate-300 hover:text-red-500 bg-slate-50 h-10 w-10 rounded-xl border border-slate-200 flex items-center justify-center"
//                               >
//                                 <Trash2 size={16} />
//                               </button>
//                             </div>
//                           ))}
//                           {formData.certificateFiles.length === 0 &&
//                             formData.certificateLinks.filter((l) => l)
//                               .length === 0 && (
//                               <div className="py-8 text-center bg-slate-50/50 border border-dashed border-slate-200 rounded-2xl">
//                                 <p className="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">
//                                   No secondary artifacts registered
//                                 </p>
//                               </div>
//                             )}
//                         </div>
//                       </div>
//                     </div>

//                     {/* METADATA INFO CARD */}
//                     <div className="bg-slate-50 rounded-3xl p-6 flex flex-col md:flex-row items-center justify-between gap-6 ">
//                       <div className="flex items-center gap-4">
//                         <div className="h-10 w-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400">
//                           <History size={20} />
//                         </div>
//                         <div>
//                           <p className="text-slate-800 text-xs font-bold tracking-wide uppercase">
//                              Final Review
//                           </p>
//                           <p className="text-slate-400 text-[10px] uppercase font-semibold tracking-tighter">
//                             Employee Id {effectiveId} â€¢ Ready to submit
//                           </p>
//                         </div>
//                       </div>
//                       <button
//                         // type="submit"
//                         type="button" 
//                         // onClick={handleSubmit}
//                         onClick={async () => {
//                           setLoading(true);

//                           await saveStepData(5); // ðŸ”¥ FINAL API CALL HERE

//                           setLoading(false);

//                           toast.success("Candidate Saved âœ”");

//                           navigate("/candidate"); // redirect after save
//                         }}
//                         className="w-full md:w-auto px-10 py-3.5 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl text-[11px] font-black uppercase tracking-widest transition-all shadow-xl shadow-blue-600/20 active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3"
//                       >
//                         {loading ? (
//                           <Loader2 className="animate-spin" size={18} />
//                         ) : (
//                           <>
//                             <Database size={18} />
//                             <span>Submit data</span>
//                           </>
//                         )}
//                       </button>
//                     </div>
//                   </div>

//                   {/* FOOTER ACTIONS */}
//                   <div className="flex justify-center pt-2 pb-8">
//                     <button
//                       type="button"
//                       onClick={() => setStep(4)}
//                       className="text-[10px] font-bold text-slate-400 uppercase tracking-widest hover:text-slate-900 transition-colors flex items-center gap-2 group"
//                     >
//                       <ChevronLeft
//                         size={16}
//                         className="group-hover:-translate-x-1 transition-transform"
//                       />
//                       Return to back page
//                     </button>
//                   </div>
//                 </div>
//               </div>
//             )}
//           </div>
//         </form>
//       </div>

//       {showCertEditModal && (
//   <div className="fixed inset-0 bg-black/50 flex items-center justify-center">
//     <div className="bg-white p-6 rounded-2xl w-[420px] space-y-4">

//       <h3 className="font-bold">Edit Certificate</h3>

//       <input
//         value={certForm.name}
//         onChange={(e) =>
//           setCertForm({ ...certForm, name: e.target.value })
//         }
//         className="border p-2 rounded-xl w-full"
//         placeholder="Certificate Name"
//       />

//       {certForm.uploadMode === "file" ? (
//         <input
//           type="file"
//           accept=".pdf"
//           onChange={(e) =>
//             setCertForm({
//               ...certForm,
//               certificate_file: e.target.files[0],
//             })
//           }
//         />
//       ) : (
//         <input
//           value={certForm.certificate_link}
//           onChange={(e) =>
//             setCertForm({
//               ...certForm,
//               certificate_link: e.target.value,
//             })
//           }
//           className="border p-2 rounded-xl w-full"
//         />
//       )}

//       <button
//         onClick={updateCertificate}
//         className="w-full bg-blue-600 text-white py-2 rounded-xl"
//       >
//         Update Certificate
//       </button>

//       <button
//         onClick={() => setShowCertEditModal(false)}
//         className="w-full border py-2 rounded-xl"
//       >
//         Cancel
//       </button>
//     </div>
//   </div>
// )}

//       <style
//         dangerouslySetInnerHTML={{
//           __html: `.custom-scrollbar-professional::-webkit-scrollbar { width: 6px; }.custom-scrollbar-professional::-webkit-scrollbar-track { background: transparent; }.custom-scrollbar-professional::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 20px; }.custom-scrollbar-professional::-webkit-scrollbar-thumb:hover { background: #CBD5E1; }`,
//         }}
//       />
//     </div>
//   );
// };

// export default ManualEntryPage;
//*****************************************************working cdoe phase 1 20/02/26************************************************************** */
// import React, { useState, useEffect, useRef } from "react";
// import { useParams, useNavigate, useSearchParams  } from "react-router-dom";
// import {
//   Check,
//   Award,
//   User,
//   Briefcase,
//   Fingerprint,
//   Calendar,
//   FileText,
//   CheckCircle,
//   MapPin,
//   Loader2,
//   Plus,
//   Trash2,
//   Layers,
//   Cpu,
//   Database,
//   Globe,
//   ShieldCheck,
//   History,
//   X,
//   Edit3,
//   LinkIcon,
//   FileUp,
//   ChevronRight,
//   ChevronLeft,
//   ChevronDown,
// } from "lucide-react";
// import toast from "react-hot-toast";
// import { candidateService } from "../../services/candidateService";
// import { departmentService } from "../../services/department.service";

// const FormField = ({ label, required, error, children }) => (
//   <div className="space-y-1 w-full">
//     <label className="text-[10px] md:text-[11px] font-black text-slate-500 uppercase tracking-widest ml-1 flex justify-between items-center">
//       <span>{label}</span>
//       <span
//         className={`font-bold normal-case ${required ? "text-red-500" : "text-slate-300"}`}
//       >
//         {required ? "Required" : "Optional"}
//       </span>
//     </label>
//     {children}
//     {error && (
//       <p className="text-[9px] text-red-500 font-bold uppercase tracking-tighter ml-1">
//         {error}
//       </p>
//     )}
//   </div>
// );

// const ManualEntryPage = () => {
//   const { id } = useParams();
//   const navigate = useNavigate();
//   const [searchParams] = useSearchParams();
//   const effectiveId = id || "666";
//   const ASSET_OPTIONS = [
//     "Laptop",
//     "Mouse",
//     "Keyboard",
//     "Monitor",
//     "Headset",
//     "Mobile",
//     "ID Card",
//     "SIM Card",
//   ];
//   // Professional Enterprise Input Style
//   const inputStyle =
//     "w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-[13px] font-bold outline-none focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-500/5 transition-all shadow-sm";

//   // 1. INITIALIZE ALL STATES
//   const [step, setStep] = useState(1);
//   const [loading, setLoading] = useState(false);
//   const [fetchingData, setFetchingData] = useState(false);
//   const [errors, setErrors] = useState({});
//   const [isFetchingPincode, setIsFetchingPincode] = useState(false);
//   const [cityOptions, setCityOptions] = useState([]);
//   const [resumeMode, setResumeMode] = useState("file");
//   const [skillInput, setSkillInput] = useState("");
//   const [assetInput, setAssetInput] = useState("");
//   const [isFresher, setIsFresher] = useState(null);
//   const [deptSearch, setDeptSearch] = useState("");
//   const [eduSearch, setEduSearch] = useState("");
//   const [dynamicSkills, setDynamicSkills] = useState([]);
//   const [existingResume, setExistingResume] = useState("");
// const [industrySearch, setIndustrySearch] = useState("");
// const [showIndustryDrop, setShowIndustryDrop] = useState(false);
//   const [dynamicAssets, setDynamicAssets] = useState([]);
//   const [showSkillDrop, setShowSkillDrop] = useState(false);
//   const [showAssetDrop, setShowAssetDrop] = useState(false);
//   const [skillFocused, setSkillFocused] = useState(false);
//   const [departments, setDepartments] = useState([]);
//   const dropdownContainerRef = useRef(null);
//   const [existingCertificates, setExistingCertificates] = useState([]);
//   const [editingCertId, setEditingCertId] = useState(null);
//   const [editingCertValue, setEditingCertValue] = useState("");
//   const [showExpModal, setShowExpModal] = useState(false);
// const [currentEditingIndex, setCurrentEditingIndex] = useState(null);
// const [newExperiences, setNewExperiences] = useState([]);


//   const careerStepRef = useRef(null);

//   const [formData, setFormData] = useState({
//     name: "",
//     email: "",
//     phone: "",
//     address: "",
//     address2: "",
//     location: "",
//     pincode: "",
//     state: "",
//     city: "",
//     district: "",
//     country: "India",
//     position: "",
//     education: "",
//     gender: "",
//     dob: "",
//     experience: "",
//     about_me: "",
//     languages_spoken: [],
//     skills: [],
//     assets: [],
//     department: "",
//     cvFile: null,
//     resume_link: "",
//     certificateFiles: [],
//     certificateLinks: [""],
//     experiences: [],
//   });

//   const totalSteps = 5;

//   const educationOptions = [
//     "SSC / 10th",
//     "HSC / 12th",
//     "ITI",
//     "Diploma",
//     "Polytechnic",

//     "B.A",
//     "B.Com",
//     "B.Sc",
//     "BCA",
//     "BBA",
//     "B.Tech",
//     "BE",
//     "B.Pharm",
//     "B.Ed",

//     "M.A",
//     "M.Com",
//     "M.Sc",
//     "MCA",
//     "MBA",
//     "M.Tech",
//     "ME",
//     "M.Pharm",
//     "M.Ed",

//     "PGDM",
//     "Post Graduate Diploma",

//     "PhD / Doctorate",
//   ];

//   const POSITION_OPTIONS = [
//     // IT / Software
//     "Frontend Developer",
//     "Backend Developer",
//     "Full Stack Developer",
//     "Software Engineer",
//     "Senior Software Engineer",
//     "Lead Developer",
//     "DevOps Engineer",
//     "QA Engineer",
//     "Automation Tester",
//     "Manual Tester",
//     "UI/UX Designer",
//     "Mobile App Developer",
//     "Android Developer",
//     "iOS Developer",
//     "Data Analyst",
//     "Data Scientist",
//     "Machine Learning Engineer",
//     "AI Engineer",
//     "Cloud Engineer",
//     "System Administrator",
//     "Network Engineer",
//     "Cyber Security Analyst",

//     // Management / Office
//     "Project Manager",
//     "Product Manager",
//     "Operations Manager",
//     "Team Lead",
//     "Business Analyst",
//     "HR Executive",
//     "HR Manager",
//     "Recruiter",
//     "Office Administrator",

//     // Non-IT / General
//     "Accountant",
//     "Finance Executive",
//     "Sales Executive",
//     "Marketing Executive",
//     "Digital Marketing Specialist",
//     "Customer Support Executive",
//     "Technical Support Engineer",
//     "Field Executive",
//     "Supervisor",
//     "Store Manager",
//     "Warehouse Executive",

//     // Fresher / Entry
//     "Intern",
//     "Trainee",
//     "Graduate Engineer Trainee",
//     "Apprentice",
//   ];

//   const filteredEducation = educationOptions.filter((e) =>
//     e.toLowerCase().includes(eduSearch.toLowerCase()),
//   );
//   const filteredDepartments = departments.filter((d) =>
//     (d.name || "").toLowerCase().includes(deptSearch.toLowerCase()),
//   );
//   const isStep1Valid =
//     formData.name && /^\S+@\S+\.\S+$/.test(formData.email) && formData.phone;

//   // 2. HYDRATION LOGIC (GET API)
//   useEffect(() => {
   
//     hydrateNode();
//   }, [effectiveId]);

//    const hydrateNode = async () => {
//       setFetchingData(true);
//       try {
//         const response = await fetch(
//           `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//         );
//         if (!response.ok) throw new Error();
//         const data = await response.json();

//         if (data) {
//           setExistingResume(data.resume_path || "");

//           setExistingCertificates(
//             Array.isArray(data.certificates) ? data.certificates : [],
//           );

//           const safeParse = (value) => {
//             if (!value) return [];

//             try {
//               // Already array â†’ fix broken JSON pieces
//               if (Array.isArray(value)) {
//                 const joined = value.join("");
//                 if (joined.startsWith("[")) {
//                   return JSON.parse(joined);
//                 }
//                 return value;
//               }

//               // If string JSON
//               if (typeof value === "string" && value.startsWith("[")) {
//                 return JSON.parse(value);
//               }

//               // If CSV string â†’ convert to array
//               if (typeof value === "string") {
//                 return value
//                   .split(",")
//                   .map((s) => s.trim())
//                   .filter(Boolean);
//               }

//               return [];
//             } catch {
//               return [];
//             }
//           };

//           setFormData((prev) => ({
//             ...prev,
//             name: data.full_name || "",
//             email: data.email || "",
//             phone: data.phone || "",
//             gender: data.gender || "",
//             dob: data.dob || "",
//             address: data.address || "",
//             address2: data.address2 || "",
//             location: data.location || "",
//             pincode: data.pincode || "",
//             city: data.city || "",
//             state: data.state || "",
//             district: data.district || "",
//             country: data.country || "India",
//             position: data.position || "",
//             experience: data.experience || "",
//             education: data.education || "",
//             department: data.department || "",
//             about_me: data.about_me || "",
//             resume_link: data.resume_path || "",
//             languages_spoken: safeParse(data.languages_spoken),
//             experiences: data.experiences || [],
//             skills: safeParse(data.skills),
//             assets: safeParse(data.assets),
//           }));

//           setIsFresher(!data.experiences || data.experiences.length === 0);
//         }

//         const deptData = await departmentService.getAll();
//         setDepartments(deptData || []);
//         await fetchSkills();
//         await fetchAssets(effectiveId);
//       } catch (err) {
//         console.warn("Initializing Empty Node");
//       } finally {
//         setFetchingData(false);
//       }
//     };

//     const INDUSTRY_OPTIONS = [
//   "Information Technology",
//   "Software Development",
//   "Banking & Finance",
//   "Healthcare",
//   "Education",
//   "Manufacturing",
//   "Retail",
//   "Telecom",
//   "Construction",
//   "Logistics",
//   "Marketing & Advertising",
//   "HR / Recruitment",
//   "Government",
//   "Automobile",
//   "Pharmaceutical",
//   "E-Commerce",
//   "Media & Entertainment",
//   "Real Estate",
//   "Hospitality",
//   "Other",
// ];


//   // Click Outside to close dropdowns
//   useEffect(() => {
//     const handleClickOutside = (event) => {
//       if (
//         dropdownContainerRef.current &&
//         !dropdownContainerRef.current.contains(event.target)
//       ) {
//         setShowSkillDrop(false);
//         setShowAssetDrop(false);
//         setSkillFocused(false);
//       }
//     };
//     document.addEventListener("mousedown", handleClickOutside);
//     return () => document.removeEventListener("mousedown", handleClickOutside);
//   }, []);

//   // READ STEP FROM URL (?step=3)
// useEffect(() => {
//   const stepFromUrl = Number(searchParams.get("step"));

//   if (stepFromUrl && stepFromUrl >= 1 && stepFromUrl <= totalSteps) {
//     setStep(stepFromUrl);
//   }
// }, [searchParams]);


//   // 3. HANDLERS
//   const fetchSkills = async () => {
//     try {
//       const res = await fetch(
//         "https://apihrr.goelectronix.co.in/masters/skills",
//       );
//       const data = await res.json();
//       setDynamicSkills(data.map((item) => item.name || item));
//     } catch {}
//   };

//   const fetchAssets = async (cId) => {
//     try {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${cId}/assets`,
//       );
//       const data = await res.json();
//       setDynamicAssets(Array.isArray(data) ? data.map((a) => a.name) : []);
//     } catch {}
//   };

//   const handleManualAddSkill = async () => {
//     const name = skillInput.trim();
//     if (!name) {
//       await fetchSkills();
//       return;
//     }
//     const success = await handleCreateMaster("skills", name);
//     if (success) {
//       if (!formData.skills.includes(name))
//         setFormData((p) => ({ ...p, skills: [...p.skills, name] }));
//       setSkillInput("");
//       await fetchSkills();
//     }
//   };

//   const handleCreateMaster = async (type, name) => {
//     try {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/masters/${type}`,
//         {
//           method: "POST",
//           headers: { "Content-Type": "application/json" },
//           body: JSON.stringify({ name: name.trim() }),
//         },
//       );
//       return res.ok;
//     } catch {
//       return false;
//     }
//   };

//   const handleAddAssetAPI = async (assetName) => {
//     if (!assetName.trim()) return;
//     const loadingToast = toast.loading(`Linking asset...`);
//     try {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/assets`,
//         {
//           method: "POST",
//           headers: { "Content-Type": "application/json" },
//           body: JSON.stringify({ name: assetName.trim() }),
//         },
//       );
//       if (res.ok) {
//         toast.success("Linked", { id: loadingToast });
//         await fetchAssets(effectiveId);
//         return true;
//       }
//     } catch {
//       toast.error("Sync failed", { id: loadingToast });
//     }
//     return false;
//   };

//   const filteredIndustries = INDUSTRY_OPTIONS.filter((ind) =>
//   ind.toLowerCase().includes(industrySearch.toLowerCase())
// );


//   // const handleSaveExperienceAPI = async (i) => {
//   //   console.log(formData);
//   //   const exp = formData.experiences[i];

//   //   console.log("add",i)

//   //   if (
//   //     !exp.company_name?.trim() ||
//   //     !exp.job_title?.trim() ||
//   //     !exp.start_date ||
//   //     !exp.end_date
//   //   ) {
//   //     toast.error("Required: Company, Role, Start Date, End Date");
//   //     return;
//   //   }

//   //   const loadingToast = toast.loading("Saving experience...");

//   //   try {
//   //     const fd = new FormData();

//   //     // Required
//   //     fd.append("company_name", exp.company_name);
//   //     fd.append("job_title", exp.job_title);
//   //     fd.append("start_date", exp.start_date);
//   //     fd.append("end_date", exp.end_date);

//   //     // Optional (send empty safely)
//   //     fd.append(
//   //       "previous_ctc",
//   //       exp.previous_ctc ? Number(exp.previous_ctc) : "",
//   //     );

//   //     fd.append("location", exp.location ? exp.location : "");
//   //     fd.append("description", exp.description ? exp.description : "");

//   //     // LINK MODE
//   //     if (exp.uploadMode === "link") {
//   //       fd.append("exp_letter_link", exp.exp_letter_link || "");
//   //       // Do NOT overwrite existing file if link mode
//   //     }

//   //     // FILE MODE
//   //     else {
//   //       // Case 1: New file selected â†’ upload
//   //       if (exp.expLetterFile instanceof File) {
//   //         fd.append("exp_letter_file", exp.expLetterFile);
//   //       }

//   //       // Case 2: No new file BUT already saved file exists â†’ keep old
//   //       else if (exp.experience_letter_path) {
//   //         fd.append("experience_letter_path", exp.experience_letter_path);
//   //       }

//   //       // Case 3: Nothing exists â†’ send nothing (important)
//   //     }

//   //     const res = await fetch(
//   //       `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/experiences`,
//   //       {
//   //         method: "POST",
//   //         body: fd, // â— Don't set Content-Type manually
//   //       },
//   //     );

//   //     if (!res.ok) {
//   //       const err = await res.text();
//   //       console.error(err);
//   //       throw new Error(err);
//   //     }

//   //     toast.success("Experience Saved âœ…", { id: loadingToast });
//   //   } catch (err) {
//   //     console.error(err);
//   //     toast.error("Failed to save experience âŒ", { id: loadingToast });
//   //   }
//   // };


// //   const handleSaveExperienceAPI = async (i) => {
// //   const exp = newExperiences[i];   // âœ… FIXED

// //   if (
// //     !exp.company_name?.trim() ||
// //     !exp.job_title?.trim() ||
// //     !exp.start_date ||
// //     !exp.end_date
// //   ) {
// //     toast.error("Required: Company, Role, Start Date, End Date");
// //     return;
// //   }

// //   const loadingToast = toast.loading("Saving experience...");

// //   try {
// //     const fd = new FormData();

// //     fd.append("company_name", exp.company_name);
// //     fd.append("job_title", exp.job_title);
// //     fd.append("start_date", exp.start_date);
// //     fd.append("end_date", exp.end_date);

// //     fd.append("previous_ctc", exp.previous_ctc || "");
// //     fd.append("location", exp.location || "");
// //     fd.append("description", exp.description || "");

// //     if (exp.uploadMode === "link") {
// //       fd.append("exp_letter_link", exp.exp_letter_link || "");
// //     } else if (exp.expLetterFile instanceof File) {
// //       fd.append("exp_letter_file", exp.expLetterFile);
// //     }

// //     const res = await fetch(
// //       `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/experiences`,
// //       { method: "POST", body: fd }
// //     );

// //     if (!res.ok) throw new Error(await res.text());

// //     toast.success("Experience Saved âœ…", { id: loadingToast });

// //     await hydrateNode();

// //       /* ===== FIX 2 â€” ADD TO MAIN LIST ===== */
// //     setFormData(prev => ({
// //       ...prev,
// //       experiences: [...prev.experiences, newExperiences[i]]
// //     }));

// //     /* ===== OPTIONAL â€” REMOVE FROM MODAL ===== */
// //     setNewExperiences(prev => prev.filter((_, idx) => idx !== i));

// //   } catch (err) {
// //     console.error(err);
// //     toast.error("Failed to save experience âŒ", { id: loadingToast });
// //   }
// // };

// // const handleSaveOrUpdateExperience = async (i) => {
// //   const exp = newExperiences[i];

// //   if (
// //     !exp.company_name?.trim() ||
// //     !exp.job_title?.trim() ||
// //     !exp.start_date ||
// //     !exp.end_date
// //   ) {
// //     toast.error("Required: Company, Role, Start Date, End Date");
// //     return;
// //   }

// //   const loadingToast = toast.loading(
// //     currentEditingIndex !== null ? "Updating experience..." : "Saving experience..."
// //   );

// //   try {
// //     const fd = new FormData();

// //     fd.append("company_name", exp.company_name);
// //     fd.append("job_title", exp.job_title);
// //     fd.append("start_date", exp.start_date);
// //     fd.append("end_date", exp.end_date);
// //     fd.append("previous_ctc", exp.previous_ctc || "");
// //     fd.append("location", exp.location || "");
// //     fd.append("description", exp.description || "");
// //     fd.append("industry", exp.industry || "");

// //     if (exp.uploadMode === "link") {
// //       fd.append("exp_letter_link", exp.exp_letter_link || "");
// //     } else if (exp.expLetterFile instanceof File) {
// //       fd.append("exp_letter_file", exp.expLetterFile);
// //     }

// //     // ====================================
// //     // UPDATE EXISTING EXPERIENCE (PATCH)
// //     // ====================================
// //     if (currentEditingIndex !== null && exp.id) {
// //       const experienceId = exp.id;

// //       const res = await fetch(
// //         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/experiences/${experienceId}`,
// //         {
// //           method: "PATCH",
// //           body: fd,
// //         }
// //       );

// //       if (!res.ok) throw new Error(await res.text());

// //       // Update UI
// //       const updated = [...formData.experiences];
// //       updated[currentEditingIndex] = exp;

// //       setFormData((prev) => ({
// //         ...prev,
// //         experiences: updated,
// //       }));

// //       toast.success("Experience Updated âœ…", { id: loadingToast });
// //     }

// //     // ====================================
// //     // ADD NEW EXPERIENCE (POST)
// //     // ====================================
// //     else {
// //       const res = await fetch(
// //         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/experiences`,
// //         { method: "POST", body: fd }
// //       );

// //       if (!res.ok) throw new Error(await res.text());

// //       await hydrateNode(); // refresh from backend

// //       toast.success("Experience Added âœ…", { id: loadingToast });
// //     }

// //     setNewExperiences([]);
// //     setCurrentEditingIndex(null);
// //     setShowExpModal(false);

// //   } catch (err) {
// //     console.error(err);
// //     toast.error("Failed âŒ", { id: loadingToast });
// //   }
// // };

// const handleSaveOrUpdateExperience = async (i) => {
//   const exp = newExperiences[i];

//   if (!exp.company_name || !exp.job_title || !exp.start_date || !exp.end_date) {
//     toast.error("Company, Role, Start Date, End Date required");
//     return;
//   }

//   const loadingToast = toast.loading(
//     currentEditingIndex !== null ? "Updating experience..." : "Saving experience..."
//   );

//   try {
//     const fd = new FormData();

//     fd.append("company_name", exp.company_name);
//     fd.append("job_title", exp.job_title);
//     fd.append("start_date", exp.start_date);
//     fd.append("end_date", exp.end_date);
//     fd.append("previous_ctc", exp.previous_ctc || "");
//     fd.append("location", exp.location || "");
//     fd.append("description", exp.description || "");
//     fd.append("industry", exp.industry || "");

//     if (exp.uploadMode === "link") {
//       fd.append("exp_letter_link", exp.exp_letter_link || "");
//     } else if (exp.expLetterFile instanceof File) {
//       fd.append("exp_letter_file", exp.expLetterFile);
//     }

//     // =========================
//     // UPDATE (PATCH)
//     // =========================
//     if (currentEditingIndex !== null && exp.id) {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/experiences/${exp.id}`,
//         {
//           method: "PUT",
//           body: fd,
//         }
//       );

//       if (!res.ok) throw new Error(await res.text());

//       // Update UI instantly
//       const updated = [...formData.experiences];
//       updated[currentEditingIndex] = exp;

//       setFormData((prev) => ({
//         ...prev,
//         experiences: updated,
//       }));

//       toast.success("Experience Updated âœ…", { id: loadingToast });
//     }

//     // =========================
//     // ADD NEW (POST)
//     // =========================
//     else {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/experiences`,
//         {
//           method: "POST",
//           body: fd,
//         }
//       );

//       if (!res.ok) throw new Error(await res.text());

//       await hydrateNode(); // reload from backend

//       toast.success("Experience Added âœ…", { id: loadingToast });
//     }

//     setNewExperiences([]);
//     setCurrentEditingIndex(null);
//     setShowExpModal(false);

//   } catch (err) {
//     console.error(err);
//     toast.error("Failed âŒ", { id: loadingToast });
//   }
// };




//   const fetchPincodeDetails = async (pincode) => {
//     if (!/^\d{6}$/.test(pincode)) return;

//     setIsFetchingPincode(true);

//     try {
//       const res = await fetch(
//         `https://api.postalpincode.in/pincode/${pincode}`,
//       );
//       const data = await res.json();

//       if (data[0]?.Status === "Success" && data[0].PostOffice?.length > 0) {
//         const postOffices = data[0].PostOffice;

//         setCityOptions(postOffices); // â­ store full objects

//         const first = postOffices[0];

//         setFormData((prev) => ({
//           ...prev,
//           city: first.Name || "",
//           district: first.District || "",
//           state: first.State || "",
//           country: first.Country || "India",
//         }));
//       } else {
//         setCityOptions([]);
//       }
//     } catch (err) {
//       console.error(err);
//       setCityOptions([]);
//     } finally {
//       setIsFetchingPincode(false);
//     }
//   };

//   const STEP_FIELDS = {
//     1: [
//       "name",
//       "email",
//       "phone",
//       "gender",
//       "dob",
//       "position",
//       "experience",
//       "education",
//       "department",
//       "about_me",
//       "languages_spoken",
//     ],

//     2: [
//       "address",
//       "address2",
//       "location",
//       "pincode",
//       "city",
//       "district",
//       "state",
//       "country",
//     ],

//     3: ["experiences"],

//     4: ["skills", "assets"],

//     5: ["resume_link", "cvFile", "certificateFiles", "certificateLinks"],
//   };


//   // ---------- STEP VALIDATION ----------

// const isStep1Incomplete = () => {
//   return !(
//     formData.full_name &&
//     formData.email &&
//     formData.phone &&
//     formData.gender &&
//     formData.dob &&
//     (formData.languages_spoken || []).length > 0 &&
//     formData.about_me
//   );
// };

// const isStep2Incomplete = () => {
//   return !(
//     formData.address &&
//     formData.city &&
//     formData.state &&
//     formData.pincode
//   );
// };

// const isStep3Incomplete = () => {
//   return !(
//     formData.experiences &&
//     formData.experiences.length > 0
//   );
// };

// const isStep4Incomplete = () => {
//   return !(
//     (formData.skills && formData.skills.length > 0) ||
//     (formData.assets && formData.assets.length > 0)
//   );
// };

// const isStep5Incomplete = () => {
//   return !(
//     formData.resume_path ||
//     // formData.cvFile ||
//     // (formData.certificateFiles && formData.certificateFiles.length > 0) ||
//     (formData.certificates && formData.certificates.length > 0)
//   );
// };


//   const fixResumeUrl = (url) => {
//     if (!url) return "";

//     // remove wrong https//
//     let clean = url.replace(/^https\/\//, "");

//     // if already full valid http/https â†’ keep it
//     if (clean.startsWith("http://") || clean.startsWith("https://")) {
//       return clean;
//     }

//     // attach correct base URL
//     return `https://apihrr.goelectronix.co.in/${clean.replace(/^\/+/, "")}`;
//   };

//   const fixResumeUrl2 = (url) => {
//     if (!url) return "";

//     let clean = url.trim();

//     // Fix broken https//
//     clean = clean.replace(/^https\/\//, "https://");

//     // ðŸ”´ If URL is https://uploads/... â†’ replace domain
//     if (clean.startsWith("https://uploads")) {
//       return clean.replace(
//         "https://uploads",
//         "https://apihrr.goelectronix.co.in/uploads",
//       );
//     }

//     // Already full valid URL â†’ return
//     if (clean.startsWith("http://") || clean.startsWith("https://")) {
//       return clean;
//     }

//     // Remove starting slash
//     clean = clean.replace(/^\/+/, "");

//     // Attach backend base
//     return `https://apihrr.goelectronix.co.in/${clean}`;
//   };

//   const hasExistingExperience =
//     Array.isArray(formData.experiences) && formData.experiences.length > 0;

//   const saveStepData = async (stepNumber) => {
//     try {
//       const apiData = new FormData();
//       const fields = STEP_FIELDS[stepNumber] || [];

//       fields.forEach((key) => {
//         if (key === "languages_spoken") {
//           apiData.append(
//             "languages_spoken",
//             (formData.languages_spoken || []).join(","),
//           );
//         } else if (key === "skills" || key === "assets") {
//           // apiData.append(key, JSON.stringify(formData[key] || []));
//           apiData.append(key, (formData[key] || []).join(","));
//         } else if (key === "experiences") {
//           apiData.append(
//             "experience_details",
//             JSON.stringify(formData.experiences || []),
//           );
//         } else if (key === "cvFile" && formData.cvFile) {
//           apiData.append("resumepdf", formData.cvFile);
//         }
//         // CASE 2: Resume LINK
//         else if (key === "resume_link" && formData.resume_link) {
//           apiData.append("resume_link", formData.resume_link);
//         } else if (key === "certificateFiles") {
//           formData.certificateFiles.forEach((file) => {
//             apiData.append("certificates", file);
//           });
//         }else {
//           apiData.append(key, formData[key] ?? "");
//         }
//       });

//           // ===========================
//     // FORCE CERTIFICATES FOR STEP 5
//     // ===========================
//     if (stepNumber === 5) {

//       // FILES
//       formData.certificateFiles.forEach((file) => {
//         apiData.append("certificates", file);
//       });

//       // LINKS (append one by one, NOT JSON)
//       formData.certificateLinks
//         .filter((link) => link && link.trim())
//         .forEach((link) => {
//           apiData.append("certificate_links", link);
//         });
//     }

//       apiData.append("full_name", formData.name || "");

//       await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//         {
//           method: "PATCH",
//           body: apiData,
//         },
//       );

//       // ðŸ”¥ FIX-2: Clear uploaded certificates after Step 5 save
// if (stepNumber === 5) {
//   setFormData((prev) => ({
//     ...prev,
//     certificateFiles: [],
//     certificateLinks: [""],   // reset to empty input
//   }));
// }

//       toast.success(`Step ${stepNumber} saved`);
//     } catch (err) {
//       console.error(err);
//       toast.error("Auto save failed");
//     }
//   };

//   const handleSubmit = async (e) => {
//     e.preventDefault();
//     setLoading(true);

//     const loadingToast = toast.loading("Executing Final PATCH Sync...");

//     try {
//       const apiData = new FormData();

//       // ðŸ”¹ Append ALL simple fields (NO skipping empty)
//       for (const key in formData) {
//         if (
//           ![
//             "experiences",
//             "certificateFiles",
//             "languages_spoken",
//             "cvFile",
//             "skills",
//             "assets",
//           ].includes(key)
//         ) {
//           apiData.append(key, formData[key] ?? "");
//         }
//       }

//       // ðŸ”¹ Required backend fields
//       apiData.append("full_name", formData.name || "");

//       apiData.append(
//         "languages_spoken",
//         (formData.languages_spoken || []).join(","),
//       );

//       apiData.append("skills", (formData.skills || []).join(","));
//       apiData.append("assets", (formData.assets || []).join(","));

//       // CASE 1: Upload PDF
//       if (formData.cvFile) {
//         apiData.append("resumepdf", formData.cvFile); // âœ… correct key
//       }

//       // CASE 2: Resume Link
//       else if (formData.resume_link) {
//         apiData.append("resume_link", formData.resume_link); // âœ… correct key
//       }

//       // CASE 3: Keep existing resume (no change)
//       else if (existingResume) {
//         apiData.append("resume_link", existingResume);
//       }

//       // ðŸ”¹ Certificates FILES
//       formData.certificateFiles.forEach((file) => {
//         apiData.append("certificates", file);
//       });

//       // ðŸ”¹ Certificate LINKS
//       apiData.append(
//         "certificate_links",
//         JSON.stringify(formData.certificateLinks.filter((l) => l && l.trim())),
//       );

//       // ðŸ”¹ Debug â€” SEE WHAT GOES TO API
//       for (let pair of apiData.entries()) {
//         console.log(pair[0], pair[1]);
//       }

//       const response = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//         {
//           method: "PATCH",
//           body: apiData,
//         },
//       );

//       if (!response.ok) {
//         const err = await response.text();
//         console.error(err);
//         throw new Error("API Failed");
//       }

//       toast.success("Candidate Synchronized ðŸŽ‰", { id: loadingToast });
//     } catch (err) {
//       console.error(err);
//       toast.error("Commit failed âŒ", { id: loadingToast });
//     } finally {
//       setLoading(false);
//     }
//   };

//   const numberToIndianWords = (num) => {
//     if (!num || isNaN(num)) return "";

//     const ones = [
//       "",
//       "One",
//       "Two",
//       "Three",
//       "Four",
//       "Five",
//       "Six",
//       "Seven",
//       "Eight",
//       "Nine",
//       "Ten",
//       "Eleven",
//       "Twelve",
//       "Thirteen",
//       "Fourteen",
//       "Fifteen",
//       "Sixteen",
//       "Seventeen",
//       "Eighteen",
//       "Nineteen",
//     ];

//     const tens = [
//       "",
//       "",
//       "Twenty",
//       "Thirty",
//       "Forty",
//       "Fifty",
//       "Sixty",
//       "Seventy",
//       "Eighty",
//       "Ninety",
//     ];

//     const twoDigits = (n) =>
//       n < 20
//         ? ones[n]
//         : tens[Math.floor(n / 10)] + (n % 10 ? " " + ones[n % 10] : "");

//     const threeDigits = (n) => {
//       if (n === 0) return "";
//       if (n < 100) return twoDigits(n);
//       return (
//         ones[Math.floor(n / 100)] +
//         " Hundred" +
//         (n % 100 ? " " + twoDigits(n % 100) : "")
//       );
//     };

//     const crore = Math.floor(num / 10000000);
//     const lakh = Math.floor((num % 10000000) / 100000);
//     const thousand = Math.floor((num % 100000) / 1000);
//     const hundred = num % 1000;

//     let result = "";

//     if (crore) result += twoDigits(crore) + " Crore ";
//     if (lakh) result += twoDigits(lakh) + " Lakh ";
//     if (thousand) result += twoDigits(thousand) + " Thousand ";
//     if (hundred) result += threeDigits(hundred);

//     return result.trim() + " per annum";
//   };

//   const today = new Date();

//   // 18 years ago (max allowed DOB)
//   const maxDate = new Date(
//     today.getFullYear() - 18,
//     today.getMonth(),
//     today.getDate(),
//   )
//     .toISOString()
//     .split("T")[0];

//   // 70 years ago (min allowed DOB)
//   const minDate = new Date(
//     today.getFullYear() - 70,
//     today.getMonth(),
//     today.getDate(),
//   )
//     .toISOString()
//     .split("T")[0];

//   const [dobError, setDobError] = useState("");

//   const handleDobChange = (value) => {
//     setFormData({ ...formData, dob: value });

//     if (!value) {
//       setDobError("Date of Birth is required");
//       return;
//     }

//     const selected = new Date(value);

//     if (selected > new Date(maxDate)) {
//       setDobError("Age must be at least 18 years");
//     } else if (selected < new Date(minDate)) {
//       setDobError("Age must be below 70 years");
//     } else {
//       setDobError("");
//     }
//   };

  

//   if (fetchingData)
//     return (
//       <div className="min-h-screen flex flex-col items-center justify-center bg-slate-50 gap-4">
//         <Loader2 className="h-10 w-10 animate-spin text-blue-600" />
//         <p className="text-[11px] font-black uppercase tracking-[0.2em] text-slate-400">
//           Loading Data Load {effectiveId}...
//         </p>
//       </div>
//     );

//   return (
//     <div className="min-h-screen bg-[#F8FAFC] p-4 md:p-12 antialiased">
//       <div className="max-w-6xl mx-auto space-y-8" ref={dropdownContainerRef}>
//         {/* ROADMAP HEADER */}
//         <div className="flex flex-col lg:flex-row justify-between items-center bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 gap-8">
//           <div className="flex items-center gap-6">
//             <div className="h-16 w-16 bg-slate-900 rounded-[1.5rem] flex items-center justify-center text-white shadow-2xl">
//               <Database size={32} />
//             </div>
//             <div>
//               <h2 className="text-2xl font-black text-slate-900 tracking-tight leading-none">
//                 {id ? "Profile" : "Manual Registry"}
//               </h2>
//               <div className="flex items-center gap-2 mt-1 text-blue-600">
//                 <ShieldCheck size={14} />
//               </div>
//             </div>
//           </div>

//           <div className="flex-1 max-w-2xl w-full px-4">
//             <div className="relative flex justify-between items-center w-full">
//               <div className="absolute top-1/2 left-0 w-full h-0.5 bg-slate-100 -translate-y-1/2 z-0" />
//               <div
//                 className="absolute top-1/2 left-0 h-0.5 bg-blue-600 -translate-y-1/2 z-0 transition-all duration-700"
//                 style={{ width: `${((step - 1) / (totalSteps - 1)) * 100}%` }}
//               />
//               {[1, 2, 3, 4, 5].map((num) => (
//                 <div
//                   key={num}
//                   className="relative z-10 flex flex-col items-center gap-2"
//                 >
//                   {/* <div
//                     className={`h-8 w-8 rounded-full flex items-center justify-center text-[10px] font-black transition-all border-4 ${step === num ? "bg-blue-600 text-white border-blue-100 scale-110 shadow-lg" : step > num ? "bg-emerald-500 text-white border-emerald-50" : "bg-white text-slate-300 border-slate-50"}`}
//                   >
//                     {step > num ? <Check size={14} strokeWidth={4} /> : num}
//                   </div> */}
//                   <div
//   className={`h-8 w-8 rounded-full flex items-center justify-center text-[10px] font-black transition-all border-4
//   ${
//     step === num
//       ? "bg-blue-600 text-white border-blue-100 scale-110 shadow-lg"
//       : step > num
//       ? "bg-emerald-500 text-white border-emerald-50"
//       : (
//           (num === 1 && isStep1Incomplete()) ||
//           (num === 2 && isStep2Incomplete()) ||
//           (num === 3 && isStep3Incomplete()) ||
//           (num === 4 && isStep4Incomplete()) ||
//           (num === 5 && isStep5Incomplete())
//         )
//       ? "bg-yellow-400 text-white border-yellow-100"
//       : "bg-white text-slate-300 border-slate-50"
//   }`}
// >
//   {step > num ? <Check size={14} strokeWidth={4} /> : num}
// </div>

//                   <span
//                     className={`absolute -bottom-6 text-[8px] font-black uppercase tracking-tighter transition-colors duration-300 ${step === num ? "text-blue-600" : "text-slate-300"}`}
//                   >
//                     {num === 1 && "Personal"} {num === 2 && "Location"}{" "}
//                     {num === 3 && "Experience"} {num === 4 && "Assets & skill"}{" "}
//                     {num === 5 && "Documents"}
//                   </span>
//                 </div>
//               ))}
//             </div>
//           </div>
//           <div className="bg-slate-50 border border-slate-200 rounded-2xl px-6 py-3 flex items-center gap-3 shadow-inner">
//             <div className="text-right">
//               <p className="text-[8px] font-black text-slate-400 uppercase leading-none">
//                 Status
//               </p>
//               <p className="text-sm font-black text-slate-900 mt-1">
//                 {Math.round((step / totalSteps) * 100)}%
//               </p>
//             </div>
//             <div className="h-8 w-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center">
//               <Check size={18} />
//             </div>
//           </div>
//         </div>

//         <form onSubmit={handleSubmit}>
//           <div className="space-y-12">
//             {/* STEP 1: IDENTITY & CAREER */}
//             {step === 1 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8 duration-500">
//                 <div className="flex items-center gap-4 pb-4 border-b border-slate-100">
//                   <User size={18} className="text-blue-600" />
//                   <h3 className="text-sm font-black text-slate-800 uppercase tracking-widest">
//                     Basic Candidate profile
//                   </h3>
//                 </div>
//                 <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
//                   <FormField label="Full Name" required>
//                     <input
//                       placeholder="Legal Name"
//                       value={formData.name}
//                       onChange={(e) =>
//                         setFormData({ ...formData, name: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <FormField label="Email" required>
//                     <input
//                       type="email"
//                       placeholder="name@domain.com"
//                       value={formData.email}
//                       onChange={(e) =>
//                         setFormData({ ...formData, email: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <FormField label="Phone" required>
//                     <div className="flex items-center bg-slate-50 border border-slate-200 rounded-xl overflow-hidden focus-within:bg-white focus-within:border-blue-500 transition-all shadow-sm">
//                       <span className="px-3 text-[11px] font-black text-slate-400">
//                         +91
//                       </span>
//                       <input
//                         maxLength={10}
//                         value={formData.phone}
//                         onChange={(e) =>
//                           setFormData({ ...formData, phone: e.target.value })
//                         }
//                         className="w-full px-3 py-2 bg-transparent text-[13px] font-bold outline-none"
//                       />
//                     </div>
//                   </FormField>
//                   <FormField label="Gender">
//                     <select
//                       value={formData.gender}
//                       onChange={(e) =>
//                         setFormData({ ...formData, gender: e.target.value })
//                       }
//                       className={inputStyle}
//                     >
//                       <option value="">Select</option>
//                       <option value="male">Male</option>
//                       <option value="female">Female</option>
//                       <option value="transgender">Transgender</option>
//                       <option value="prefer_not_to_say">
//                         Prefer not to say
//                       </option>
//                     </select>
//                   </FormField>
//                 </div>

//                 <div className="grid grid-cols-1 md:grid-cols-2 gap-8 pt-4">
//                   <FormField label="Date of Birth">
//                     <input
//                       type="date"
//                       min={minDate}
//                       max={maxDate}
//                       value={formData.dob}
//                       onChange={(e) =>
//                         setFormData({ ...formData, dob: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <FormField label="Languages">
//                     <div className="bg-slate-50 border border-slate-200 rounded-xl p-3 max-h-32 overflow-y-auto grid grid-cols-2 gap-3 shadow-inner">
//                       {[
//                         "English",
//                         "Hindi",
//                         "Marathi",
//                         "Gujarati",
//                         "Tamil",
//                         "Telugu",
//                       ].map((lang) => (
//                         <label
//                           key={lang}
//                           className="flex items-center gap-2 text-[11px] font-medium text-slate-600 cursor-pointer hover:text-blue-600 transition-colors"
//                         >
//                           <input
//                             type="checkbox"
//                             checked={formData.languages_spoken.includes(lang)}
//                             onChange={() => {
//                               const u = formData.languages_spoken.includes(lang)
//                                 ? formData.languages_spoken.filter(
//                                     (l) => l !== lang,
//                                   )
//                                 : [...formData.languages_spoken, lang];
//                               setFormData({ ...formData, languages_spoken: u });
//                             }}
//                             className="w-3.5 h-3.5 accent-blue-600 rounded"
//                           />{" "}
//                           {lang}
//                         </label>
//                       ))}
//                     </div>
//                   </FormField>
//                 </div>
//                 <FormField label="Bio Summary">
//                   <textarea
//                     rows={3}
//                     value={formData.about_me}
//                     onChange={(e) =>
//                       setFormData({ ...formData, about_me: e.target.value })
//                     }
//                     className={inputStyle + " resize-none"}
//                   />
//                 </FormField>
//                 <div className="flex justify-end pt-4">
//                   <button
//                     type="button"
//                     // onClick={() => setStep(2)}
//                     onClick={async () => {
//                       await saveStepData(1);
//                       setStep(2);
//                     }}
//                     className={`px-12 py-3 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest shadow-xl active:scale-95 transition-all`}
//                   >
//                     Next Phase â†’
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 2: GEOGRAPHY */}
//             {step === 2 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8">
//                 <div className="flex items-center gap-3 pb-4 border-b border-slate-100">
//                   <MapPin size={18} className="text-blue-600" />
//                   <h3 className="text-xs font-black text-slate-800 uppercase tracking-widest">
//                     location Data
//                   </h3>
//                 </div>
//                 <div className="space-y-8">
//                   <FormField label="Address 1" required>
//                     <input
//                       value={formData.address}
//                       onChange={(e) =>
//                         setFormData({ ...formData, address: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                     <FormField label="Address 2" required>
//                       <input
//                         value={formData.location}
//                         onChange={(e) =>
//                           setFormData({ ...formData, location: e.target.value })
//                         }
//                         className={inputStyle}
//                       />
//                     </FormField>
//                     <FormField label="Pincode" required>
//                       <input
//                         maxLength={6}
//                         placeholder="000000"
//                         value={formData.pincode}
//                         onChange={(e) => {
//                           setFormData({ ...formData, pincode: e.target.value });
//                           if (e.target.value.length === 6)
//                             fetchPincodeDetails(e.target.value);
//                         }}
//                         className={inputStyle}
//                       />
//                     </FormField>
//                   </div>
//                   <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
                    
//                     <FormField label="City">
//                       {isFetchingPincode ? (
//                         <input
//                           value="Fetching..."
//                           readOnly
//                           className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-400 shadow-inner"
//                         />
//                       ) : cityOptions.length > 1 ? (
//                         <select
//                           value={formData.city}
//                           onChange={(e) => {
//                             const selected = cityOptions.find(
//                               (c) => c.Name === e.target.value,
//                             );

//                             setFormData((prev) => ({
//                               ...prev,
//                               city: selected?.Name || "",
//                               district: selected?.District || "",
//                               state: selected?.State || "",
//                               country: selected?.Country || "India",
//                             }));
//                           }}
//                           className="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl text-xs font-bold text-slate-700 shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100"
//                         >
//                           {cityOptions.map((c, i) => (
//                             <option key={i} value={c.Name}>
//                               {c.Name}
//                             </option>
//                           ))}
//                         </select>
//                       ) : (
//                         <input
//                           value={formData.city || ""}
//                           readOnly
//                           className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                         />
//                       )}
//                     </FormField>

//                     <FormField label="District">
//                       <input
//                         // value={formData.district}
//                         value={
//                           isFetchingPincode ? "Fetching..." : formData.district
//                         }
//                         readOnly
//                         className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                       />
//                     </FormField>
//                     <FormField label="State">
//                       <input
//                         // value={formData.state}
//                         value={
//                           isFetchingPincode ? "Fetching..." : formData.state
//                         }
//                         readOnly
//                         className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                       />
//                     </FormField>
//                     <FormField label="Country">
//                       <input
//                         // value={formData.country}
//                         value={
//                           isFetchingPincode ? "Fetching..." : formData.country
//                         }
//                         readOnly
//                         onChange={(e) =>
//                           setFormData({ ...formData, country: e.target.value })
//                         }
//                         className={inputStyle}
//                       />
//                     </FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-between pt-8 border-t border-slate-50">
//                   <button
//                     onClick={() => setStep(1)}
//                     type="button"
//                     className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase hover:text-slate-900 transition-all shadow-sm"
//                   >
//                     â† Back
//                   </button>
//                   <button
//                     //  onClick={() => setStep(3)}
//                     onClick={async () => {
//                       await saveStepData(2);
//                       setStep(3);
//                     }}
//                     type="button"
//                     className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase shadow-xl transition-all"
//                   >
//                     Continue â†’
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 3: EXPERIENCE */}
//             {/* {step === 3 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
//                 <div className="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-sm transition-all overflow-hidden">
//                   <div className="flex flex-col md:flex-row items-center justify-between gap-6">
//                     <div className="flex items-center gap-4 text-slate-900 font-black">
//                       <Briefcase size={24} className="text-blue-600" />
//                       <div>
//                         <h3 className="text-sm uppercase tracking-widest">
//                           Are you Fresher?
//                         </h3>
//                         <p className="text-[10px] font-bold text-slate-400 mt-1">
//                           Select current career status
//                         </p>
//                       </div>
//                     </div>
//                     <div className="flex bg-slate-100 p-1.5 rounded-[1.5rem] border border-slate-200 w-full md:w-auto">
                      
//                       <button
//                         type="button"
//                         disabled={hasExistingExperience} // â­ disable when experience present
//                         onClick={() => {
//                           if (hasExistingExperience) return; // safety
//                           setIsFresher(true);
//                           setFormData({ ...formData, experiences: [] });
//                         }}
//                         className={`px-8 py-2.5 rounded-2xl text-[10px] font-black transition-all
//   ${
//     hasExistingExperience
//       ? "bg-slate-100 text-slate-300 cursor-not-allowed" // disabled style
//       : isFresher === true
//         ? "bg-white text-blue-600 shadow-sm border"
//         : "text-slate-400"
//   }`}
//                       >
//                         Yes
//                       </button>

//                       <button
//                         type="button"
//                         onClick={() => {
//                           setIsFresher(false);

//                           if (
//                             !formData.experiences ||
//                             formData.experiences.length === 0
//                           ) {
//                             setFormData({
//                               ...formData,
//                               experiences: [
//                                 {
//                                   company_name: "",
//                                   job_title: "",
//                                   start_date: "",
//                                   end_date: "",
//                                   industry: "",
//                                   previous_ctc: "",
//                                   location: "",
//                                   description: "",
//                                   exp_letter_link: "",
//                                   uploadMode: "file",
//                                 },
//                               ],
//                             });
//                           }
//                         }}
//                         className={`px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === false ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}
//                       >
//                         No
//                       </button>
//                     </div>
//                   </div>
//                 </div>

//                 {isFresher === false && (
//                   <div className="bg-white p-6 md:p-10 rounded-[3.5rem] border border-slate-200 shadow-xl space-y-10 animate-in fade-in duration-500 shadow-slate-100">
//                     <div className="flex flex-col sm:flex-row justify-between items-start border-b border-slate-100 pb-8">
//                       <div className="flex items-center gap-4">
//                         <div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg">
//                           <History size={20} />
//                         </div>
//                         <h3 className="text-sm font-black text-slate-900 uppercase">
//                           Career Timeline
//                         </h3>
//                       </div>
//                       <button
//                         type="button"
//                         onClick={() =>
//                           setFormData({
//                             ...formData,
//                             experiences: [
//                               ...formData.experiences,
//                               {
//                                 company_name: "",
//                                 job_title: "",
//                                 start_date: "",
//                                 industry: "",
//                                 end_date: "",
//                                 previous_ctc: "",
//                                 location: "",
//                                 description: "",
//                                 exp_letter_link: "",
//                                 uploadMode: "file",
//                               },
//                             ],
//                           })
//                         }
//                         className="px-6 py-3 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase shadow-lg active:scale-95 transition-all"
//                       >
//                         + Add Experiance
//                       </button>
//                     </div>
//                     <div className="space-y-10 max-h-[600px] overflow-y-auto pr-4 custom-scrollbar-professional">
//                       {formData.experiences.map((exp, i) => (
//                         <div
//                           key={i}
//                           className="relative bg-slate-50/50 border border-slate-200 p-8 rounded-[2.5rem] space-y-8 animate-in zoom-in-95 group hover:bg-white transition-all shadow-inner"
//                         >
//                           <button
//                             type="button"
//                             onClick={() => {
//                               if (formData.experiences.length === 1) return;
//                               setFormData({
//                                 ...formData,
//                                 experiences: formData.experiences.filter(
//                                   (_, idx) => idx !== i,
//                                 ),
//                               });
//                             }}
//                             className="absolute -top-3 -right-3 h-10 w-10 bg-white border border-slate-200 text-red-500 rounded-full flex items-center justify-center shadow-lg transition-all opacity-0 group-hover:opacity-100 z-20"
//                           >
//                             <Trash2 size={18} />
//                           </button>
//                           <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
//                             <FormField label="Employer">
//                               <input
//                                 value={exp.company_name}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].company_name = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                             <FormField label="Designation">
//                               <input
//                                 value={exp.job_title}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].job_title = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                             <FormField label="Industry">
//                               <select
//                                 value={exp.industry || ""}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].industry = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               >
//                                 <option value="">Select Industry</option>
//                                 <option>Information Technology</option>
//                                 <option>Software Development</option>
//                                 <option>Banking & Finance</option>
//                                 <option>Healthcare</option>
//                                 <option>Education</option>
//                                 <option>Manufacturing</option>
//                                 <option>Retail</option>
//                                 <option>Telecom</option>
//                                 <option>Construction</option>
//                                 <option>Logistics</option>
//                                 <option>Marketing & Advertising</option>
//                                 <option>HR / Recruitment</option>
//                                 <option>Government</option>
//                                 <option>Other</option>
//                               </select>
//                             </FormField>
//                           </div>

//                           <div className="grid grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8">
//                             <FormField label="Start">
//                               <input
//                                 type="date"
//                                 value={exp.start_date}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].start_date = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                             <FormField label="End">
//                               <input
//                                 type="date"
//                                 value={exp.end_date}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].end_date = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>

//                             <FormField label="Annual CTC">
//                               <div className="relative">
                            
//                                 <div className="flex items-center bg-slate-50 border border-slate-200 rounded-2xl overflow-hidden focus-within:bg-white focus-within:border-blue-500 focus-within:ring-4 focus-within:ring-blue-500/10 transition-all duration-300 shadow-sm">
                               
//                                   <div className="px-5 py-3 border-r border-slate-200/60 bg-slate-100/50 flex items-center justify-center">
//                                     <span className="text-sm font-black text-blue-600">
//                                       â‚¹
//                                     </span>
//                                   </div>

                              
//                                   <input
//                                     type="number"
//                                     placeholder="0.00"
//                                     value={exp.previous_ctc}
//                                     onChange={(e) => {
//                                       const u = [...formData.experiences];
//                                       u[i].previous_ctc = e.target.value;
//                                       setFormData({
//                                         ...formData,
//                                         experiences: u,
//                                       });
//                                     }}
//                                     className="w-full px-4 py-3 bg-transparent text-[13px] font-bold text-slate-700 outline-none placeholder:text-slate-300"
//                                   />

                                 
//                                   <div className="pr-5">
//                                     <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">
//                                       LPA
//                                     </span>
//                                   </div>
//                                 </div>

                             
//                                 {exp.previous_ctc && (
//                                   <div className="absolute -bottom-6 left-1 flex items-center gap-2 animate-in fade-in slide-in-from-top-1">
//                                     <div className="h-1.5 w-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.4)]" />
//                                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest italic">
//                                       {numberToIndianWords(
//                                         Number(exp.previous_ctc),
//                                       )}{" "}
//                                       Rupees
//                                     </p>
//                                   </div>
//                                 )}
//                               </div>
//                             </FormField>

//                             <FormField label="City">
//                               <input
//                                 value={exp.location}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].location = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                           </div>

//                           <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
//                             <FormField label="Job Description">
//                               <textarea
//                                 rows={5}
//                                 value={exp.description}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].description = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={
//                                   inputStyle +
//                                   " resize-none h-full min-h-[140px]"
//                                 }
//                               />
//                             </FormField>
//                             <div className="space-y-3">
//                               <div className="flex justify-between items-center px-1">
//                                 <p className="text-[10px] font-black text-slate-400 uppercase">
//                                   Experience Letter
//                                 </p>
//                                 <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200">
//                                   <button
//                                     type="button"
//                                     onClick={() => {
//                                       const u = [...formData.experiences];
//                                       u[i].uploadMode = "file";
//                                       setFormData({
//                                         ...formData,
//                                         experiences: u,
//                                       });
//                                     }}
//                                     className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode !== "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                                   >
//                                     FILE
//                                   </button>
//                                   <button
//                                     type="button"
//                                     onClick={() => {
//                                       const u = [...formData.experiences];
//                                       u[i].uploadMode = "link";
//                                       setFormData({
//                                         ...formData,
//                                         experiences: u,
//                                       });
//                                     }}
//                                     className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                                   >
//                                     URL
//                                   </button>
//                                 </div>
//                               </div>
//                               <div className="bg-white/50 border border-slate-100 rounded-3xl p-4 min-h-[140px] flex flex-col justify-center">
                                

//                                 {exp.uploadMode !== "link" ? (
//                                   <label className="flex flex-col items-center justify-center gap-3 w-full h-full border-2 border-dashed border-slate-200 rounded-2xl hover:bg-blue-50/30 cursor-pointer group p-4 transition-all">
//                                     <FileUp
//                                       size={24}
//                                       className="text-slate-400 group-hover:text-blue-500"
//                                     />

                                   
//                                     <span className="text-[9px] font-bold text-slate-500 uppercase tracking-widest text-center">
//                                       {exp.expLetterFile
//                                         ? exp.expLetterFile.name
//                                         : exp.experience_letter_path
//                                           ? "Existing Experience Letter Available"
//                                           : "Drop PDF Validation"}
//                                     </span>

                                   
//                                     {exp.experience_letter_path &&
//                                       !exp.expLetterFile && (
//                                         <a
//                                           href={fixResumeUrl2(
//                                             exp.experience_letter_path,
//                                           )}
//                                           target="_blank"
//                                           rel="noreferrer"
//                                           className="text-blue-600 text-[10px] underline"
//                                           onClick={(e) => e.stopPropagation()}
//                                         >
//                                           View Current File
//                                         </a>
//                                       )}

//                                     <input
//                                       type="file"
//                                       accept=".pdf"
//                                       className="hidden"
//                                       onChange={(e) => {
//                                         const u = [...formData.experiences];
//                                         u[i].expLetterFile = e.target.files[0];
//                                         setFormData({
//                                           ...formData,
//                                           experiences: u,
//                                         });
//                                       }}
//                                     />
//                                   </label>
//                                 ) : (
//                                   <div className="relative">
//                                     <LinkIcon
//                                       size={16}
//                                       className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                                     />
//                                     <input
//                                       placeholder="Storage URI"
//                                       value={exp.exp_letter_link || ""}
//                                       onChange={(e) => {
//                                         const u = [...formData.experiences];
//                                         u[i].exp_letter_link = e.target.value;
//                                         setFormData({
//                                           ...formData,
//                                           experiences: u,
//                                         });
//                                       }}
//                                       className={inputStyle + " pl-11"}
//                                     />
//                                   </div>
//                                 )}
//                               </div>
//                             </div>
//                           </div>
//                           <div className="flex justify-between pt-2 border-t border-slate-50">
//                             <button
//                               type="button"
//                               onClick={() =>
//                                 setFormData({
//                                   ...formData,
//                                   experiences: [
//                                     ...formData.experiences,
//                                     {
//                                       company_name: "",
//                                       job_title: "",
//                                       start_date: "",
//                                       industry: "",
//                                       end_date: "",
//                                       previous_ctc: "",
//                                       location: "",
//                                       description: "",
//                                       exp_letter_link: "",
//                                       uploadMode: "file",
//                                     },
//                                   ],
//                                 })
//                               }
//                               className="px-6 py-3 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase shadow-lg active:scale-95 transition-all"
//                             >
//                               + Add Experiance
//                             </button>
//                             <button
//                               type="button"
//                               onClick={() => handleSaveExperienceAPI(i)}
//                               className="flex items-center gap-2 px-8 py-3 bg-emerald-50 text-emerald-600 border border-emerald-100 rounded-2xl text-[10px] font-black uppercase hover:bg-emerald-500 hover:text-white transition-all active:scale-95 shadow-sm"
//                             >
//                               <Check size={16} strokeWidth={3} /> Save Record
//                             </button>
//                           </div>
//                         </div>
//                       ))}
//                     </div>
//                   </div>
//                 )}
//                 <div className="flex justify-between pt-4">
//                   <button
//                     onClick={() => setStep(2)}
//                     type="button"
//                     className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase shadow-sm transition-all hover:text-slate-900 flex items-center gap-2"
//                   >
//                     â† Back
//                   </button>
//                   <button
//                     onClick={async () => {
//                       await saveStepData(3);
//                       setStep(4);
//                     }}
//                     type="button"
//                     disabled={isFresher === null}
//                     className={`px-12 py-4 rounded-2xl text-xs font-black uppercase shadow-xl transition-all active:scale-95 ${isFresher !== null ? "bg-blue-600 text-white shadow-blue-600/30 hover:bg-blue-700" : "bg-slate-200 text-slate-400 cursor-not-allowed"}`}
//                   >
//                     Next Phase â†’
//                   </button>
//                 </div>
//               </div>
//             )} */}  

//       {/* STEP 3: EXPERIENCE ARCHITECTURE */}
//       {/* {step === 3 && (
//   <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
    
//     <div className="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-sm overflow-hidden relative group">
//       <Fingerprint className="absolute -right-6 -bottom-6 text-slate-50 opacity-[0.4] -rotate-12 pointer-events-none" size={100} />
//       <div className="flex flex-col md:flex-row items-center justify-between gap-6 relative z-10">
//         <div className="flex items-center gap-4 text-slate-900 font-black">
//           <div className="w-12 h-12 bg-blue-50 rounded-2xl flex items-center justify-center text-blue-600 shadow-inner">
//             <Briefcase size={22} strokeWidth={2.5} />
//           </div>
//           <div>
//             <h3 className="text-sm uppercase tracking-[0.15em]">Are you Fresher?</h3>
//             <p className="text-[10px] font-bold text-slate-400 mt-1 uppercase tracking-widest">Select current career status</p>
//           </div>
//         </div>
//         <div className="flex bg-slate-100 p-1.5 rounded-[1.5rem] border border-slate-200 w-full md:w-auto">
//           <button
//             type="button"
//             disabled={hasExistingExperience}
//             onClick={() => {
//               if (hasExistingExperience) return;
//               setIsFresher(true);
//               setFormData({ ...formData, experiences: [] });
//             }}
//             className={`px-10 py-3 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === true ? "bg-white text-blue-600 shadow-sm border border-slate-200" : "text-slate-400"}`}
//           >YES</button>
//           <button
//             type="button"
//             onClick={() => setIsFresher(false)}
//             className={`px-10 py-3 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === false ? "bg-white text-blue-600 shadow-sm border border-slate-200" : "text-slate-400"}`}
//           >NO</button>
//         </div>
//       </div>
//     </div>

 
//     {isFresher === false && (
//       <div className="bg-white p-8 rounded-[3.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 space-y-10 relative overflow-hidden">
//         <div className="flex flex-col sm:flex-row justify-between items-center border-b border-slate-50 pb-8 relative z-10">
//           <div className="flex items-center gap-4">
//             <div className="h-10 w-10 rounded-xl bg-slate-900 flex items-center justify-center text-white shadow-lg shadow-slate-300">
//               <History size={20} />
//             </div>
//             <h3 className="text-sm font-black text-slate-900 uppercase tracking-widest">Career History Nodes</h3>
//           </div>
//           <button
//             type="button"
//             onClick={() => {
//               // Initialize one empty entry when opening if none exist
//               if (newExperiences.length === 0) {
//                 setNewExperiences([{ company_name: "", job_title: "", start_date: "", end_date: "", previous_ctc: "", location: "", description: "", experience_letter_path: null }]);
//               }
//               setShowExpModal(true);
//             }}
//             className="px-6 py-3 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl shadow-blue-200 hover:bg-blue-700 active:scale-95 transition-all flex items-center gap-2"
//           >
//             <Plus size={14} strokeWidth={3} /> Add Experience
//           </button>
//         </div>

       
//         <div className="space-y-6 relative z-10">
//           {formData.experiences && formData.experiences.length > 0 ? (
//             formData.experiences.map((exp, i) => (
//               <div key={i} className="group flex flex-col md:flex-row items-center gap-6 p-6 bg-slate-50/50 border border-slate-100 rounded-[2rem] hover:bg-white hover:border-blue-200 hover:shadow-md transition-all">
//                 <div className="w-12 h-12 flex-shrink-0 bg-white border border-slate-200 rounded-xl flex items-center justify-center text-[11px] font-black text-slate-900 shadow-sm">
//                   0{i + 1}
//                 </div>
//                 <div className="flex-1 min-w-0">
//                   <div className="flex items-center gap-3 mb-1">
//                     <h4 className="text-sm font-black text-slate-900 uppercase tracking-tight truncate">{exp.company_name}</h4>
//                     <span className="h-1 w-1 rounded-full bg-slate-300" />
//                     <span className="text-[10px] font-bold text-blue-600 uppercase tracking-widest">{exp.job_title}</span>
//                   </div>
//                   <div className="flex flex-wrap gap-x-6 gap-y-2">
//                     <span className="text-[10px] font-black text-slate-400 uppercase">{exp.start_date} â€” {exp.end_date}</span>
//                     <span className="text-[10px] font-black text-emerald-600 uppercase">â‚¹{(exp.previous_ctc / 100000).toFixed(2)} LPA</span>
//                   </div>
//                 </div>
//                 <button type="button" onClick={() => setShowExpModal(true)} className="p-2 text-slate-300 hover:text-blue-600 transition-colors"><Edit3 size={16}/></button>
//               </div>
//             ))
//           ) : (
//             <div className="text-center py-16 bg-slate-50/30 border-2 border-dashed border-slate-100 rounded-[2.5rem]">
//               <Database className="mx-auto text-slate-200 mb-4" size={32} />
//               <p className="text-[10px] font-black text-slate-300 uppercase tracking-[0.2em]">No Experience Logged</p>
//             </div>
//           )}
//         </div>
//       </div>
//     )}

  
//     <div className="flex justify-between pt-6">
//       <button type="button" onClick={() => setStep(2)} className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[10px] font-black uppercase shadow-sm transition-all hover:text-slate-900">â† Back</button>
//       <button
//         type="button"
//         onClick={async () => { await saveStepData(3); setStep(4); }}
//         disabled={isFresher === null}
//         className={`px-12 py-4 rounded-2xl text-[10px] font-black uppercase shadow-xl transition-all ${isFresher !== null ? "bg-blue-600 text-white shadow-blue-200" : "bg-slate-200 text-slate-300 cursor-not-allowed"}`}
//       >Commit & Continue â†’</button>
//     </div>

//     {showExpModal && (
//       <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 md:p-8 bg-slate-900/60 backdrop-blur-md animate-in fade-in duration-300">
//         <div className="bg-white w-full max-w-6xl h-full max-h-[90vh] rounded-[3rem] shadow-2xl border border-slate-200 flex flex-col overflow-hidden animate-in zoom-in-95">
//           <div className="px-10 py-8 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
//             <div className="flex items-center gap-4">
//               <div className="w-14 h-14 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-xl">
//                 <Plus size={28} strokeWidth={3} />
//               </div>
//               <div>
//                 <h2 className="text-base font-black text-slate-900 uppercase tracking-[0.2em]">New Experience Terminal</h2>
//                 <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Append New Deployment Nodes</p>
//               </div>
//             </div>
//             <button onClick={() => setShowExpModal(false)} className="w-12 h-12 flex items-center justify-center bg-white border border-slate-100 hover:bg-red-50 hover:text-red-500 rounded-full transition-all shadow-sm"><X size={24} /></button>
//           </div>

//           <div className="flex-1 overflow-y-auto p-10 space-y-12 custom-scrollbar-professional bg-white">
//             {newExperiences.map((exp, i) => (
//               <div key={i} className="relative bg-slate-50/50 border border-slate-200 p-8 rounded-[2.5rem] space-y-8 group hover:bg-white transition-all shadow-inner">
//                 <button
//                   type="button"
//                   onClick={() => setNewExperiences(newExperiences.filter((_, idx) => idx !== i))}
//                   className="absolute -top-3 -right-3 h-10 w-10 bg-white border border-slate-200 text-red-500 rounded-full flex items-center justify-center shadow-lg opacity-0 group-hover:opacity-100 transition-all z-20"
//                 ><Trash2 size={18} /></button>

//                 <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
//                   <FormField label="Employer">
//                     <input value={exp.company_name} onChange={(e) => { const u = [...newExperiences]; u[i].company_name = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//                   </FormField>
//                   <FormField label="Designation">
//                     <input value={exp.job_title} onChange={(e) => { const u = [...newExperiences]; u[i].job_title = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//                   </FormField>
//                   <FormField label="Location">
//                     <input value={exp.location} onChange={(e) => { const u = [...newExperiences]; u[i].location = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//                   </FormField>
//                 </div>

//                 <div className="grid grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8">
//                   <FormField label="Start Date">
//                     <input type="date" value={exp.start_date} onChange={(e) => { const u = [...newExperiences]; u[i].start_date = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//                   </FormField>
//                   <FormField label="End Date">
//                     <input type="date" value={exp.end_date} onChange={(e) => { const u = [...newExperiences]; u[i].end_date = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//                   </FormField>
//                   <FormField label="Annual CTC">
//                     <div className="flex items-center bg-white border border-slate-200 rounded-2xl overflow-hidden focus-within:border-blue-500 transition-all">
//                       <div className="px-4 text-blue-600 font-black">â‚¹</div>
//                       <input type="number" value={exp.previous_ctc} onChange={(e) => { const u = [...newExperiences]; u[i].previous_ctc = e.target.value; setNewExperiences(u); }} className="w-full py-3 bg-transparent text-[12px] font-bold outline-none" />
//                       <div className="pr-4 text-[9px] font-black text-slate-400 uppercase">LPA</div>
//                     </div>
//                   </FormField>
//                 </div>

//                 <div className="flex justify-end pt-4 border-t border-slate-100">
//                   <button
//                     type="button"
//                     onClick={() => handleSaveExperienceAPI(i)} // This uses your existing logic
//                     className="flex items-center gap-2 px-8 py-3 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl shadow-blue-200 transition-all"
//                   >
//                     <CheckCircle size={16} /> Save Record
//                   </button>
//                 </div>
//               </div>
//             ))}

//             <button
//               type="button"
//               onClick={() => setNewExperiences([...newExperiences, { company_name: "", job_title: "", start_date: "", end_date: "", previous_ctc: "", location: "", description: "", experience_letter_path: null }])}
//               className="w-full py-8 border-2 border-dashed border-slate-200 rounded-[2.5rem] text-slate-400 hover:text-blue-600 transition-all text-[11px] font-black uppercase tracking-[0.3em]"
//             >
//               + Initialize Additional Node
//             </button>
//           </div>

//           <div className="px-10 py-6 bg-slate-50 border-t border-slate-100 flex justify-between items-center">
//             <div className="flex items-center gap-2">
//                <ShieldCheck className="text-emerald-500" size={18} />
//                <span className="text-[9px] font-black text-slate-400 uppercase tracking-widest">Node Encryption Active</span>
//             </div>
//             <div className="flex gap-4">
//               <button type="button" onClick={() => { setNewExperiences([]); setShowExpModal(false); }} className="px-8 py-4 text-slate-500 text-[10px] font-black uppercase">Discard</button>
//               <button 
//                 type="button" 
//                 onClick={() => {
//                   setFormData({ ...formData, experiences: [...formData.experiences, ...newExperiences] });
//                   setNewExperiences([]);
//                   setShowExpModal(false);
//                   toast.success("Nodes Committed to Timeline");
//                 }} 
//                 className="px-12 py-4 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase shadow-2xl active:scale-95 transition-all"
//               >Commit All Nodes</button>
//             </div>
//           </div>
//         </div>
//       </div>
//     )}
//   </div>
// )} */}

// {step === 3 && (
//   <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
//     {/* STATUS SELECTOR CARD */}
//     <div className="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-sm overflow-hidden relative group">
//       <Fingerprint className="absolute -right-6 -bottom-6 text-slate-50 opacity-[0.4] -rotate-12 pointer-events-none" size={100} />
//       <div className="flex flex-col md:flex-row items-center justify-between gap-6 relative z-10">
//         <div className="flex items-center gap-4 text-slate-900 font-black">
//           <div className="w-12 h-12 bg-blue-50 rounded-2xl flex items-center justify-center text-blue-600 shadow-inner">
//             <Briefcase size={22} strokeWidth={2.5} />
//           </div>
//           <div>
//             <h3 className="text-sm uppercase tracking-[0.15em]">Are you Fresher?</h3>
//             <p className="text-[10px] font-bold text-slate-400 mt-1 uppercase tracking-widest">Career status determines validation protocol</p>
//           </div>
//         </div>
//         <div className="flex bg-slate-100 p-1.5 rounded-[1.5rem] border border-slate-200 w-full md:w-auto">
//           <button
//             type="button"
//             disabled={hasExistingExperience}
//             onClick={() => {
//               if (hasExistingExperience) return;
//               setIsFresher(true);
//               setFormData({ ...formData, experiences: [] });
//             }}
//             className={`px-10 py-3 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === true ? "bg-white text-blue-600 shadow-sm border border-slate-200" : "text-slate-400"}`}
//           >YES</button>
//           <button
//             type="button"
//             onClick={() => setIsFresher(false)}
//             className={`px-10 py-3 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === false ? "bg-white text-blue-600 shadow-sm border border-slate-200" : "text-slate-400"}`}
//           >NO</button>
//         </div>
//       </div>
//     </div>

//     {/* EXPERIENCE TIMELINE DISPLAY */}
//     {isFresher === false && (
//       <div className="bg-white p-8 rounded-[3.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 space-y-10 relative overflow-hidden">
//         <div className="flex flex-col sm:flex-row justify-between items-center border-b border-slate-50 pb-8 relative z-10">
//           <div className="flex items-center gap-4">
//             <div className="h-10 w-10 rounded-xl bg-slate-900 flex items-center justify-center text-white shadow-lg">
//               <History size={20} />
//             </div>
//             <h3 className="text-sm font-black text-slate-900 uppercase tracking-widest">Job Experience History</h3>
//           </div>
//           <button
//             type="button"
//             onClick={() => {
//               if (newExperiences.length === 0) {
//                 setNewExperiences([{ company_name: "", job_title: "", start_date: "", end_date: "", previous_ctc: "", location: "", description: "" }]);
//               }
//               setShowExpModal(true);
//             }}
//             className="px-6 py-3 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl shadow-blue-200 hover:bg-blue-700 active:scale-95 transition-all flex items-center gap-2"
//           >
//             <Plus size={14} strokeWidth={3} /> Add Experience
//           </button>
//         </div>

//         {/* VERIFIED DATA LIST (Shows existing records from formData) */}
//         {/* <div className="space-y-6 relative z-10">
//           {formData.experiences && formData.experiences.length > 0 ? (
//             formData.experiences.map((exp, i) => (
//               <div key={i} className="group flex flex-col md:flex-row items-center gap-6 p-6 bg-slate-50/50 border border-slate-100 rounded-[2rem] hover:bg-white hover:border-blue-200 transition-all border-l-4 border-l-blue-600">
//                 <div className="w-12 h-12 flex-shrink-0 bg-white border border-slate-200 rounded-xl flex items-center justify-center text-[11px] font-black text-slate-900">
//                   0{i + 1}
//                 </div>
//                 <div className="flex-1 min-w-0">
//                   <div className="flex items-center gap-3 mb-1">
//                     <h4 className="text-sm font-black text-slate-900 uppercase tracking-tight truncate">{exp.company_name}</h4>
//                     <span className="h-1 w-1 rounded-full bg-slate-300" />
//                     <span className="text-[10px] font-bold text-blue-600 uppercase tracking-widest">{exp.job_title}</span>
//                   </div>
//                   <div className="flex flex-wrap gap-x-6 gap-y-2">
//                     <span className="text-[10px] font-black text-slate-400 uppercase">{exp.start_date} â€” {exp.end_date}</span>
//                     <span className="text-[10px] font-black text-emerald-600 uppercase italic">â‚¹{(exp.previous_ctc / 100000).toFixed(2)} LPA</span>
//                   </div>
//                 </div>
//                 <button type="button" onClick={() => setShowExpModal(true)} className="p-2 text-slate-300 hover:text-blue-600 transition-colors"><Edit3 size={16}/></button>
//               </div>
//             ))
//           ) : (
//             <div className="text-center py-16 bg-slate-50/30 border-2 border-dashed border-slate-100 rounded-[2.5rem]">
//               <Database className="mx-auto text-slate-200 mb-4" size={32} />
//               <p className="text-[10px] font-black text-slate-300 uppercase tracking-[0.2em]">No Experience </p>
//             </div>
//           )}
//         </div> */}
//         <div className="space-y-4 relative z-10 animate-in fade-in slide-in-from-bottom-4 duration-700">
//   {formData.experiences && formData.experiences.length > 0 ? (
//     formData.experiences.map((exp, i) => (
//       <div 
//         key={i} 
//         className="group relative flex flex-col md:flex-row items-stretch gap-0 bg-white border border-slate-200 rounded-[1.5rem] hover:border-blue-400 hover:shadow-xl hover:shadow-blue-500/5 transition-all duration-300 overflow-hidden"
//       >
//         {/* SIDE BRANDING BAR: Denotes 'Verified Node' status */}
//         <div className="w-1.5 bg-blue-600 group-hover:w-2 transition-all duration-300" />

//         {/* INDEX NODE: Terminal Style */}
//         <div className="flex items-center justify-center px-6 bg-slate-50/50 border-r border-slate-100">
//           <div className="w-10 h-10 rounded-xl bg-white border border-slate-200 flex flex-col items-center justify-center shadow-sm group-hover:border-blue-200 transition-colors">
//             <span className="text-[10px] font-black text-slate-400 leading-none uppercase tracking-tighter">exp</span>
//             <span className="text-sm font-black text-slate-900 leading-none mt-1">0{i + 1}</span>
//           </div>
//         </div>

//         {/* MAIN CONTENT STRIP */}
//         <div className="flex-1 p-5 md:p-6 flex flex-col md:flex-row md:items-center justify-between gap-6">
//           <div className="min-w-0 space-y-2">
//             {/* Entity & Role */}
//             <div className="flex items-center gap-3">
//               <h4 className="text-sm font-black text-slate-900 uppercase tracking-tight truncate group-hover:text-blue-600 transition-colors">
//                 {exp.company_name || "Unidentified Entity"}
//               </h4>
//               <div className="h-1 w-1 rounded-full bg-slate-300" />
//               <div className="px-2 py-0.5 bg-blue-50 text-blue-700 rounded-md text-[9px] font-black uppercase tracking-widest border border-blue-100/50">
//                 {exp.job_title || "Role Pending"}
//               </div>
//             </div>

//             {/* Deployment Meta-Data */}
//             <div className="flex flex-wrap items-center gap-x-6 gap-y-2">
//               <div className="flex items-center gap-2 text-slate-400">
//                 <Calendar size={13} className="text-slate-300" />
//                 <span className="text-[10px] font-bold uppercase tracking-widest">
//                   {exp.start_date || "----"} <span className="text-slate-200 mx-1">â€”</span> {exp.end_date || "Present"}
//                 </span>
//               </div>
//               <div className="flex items-center gap-2 text-slate-400">
//                 <MapPin size={13} className="text-slate-300" />
//                 <span className="text-[10px] font-bold uppercase tracking-widest">{exp.location || "Global Node"}</span>
//               </div>
//             </div>
//           </div>

//           {/* FINANCIAL NODE: High Contrast Badge */}
//           <div className="flex items-center gap-6">
//             <div className="flex flex-col items-end border-r border-slate-100 pr-6">
//               <span className="text-[8px] font-black text-slate-400 uppercase tracking-[0.2em] mb-1">Previous CTC</span>
//               <div className="flex items-center gap-1.5 text-emerald-600">
//                 <div className="h-1.5 w-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]" />
//                 <span className="text-[12px] font-black uppercase tracking-tight">
//                   â‚¹{exp.previous_ctc ? `${(exp.previous_ctc / 100000).toFixed(2)} LPA` : "0.00"}
//                 </span>
//               </div>
//             </div>

//             {/* ACTION INTERFACE */}
//             <div className="flex items-center gap-2">
//               <button 
//                 type="button" 
//                 // onClick={() => {
//                 //   setCurrentEditingIndex(i);
//                 //   setShowExpModal(true);
//                 // }} 
// //                 onClick={() => {
// //   setCurrentEditingIndex(i);

// //   // Load existing data into modal form
// //   setNewExperiences([
// //     {
// //       ...formData.experiences[i],
// //       uploadMode: formData.experiences[i]?.uploadMode || "file",
// //     },
// //   ]);

// //   setShowExpModal(true);
// // }}
// onClick={() => {
//   const existing = formData.experiences[i];

//   setCurrentEditingIndex(i);

//   setNewExperiences([
//     {
//       ...existing,
//       uploadMode: existing.exp_letter_link ? "link" : "file",
//       expLetterFile: null, // important
//     },
//   ]);

//   setShowExpModal(true);
// }}



//                 className="p-3 bg-slate-50 text-slate-400 hover:bg-blue-600 hover:text-white rounded-xl transition-all duration-300 border border-slate-100 active:scale-90"
//               >
//                 <Edit3 size={16} strokeWidth={2.5} />
//               </button>
//             </div>
//           </div>
//         </div>

//         {/* Decorative Watermark for Enterprise Feel */}
//         <History className="absolute -right-4 -bottom-4 text-slate-900 opacity-[0.02] -rotate-12 pointer-events-none group-hover:opacity-[0.05] transition-opacity" size={100} />
//       </div>
//     ))
//   ) : (
//     /* EMPTY STATE: Audit-Empty Pattern */
//     <div className="relative group flex flex-col items-center justify-center py-20 bg-slate-50/30 border-2 border-dashed border-slate-200 rounded-[2.5rem] transition-colors hover:bg-slate-50">
//       <div className="relative z-10 flex flex-col items-center">
//         <div className="w-16 h-16 bg-white rounded-[1.5rem] shadow-sm border border-slate-100 flex items-center justify-center text-slate-200 mb-6 group-hover:scale-110 transition-transform duration-500">
//           <Database size={32} strokeWidth={1.5} />
//         </div>
//         <h4 className="text-[11px] font-black text-slate-400 uppercase tracking-[0.3em] mb-2">
//           Zero Nodes Synchronized
//         </h4>
//         <p className="text-[10px] font-bold text-slate-300 uppercase tracking-widest text-center max-w-xs">
//           Professional history registry currently empty. Initialize a new experience node to begin.
//         </p>
//       </div>
//       <div className="absolute inset-0 overflow-hidden pointer-events-none rounded-[2.5rem]">
//          <ShieldCheck className="absolute -right-8 -bottom-8 text-slate-900 opacity-[0.02] -rotate-12" size={200} />
//       </div>
//     </div>
//   )}
// </div>
//       </div>
//     )}

//     {/* NAVIGATION */}
//     <div className="flex justify-between pt-6">
//       <button type="button" onClick={() => setStep(2)} className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[10px] font-black uppercase shadow-sm transition-all hover:text-slate-900">â† Back</button>
//       <button
//         type="button"
//         onClick={async () => { await saveStepData(3); setStep(4); }}
//         disabled={isFresher === null}
//         className={`px-12 py-4 rounded-2xl text-[10px] font-black uppercase shadow-xl transition-all ${isFresher !== null ? "bg-blue-600 text-white shadow-blue-200" : "bg-slate-200 text-slate-300 cursor-not-allowed"}`}
//       >Commit & Continue â†’</button>
//     </div>

//     {/* MODAL: ADDING NEW RECORDS ONLY (Upload Logic Removed) */}
//     {/* {showExpModal && (
//       <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 md:p-8 bg-slate-900/60 backdrop-blur-md animate-in fade-in duration-300">
//         <div className="bg-white w-full max-w-5xl h-full max-h-[85vh] rounded-[3rem] shadow-2xl border border-slate-200 flex flex-col overflow-hidden animate-in zoom-in-95">
//           <div className="px-10 py-8 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
//             <div className="flex items-center gap-4">
//               <div className="w-14 h-14 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-xl">
//                 <Plus size={28} strokeWidth={3} />
//               </div>
//               <div>
//                 <h2 className="text-base font-black text-slate-900 uppercase tracking-[0.2em]">New Experience Terminal</h2>
//                 <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Append deployment node to registry</p>
//               </div>
//             </div>
//             <button onClick={() => setShowExpModal(false)} className="w-12 h-12 flex items-center justify-center bg-white border border-slate-100 hover:bg-red-50 hover:text-red-500 rounded-full transition-all shadow-sm"><X size={24} /></button>
//           </div>

//           <div className="flex-1 overflow-y-auto p-10 space-y-12 custom-scrollbar-professional bg-white">
//             {newExperiences.map((exp, i) => (
//               <div key={i} className="relative bg-slate-50/50 border border-slate-200 p-8 rounded-[2.5rem] space-y-8 animate-in slide-in-from-bottom-4 group hover:bg-white hover:border-blue-200 transition-all">
//                 <button
//                   type="button"
//                   onClick={() => setNewExperiences(newExperiences.filter((_, idx) => idx !== i))}
//                   className="absolute -top-3 -right-3 h-10 w-10 bg-white border border-slate-200 text-red-500 rounded-full flex items-center justify-center shadow-lg opacity-0 group-hover:opacity-100 transition-all z-20"
//                 ><Trash2 size={18} /></button>

//                 <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
//                   <FormField label="Employer">
//                     <input placeholder="Company Name" value={exp.company_name} onChange={(e) => { const u = [...newExperiences]; u[i].company_name = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//                   </FormField>
//                   <FormField label="Designation">
//                     <input placeholder="Job Title" value={exp.job_title} onChange={(e) => { const u = [...newExperiences]; u[i].job_title = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//                   </FormField>
//                   <FormField label="Location">
//                     <input placeholder="City" value={exp.location} onChange={(e) => { const u = [...newExperiences]; u[i].location = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//                   </FormField>
//                 </div>

//                 <div className="grid grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
//                   <FormField label="Start Date">
//                     <input type="date" value={exp.start_date} onChange={(e) => { const u = [...newExperiences]; u[i].start_date = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//                   </FormField>
//                   <FormField label="End Date">
//                     <input type="date" value={exp.end_date} onChange={(e) => { const u = [...newExperiences]; u[i].end_date = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//                   </FormField>
//                   <FormField label="Annual CTC">
//                     <div className="flex items-center bg-white border border-slate-200 rounded-2xl overflow-hidden focus-within:border-blue-500 transition-all">
//                       <div className="px-4 text-blue-600 font-black italic">â‚¹</div>
//                       <input type="number" placeholder="0.00" value={exp.previous_ctc} onChange={(e) => { const u = [...newExperiences]; u[i].previous_ctc = e.target.value; setNewExperiences(u); }} className="w-full py-3 bg-transparent text-[12px] font-bold outline-none" />
//                       <div className="pr-4 text-[9px] font-black text-slate-400 uppercase">LPA</div>
//                     </div>
//                   </FormField>
//                 </div>

//                 <FormField label="Professional Summary">
//                   <textarea rows={3} placeholder="Briefly describe your role..." value={exp.description} onChange={(e) => { const u = [...newExperiences]; u[i].description = e.target.value; setNewExperiences(u); }} className={inputStyle + " resize-none"} />
//                 </FormField>

//                 <div className="flex justify-end pt-4 border-t border-slate-100">
//                   <button
//                     type="button"
//                     onClick={() => handleSaveExperienceAPI(i)} 
//                     className="flex items-center gap-2 px-8 py-3 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl shadow-blue-200 transition-all hover:bg-blue-700"
//                   >
//                     <CheckCircle size={16} /> Save Record
//                   </button>
//                 </div>
//               </div>
//             ))}

//             <button
//               type="button"
//               onClick={() => setNewExperiences([...newExperiences, { company_name: "", job_title: "", start_date: "", end_date: "", previous_ctc: "", location: "", description: "" }])}
//               className="w-full py-8 border-2 border-dashed border-slate-200 rounded-[2.5rem] text-slate-400 hover:text-blue-600 transition-all text-[11px] font-black uppercase tracking-[0.3em]"
//             >
//               + Initialize New Entry Node
//             </button>
//           </div>

//           <div className="px-10 py-6 bg-slate-50 border-t border-slate-100 flex justify-between items-center">
//             <div className="flex items-center gap-2">
//                <ShieldCheck className="text-emerald-500" size={18} />
//                <span className="text-[9px] font-black text-slate-400 uppercase tracking-widest">Metadata Integrity Sync Active</span>
//             </div>
//             <div className="flex gap-4">
//               <button type="button" onClick={() => { setNewExperiences([]); setShowExpModal(false); }} className="px-8 py-4 text-slate-500 text-[10px] font-black uppercase hover:text-slate-900 transition-all">Discard</button>
//               <button 
//                 type="button" 
//                 onClick={() => {
//                   setFormData({ ...formData, experiences: [...formData.experiences, ...newExperiences] });
//                   setNewExperiences([]);
//                   setShowExpModal(false);
//                 }} 
//                 className="px-12 py-4 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase shadow-2xl active:scale-95 transition-all"
//               >Commit Nodes</button>
//             </div>
//           </div>
//         </div>
//       </div>
//     )} */}
//     {showExpModal && (
//   <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 md:p-8 bg-slate-900/60 backdrop-blur-md animate-in fade-in duration-300">
//     <div className="bg-white w-full max-w-6xl h-full max-h-[85vh] rounded-[3rem] shadow-2xl border border-slate-200 flex flex-col overflow-hidden animate-in zoom-in-95 duration-300">
      
//       {/* Modal Header */}
//       <div className="px-10 py-8 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
//         <div className="flex items-center gap-4">
//           <div className="w-14 h-14 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-xl shadow-blue-200">
//             <Plus size={28} strokeWidth={3} />
//           </div>
//           <div>
//             {/* <h2 className="text-base font-black text-slate-900 uppercase tracking-[0.2em]">New Experience</h2> */}
//             <h2 className="text-base font-black text-slate-900 uppercase tracking-[0.2em]">
//                 {currentEditingIndex !== null ? "Edit Experience" : "New Experience"}
//             </h2>
//             <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Add new Experience Records</p>
//           </div>
//         </div>
//         <button onClick={() => setShowExpModal(false)} className="w-12 h-12 flex items-center justify-center bg-white border border-slate-100 hover:bg-red-50 hover:text-red-500 rounded-full transition-all shadow-sm">
//           <X size={24} />
//         </button>
//       </div>

//       {/* Modal Content */}
//       <div className="flex-1 overflow-y-auto p-10 space-y-12 custom-scrollbar-professional bg-white">
//         {newExperiences.map((exp, i) => (
//           <div key={i} className="relative bg-slate-50/50 border border-slate-200 p-8 rounded-[2.5rem] space-y-8 animate-in slide-in-from-bottom-4 group hover:bg-white hover:border-blue-200 transition-all">
//             {/* Remove Entry */}
//             <button
//               type="button"
//               onClick={() => setNewExperiences(newExperiences.filter((_, idx) => idx !== i))}
//               className="absolute -top-3 -right-3 h-10 w-10 bg-white border border-slate-200 text-red-500 rounded-full flex items-center justify-center shadow-lg opacity-0 group-hover:opacity-100 transition-all z-20 hover:bg-red-500 hover:text-white"
//             >
//               <Trash2 size={18} />
//             </button>

//             {/* GRID 1: IDENTITY */}
//             <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
//               <FormField label="Employer">
//                 <input placeholder="Company Name" value={exp.company_name} onChange={(e) => { const u = [...newExperiences]; u[i].company_name = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//               </FormField>
//               <FormField label="Designation">
//                 <input placeholder="Job Title" value={exp.job_title} onChange={(e) => { const u = [...newExperiences]; u[i].job_title = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//               </FormField>
//               <FormField label="Location">
//                 <input placeholder="City" value={exp.location} onChange={(e) => { const u = [...newExperiences]; u[i].location = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//               </FormField>
//                {/* <FormField label="Industry">
//                 <input placeholder="Industry" value={exp.industry} onChange={(e) => { const u = [...newExperiences]; u[i].location = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//               </FormField> */}
//              <FormField label="Industry">
//   <div className="relative">

//     {/* INPUT BOX */}
//     <input
//       value={exp.industry || ""}
//       placeholder="Search or select industry..."
//       onFocus={() => setShowIndustryDrop(true)}
//       onChange={(e) => {
//         const value = e.target.value;
//         setIndustrySearch(value);

//         const u = [...newExperiences];
//         u[i].industry = value;
//         setNewExperiences(u);
//       }}
//       className={inputStyle}
//     />

//     {/* DROPDOWN */}
//     {showIndustryDrop && (
//       <div className="absolute z-50 mt-2 w-full bg-white border border-slate-200 rounded-xl shadow-lg overflow-hidden">

//         {/* LIST â€” SHOW 4 ITEMS HEIGHT */}
//         <div className="max-h-44 overflow-y-auto">

//           {filteredIndustries.length > 0 ? (
//             filteredIndustries.map((ind) => (
//               <div
//                 key={ind}
//                 onClick={() => {
//                   const u = [...newExperiences];
//                   u[i].industry = ind;
//                   setNewExperiences(u);

//                   setIndustrySearch("");
//                   setShowIndustryDrop(false);
//                 }}
//                 className="px-4 py-2 text-[13px] font-bold text-slate-700 hover:bg-blue-50 hover:text-blue-600 cursor-pointer transition"
//               >
//                 {ind}
//               </div>
//             ))
//           ) : (
//             <div className="px-4 py-3 text-xs text-slate-400">
//               No match found
//             </div>
//           )}
//         </div>
//       </div>
//     )}
//   </div>
// </FormField>


//             </div>

//             {/* GRID 2: TIMELINE & CTC */}
//             <div className="grid grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
//               <FormField label="Start Date">
//                 <input type="date" value={exp.start_date} onChange={(e) => { const u = [...newExperiences]; u[i].start_date = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//               </FormField>
//               <FormField label="End Date">
//                 <input type="date" value={exp.end_date} onChange={(e) => { const u = [...newExperiences]; u[i].end_date = e.target.value; setNewExperiences(u); }} className={inputStyle} />
//               </FormField>
//               <FormField label="Annual CTC">
//                 <div className="flex items-center bg-white border border-slate-200 rounded-2xl overflow-hidden focus-within:border-blue-500 transition-all">
//                   <div className="px-4 text-blue-600 font-black italic">â‚¹</div>
//                   <input type="number" placeholder="0.00" value={exp.previous_ctc} onChange={(e) => { const u = [...newExperiences]; u[i].previous_ctc = e.target.value; setNewExperiences(u); }} className="w-full py-3 bg-transparent text-[12px] font-bold outline-none" />
//                   <div className="pr-4 text-[9px] font-black text-slate-400">LPA</div>
//                 </div>
//               </FormField>
//             </div>

//             {/* GRID 3: DESCRIPTION & ARTIFACT UPLOAD */}
//             <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
//               <FormField label="Professional Summary">
//                 <textarea rows={4} placeholder="Briefly describe your role..." value={exp.description} onChange={(e) => { const u = [...newExperiences]; u[i].description = e.target.value; setNewExperiences(u); }} className={inputStyle + " resize-none"} />
//               </FormField>
              
//               <div className="space-y-4">
//                 <div className="flex justify-between items-center px-1">
//                   <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Experience Artifact</p>
//                   <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200 scale-90">
//                     <button
//                       type="button"
//                       onClick={() => { const u = [...newExperiences]; u[i].uploadMode = "file"; setNewExperiences(u); }}
//                       className={`px-4 py-1 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode !== "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                     >FILE</button>
//                     <button
//                       type="button"
//                       onClick={() => { const u = [...newExperiences]; u[i].uploadMode = "link"; setNewExperiences(u); }}
//                       className={`px-4 py-1 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                     >URL</button>
//                   </div>
//                 </div>

//                 <div className="bg-white/50 border-2 border-dashed border-slate-200 rounded-[2rem] p-6 min-h-[140px] flex flex-col justify-center items-center group/upload hover:bg-blue-50/30 transition-all">
//                   {exp.uploadMode !== "link" ? (
//                     <label className="flex flex-col items-center cursor-pointer w-full">
//                       <FileUp size={24} className="text-slate-300 group-hover/upload:text-blue-500 mb-2 transition-colors" />
//                       <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest text-center px-4">
//                         {exp.expLetterFile ? exp.expLetterFile.name : "Select Validation PDF"}
//                       </span>
//                       <input 
//                         type="file" 
//                         accept=".pdf" 
//                         className="hidden" 
//                         onChange={(e) => { const u = [...newExperiences]; u[i].expLetterFile = e.target.files[0]; setNewExperiences(u); }} 
//                       />
//                     </label>
//                   ) : (
//                     <div className="w-full px-4 relative">
//                       <LinkIcon size={16} className="absolute left-7 top-1/2 -translate-y-1/2 text-slate-300" />
//                       <input 
//                         placeholder="Public Storage URI (https://...)" 
//                         value={exp.exp_letter_link || ""} 
//                         onChange={(e) => { const u = [...newExperiences]; u[i].exp_letter_link = e.target.value; setNewExperiences(u); }} 
//                         className={inputStyle + " pl-12"} 
//                       />
//                     </div>
//                   )}
//                 </div>
//               </div>
//             </div>

//             {/* SAVE ACTION */}
//             <div className="flex justify-end pt-4 border-t border-slate-100">
//               <button
//                 type="button"
//                 // onClick={() => handleSaveExperienceAPI(i)} 
//                 onClick={() => handleSaveOrUpdateExperience(i)}
//                 className="flex items-center gap-2 px-8 py-3 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl shadow-blue-200 transition-all hover:bg-blue-700 active:scale-95"
//               >
//                 {/* <CheckCircle size={16} /> Save */}
//                 <CheckCircle size={16} />
// {currentEditingIndex !== null ? "Update" : "Save"}

//               </button>
//             </div>
//           </div>
//         ))}

//         {/* <button
//           type="button"
//           onClick={() => setNewExperiences([...newExperiences, { company_name: "", job_title: "", start_date: "", end_date: "", previous_ctc: "", location: "", description: "", uploadMode: "file", expLetterFile: null, exp_letter_link: "", candidate_id: effectiveId, }])}
//           className="w-full py-8 border-2 border-dashed border-slate-400 rounded-[2.5rem] text-slate-500 hover:text-blue-600 hover:border-blue-200 hover:bg-blue-50/20 transition-all text-[11px] font-black uppercase tracking-[0.3em]"
//         >
//          + Add New Row
//         </button> */}
//         {currentEditingIndex === null && (
//   <button
//     type="button"
//     onClick={() =>
//       setNewExperiences([
//         ...newExperiences,
//         {
//           company_name: "",
//           job_title: "",
//           start_date: "",
//           end_date: "",
//           previous_ctc: "",
//           location: "",
//           description: "",
//           industry: "",
//           uploadMode: "file",
//           expLetterFile: null,
//           exp_letter_link: "",
//           candidate_id: effectiveId,
//         },
//       ])
//     }
//     className="w-full py-8 border-2 border-dashed border-slate-400 rounded-[2.5rem] text-slate-500 hover:text-blue-600 hover:border-blue-200 hover:bg-blue-50/20 transition-all text-[11px] font-black uppercase tracking-[0.3em]"
//   >
//     + Add New Row
//   </button>
// )}

//       </div>

//       {/* Modal Footer */}
//       {/* <div className="px-10 py-6 bg-slate-50 border-t border-slate-100 flex justify-between items-center">
//         <div className="flex items-center gap-2">
//            <ShieldCheck className="text-emerald-500" size={18} />
//            <span className="text-[9px] font-black text-slate-400 uppercase tracking-widest">Metadata Integrity Sync Active</span>
//         </div>
//         <div className="flex gap-4">
//           <button type="button" onClick={() => { setNewExperiences([]); setShowExpModal(false); }} className="px-8 py-4 text-slate-500 text-[10px] font-black uppercase tracking-widest hover:text-slate-900 transition-all">Discard</button>
//           <button 
//             type="button" 
//             onClick={() => {
//               setFormData({ ...formData, experiences: [...formData.experiences, ...newExperiences] });
//               setNewExperiences([]);
//               setShowExpModal(false);
//             }} 
//             className="px-12 py-4 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase shadow-2xl active:scale-95 transition-all"
//           >Commit Changes</button>
//         </div>
//       </div> */}
//     </div>
//   </div>
// )} 
//   </div>
// )}


//             {/* STEP 4: INVENTORY */}
//             {step === 4 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 overflow-visible">
//                 <div className="bg-white border border-slate-200 rounded-[3.5rem] shadow-xl overflow-visible shadow-slate-200/50">
//                   <div className="bg-slate-50/50 px-10 py-6 border-b border-slate-200 flex items-center justify-between rounded-t-[3.5rem]">
//                     <div className="flex items-center gap-4">
//                       <div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg">
//                         <Cpu size={20} />
//                       </div>
//                       <div>
//                         <h3 className="text-sm font-black text-slate-900 uppercase tracking-widest leading-none">
//                           Skills & Assets
//                         </h3>
//                       </div>
//                     </div>
//                   </div>
//                   <div className="p-8 md:p-12 space-y-12 overflow-visible">
//                     <FormField label="Skills">
//                       <div className="space-y-6">
//                         <div className="flex flex-col sm:flex-row gap-4 items-end">
//                           <div className="relative max-w-md w-full">
//                             <Plus
//                               size={16}
//                               className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                             />
//                             <input
//                               value={skillInput}
//                               onChange={(e) => setSkillInput(e.target.value)}
//                               onKeyDown={(e) => {
//                                 if (e.key === "Enter") {
//                                   e.preventDefault();
//                                   const name = skillInput.trim();
//                                   if (!name) return;

//                                   // prevent duplicate
//                                   if (!formData.skills.includes(name)) {
//                                     setFormData((prev) => ({
//                                       ...prev,
//                                       skills: [...prev.skills, name],
//                                     }));
//                                   }

//                                   setSkillInput("");
//                                 }
//                               }}
//                               placeholder="Register skill..."
//                               className={inputStyle + " pl-12"}
//                             />
//                           </div>
//                         </div>

//                         <div className="flex flex-wrap gap-3 p-1 w-full min-h-[40px]">
//                           {[
//                             ...new Set([...dynamicSkills, ...formData.skills]),
//                           ].map((skill) => {
//                             const isSelected = formData.skills.includes(skill);

//                             return (
//                               <button
//                                 key={skill}
//                                 type="button"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     skills: isSelected
//                                       ? formData.skills.filter(
//                                           (s) => s !== skill,
//                                         )
//                                       : [...formData.skills, skill],
//                                   })
//                                 }
//                                 className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${
//                                   isSelected
//                                     ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200"
//                                     : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"
//                                 }`}
//                               >
//                                 {skill}
//                                 {isSelected && (
//                                   <Check size={14} strokeWidth={3} />
//                                 )}
//                               </button>
//                             );
//                           })}
//                         </div>
//                       </div>
//                     </FormField>
//                     {/* <FormField label="Enterprise Hardware Matrix"><div className="space-y-6 pt-8 border-t border-slate-100"><div className="relative max-w-md w-full"><Layers size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={assetInput} onChange={(e) => setAssetInput(e.target.value)} onKeyDown={async (e) => { if(e.key === 'Enter') { e.preventDefault(); const v = assetInput.trim(); if(v && !formData.assets.includes(v)) { const ok = await handleAddAssetAPI(v); if(ok) { setFormData({...formData, assets: [...formData.assets, v]}); setAssetInput(""); } } } }} placeholder="Link hardware..." className={inputStyle + " pl-12"} /></div><div className="flex flex-wrap gap-3 p-1">{dynamicAssets.map((asset) => { const isSelected = formData.assets.includes(asset); return (<button key={asset} type="button" onClick={async () => { if(!isSelected) { const ok = await handleAddAssetAPI(asset); if(ok) setFormData({...formData, assets: [...formData.assets, asset]}); } else { setFormData({...formData, assets: formData.assets.filter(a => a !== asset)}); } }} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${isSelected ? "bg-slate-900 border-slate-900 text-white shadow-lg shadow-slate-200" : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`}>{asset} {isSelected && <Check size={14} strokeWidth={3} className="animate-in zoom-in" />}</button>); })}</div></div></FormField> */}
//                     <div className="space-y-6 pt-8 border-t border-slate-100">
//                       <FormField label="Assets">
//                         <div className="space-y-6">
//                           {/* Search & Manual Add Input */}
//                           <div className="relative max-w-md">
//                             <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">
//                               <Layers size={16} />
//                             </div>
//                             <input
//                               value={assetInput}
//                               onChange={(e) => setAssetInput(e.target.value)}
                              
//                               onKeyDown={(e) => {
//                                 if (e.key === "Enter") {
//                                   e.preventDefault();
//                                   const v = assetInput.trim();
//                                   if (!v) return;

//                                   // Prevent duplicate
//                                   if (!formData.assets.includes(v)) {
//                                     setFormData((prev) => ({
//                                       ...prev,
//                                       assets: [...prev.assets, v],
//                                     }));
//                                   }

//                                   setAssetInput("");
//                                 }
//                               }}
//                               placeholder="Type hardware name and press Enter..."
//                               className="w-full pl-12 pr-4 py-3.5 bg-slate-50 border border-slate-200 rounded-2xl text-xs font-bold outline-none focus:bg-white focus:border-slate-900 focus:ring-4 focus:ring-slate-900/5 transition-all shadow-inner"
//                             />
//                           </div>

//                           <div className="flex flex-wrap gap-3 p-1 w-full min-h-[40px]">
//                             {[
//                               ...new Set([
//                                 ...dynamicAssets,
//                                 ...formData.assets,
//                               ]),
//                             ].filter(
//                               (a) => typeof a === "string" && a.trim() !== "",
//                             ).length === 0 ? (
//                               /* âŒ NO ASSETS */
//                               <div className="w-full text-center py-6 bg-slate-50 border border-dashed border-slate-200 rounded-2xl">
//                                 <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">
//                                   No assets available
//                                 </p>
//                               </div>
//                             ) : (
//                               /* âœ… ASSET CHIPS */
//                               [
//                                 ...new Set([
//                                   ...dynamicAssets,
//                                   ...formData.assets,
//                                 ]),
//                               ]
//                                 .filter(
//                                   (a) =>
//                                     typeof a === "string" && a.trim() !== "",
//                                 )
//                                 .map((asset) => {
//                                   const isSelected =
//                                     formData.assets.includes(asset);

//                                   return (
//                                     <button
//                                       key={asset}
//                                       type="button"
//                                       onClick={() =>
//                                         setFormData((prev) => ({
//                                           ...prev,
//                                           assets: isSelected
//                                             ? prev.assets.filter(
//                                                 (a) => a !== asset,
//                                               )
//                                             : [...prev.assets, asset],
//                                         }))
//                                       }
//                                       className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90
//             ${
//               isSelected
//                 ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200"
//                 : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"
//             }`}
//                                     >
//                                       {asset}
//                                       {isSelected && (
//                                         <Check size={14} strokeWidth={3} />
//                                       )}
//                                     </button>
//                                   );
//                                 })
//                             )}
//                           </div>
//                         </div>
//                       </FormField>
//                     </div>
//                   </div>
//                 </div>
//                 <div className="flex justify-between items-center pt-4">
//                   <button
//                     onClick={() => setStep(3)}
//                     type="button"
//                     className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[11px] font-black uppercase transition-all shadow-sm hover:text-slate-900 flex items-center gap-2 transition-all"
//                   >
//                     <ChevronLeft size={16} /> Back
//                   </button>

//                   <button
//                     onClick={async () => {
//                       await saveStepData(4);
//                       setStep(5);
//                     }}
//                     type="button"
//                     className="px-12 py-4 bg-blue-600 text-white rounded-xl text-[11px] font-black uppercase shadow-xl active:scale-95 transition-all flex items-center gap-2 whitespace-nowrap"
//                   >
//                     Next Phase <ChevronRight size={14} />
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 5: DOCUMENT VAULT */}

//             {step === 5 && (
//               <div className="space-y-8 animate-in slide-in-from-bottom-8 duration-500">
//                 <div className="bg-white rounded-[2rem] shadow-2xl shadow-slate-200/50 border border-slate-200 overflow-hidden relative">
//                   {/* SECTION HEADER: Enterprise Indigo Theme */}
//                   <div className="bg-slate-50 px-8 py-6 border-b border-slate-200 flex items-center justify-between">
//                     <div className="flex items-center gap-5">
//                       <div className="h-12 w-12 bg-slate-900 rounded-2xl flex items-center justify-center text-white shadow-lg">
//                         <ShieldCheck size={24} />
//                       </div>
//                       <div>
//                         <h3 className="text-lg font-bold text-slate-900 tracking-tight">
//                           Document upload
//                         </h3>
//                         <p className="text-[11px] font-semibold text-slate-500 uppercase tracking-widest">
//                           Document Verification
//                         </p>
//                       </div>
//                     </div>
//                     <div className="hidden md:flex items-center gap-2 px-4 py-1.5 bg-blue-50 border border-blue-100 rounded-full">
//                       <div className="h-1.5 w-1.5 rounded-full bg-blue-500 animate-pulse" />
//                       <span className="text-[10px] font-bold text-blue-600 uppercase tracking-tighter">
//                         ready to save
//                       </span>
//                     </div>
//                   </div>

//                   <div className="p-8 md:p-12 space-y-12">
//                     <div className="grid grid-cols-1 lg:grid-cols-2 gap-12">
//                       {/* 1. MASTER RESUME SECTION */}
//                       <div className="space-y-6">
//                         <div className="flex justify-between items-center px-1">
//                           <div className="flex items-center gap-2">
//                             <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">
//                               01. Resume
//                             </span>
//                           </div>
//                           <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200 scale-90">
//                             <button
//                               type="button"
//                               onClick={() => setResumeMode("file")}
//                               className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === "file" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500 hover:text-slate-700"}`}
//                             >
//                               FILE
//                             </button>
//                             <button
//                               type="button"
//                               onClick={() => setResumeMode("link")}
//                               className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                             >
//                               URL
//                             </button>
//                           </div>
//                         </div>

//                         {resumeMode === "file" ? (
//                           <label className="flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-slate-200 rounded-3xl bg-slate-50/50 hover:bg-white hover:border-blue-500 transition-all cursor-pointer group">
//                             <div className="flex flex-col items-center gap-3">
//                               <div className="p-4 bg-white rounded-2xl shadow-sm border border-slate-100 group-hover:scale-110 transition-transform duration-500">
//                                 <FileUp
//                                   size={28}
//                                   className="text-slate-400 group-hover:text-blue-500"
//                                 />
//                               </div>
//                               <span className="text-[11px] font-bold text-slate-500 uppercase tracking-widest">
//                                 {formData.cvFile
//                                   ? formData.cvFile.name
//                                   : existingResume
//                                     ? "Existing Resume Available"
//                                     : "Commit Resume PDF"}
//                               </span>

//                               {/* VIEW EXISTING RESUME */}
//                               {existingResume && !formData.cvFile && (
//                                 <a
//                                   href={fixResumeUrl2(existingResume)}
//                                   target="_blank"
//                                   rel="noreferrer"
//                                   className="text-blue-600 text-xs underline mt-1"
//                                 >
//                                   View Current Resume
//                                 </a>
//                               )}
//                             </div>
//                             <input
//                               type="file"
//                               accept=".pdf"
//                               className="hidden"
//                               onChange={(e) =>
//                                 setFormData({
//                                   ...formData,
//                                   cvFile: e.target.files[0],
//                                   resume_link: "",
//                                 })
//                               }
//                             />
//                           </label>
//                         ) : (
//                           <div className="relative">
//                             <LinkIcon
//                               size={18}
//                               className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                             />
//                             <input
//                               placeholder="Enter Public Storage URI..."
//                               value={formData.resume_link}
//                               onChange={(e) =>
//                                 setFormData({
//                                   ...formData,
//                                   resume_link: e.target.value,
//                                   cvFile: null,
//                                 })
//                               }
//                               className={inputStyle + " pl-12"}
//                             />
//                           </div>
//                         )}
//                       </div>

//                       {/* 2. CREDENTIALS MATRIX SECTION */}
//                       <div className="space-y-6">
//                         <div className="flex justify-between items-center px-1">
//                           <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">
//                             02. certificate
//                           </span>
//                           <div className="flex gap-2">
//                             <label className="cursor-pointer h-10 w-10 bg-slate-900 text-white rounded-xl hover:bg-blue-600 active:scale-90 transition-all flex items-center justify-center shadow-lg shadow-slate-200">
//                               <Plus size={18} />
//                               <input
//                                 type="file"
//                                 multiple
//                                 accept=".pdf"
//                                 className="hidden"
//                                 onChange={(e) =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateFiles: [
//                                       ...formData.certificateFiles,
//                                       ...Array.from(e.target.files),
//                                     ],
//                                   })
//                                 }
//                               />
//                             </label>
//                             <button
//                               type="button"
//                               onClick={() =>
//                                 setFormData({
//                                   ...formData,
//                                   certificateLinks: [
//                                     ...formData.certificateLinks,
//                                     "",
//                                   ],
//                                 })
//                               }
//                               className="h-10 w-10 bg-white text-slate-600 rounded-xl border border-slate-200 hover:border-blue-500 hover:text-blue-500 active:scale-90 transition-all flex items-center justify-center shadow-sm"
//                             >
//                               <LinkIcon size={18} />
//                             </button>
//                           </div>
//                         </div>

//                         <div className="grid grid-cols-1 gap-4 max-h-[220px] overflow-y-auto no-scrollbar pr-1">
//                           {/* EXISTING CERTIFICATES FROM SERVER */}
//                           {existingCertificates.map((url, idx) => (
//                             <div
//                               key={`existing-${idx}`}
//                               className="flex justify-between items-center bg-blue-50 p-4 rounded-2xl border border-blue-100"
//                             >
//                               <div className="flex items-center gap-3">
//                                 <div className="h-2 w-2 rounded-full bg-blue-500" />

//                                 <a
//                                   href={url}
//                                   target="_blank"
//                                   rel="noreferrer"
//                                   className="text-[12px] font-bold text-blue-700 underline truncate max-w-[200px]"
//                                 >
//                                   Existing Certificate {idx + 1}
//                                 </a>
//                               </div>

//                               <X
//                                 size={16}
//                                 className="text-red-400 hover:text-red-600 cursor-pointer"
//                                 onClick={() =>
//                                   setExistingCertificates((prev) =>
//                                     prev.filter((_, i) => i !== idx),
//                                   )
//                                 }
//                               />
//                             </div>
//                           ))}

//                           {formData.certificateFiles.map((file, idx) => (
//                             <div
//                               key={idx}
//                               className="flex justify-between items-center bg-slate-50 p-4 rounded-2xl border border-slate-100 hover:border-blue-300 transition-colors"
//                             >
//                               <div className="flex items-center gap-3">
//                                 <div className="h-2 w-2 rounded-full bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)]" />
//                                 <span className="text-[12px] font-bold text-slate-700 truncate max-w-[200px]">
//                                   {file.name}
//                                 </span>
//                               </div>
//                               <X
//                                 size={16}
//                                 className="text-slate-300 hover:text-red-500 cursor-pointer transition-all hover:rotate-90"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateFiles:
//                                       formData.certificateFiles.filter(
//                                         (_, i) => i !== idx,
//                                       ),
//                                   })
//                                 }
//                               />
//                             </div>
//                           ))}
//                           {formData.certificateLinks.map((link, idx) => (
//                             <div
//                               key={idx}
//                               className="flex gap-3 animate-in slide-in-from-right-4"
//                             >
//                               <div className="relative flex-1">
//                                 <Globe
//                                   size={16}
//                                   className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                                 />
//                                 <input
//                                   value={link}
//                                   placeholder="Public URI..."
//                                   onChange={(e) => {
//                                     const u = [...formData.certificateLinks];
//                                     u[idx] = e.target.value;
//                                     setFormData({
//                                       ...formData,
//                                       certificateLinks: u,
//                                     });
//                                   }}
//                                   className={inputStyle + " pl-11 !py-2.5"}
//                                 />
//                               </div>
//                               <button
//                                 type="button"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateLinks:
//                                       formData.certificateLinks.filter(
//                                         (_, i) => i !== idx,
//                                       ),
//                                   })
//                                 }
//                                 className="text-slate-300 hover:text-red-500 bg-slate-50 h-10 w-10 rounded-xl border border-slate-200 flex items-center justify-center"
//                               >
//                                 <Trash2 size={16} />
//                               </button>
//                             </div>
//                           ))}
//                           {formData.certificateFiles.length === 0 &&
//                             formData.certificateLinks.filter((l) => l)
//                               .length === 0 && (
//                               <div className="py-8 text-center bg-slate-50/50 border border-dashed border-slate-200 rounded-2xl">
//                                 <p className="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">
//                                   No secondary artifacts registered
//                                 </p>
//                               </div>
//                             )}
//                         </div>
//                       </div>
//                     </div>

//                     {/* METADATA INFO CARD */}
//                     <div className="bg-slate-50 rounded-3xl p-6 flex flex-col md:flex-row items-center justify-between gap-6 ">
//                       <div className="flex items-center gap-4">
//                         <div className="h-10 w-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400">
//                           <History size={20} />
//                         </div>
//                         <div>
//                           <p className="text-slate-800 text-xs font-bold tracking-wide uppercase">
//                              Final Review
//                           </p>
//                           <p className="text-slate-400 text-[10px] uppercase font-semibold tracking-tighter">
//                             Employee Id {effectiveId} â€¢ Ready to submit
//                           </p>
//                         </div>
//                       </div>
//                       <button
//                         // type="submit"
//                         type="button" 
//                         // onClick={handleSubmit}
//                         onClick={async () => {
//                           setLoading(true);

//                           await saveStepData(5); // ðŸ”¥ FINAL API CALL HERE

//                           setLoading(false);

//                           toast.success("Candidate Saved âœ”");

//                           navigate("/candidate"); // redirect after save
//                         }}
//                         className="w-full md:w-auto px-10 py-3.5 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl text-[11px] font-black uppercase tracking-widest transition-all shadow-xl shadow-blue-600/20 active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3"
//                       >
//                         {loading ? (
//                           <Loader2 className="animate-spin" size={18} />
//                         ) : (
//                           <>
//                             <Database size={18} />
//                             <span>Submit data</span>
//                           </>
//                         )}
//                       </button>
//                     </div>
//                   </div>

//                   {/* FOOTER ACTIONS */}
//                   <div className="flex justify-center pt-2 pb-8">
//                     <button
//                       type="button"
//                       onClick={() => setStep(4)}
//                       className="text-[10px] font-bold text-slate-400 uppercase tracking-widest hover:text-slate-900 transition-colors flex items-center gap-2 group"
//                     >
//                       <ChevronLeft
//                         size={16}
//                         className="group-hover:-translate-x-1 transition-transform"
//                       />
//                       Return to back page
//                     </button>
//                   </div>
//                 </div>
//               </div>
//             )}
//           </div>
//         </form>
//       </div>
//       <style
//         dangerouslySetInnerHTML={{
//           __html: `.custom-scrollbar-professional::-webkit-scrollbar { width: 6px; }.custom-scrollbar-professional::-webkit-scrollbar-track { background: transparent; }.custom-scrollbar-professional::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 20px; }.custom-scrollbar-professional::-webkit-scrollbar-thumb:hover { background: #CBD5E1; }`,
//         }}
//       />
//     </div>
//   );
// };

// export default ManualEntryPage;
//********************************************************working cdoe phase 2 19/02/26*************************************************************** */
// import React, { useState, useEffect, useRef } from "react";
// import { useParams, useNavigate } from "react-router-dom";
// import {
//   Check,
//   Award,
//   User,
//   Briefcase,
//   MapPin,
//   Loader2,
//   Plus,
//   Trash2,
//   Layers,
//   Cpu,
//   Database,
//   Globe,
//   ShieldCheck,
//   History,
//   X,
//   Edit3,
//   LinkIcon,
//   FileUp,
//   ChevronRight,
//   ChevronLeft,
//   ChevronDown,
// } from "lucide-react";
// import toast from "react-hot-toast";
// import { candidateService } from "../../services/candidateService";
// import { departmentService } from "../../services/department.service";

// const FormField = ({ label, required, error, children }) => (
//   <div className="space-y-1 w-full">
//     <label className="text-[10px] md:text-[11px] font-black text-slate-500 uppercase tracking-widest ml-1 flex justify-between items-center">
//       <span>{label}</span>
//       <span
//         className={`font-bold normal-case ${required ? "text-red-500" : "text-slate-300"}`}
//       >
//         {required ? "Required" : "Optional"}
//       </span>
//     </label>
//     {children}
//     {error && (
//       <p className="text-[9px] text-red-500 font-bold uppercase tracking-tighter ml-1">
//         {error}
//       </p>
//     )}
//   </div>
// );

// const ManualEntryPage = () => {
//   const { id } = useParams();
//   const navigate = useNavigate();
//   const effectiveId = id || "666";
//   const ASSET_OPTIONS = [
//     "Laptop",
//     "Mouse",
//     "Keyboard",
//     "Monitor",
//     "Headset",
//     "Mobile",
//     "ID Card",
//     "SIM Card",
//   ];
//   // Professional Enterprise Input Style
//   const inputStyle =
//     "w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-[13px] font-bold outline-none focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-500/5 transition-all shadow-sm";

//   // 1. INITIALIZE ALL STATES
//   const [step, setStep] = useState(1);
//   const [loading, setLoading] = useState(false);
//   const [fetchingData, setFetchingData] = useState(false);
//   const [errors, setErrors] = useState({});
//   const [isFetchingPincode, setIsFetchingPincode] = useState(false);
//   const [cityOptions, setCityOptions] = useState([]);
//   const [resumeMode, setResumeMode] = useState("file");
//   const [skillInput, setSkillInput] = useState("");
//   const [assetInput, setAssetInput] = useState("");
//   const [isFresher, setIsFresher] = useState(null);
//   const [deptSearch, setDeptSearch] = useState("");
//   const [eduSearch, setEduSearch] = useState("");
//   const [dynamicSkills, setDynamicSkills] = useState([]);
//   const [existingResume, setExistingResume] = useState("");

//   const [dynamicAssets, setDynamicAssets] = useState([]);
//   const [showSkillDrop, setShowSkillDrop] = useState(false);
//   const [showAssetDrop, setShowAssetDrop] = useState(false);
//   const [skillFocused, setSkillFocused] = useState(false);
//   const [departments, setDepartments] = useState([]);
//   const dropdownContainerRef = useRef(null);
//   const [existingCertificates, setExistingCertificates] = useState([]);
//   const [editingCertId, setEditingCertId] = useState(null);
//   const [editingCertValue, setEditingCertValue] = useState("");


//   const careerStepRef = useRef(null);

//   const [formData, setFormData] = useState({
//     name: "",
//     email: "",
//     phone: "",
//     address: "",
//     address2: "",
//     location: "",
//     pincode: "",
//     state: "",
//     city: "",
//     district: "",
//     country: "India",
//     position: "",
//     education: "",
//     gender: "",
//     dob: "",
//     experience: "",
//     about_me: "",
//     languages_spoken: [],
//     skills: [],
//     assets: [],
//     department: "",
//     cvFile: null,
//     resume_link: "",
//     certificateFiles: [],
//     certificateLinks: [""],
//     experiences: [],
//   });

//   const totalSteps = 5;

//   const educationOptions = [
//     "SSC / 10th",
//     "HSC / 12th",
//     "ITI",
//     "Diploma",
//     "Polytechnic",

//     "B.A",
//     "B.Com",
//     "B.Sc",
//     "BCA",
//     "BBA",
//     "B.Tech",
//     "BE",
//     "B.Pharm",
//     "B.Ed",

//     "M.A",
//     "M.Com",
//     "M.Sc",
//     "MCA",
//     "MBA",
//     "M.Tech",
//     "ME",
//     "M.Pharm",
//     "M.Ed",

//     "PGDM",
//     "Post Graduate Diploma",

//     "PhD / Doctorate",
//   ];

//   const POSITION_OPTIONS = [
//     // IT / Software
//     "Frontend Developer",
//     "Backend Developer",
//     "Full Stack Developer",
//     "Software Engineer",
//     "Senior Software Engineer",
//     "Lead Developer",
//     "DevOps Engineer",
//     "QA Engineer",
//     "Automation Tester",
//     "Manual Tester",
//     "UI/UX Designer",
//     "Mobile App Developer",
//     "Android Developer",
//     "iOS Developer",
//     "Data Analyst",
//     "Data Scientist",
//     "Machine Learning Engineer",
//     "AI Engineer",
//     "Cloud Engineer",
//     "System Administrator",
//     "Network Engineer",
//     "Cyber Security Analyst",

//     // Management / Office
//     "Project Manager",
//     "Product Manager",
//     "Operations Manager",
//     "Team Lead",
//     "Business Analyst",
//     "HR Executive",
//     "HR Manager",
//     "Recruiter",
//     "Office Administrator",

//     // Non-IT / General
//     "Accountant",
//     "Finance Executive",
//     "Sales Executive",
//     "Marketing Executive",
//     "Digital Marketing Specialist",
//     "Customer Support Executive",
//     "Technical Support Engineer",
//     "Field Executive",
//     "Supervisor",
//     "Store Manager",
//     "Warehouse Executive",

//     // Fresher / Entry
//     "Intern",
//     "Trainee",
//     "Graduate Engineer Trainee",
//     "Apprentice",
//   ];

//   const filteredEducation = educationOptions.filter((e) =>
//     e.toLowerCase().includes(eduSearch.toLowerCase()),
//   );
//   const filteredDepartments = departments.filter((d) =>
//     (d.name || "").toLowerCase().includes(deptSearch.toLowerCase()),
//   );
//   const isStep1Valid =
//     formData.name && /^\S+@\S+\.\S+$/.test(formData.email) && formData.phone;

//   // 2. HYDRATION LOGIC (GET API)
//   useEffect(() => {
//     const hydrateNode = async () => {
//       setFetchingData(true);
//       try {
//         const response = await fetch(
//           `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//         );
//         if (!response.ok) throw new Error();
//         const data = await response.json();

//         if (data) {
//           setExistingResume(data.resume_path || "");

//           setExistingCertificates(
//             Array.isArray(data.certificates) ? data.certificates : [],
//           );

//           const safeParse = (value) => {
//             if (!value) return [];

//             try {
//               // Already array â†’ fix broken JSON pieces
//               if (Array.isArray(value)) {
//                 const joined = value.join("");
//                 if (joined.startsWith("[")) {
//                   return JSON.parse(joined);
//                 }
//                 return value;
//               }

//               // If string JSON
//               if (typeof value === "string" && value.startsWith("[")) {
//                 return JSON.parse(value);
//               }

//               // If CSV string â†’ convert to array
//               if (typeof value === "string") {
//                 return value
//                   .split(",")
//                   .map((s) => s.trim())
//                   .filter(Boolean);
//               }

//               return [];
//             } catch {
//               return [];
//             }
//           };

//           setFormData((prev) => ({
//             ...prev,
//             name: data.full_name || "",
//             email: data.email || "",
//             phone: data.phone || "",
//             gender: data.gender || "",
//             dob: data.dob || "",
//             address: data.address || "",
//             address2: data.address2 || "",
//             location: data.location || "",
//             pincode: data.pincode || "",
//             city: data.city || "",
//             state: data.state || "",
//             district: data.district || "",
//             country: data.country || "India",
//             position: data.position || "",
//             experience: data.experience || "",
//             education: data.education || "",
//             department: data.department || "",
//             about_me: data.about_me || "",
//             resume_link: data.resume_path || "",
//             languages_spoken: safeParse(data.languages_spoken),
//             experiences: data.experiences || [],
//             skills: safeParse(data.skills),
//             assets: safeParse(data.assets),
//           }));

//           setIsFresher(!data.experiences || data.experiences.length === 0);
//         }

//         const deptData = await departmentService.getAll();
//         setDepartments(deptData || []);
//         await fetchSkills();
//         await fetchAssets(effectiveId);
//       } catch (err) {
//         console.warn("Initializing Empty Node");
//       } finally {
//         setFetchingData(false);
//       }
//     };
//     hydrateNode();
//   }, [effectiveId]);

//   // Click Outside to close dropdowns
//   useEffect(() => {
//     const handleClickOutside = (event) => {
//       if (
//         dropdownContainerRef.current &&
//         !dropdownContainerRef.current.contains(event.target)
//       ) {
//         setShowSkillDrop(false);
//         setShowAssetDrop(false);
//         setSkillFocused(false);
//       }
//     };
//     document.addEventListener("mousedown", handleClickOutside);
//     return () => document.removeEventListener("mousedown", handleClickOutside);
//   }, []);

//   // 3. HANDLERS
//   const fetchSkills = async () => {
//     try {
//       const res = await fetch(
//         "https://apihrr.goelectronix.co.in/masters/skills",
//       );
//       const data = await res.json();
//       setDynamicSkills(data.map((item) => item.name || item));
//     } catch {}
//   };

//   const fetchAssets = async (cId) => {
//     try {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${cId}/assets`,
//       );
//       const data = await res.json();
//       setDynamicAssets(Array.isArray(data) ? data.map((a) => a.name) : []);
//     } catch {}
//   };

//   const handleManualAddSkill = async () => {
//     const name = skillInput.trim();
//     if (!name) {
//       await fetchSkills();
//       return;
//     }
//     const success = await handleCreateMaster("skills", name);
//     if (success) {
//       if (!formData.skills.includes(name))
//         setFormData((p) => ({ ...p, skills: [...p.skills, name] }));
//       setSkillInput("");
//       await fetchSkills();
//     }
//   };

//   const handleCreateMaster = async (type, name) => {
//     try {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/masters/${type}`,
//         {
//           method: "POST",
//           headers: { "Content-Type": "application/json" },
//           body: JSON.stringify({ name: name.trim() }),
//         },
//       );
//       return res.ok;
//     } catch {
//       return false;
//     }
//   };

//   const handleAddAssetAPI = async (assetName) => {
//     if (!assetName.trim()) return;
//     const loadingToast = toast.loading(`Linking asset...`);
//     try {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/assets`,
//         {
//           method: "POST",
//           headers: { "Content-Type": "application/json" },
//           body: JSON.stringify({ name: assetName.trim() }),
//         },
//       );
//       if (res.ok) {
//         toast.success("Linked", { id: loadingToast });
//         await fetchAssets(effectiveId);
//         return true;
//       }
//     } catch {
//       toast.error("Sync failed", { id: loadingToast });
//     }
//     return false;
//   };

//   const handleSaveExperienceAPI = async (i) => {
//     console.log(formData);
//     const exp = formData.experiences[i];

//     if (
//       !exp.company_name?.trim() ||
//       !exp.job_title?.trim() ||
//       !exp.start_date ||
//       !exp.end_date
//     ) {
//       toast.error("Required: Company, Role, Start Date, End Date");
//       return;
//     }

//     const loadingToast = toast.loading("Saving experience...");

//     try {
//       const fd = new FormData();

//       // Required
//       fd.append("company_name", exp.company_name);
//       fd.append("job_title", exp.job_title);
//       fd.append("start_date", exp.start_date);
//       fd.append("end_date", exp.end_date);

//       // Optional (send empty safely)
//       fd.append(
//         "previous_ctc",
//         exp.previous_ctc ? Number(exp.previous_ctc) : "",
//       );

//       fd.append("location", exp.location ? exp.location : "");
//       fd.append("description", exp.description ? exp.description : "");

//       // LINK MODE
//       if (exp.uploadMode === "link") {
//         fd.append("exp_letter_link", exp.exp_letter_link || "");
//         // Do NOT overwrite existing file if link mode
//       }

//       // FILE MODE
//       else {
//         // Case 1: New file selected â†’ upload
//         if (exp.expLetterFile instanceof File) {
//           fd.append("exp_letter_file", exp.expLetterFile);
//         }

//         // Case 2: No new file BUT already saved file exists â†’ keep old
//         else if (exp.experience_letter_path) {
//           fd.append("experience_letter_path", exp.experience_letter_path);
//         }

//         // Case 3: Nothing exists â†’ send nothing (important)
//       }

//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/experiences`,
//         {
//           method: "POST",
//           body: fd, // â— Don't set Content-Type manually
//         },
//       );

//       if (!res.ok) {
//         const err = await res.text();
//         console.error(err);
//         throw new Error(err);
//       }

//       toast.success("Experience Saved âœ…", { id: loadingToast });
//     } catch (err) {
//       console.error(err);
//       toast.error("Failed to save experience âŒ", { id: loadingToast });
//     }
//   };

//   const fetchPincodeDetails = async (pincode) => {
//     if (!/^\d{6}$/.test(pincode)) return;

//     setIsFetchingPincode(true);

//     try {
//       const res = await fetch(
//         `https://api.postalpincode.in/pincode/${pincode}`,
//       );
//       const data = await res.json();

//       if (data[0]?.Status === "Success" && data[0].PostOffice?.length > 0) {
//         const postOffices = data[0].PostOffice;

//         setCityOptions(postOffices); // â­ store full objects

//         const first = postOffices[0];

//         setFormData((prev) => ({
//           ...prev,
//           city: first.Name || "",
//           district: first.District || "",
//           state: first.State || "",
//           country: first.Country || "India",
//         }));
//       } else {
//         setCityOptions([]);
//       }
//     } catch (err) {
//       console.error(err);
//       setCityOptions([]);
//     } finally {
//       setIsFetchingPincode(false);
//     }
//   };

//   const STEP_FIELDS = {
//     1: [
//       "name",
//       "email",
//       "phone",
//       "gender",
//       "dob",
//       "position",
//       "experience",
//       "education",
//       "department",
//       "about_me",
//       "languages_spoken",
//     ],

//     2: [
//       "address",
//       "address2",
//       "location",
//       "pincode",
//       "city",
//       "district",
//       "state",
//       "country",
//     ],

//     3: ["experiences"],

//     4: ["skills", "assets"],

//     5: ["resume_link", "cvFile", "certificateFiles", "certificateLinks"],
//   };

//   const fixResumeUrl = (url) => {
//     if (!url) return "";

//     // remove wrong https//
//     let clean = url.replace(/^https\/\//, "");

//     // if already full valid http/https â†’ keep it
//     if (clean.startsWith("http://") || clean.startsWith("https://")) {
//       return clean;
//     }

//     // attach correct base URL
//     return `https://apihrr.goelectronix.co.in/${clean.replace(/^\/+/, "")}`;
//   };

//   const fixResumeUrl2 = (url) => {
//     if (!url) return "";

//     let clean = url.trim();

//     // Fix broken https//
//     clean = clean.replace(/^https\/\//, "https://");

//     // ðŸ”´ If URL is https://uploads/... â†’ replace domain
//     if (clean.startsWith("https://uploads")) {
//       return clean.replace(
//         "https://uploads",
//         "https://apihrr.goelectronix.co.in/uploads",
//       );
//     }

//     // Already full valid URL â†’ return
//     if (clean.startsWith("http://") || clean.startsWith("https://")) {
//       return clean;
//     }

//     // Remove starting slash
//     clean = clean.replace(/^\/+/, "");

//     // Attach backend base
//     return `https://apihrr.goelectronix.co.in/${clean}`;
//   };

//   const hasExistingExperience =
//     Array.isArray(formData.experiences) && formData.experiences.length > 0;

//   const saveStepData = async (stepNumber) => {
//     try {
//       const apiData = new FormData();
//       const fields = STEP_FIELDS[stepNumber] || [];

//       fields.forEach((key) => {
//         if (key === "languages_spoken") {
//           apiData.append(
//             "languages_spoken",
//             (formData.languages_spoken || []).join(","),
//           );
//         } else if (key === "skills" || key === "assets") {
//           // apiData.append(key, JSON.stringify(formData[key] || []));
//           apiData.append(key, (formData[key] || []).join(","));
//         } else if (key === "experiences") {
//           apiData.append(
//             "experience_details",
//             JSON.stringify(formData.experiences || []),
//           );
//         } else if (key === "cvFile" && formData.cvFile) {
//           apiData.append("resumepdf", formData.cvFile);
//         }
//         // CASE 2: Resume LINK
//         else if (key === "resume_link" && formData.resume_link) {
//           apiData.append("resume_link", formData.resume_link);
//         } else if (key === "certificateFiles") {
//           formData.certificateFiles.forEach((file) => {
//             apiData.append("certificates", file);
//           });
//         } else if (key === "certificateLinks") {
//           apiData.append(
//             "certificate_links",
//             JSON.stringify(
//               formData.certificateLinks.filter((l) => l && l.trim()),
//             ),
//           );
//         } else {
//           apiData.append(key, formData[key] ?? "");
//         }
//       });

//       apiData.append("full_name", formData.name || "");

//       await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//         {
//           method: "PATCH",
//           body: apiData,
//         },
//       );

//       toast.success(`Step ${stepNumber} saved`);
//     } catch (err) {
//       console.error(err);
//       toast.error("Auto save failed");
//     }
//   };

//   const handleSubmit = async (e) => {
//     e.preventDefault();
//     setLoading(true);

//     const loadingToast = toast.loading("Executing Final PATCH Sync...");

//     try {
//       const apiData = new FormData();

//       // ðŸ”¹ Append ALL simple fields (NO skipping empty)
//       for (const key in formData) {
//         if (
//           ![
//             "experiences",
//             "certificateFiles",
//             "languages_spoken",
//             "cvFile",
//             "skills",
//             "assets",
//           ].includes(key)
//         ) {
//           apiData.append(key, formData[key] ?? "");
//         }
//       }

//       // ðŸ”¹ Required backend fields
//       apiData.append("full_name", formData.name || "");

//       apiData.append(
//         "languages_spoken",
//         (formData.languages_spoken || []).join(","),
//       );

//       apiData.append("skills", (formData.skills || []).join(","));
//       apiData.append("assets", (formData.assets || []).join(","));

//       // CASE 1: Upload PDF
//       if (formData.cvFile) {
//         apiData.append("resumepdf", formData.cvFile); // âœ… correct key
//       }

//       // CASE 2: Resume Link
//       else if (formData.resume_link) {
//         apiData.append("resume_link", formData.resume_link); // âœ… correct key
//       }

//       // CASE 3: Keep existing resume (no change)
//       else if (existingResume) {
//         apiData.append("resume_link", existingResume);
//       }

//       // ðŸ”¹ Certificates FILES
//       formData.certificateFiles.forEach((file) => {
//         apiData.append("certificates", file);
//       });

//       // ðŸ”¹ Certificate LINKS
//       apiData.append(
//         "certificate_links",
//         JSON.stringify(formData.certificateLinks.filter((l) => l && l.trim())),
//       );

//       // ðŸ”¹ Debug â€” SEE WHAT GOES TO API
//       for (let pair of apiData.entries()) {
//         console.log(pair[0], pair[1]);
//       }

//       const response = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//         {
//           method: "PATCH",
//           body: apiData,
//         },
//       );

//       if (!response.ok) {
//         const err = await response.text();
//         console.error(err);
//         throw new Error("API Failed");
//       }

//       toast.success("Candidate Synchronized ðŸŽ‰", { id: loadingToast });
//     } catch (err) {
//       console.error(err);
//       toast.error("Commit failed âŒ", { id: loadingToast });
//     } finally {
//       setLoading(false);
//     }
//   };

//   const numberToIndianWords = (num) => {
//     if (!num || isNaN(num)) return "";

//     const ones = [
//       "",
//       "One",
//       "Two",
//       "Three",
//       "Four",
//       "Five",
//       "Six",
//       "Seven",
//       "Eight",
//       "Nine",
//       "Ten",
//       "Eleven",
//       "Twelve",
//       "Thirteen",
//       "Fourteen",
//       "Fifteen",
//       "Sixteen",
//       "Seventeen",
//       "Eighteen",
//       "Nineteen",
//     ];

//     const tens = [
//       "",
//       "",
//       "Twenty",
//       "Thirty",
//       "Forty",
//       "Fifty",
//       "Sixty",
//       "Seventy",
//       "Eighty",
//       "Ninety",
//     ];

//     const twoDigits = (n) =>
//       n < 20
//         ? ones[n]
//         : tens[Math.floor(n / 10)] + (n % 10 ? " " + ones[n % 10] : "");

//     const threeDigits = (n) => {
//       if (n === 0) return "";
//       if (n < 100) return twoDigits(n);
//       return (
//         ones[Math.floor(n / 100)] +
//         " Hundred" +
//         (n % 100 ? " " + twoDigits(n % 100) : "")
//       );
//     };

//     const crore = Math.floor(num / 10000000);
//     const lakh = Math.floor((num % 10000000) / 100000);
//     const thousand = Math.floor((num % 100000) / 1000);
//     const hundred = num % 1000;

//     let result = "";

//     if (crore) result += twoDigits(crore) + " Crore ";
//     if (lakh) result += twoDigits(lakh) + " Lakh ";
//     if (thousand) result += twoDigits(thousand) + " Thousand ";
//     if (hundred) result += threeDigits(hundred);

//     return result.trim() + " per annum";
//   };

//   const today = new Date();

//   // 18 years ago (max allowed DOB)
//   const maxDate = new Date(
//     today.getFullYear() - 18,
//     today.getMonth(),
//     today.getDate(),
//   )
//     .toISOString()
//     .split("T")[0];

//   // 70 years ago (min allowed DOB)
//   const minDate = new Date(
//     today.getFullYear() - 70,
//     today.getMonth(),
//     today.getDate(),
//   )
//     .toISOString()
//     .split("T")[0];

//   const [dobError, setDobError] = useState("");

//   const handleDobChange = (value) => {
//     setFormData({ ...formData, dob: value });

//     if (!value) {
//       setDobError("Date of Birth is required");
//       return;
//     }

//     const selected = new Date(value);

//     if (selected > new Date(maxDate)) {
//       setDobError("Age must be at least 18 years");
//     } else if (selected < new Date(minDate)) {
//       setDobError("Age must be below 70 years");
//     } else {
//       setDobError("");
//     }
//   };

  

//   if (fetchingData)
//     return (
//       <div className="min-h-screen flex flex-col items-center justify-center bg-slate-50 gap-4">
//         <Loader2 className="h-10 w-10 animate-spin text-blue-600" />
//         <p className="text-[11px] font-black uppercase tracking-[0.2em] text-slate-400">
//           Loading Data Load {effectiveId}...
//         </p>
//       </div>
//     );

//   return (
//     <div className="min-h-screen bg-[#F8FAFC] p-4 md:p-12 antialiased">
//       <div className="max-w-6xl mx-auto space-y-8" ref={dropdownContainerRef}>
//         {/* ROADMAP HEADER */}
//         <div className="flex flex-col lg:flex-row justify-between items-center bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 gap-8">
//           <div className="flex items-center gap-6">
//             <div className="h-16 w-16 bg-slate-900 rounded-[1.5rem] flex items-center justify-center text-white shadow-2xl">
//               <Database size={32} />
//             </div>
//             <div>
//               <h2 className="text-2xl font-black text-slate-900 tracking-tight leading-none">
//                 {id ? "Profile" : "Manual Registry"}
//               </h2>
//               <div className="flex items-center gap-2 mt-1 text-blue-600">
//                 <ShieldCheck size={14} />
//               </div>
//             </div>
//           </div>

//           <div className="flex-1 max-w-2xl w-full px-4">
//             <div className="relative flex justify-between items-center w-full">
//               <div className="absolute top-1/2 left-0 w-full h-0.5 bg-slate-100 -translate-y-1/2 z-0" />
//               <div
//                 className="absolute top-1/2 left-0 h-0.5 bg-blue-600 -translate-y-1/2 z-0 transition-all duration-700"
//                 style={{ width: `${((step - 1) / (totalSteps - 1)) * 100}%` }}
//               />
//               {[1, 2, 3, 4, 5].map((num) => (
//                 <div
//                   key={num}
//                   className="relative z-10 flex flex-col items-center gap-2"
//                 >
//                   <div
//                     className={`h-8 w-8 rounded-full flex items-center justify-center text-[10px] font-black transition-all border-4 ${step === num ? "bg-blue-600 text-white border-blue-100 scale-110 shadow-lg" : step > num ? "bg-emerald-500 text-white border-emerald-50" : "bg-white text-slate-300 border-slate-50"}`}
//                   >
//                     {step > num ? <Check size={14} strokeWidth={4} /> : num}
//                   </div>
//                   <span
//                     className={`absolute -bottom-6 text-[8px] font-black uppercase tracking-tighter transition-colors duration-300 ${step === num ? "text-blue-600" : "text-slate-300"}`}
//                   >
//                     {num === 1 && "Identity"} {num === 2 && "Location"}{" "}
//                     {num === 3 && "Experience"} {num === 4 && "Inventory"}{" "}
//                     {num === 5 && "Documents"}
//                   </span>
//                 </div>
//               ))}
//             </div>
//           </div>
//           <div className="bg-slate-50 border border-slate-200 rounded-2xl px-6 py-3 flex items-center gap-3 shadow-inner">
//             <div className="text-right">
//               <p className="text-[8px] font-black text-slate-400 uppercase leading-none">
//                 Status
//               </p>
//               <p className="text-sm font-black text-slate-900 mt-1">
//                 {Math.round((step / totalSteps) * 100)}%
//               </p>
//             </div>
//             <div className="h-8 w-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center">
//               <Check size={18} />
//             </div>
//           </div>
//         </div>

//         <form onSubmit={handleSubmit}>
//           <div className="space-y-12">
//             {/* STEP 1: IDENTITY & CAREER */}
//             {step === 1 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8 duration-500">
//                 <div className="flex items-center gap-4 pb-4 border-b border-slate-100">
//                   <User size={18} className="text-blue-600" />
//                   <h3 className="text-sm font-black text-slate-800 uppercase tracking-widest">
//                     Basic Candidate profile
//                   </h3>
//                 </div>
//                 <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
//                   <FormField label="Full Name" required>
//                     <input
//                       placeholder="Legal Name"
//                       value={formData.name}
//                       onChange={(e) =>
//                         setFormData({ ...formData, name: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <FormField label="Email" required>
//                     <input
//                       type="email"
//                       placeholder="name@domain.com"
//                       value={formData.email}
//                       onChange={(e) =>
//                         setFormData({ ...formData, email: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <FormField label="Phone" required>
//                     <div className="flex items-center bg-slate-50 border border-slate-200 rounded-xl overflow-hidden focus-within:bg-white focus-within:border-blue-500 transition-all shadow-sm">
//                       <span className="px-3 text-[11px] font-black text-slate-400">
//                         +91
//                       </span>
//                       <input
//                         maxLength={10}
//                         value={formData.phone}
//                         onChange={(e) =>
//                           setFormData({ ...formData, phone: e.target.value })
//                         }
//                         className="w-full px-3 py-2 bg-transparent text-[13px] font-bold outline-none"
//                       />
//                     </div>
//                   </FormField>
//                   <FormField label="Gender">
//                     <select
//                       value={formData.gender}
//                       onChange={(e) =>
//                         setFormData({ ...formData, gender: e.target.value })
//                       }
//                       className={inputStyle}
//                     >
//                       <option value="">Select</option>
//                       <option value="male">Male</option>
//                       <option value="female">Female</option>
//                       <option value="transgender">Transgender</option>
//                       <option value="prefer_not_to_say">
//                         Prefer not to say
//                       </option>
//                     </select>
//                   </FormField>
//                 </div>

//                 <div className="grid grid-cols-1 md:grid-cols-2 gap-8 pt-4">
//                   <FormField label="Date of Birth">
//                     <input
//                       type="date"
//                       min={minDate}
//                       max={maxDate}
//                       value={formData.dob}
//                       onChange={(e) =>
//                         setFormData({ ...formData, dob: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <FormField label="Languages">
//                     <div className="bg-slate-50 border border-slate-200 rounded-xl p-3 max-h-32 overflow-y-auto grid grid-cols-2 gap-3 shadow-inner">
//                       {[
//                         "English",
//                         "Hindi",
//                         "Marathi",
//                         "Gujarati",
//                         "Tamil",
//                         "Telugu",
//                       ].map((lang) => (
//                         <label
//                           key={lang}
//                           className="flex items-center gap-2 text-[11px] font-medium text-slate-600 cursor-pointer hover:text-blue-600 transition-colors"
//                         >
//                           <input
//                             type="checkbox"
//                             checked={formData.languages_spoken.includes(lang)}
//                             onChange={() => {
//                               const u = formData.languages_spoken.includes(lang)
//                                 ? formData.languages_spoken.filter(
//                                     (l) => l !== lang,
//                                   )
//                                 : [...formData.languages_spoken, lang];
//                               setFormData({ ...formData, languages_spoken: u });
//                             }}
//                             className="w-3.5 h-3.5 accent-blue-600 rounded"
//                           />{" "}
//                           {lang}
//                         </label>
//                       ))}
//                     </div>
//                   </FormField>
//                 </div>
//                 <FormField label="Bio Summary">
//                   <textarea
//                     rows={3}
//                     value={formData.about_me}
//                     onChange={(e) =>
//                       setFormData({ ...formData, about_me: e.target.value })
//                     }
//                     className={inputStyle + " resize-none"}
//                   />
//                 </FormField>
//                 <div className="flex justify-end pt-4">
//                   <button
//                     type="button"
//                     // onClick={() => setStep(2)}
//                     onClick={async () => {
//                       await saveStepData(1);
//                       setStep(2);
//                     }}
//                     className={`px-12 py-3 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest shadow-xl active:scale-95 transition-all`}
//                   >
//                     Next Phase â†’
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 2: GEOGRAPHY */}
//             {step === 2 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8">
//                 <div className="flex items-center gap-3 pb-4 border-b border-slate-100">
//                   <MapPin size={18} className="text-blue-600" />
//                   <h3 className="text-xs font-black text-slate-800 uppercase tracking-widest">
//                     location Data
//                   </h3>
//                 </div>
//                 <div className="space-y-8">
//                   <FormField label="Address 1" required>
//                     <input
//                       value={formData.address}
//                       onChange={(e) =>
//                         setFormData({ ...formData, address: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                     <FormField label="Address 2" required>
//                       <input
//                         value={formData.location}
//                         onChange={(e) =>
//                           setFormData({ ...formData, location: e.target.value })
//                         }
//                         className={inputStyle}
//                       />
//                     </FormField>
//                     <FormField label="Pincode" required>
//                       <input
//                         maxLength={6}
//                         placeholder="000000"
//                         value={formData.pincode}
//                         onChange={(e) => {
//                           setFormData({ ...formData, pincode: e.target.value });
//                           if (e.target.value.length === 6)
//                             fetchPincodeDetails(e.target.value);
//                         }}
//                         className={inputStyle}
//                       />
//                     </FormField>
//                   </div>
//                   <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
                    
//                     <FormField label="City">
//                       {isFetchingPincode ? (
//                         <input
//                           value="Fetching..."
//                           readOnly
//                           className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-400 shadow-inner"
//                         />
//                       ) : cityOptions.length > 1 ? (
//                         <select
//                           value={formData.city}
//                           onChange={(e) => {
//                             const selected = cityOptions.find(
//                               (c) => c.Name === e.target.value,
//                             );

//                             setFormData((prev) => ({
//                               ...prev,
//                               city: selected?.Name || "",
//                               district: selected?.District || "",
//                               state: selected?.State || "",
//                               country: selected?.Country || "India",
//                             }));
//                           }}
//                           className="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl text-xs font-bold text-slate-700 shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100"
//                         >
//                           {cityOptions.map((c, i) => (
//                             <option key={i} value={c.Name}>
//                               {c.Name}
//                             </option>
//                           ))}
//                         </select>
//                       ) : (
//                         <input
//                           value={formData.city || ""}
//                           readOnly
//                           className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                         />
//                       )}
//                     </FormField>

//                     <FormField label="District">
//                       <input
//                         // value={formData.district}
//                         value={
//                           isFetchingPincode ? "Fetching..." : formData.district
//                         }
//                         readOnly
//                         className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                       />
//                     </FormField>
//                     <FormField label="State">
//                       <input
//                         // value={formData.state}
//                         value={
//                           isFetchingPincode ? "Fetching..." : formData.state
//                         }
//                         readOnly
//                         className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                       />
//                     </FormField>
//                     <FormField label="Country">
//                       <input
//                         // value={formData.country}
//                         value={
//                           isFetchingPincode ? "Fetching..." : formData.country
//                         }
//                         readOnly
//                         onChange={(e) =>
//                           setFormData({ ...formData, country: e.target.value })
//                         }
//                         className={inputStyle}
//                       />
//                     </FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-between pt-8 border-t border-slate-50">
//                   <button
//                     onClick={() => setStep(1)}
//                     type="button"
//                     className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase hover:text-slate-900 transition-all shadow-sm"
//                   >
//                     â† Back
//                   </button>
//                   <button
//                     //  onClick={() => setStep(3)}
//                     onClick={async () => {
//                       await saveStepData(2);
//                       setStep(3);
//                     }}
//                     type="button"
//                     className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase shadow-xl transition-all"
//                   >
//                     Continue â†’
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 3: EXPERIENCE */}
//             {step === 3 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
//                 <div className="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-sm transition-all overflow-hidden">
//                   <div className="flex flex-col md:flex-row items-center justify-between gap-6">
//                     <div className="flex items-center gap-4 text-slate-900 font-black">
//                       <Briefcase size={24} className="text-blue-600" />
//                       <div>
//                         <h3 className="text-sm uppercase tracking-widest">
//                           Are you Fresher?
//                         </h3>
//                         <p className="text-[10px] font-bold text-slate-400 mt-1">
//                           Select current career status
//                         </p>
//                       </div>
//                     </div>
//                     <div className="flex bg-slate-100 p-1.5 rounded-[1.5rem] border border-slate-200 w-full md:w-auto">
                      
//                       <button
//                         type="button"
//                         disabled={hasExistingExperience} // â­ disable when experience present
//                         onClick={() => {
//                           if (hasExistingExperience) return; // safety
//                           setIsFresher(true);
//                           setFormData({ ...formData, experiences: [] });
//                         }}
//                         className={`px-8 py-2.5 rounded-2xl text-[10px] font-black transition-all
//   ${
//     hasExistingExperience
//       ? "bg-slate-100 text-slate-300 cursor-not-allowed" // disabled style
//       : isFresher === true
//         ? "bg-white text-blue-600 shadow-sm border"
//         : "text-slate-400"
//   }`}
//                       >
//                         Yes
//                       </button>

//                       <button
//                         type="button"
//                         onClick={() => {
//                           setIsFresher(false);

//                           if (
//                             !formData.experiences ||
//                             formData.experiences.length === 0
//                           ) {
//                             setFormData({
//                               ...formData,
//                               experiences: [
//                                 {
//                                   company_name: "",
//                                   job_title: "",
//                                   start_date: "",
//                                   end_date: "",
//                                   industry: "",
//                                   previous_ctc: "",
//                                   location: "",
//                                   description: "",
//                                   exp_letter_link: "",
//                                   uploadMode: "file",
//                                 },
//                               ],
//                             });
//                           }
//                         }}
//                         className={`px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === false ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}
//                       >
//                         No
//                       </button>
//                     </div>
//                   </div>
//                 </div>

//                 {isFresher === false && (
//                   <div className="bg-white p-6 md:p-10 rounded-[3.5rem] border border-slate-200 shadow-xl space-y-10 animate-in fade-in duration-500 shadow-slate-100">
//                     <div className="flex flex-col sm:flex-row justify-between items-start border-b border-slate-100 pb-8">
//                       <div className="flex items-center gap-4">
//                         <div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg">
//                           <History size={20} />
//                         </div>
//                         <h3 className="text-sm font-black text-slate-900 uppercase">
//                           Career Timeline
//                         </h3>
//                       </div>
//                       <button
//                         type="button"
//                         onClick={() =>
//                           setFormData({
//                             ...formData,
//                             experiences: [
//                               ...formData.experiences,
//                               {
//                                 company_name: "",
//                                 job_title: "",
//                                 start_date: "",
//                                 industry: "",
//                                 end_date: "",
//                                 previous_ctc: "",
//                                 location: "",
//                                 description: "",
//                                 exp_letter_link: "",
//                                 uploadMode: "file",
//                               },
//                             ],
//                           })
//                         }
//                         className="px-6 py-3 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase shadow-lg active:scale-95 transition-all"
//                       >
//                         + Add Experiance
//                       </button>
//                     </div>
//                     <div className="space-y-10 max-h-[600px] overflow-y-auto pr-4 custom-scrollbar-professional">
//                       {formData.experiences.map((exp, i) => (
//                         <div
//                           key={i}
//                           className="relative bg-slate-50/50 border border-slate-200 p-8 rounded-[2.5rem] space-y-8 animate-in zoom-in-95 group hover:bg-white transition-all shadow-inner"
//                         >
//                           <button
//                             type="button"
//                             onClick={() => {
//                               if (formData.experiences.length === 1) return;
//                               setFormData({
//                                 ...formData,
//                                 experiences: formData.experiences.filter(
//                                   (_, idx) => idx !== i,
//                                 ),
//                               });
//                             }}
//                             className="absolute -top-3 -right-3 h-10 w-10 bg-white border border-slate-200 text-red-500 rounded-full flex items-center justify-center shadow-lg transition-all opacity-0 group-hover:opacity-100 z-20"
//                           >
//                             <Trash2 size={18} />
//                           </button>
//                           <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
//                             <FormField label="Employer">
//                               <input
//                                 value={exp.company_name}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].company_name = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                             <FormField label="Designation">
//                               <input
//                                 value={exp.job_title}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].job_title = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                             <FormField label="Industry">
//                               <select
//                                 value={exp.industry || ""}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].industry = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               >
//                                 <option value="">Select Industry</option>
//                                 <option>Information Technology</option>
//                                 <option>Software Development</option>
//                                 <option>Banking & Finance</option>
//                                 <option>Healthcare</option>
//                                 <option>Education</option>
//                                 <option>Manufacturing</option>
//                                 <option>Retail</option>
//                                 <option>Telecom</option>
//                                 <option>Construction</option>
//                                 <option>Logistics</option>
//                                 <option>Marketing & Advertising</option>
//                                 <option>HR / Recruitment</option>
//                                 <option>Government</option>
//                                 <option>Other</option>
//                               </select>
//                             </FormField>
//                           </div>

//                           <div className="grid grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8">
//                             <FormField label="Start">
//                               <input
//                                 type="date"
//                                 value={exp.start_date}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].start_date = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                             <FormField label="End">
//                               <input
//                                 type="date"
//                                 value={exp.end_date}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].end_date = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>

//                             <FormField label="Annual CTC">
//                               <div className="relative">
//                                 {/* Visual Wrapper for Input */}
//                                 <div className="flex items-center bg-slate-50 border border-slate-200 rounded-2xl overflow-hidden focus-within:bg-white focus-within:border-blue-500 focus-within:ring-4 focus-within:ring-blue-500/10 transition-all duration-300 shadow-sm">
//                                   {/* Currency Identity */}
//                                   <div className="px-5 py-3 border-r border-slate-200/60 bg-slate-100/50 flex items-center justify-center">
//                                     <span className="text-sm font-black text-blue-600">
//                                       â‚¹
//                                     </span>
//                                   </div>

//                                   {/* Your Existing Input & Logic */}
//                                   <input
//                                     type="number"
//                                     placeholder="0.00"
//                                     value={exp.previous_ctc}
//                                     onChange={(e) => {
//                                       const u = [...formData.experiences];
//                                       u[i].previous_ctc = e.target.value;
//                                       setFormData({
//                                         ...formData,
//                                         experiences: u,
//                                       });
//                                     }}
//                                     className="w-full px-4 py-3 bg-transparent text-[13px] font-bold text-slate-700 outline-none placeholder:text-slate-300"
//                                   />

//                                   {/* Industry Standard Suffix */}
//                                   <div className="pr-5">
//                                     <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">
//                                       LPA
//                                     </span>
//                                   </div>
//                                 </div>

//                                 {/* Your Existing Word Conversion Logic with Professional Styling */}
//                                 {exp.previous_ctc && (
//                                   <div className="absolute -bottom-6 left-1 flex items-center gap-2 animate-in fade-in slide-in-from-top-1">
//                                     <div className="h-1.5 w-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.4)]" />
//                                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest italic">
//                                       {numberToIndianWords(
//                                         Number(exp.previous_ctc),
//                                       )}{" "}
//                                       Rupees
//                                     </p>
//                                   </div>
//                                 )}
//                               </div>
//                             </FormField>

//                             <FormField label="City">
//                               <input
//                                 value={exp.location}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].location = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                           </div>

//                           <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
//                             <FormField label="Job Description">
//                               <textarea
//                                 rows={5}
//                                 value={exp.description}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].description = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={
//                                   inputStyle +
//                                   " resize-none h-full min-h-[140px]"
//                                 }
//                               />
//                             </FormField>
//                             <div className="space-y-3">
//                               <div className="flex justify-between items-center px-1">
//                                 <p className="text-[10px] font-black text-slate-400 uppercase">
//                                   Experience Letter
//                                 </p>
//                                 <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200">
//                                   <button
//                                     type="button"
//                                     onClick={() => {
//                                       const u = [...formData.experiences];
//                                       u[i].uploadMode = "file";
//                                       setFormData({
//                                         ...formData,
//                                         experiences: u,
//                                       });
//                                     }}
//                                     className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode !== "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                                   >
//                                     FILE
//                                   </button>
//                                   <button
//                                     type="button"
//                                     onClick={() => {
//                                       const u = [...formData.experiences];
//                                       u[i].uploadMode = "link";
//                                       setFormData({
//                                         ...formData,
//                                         experiences: u,
//                                       });
//                                     }}
//                                     className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                                   >
//                                     URL
//                                   </button>
//                                 </div>
//                               </div>
//                               <div className="bg-white/50 border border-slate-100 rounded-3xl p-4 min-h-[140px] flex flex-col justify-center">
                                

//                                 {exp.uploadMode !== "link" ? (
//                                   <label className="flex flex-col items-center justify-center gap-3 w-full h-full border-2 border-dashed border-slate-200 rounded-2xl hover:bg-blue-50/30 cursor-pointer group p-4 transition-all">
//                                     <FileUp
//                                       size={24}
//                                       className="text-slate-400 group-hover:text-blue-500"
//                                     />

//                                     {/* TEXT STATUS */}
//                                     <span className="text-[9px] font-bold text-slate-500 uppercase tracking-widest text-center">
//                                       {exp.expLetterFile
//                                         ? exp.expLetterFile.name
//                                         : exp.experience_letter_path
//                                           ? "Existing Experience Letter Available"
//                                           : "Drop PDF Validation"}
//                                     </span>

//                                     {/* VIEW EXISTING FILE */}
//                                     {exp.experience_letter_path &&
//                                       !exp.expLetterFile && (
//                                         <a
//                                           href={fixResumeUrl2(
//                                             exp.experience_letter_path,
//                                           )}
//                                           target="_blank"
//                                           rel="noreferrer"
//                                           className="text-blue-600 text-[10px] underline"
//                                           onClick={(e) => e.stopPropagation()}
//                                         >
//                                           View Current File
//                                         </a>
//                                       )}

//                                     <input
//                                       type="file"
//                                       accept=".pdf"
//                                       className="hidden"
//                                       onChange={(e) => {
//                                         const u = [...formData.experiences];
//                                         u[i].expLetterFile = e.target.files[0];
//                                         setFormData({
//                                           ...formData,
//                                           experiences: u,
//                                         });
//                                       }}
//                                     />
//                                   </label>
//                                 ) : (
//                                   <div className="relative">
//                                     <LinkIcon
//                                       size={16}
//                                       className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                                     />
//                                     <input
//                                       placeholder="Storage URI"
//                                       value={exp.exp_letter_link || ""}
//                                       onChange={(e) => {
//                                         const u = [...formData.experiences];
//                                         u[i].exp_letter_link = e.target.value;
//                                         setFormData({
//                                           ...formData,
//                                           experiences: u,
//                                         });
//                                       }}
//                                       className={inputStyle + " pl-11"}
//                                     />
//                                   </div>
//                                 )}
//                               </div>
//                             </div>
//                           </div>
//                           <div className="flex justify-between pt-2 border-t border-slate-50">
//                             <button
//                               type="button"
//                               onClick={() =>
//                                 setFormData({
//                                   ...formData,
//                                   experiences: [
//                                     ...formData.experiences,
//                                     {
//                                       company_name: "",
//                                       job_title: "",
//                                       start_date: "",
//                                       industry: "",
//                                       end_date: "",
//                                       previous_ctc: "",
//                                       location: "",
//                                       description: "",
//                                       exp_letter_link: "",
//                                       uploadMode: "file",
//                                     },
//                                   ],
//                                 })
//                               }
//                               className="px-6 py-3 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase shadow-lg active:scale-95 transition-all"
//                             >
//                               + Add Experiance
//                             </button>
//                             <button
//                               type="button"
//                               onClick={() => handleSaveExperienceAPI(i)}
//                               className="flex items-center gap-2 px-8 py-3 bg-emerald-50 text-emerald-600 border border-emerald-100 rounded-2xl text-[10px] font-black uppercase hover:bg-emerald-500 hover:text-white transition-all active:scale-95 shadow-sm"
//                             >
//                               <Check size={16} strokeWidth={3} /> Save Record
//                             </button>
//                           </div>
//                         </div>
//                       ))}
//                     </div>
//                   </div>
//                 )}
//                 <div className="flex justify-between pt-4">
//                   <button
//                     onClick={() => setStep(2)}
//                     type="button"
//                     className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase shadow-sm transition-all hover:text-slate-900 flex items-center gap-2"
//                   >
//                     â† Back
//                   </button>
//                   <button
//                     onClick={async () => {
//                       await saveStepData(3);
//                       setStep(4);
//                     }}
//                     type="button"
//                     disabled={isFresher === null}
//                     className={`px-12 py-4 rounded-2xl text-xs font-black uppercase shadow-xl transition-all active:scale-95 ${isFresher !== null ? "bg-blue-600 text-white shadow-blue-600/30 hover:bg-blue-700" : "bg-slate-200 text-slate-400 cursor-not-allowed"}`}
//                   >
//                     Next Phase â†’
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 4: INVENTORY */}
//             {step === 4 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 overflow-visible">
//                 <div className="bg-white border border-slate-200 rounded-[3.5rem] shadow-xl overflow-visible shadow-slate-200/50">
//                   <div className="bg-slate-50/50 px-10 py-6 border-b border-slate-200 flex items-center justify-between rounded-t-[3.5rem]">
//                     <div className="flex items-center gap-4">
//                       <div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg">
//                         <Cpu size={20} />
//                       </div>
//                       <div>
//                         <h3 className="text-sm font-black text-slate-900 uppercase tracking-widest leading-none">
//                           Skills & Assets
//                         </h3>
//                       </div>
//                     </div>
//                   </div>
//                   <div className="p-8 md:p-12 space-y-12 overflow-visible">
//                     <FormField label="Skills">
//                       <div className="space-y-6">
//                         <div className="flex flex-col sm:flex-row gap-4 items-end">
//                           <div className="relative max-w-md w-full">
//                             <Plus
//                               size={16}
//                               className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                             />
//                             <input
//                               value={skillInput}
//                               onChange={(e) => setSkillInput(e.target.value)}
//                               onKeyDown={(e) => {
//                                 if (e.key === "Enter") {
//                                   e.preventDefault();
//                                   const name = skillInput.trim();
//                                   if (!name) return;

//                                   // prevent duplicate
//                                   if (!formData.skills.includes(name)) {
//                                     setFormData((prev) => ({
//                                       ...prev,
//                                       skills: [...prev.skills, name],
//                                     }));
//                                   }

//                                   setSkillInput("");
//                                 }
//                               }}
//                               placeholder="Register skill..."
//                               className={inputStyle + " pl-12"}
//                             />
//                           </div>
//                         </div>

//                         <div className="flex flex-wrap gap-3 p-1 w-full min-h-[40px]">
//                           {[
//                             ...new Set([...dynamicSkills, ...formData.skills]),
//                           ].map((skill) => {
//                             const isSelected = formData.skills.includes(skill);

//                             return (
//                               <button
//                                 key={skill}
//                                 type="button"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     skills: isSelected
//                                       ? formData.skills.filter(
//                                           (s) => s !== skill,
//                                         )
//                                       : [...formData.skills, skill],
//                                   })
//                                 }
//                                 className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${
//                                   isSelected
//                                     ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200"
//                                     : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"
//                                 }`}
//                               >
//                                 {skill}
//                                 {isSelected && (
//                                   <Check size={14} strokeWidth={3} />
//                                 )}
//                               </button>
//                             );
//                           })}
//                         </div>
//                       </div>
//                     </FormField>
//                     {/* <FormField label="Enterprise Hardware Matrix"><div className="space-y-6 pt-8 border-t border-slate-100"><div className="relative max-w-md w-full"><Layers size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={assetInput} onChange={(e) => setAssetInput(e.target.value)} onKeyDown={async (e) => { if(e.key === 'Enter') { e.preventDefault(); const v = assetInput.trim(); if(v && !formData.assets.includes(v)) { const ok = await handleAddAssetAPI(v); if(ok) { setFormData({...formData, assets: [...formData.assets, v]}); setAssetInput(""); } } } }} placeholder="Link hardware..." className={inputStyle + " pl-12"} /></div><div className="flex flex-wrap gap-3 p-1">{dynamicAssets.map((asset) => { const isSelected = formData.assets.includes(asset); return (<button key={asset} type="button" onClick={async () => { if(!isSelected) { const ok = await handleAddAssetAPI(asset); if(ok) setFormData({...formData, assets: [...formData.assets, asset]}); } else { setFormData({...formData, assets: formData.assets.filter(a => a !== asset)}); } }} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${isSelected ? "bg-slate-900 border-slate-900 text-white shadow-lg shadow-slate-200" : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`}>{asset} {isSelected && <Check size={14} strokeWidth={3} className="animate-in zoom-in" />}</button>); })}</div></div></FormField> */}
//                     <div className="space-y-6 pt-8 border-t border-slate-100">
//                       <FormField label="Assets">
//                         <div className="space-y-6">
//                           {/* Search & Manual Add Input */}
//                           <div className="relative max-w-md">
//                             <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">
//                               <Layers size={16} />
//                             </div>
//                             <input
//                               value={assetInput}
//                               onChange={(e) => setAssetInput(e.target.value)}
                              
//                               onKeyDown={(e) => {
//                                 if (e.key === "Enter") {
//                                   e.preventDefault();
//                                   const v = assetInput.trim();
//                                   if (!v) return;

//                                   // Prevent duplicate
//                                   if (!formData.assets.includes(v)) {
//                                     setFormData((prev) => ({
//                                       ...prev,
//                                       assets: [...prev.assets, v],
//                                     }));
//                                   }

//                                   setAssetInput("");
//                                 }
//                               }}
//                               placeholder="Type hardware name and press Enter..."
//                               className="w-full pl-12 pr-4 py-3.5 bg-slate-50 border border-slate-200 rounded-2xl text-xs font-bold outline-none focus:bg-white focus:border-slate-900 focus:ring-4 focus:ring-slate-900/5 transition-all shadow-inner"
//                             />
//                           </div>

//                           <div className="flex flex-wrap gap-3 p-1 w-full min-h-[40px]">
//                             {[
//                               ...new Set([
//                                 ...dynamicAssets,
//                                 ...formData.assets,
//                               ]),
//                             ].filter(
//                               (a) => typeof a === "string" && a.trim() !== "",
//                             ).length === 0 ? (
//                               /* âŒ NO ASSETS */
//                               <div className="w-full text-center py-6 bg-slate-50 border border-dashed border-slate-200 rounded-2xl">
//                                 <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">
//                                   No assets available
//                                 </p>
//                               </div>
//                             ) : (
//                               /* âœ… ASSET CHIPS */
//                               [
//                                 ...new Set([
//                                   ...dynamicAssets,
//                                   ...formData.assets,
//                                 ]),
//                               ]
//                                 .filter(
//                                   (a) =>
//                                     typeof a === "string" && a.trim() !== "",
//                                 )
//                                 .map((asset) => {
//                                   const isSelected =
//                                     formData.assets.includes(asset);

//                                   return (
//                                     <button
//                                       key={asset}
//                                       type="button"
//                                       onClick={() =>
//                                         setFormData((prev) => ({
//                                           ...prev,
//                                           assets: isSelected
//                                             ? prev.assets.filter(
//                                                 (a) => a !== asset,
//                                               )
//                                             : [...prev.assets, asset],
//                                         }))
//                                       }
//                                       className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90
//             ${
//               isSelected
//                 ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200"
//                 : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"
//             }`}
//                                     >
//                                       {asset}
//                                       {isSelected && (
//                                         <Check size={14} strokeWidth={3} />
//                                       )}
//                                     </button>
//                                   );
//                                 })
//                             )}
//                           </div>
//                         </div>
//                       </FormField>
//                     </div>
//                   </div>
//                 </div>
//                 <div className="flex justify-between items-center pt-4">
//                   <button
//                     onClick={() => setStep(3)}
//                     type="button"
//                     className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[11px] font-black uppercase transition-all shadow-sm hover:text-slate-900 flex items-center gap-2 transition-all"
//                   >
//                     <ChevronLeft size={16} /> Back
//                   </button>

//                   <button
//                     onClick={async () => {
//                       await saveStepData(4);
//                       setStep(5);
//                     }}
//                     type="button"
//                     className="px-12 py-4 bg-blue-600 text-white rounded-xl text-[11px] font-black uppercase shadow-xl active:scale-95 transition-all flex items-center gap-2 whitespace-nowrap"
//                   >
//                     Next Phase <ChevronRight size={14} />
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 5: DOCUMENT VAULT */}

//             {step === 5 && (
//               <div className="space-y-8 animate-in slide-in-from-bottom-8 duration-500">
//                 <div className="bg-white rounded-[2rem] shadow-2xl shadow-slate-200/50 border border-slate-200 overflow-hidden relative">
//                   {/* SECTION HEADER: Enterprise Indigo Theme */}
//                   <div className="bg-slate-50 px-8 py-6 border-b border-slate-200 flex items-center justify-between">
//                     <div className="flex items-center gap-5">
//                       <div className="h-12 w-12 bg-slate-900 rounded-2xl flex items-center justify-center text-white shadow-lg">
//                         <ShieldCheck size={24} />
//                       </div>
//                       <div>
//                         <h3 className="text-lg font-bold text-slate-900 tracking-tight">
//                           Document upload
//                         </h3>
//                         <p className="text-[11px] font-semibold text-slate-500 uppercase tracking-widest">
//                           Document Verification
//                         </p>
//                       </div>
//                     </div>
//                     <div className="hidden md:flex items-center gap-2 px-4 py-1.5 bg-blue-50 border border-blue-100 rounded-full">
//                       <div className="h-1.5 w-1.5 rounded-full bg-blue-500 animate-pulse" />
//                       <span className="text-[10px] font-bold text-blue-600 uppercase tracking-tighter">
//                         ready to save
//                       </span>
//                     </div>
//                   </div>

//                   <div className="p-8 md:p-12 space-y-12">
//                     <div className="grid grid-cols-1 lg:grid-cols-2 gap-12">
//                       {/* 1. MASTER RESUME SECTION */}
//                       <div className="space-y-6">
//                         <div className="flex justify-between items-center px-1">
//                           <div className="flex items-center gap-2">
//                             <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">
//                               01. Resume
//                             </span>
//                           </div>
//                           <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200 scale-90">
//                             <button
//                               type="button"
//                               onClick={() => setResumeMode("file")}
//                               className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === "file" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500 hover:text-slate-700"}`}
//                             >
//                               FILE
//                             </button>
//                             <button
//                               type="button"
//                               onClick={() => setResumeMode("link")}
//                               className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                             >
//                               URL
//                             </button>
//                           </div>
//                         </div>

//                         {resumeMode === "file" ? (
//                           <label className="flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-slate-200 rounded-3xl bg-slate-50/50 hover:bg-white hover:border-blue-500 transition-all cursor-pointer group">
//                             <div className="flex flex-col items-center gap-3">
//                               <div className="p-4 bg-white rounded-2xl shadow-sm border border-slate-100 group-hover:scale-110 transition-transform duration-500">
//                                 <FileUp
//                                   size={28}
//                                   className="text-slate-400 group-hover:text-blue-500"
//                                 />
//                               </div>
//                               <span className="text-[11px] font-bold text-slate-500 uppercase tracking-widest">
//                                 {formData.cvFile
//                                   ? formData.cvFile.name
//                                   : existingResume
//                                     ? "Existing Resume Available"
//                                     : "Commit Resume PDF"}
//                               </span>

//                               {/* VIEW EXISTING RESUME */}
//                               {existingResume && !formData.cvFile && (
//                                 <a
//                                   href={fixResumeUrl(existingResume)}
//                                   target="_blank"
//                                   rel="noreferrer"
//                                   className="text-blue-600 text-xs underline mt-1"
//                                 >
//                                   View Current Resume
//                                 </a>
//                               )}
//                             </div>
//                             <input
//                               type="file"
//                               accept=".pdf"
//                               className="hidden"
//                               onChange={(e) =>
//                                 setFormData({
//                                   ...formData,
//                                   cvFile: e.target.files[0],
//                                   resume_link: "",
//                                 })
//                               }
//                             />
//                           </label>
//                         ) : (
//                           <div className="relative">
//                             <LinkIcon
//                               size={18}
//                               className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                             />
//                             <input
//                               placeholder="Enter Public Storage URI..."
//                               value={formData.resume_link}
//                               onChange={(e) =>
//                                 setFormData({
//                                   ...formData,
//                                   resume_link: e.target.value,
//                                   cvFile: null,
//                                 })
//                               }
//                               className={inputStyle + " pl-12"}
//                             />
//                           </div>
//                         )}
//                       </div>

//                       {/* 2. CREDENTIALS MATRIX SECTION */}
//                       <div className="space-y-6">
//                         <div className="flex justify-between items-center px-1">
//                           <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">
//                             02. certificate
//                           </span>
//                           <div className="flex gap-2">
//                             <label className="cursor-pointer h-10 w-10 bg-slate-900 text-white rounded-xl hover:bg-blue-600 active:scale-90 transition-all flex items-center justify-center shadow-lg shadow-slate-200">
//                               <Plus size={18} />
//                               <input
//                                 type="file"
//                                 multiple
//                                 accept=".pdf"
//                                 className="hidden"
//                                 onChange={(e) =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateFiles: [
//                                       ...formData.certificateFiles,
//                                       ...Array.from(e.target.files),
//                                     ],
//                                   })
//                                 }
//                               />
//                             </label>
//                             <button
//                               type="button"
//                               onClick={() =>
//                                 setFormData({
//                                   ...formData,
//                                   certificateLinks: [
//                                     ...formData.certificateLinks,
//                                     "",
//                                   ],
//                                 })
//                               }
//                               className="h-10 w-10 bg-white text-slate-600 rounded-xl border border-slate-200 hover:border-blue-500 hover:text-blue-500 active:scale-90 transition-all flex items-center justify-center shadow-sm"
//                             >
//                               <LinkIcon size={18} />
//                             </button>
//                           </div>
//                         </div>

//                         <div className="grid grid-cols-1 gap-4 max-h-[220px] overflow-y-auto no-scrollbar pr-1">
//                           {/* EXISTING CERTIFICATES FROM SERVER */}
//                           {existingCertificates.map((url, idx) => (
//                             <div
//                               key={`existing-${idx}`}
//                               className="flex justify-between items-center bg-blue-50 p-4 rounded-2xl border border-blue-100"
//                             >
//                               <div className="flex items-center gap-3">
//                                 <div className="h-2 w-2 rounded-full bg-blue-500" />

//                                 <a
//                                   href={url}
//                                   target="_blank"
//                                   rel="noreferrer"
//                                   className="text-[12px] font-bold text-blue-700 underline truncate max-w-[200px]"
//                                 >
//                                   Existing Certificate {idx + 1}
//                                 </a>
//                               </div>

//                               <X
//                                 size={16}
//                                 className="text-red-400 hover:text-red-600 cursor-pointer"
//                                 onClick={() =>
//                                   setExistingCertificates((prev) =>
//                                     prev.filter((_, i) => i !== idx),
//                                   )
//                                 }
//                               />
//                             </div>
//                           ))}

//                           {formData.certificateFiles.map((file, idx) => (
//                             <div
//                               key={idx}
//                               className="flex justify-between items-center bg-slate-50 p-4 rounded-2xl border border-slate-100 hover:border-blue-300 transition-colors"
//                             >
//                               <div className="flex items-center gap-3">
//                                 <div className="h-2 w-2 rounded-full bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)]" />
//                                 <span className="text-[12px] font-bold text-slate-700 truncate max-w-[200px]">
//                                   {file.name}
//                                 </span>
//                               </div>
//                               <X
//                                 size={16}
//                                 className="text-slate-300 hover:text-red-500 cursor-pointer transition-all hover:rotate-90"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateFiles:
//                                       formData.certificateFiles.filter(
//                                         (_, i) => i !== idx,
//                                       ),
//                                   })
//                                 }
//                               />
//                             </div>
//                           ))}
//                           {formData.certificateLinks.map((link, idx) => (
//                             <div
//                               key={idx}
//                               className="flex gap-3 animate-in slide-in-from-right-4"
//                             >
//                               <div className="relative flex-1">
//                                 <Globe
//                                   size={16}
//                                   className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                                 />
//                                 <input
//                                   value={link}
//                                   placeholder="Public URI..."
//                                   onChange={(e) => {
//                                     const u = [...formData.certificateLinks];
//                                     u[idx] = e.target.value;
//                                     setFormData({
//                                       ...formData,
//                                       certificateLinks: u,
//                                     });
//                                   }}
//                                   className={inputStyle + " pl-11 !py-2.5"}
//                                 />
//                               </div>
//                               <button
//                                 type="button"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateLinks:
//                                       formData.certificateLinks.filter(
//                                         (_, i) => i !== idx,
//                                       ),
//                                   })
//                                 }
//                                 className="text-slate-300 hover:text-red-500 bg-slate-50 h-10 w-10 rounded-xl border border-slate-200 flex items-center justify-center"
//                               >
//                                 <Trash2 size={16} />
//                               </button>
//                             </div>
//                           ))}
//                           {formData.certificateFiles.length === 0 &&
//                             formData.certificateLinks.filter((l) => l)
//                               .length === 0 && (
//                               <div className="py-8 text-center bg-slate-50/50 border border-dashed border-slate-200 rounded-2xl">
//                                 <p className="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">
//                                   No secondary artifacts registered
//                                 </p>
//                               </div>
//                             )}
//                         </div>
//                       </div>
//                     </div>

//                     {/* METADATA INFO CARD */}
//                     <div className="bg-slate-900 rounded-3xl p-6 flex flex-col md:flex-row items-center justify-between gap-6 shadow-2xl">
//                       <div className="flex items-center gap-4">
//                         <div className="h-10 w-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400">
//                           <History size={20} />
//                         </div>
//                         <div>
//                           <p className="text-white text-xs font-bold tracking-wide uppercase">
//                             Final Validation
//                           </p>
//                           <p className="text-slate-400 text-[10px] uppercase font-semibold tracking-tighter">
//                             Employee Id {effectiveId} â€¢ Ready to submit
//                           </p>
//                         </div>
//                       </div>
//                       <button
//                         type="submit"
//                         // onClick={handleSubmit}
//                         onClick={async () => {
//                           setLoading(true);

//                           await saveStepData(5); // ðŸ”¥ FINAL API CALL HERE

//                           setLoading(false);

//                           toast.success("Candidate Saved âœ”");

//                           navigate("/candidate"); // redirect after save
//                         }}
//                         className="w-full md:w-auto px-10 py-3.5 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl text-[11px] font-black uppercase tracking-widest transition-all shadow-xl shadow-blue-600/20 active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3"
//                       >
//                         {loading ? (
//                           <Loader2 className="animate-spin" size={18} />
//                         ) : (
//                           <>
//                             <Database size={18} />
//                             <span>Submit data</span>
//                           </>
//                         )}
//                       </button>
//                     </div>
//                   </div>

//                   {/* FOOTER ACTIONS */}
//                   <div className="flex justify-center pt-2 pb-8">
//                     <button
//                       type="button"
//                       onClick={() => setStep(4)}
//                       className="text-[10px] font-bold text-slate-400 uppercase tracking-widest hover:text-slate-900 transition-colors flex items-center gap-2 group"
//                     >
//                       <ChevronLeft
//                         size={16}
//                         className="group-hover:-translate-x-1 transition-transform"
//                       />
//                       Return to back page
//                     </button>
//                   </div>
//                 </div>
//               </div>
//             )}
//           </div>
//         </form>
//       </div>
//       <style
//         dangerouslySetInnerHTML={{
//           __html: `.custom-scrollbar-professional::-webkit-scrollbar { width: 6px; }.custom-scrollbar-professional::-webkit-scrollbar-track { background: transparent; }.custom-scrollbar-professional::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 20px; }.custom-scrollbar-professional::-webkit-scrollbar-thumb:hover { background: #CBD5E1; }`,
//         }}
//       />
//     </div>
//   );
// };

// export default ManualEntryPage;
//**********************************************working code phase 12 18/02/26************************************************************ */
// import React, { useState, useEffect, useRef } from "react";
// import { useParams, useNavigate } from "react-router-dom";
// import {
//   Check,
//   Award,
//   User,
//   Briefcase,
//   MapPin,
//   Loader2,
//   Plus,
//   Trash2,
//   Layers,
//   Cpu,
//   Database,
//   Globe,
//   ShieldCheck,
//   History,
//   X,
//   Edit3,
//   LinkIcon,
//   FileUp,
//   ChevronRight,
//   ChevronLeft,
//   ChevronDown,
// } from "lucide-react";
// import toast from "react-hot-toast";
// import { candidateService } from "../../services/candidateService";
// import { departmentService } from "../../services/department.service";

// const FormField = ({ label, required, error, children }) => (
//   <div className="space-y-1 w-full">
//     <label className="text-[10px] md:text-[11px] font-black text-slate-500 uppercase tracking-widest ml-1 flex justify-between items-center">
//       <span>{label}</span>
//       <span
//         className={`font-bold normal-case ${required ? "text-red-500" : "text-slate-300"}`}
//       >
//         {required ? "Required" : "Optional"}
//       </span>
//     </label>
//     {children}
//     {error && (
//       <p className="text-[9px] text-red-500 font-bold uppercase tracking-tighter ml-1">
//         {error}
//       </p>
//     )}
//   </div>
// );

// const ManualEntryPage = () => {
//   const { id } = useParams();
//   const navigate = useNavigate();
//   const effectiveId = id || "666";
//   const ASSET_OPTIONS = [
//     "Laptop",
//     "Mouse",
//     "Keyboard",
//     "Monitor",
//     "Headset",
//     "Mobile",
//     "ID Card",
//     "SIM Card",
//   ];
//   // Professional Enterprise Input Style
//   const inputStyle =
//     "w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-[13px] font-bold outline-none focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-500/5 transition-all shadow-sm";

//   // 1. INITIALIZE ALL STATES
//   const [step, setStep] = useState(1);
//   const [loading, setLoading] = useState(false);
//   const [fetchingData, setFetchingData] = useState(false);
//   const [errors, setErrors] = useState({});
//   const [isFetchingPincode, setIsFetchingPincode] = useState(false);
//   const [cityOptions, setCityOptions] = useState([]);
//   const [resumeMode, setResumeMode] = useState("file");
//   const [skillInput, setSkillInput] = useState("");
//   const [assetInput, setAssetInput] = useState("");
//   const [isFresher, setIsFresher] = useState(null);
//   const [deptSearch, setDeptSearch] = useState("");
//   const [eduSearch, setEduSearch] = useState("");
//   const [dynamicSkills, setDynamicSkills] = useState([]);
//   const [existingResume, setExistingResume] = useState("");

//   const [dynamicAssets, setDynamicAssets] = useState([]);
//   const [showSkillDrop, setShowSkillDrop] = useState(false);
//   const [showAssetDrop, setShowAssetDrop] = useState(false);
//   const [skillFocused, setSkillFocused] = useState(false);
//   const [departments, setDepartments] = useState([]);
//   const dropdownContainerRef = useRef(null);
//   const [existingCertificates, setExistingCertificates] = useState([]);
//   const [editingCertId, setEditingCertId] = useState(null);
//   const [editingCertValue, setEditingCertValue] = useState("");

//   const careerStepRef = useRef(null);

//   const [formData, setFormData] = useState({
//     name: "",
//     email: "",
//     phone: "",
//     address: "",
//     address2: "",
//     location: "",
//     pincode: "",
//     state: "",
//     city: "",
//     district: "",
//     country: "India",
//     position: "",
//     education: "",
//     gender: "",
//     dob: "",
//     experience: "",
//     about_me: "",
//     languages_spoken: [],
//     skills: [],
//     assets: [],
//     department: "",
//     cvFile: null,
//     resume_link: "",
//     certificateFiles: [],
//     certificateLinks: [""],
//     experiences: [],
//   });

//   const totalSteps = 5;

//   const educationOptions = [
//     "SSC / 10th",
//     "HSC / 12th",
//     "ITI",
//     "Diploma",
//     "Polytechnic",

//     "B.A",
//     "B.Com",
//     "B.Sc",
//     "BCA",
//     "BBA",
//     "B.Tech",
//     "BE",
//     "B.Pharm",
//     "B.Ed",

//     "M.A",
//     "M.Com",
//     "M.Sc",
//     "MCA",
//     "MBA",
//     "M.Tech",
//     "ME",
//     "M.Pharm",
//     "M.Ed",

//     "PGDM",
//     "Post Graduate Diploma",

//     "PhD / Doctorate",
//   ];

//   const POSITION_OPTIONS = [
//     // IT / Software
//     "Frontend Developer",
//     "Backend Developer",
//     "Full Stack Developer",
//     "Software Engineer",
//     "Senior Software Engineer",
//     "Lead Developer",
//     "DevOps Engineer",
//     "QA Engineer",
//     "Automation Tester",
//     "Manual Tester",
//     "UI/UX Designer",
//     "Mobile App Developer",
//     "Android Developer",
//     "iOS Developer",
//     "Data Analyst",
//     "Data Scientist",
//     "Machine Learning Engineer",
//     "AI Engineer",
//     "Cloud Engineer",
//     "System Administrator",
//     "Network Engineer",
//     "Cyber Security Analyst",

//     // Management / Office
//     "Project Manager",
//     "Product Manager",
//     "Operations Manager",
//     "Team Lead",
//     "Business Analyst",
//     "HR Executive",
//     "HR Manager",
//     "Recruiter",
//     "Office Administrator",

//     // Non-IT / General
//     "Accountant",
//     "Finance Executive",
//     "Sales Executive",
//     "Marketing Executive",
//     "Digital Marketing Specialist",
//     "Customer Support Executive",
//     "Technical Support Engineer",
//     "Field Executive",
//     "Supervisor",
//     "Store Manager",
//     "Warehouse Executive",

//     // Fresher / Entry
//     "Intern",
//     "Trainee",
//     "Graduate Engineer Trainee",
//     "Apprentice",
//   ];

//   const filteredEducation = educationOptions.filter((e) =>
//     e.toLowerCase().includes(eduSearch.toLowerCase()),
//   );
//   const filteredDepartments = departments.filter((d) =>
//     (d.name || "").toLowerCase().includes(deptSearch.toLowerCase()),
//   );
//   const isStep1Valid =
//     formData.name && /^\S+@\S+\.\S+$/.test(formData.email) && formData.phone;

//   // 2. HYDRATION LOGIC (GET API)
//   useEffect(() => {
//     const hydrateNode = async () => {
//       setFetchingData(true);
//       try {
//         const response = await fetch(
//           `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//         );
//         if (!response.ok) throw new Error();
//         const data = await response.json();

//         if (data) {
//           setExistingResume(data.resume_path || "");

//           setExistingCertificates(
//             Array.isArray(data.certificates) ? data.certificates : [],
//           );

//           const safeParse = (value) => {
//             if (!value) return [];

//             try {
//               // Already array â†’ fix broken JSON pieces
//               if (Array.isArray(value)) {
//                 const joined = value.join("");
//                 if (joined.startsWith("[")) {
//                   return JSON.parse(joined);
//                 }
//                 return value;
//               }

//               // If string JSON
//               if (typeof value === "string" && value.startsWith("[")) {
//                 return JSON.parse(value);
//               }

//               // If CSV string â†’ convert to array
//               if (typeof value === "string") {
//                 return value
//                   .split(",")
//                   .map((s) => s.trim())
//                   .filter(Boolean);
//               }

//               return [];
//             } catch {
//               return [];
//             }
//           };

//           setFormData((prev) => ({
//             ...prev,
//             name: data.full_name || "",
//             email: data.email || "",
//             phone: data.phone || "",
//             gender: data.gender || "",
//             dob: data.dob || "",
//             address: data.address || "",
//             address2: data.address2 || "",
//             location: data.location || "",
//             pincode: data.pincode || "",
//             city: data.city || "",
//             state: data.state || "",
//             district: data.district || "",
//             country: data.country || "India",
//             position: data.position || "",
//             experience: data.experience || "",
//             education: data.education || "",
//             department: data.department || "",
//             about_me: data.about_me || "",
//             resume_link: data.resume_path || "",
//             languages_spoken: safeParse(data.languages_spoken),
//             experiences: data.experiences || [],
//             skills: safeParse(data.skills),
//             assets: safeParse(data.assets),
//           }));

//           setIsFresher(!data.experiences || data.experiences.length === 0);
//         }

//         const deptData = await departmentService.getAll();
//         setDepartments(deptData || []);
//         await fetchSkills();
//         await fetchAssets(effectiveId);
//       } catch (err) {
//         console.warn("Initializing Empty Node");
//       } finally {
//         setFetchingData(false);
//       }
//     };
//     hydrateNode();
//   }, [effectiveId]);

//   // Click Outside to close dropdowns
//   useEffect(() => {
//     const handleClickOutside = (event) => {
//       if (
//         dropdownContainerRef.current &&
//         !dropdownContainerRef.current.contains(event.target)
//       ) {
//         setShowSkillDrop(false);
//         setShowAssetDrop(false);
//         setSkillFocused(false);
//       }
//     };
//     document.addEventListener("mousedown", handleClickOutside);
//     return () => document.removeEventListener("mousedown", handleClickOutside);
//   }, []);

//   // 3. HANDLERS
//   const fetchSkills = async () => {
//     try {
//       const res = await fetch(
//         "https://apihrr.goelectronix.co.in/masters/skills",
//       );
//       const data = await res.json();
//       setDynamicSkills(data.map((item) => item.name || item));
//     } catch {}
//   };

//   const fetchAssets = async (cId) => {
//     try {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${cId}/assets`,
//       );
//       const data = await res.json();
//       setDynamicAssets(Array.isArray(data) ? data.map((a) => a.name) : []);
//     } catch {}
//   };

//   const handleManualAddSkill = async () => {
//     const name = skillInput.trim();
//     if (!name) {
//       await fetchSkills();
//       return;
//     }
//     const success = await handleCreateMaster("skills", name);
//     if (success) {
//       if (!formData.skills.includes(name))
//         setFormData((p) => ({ ...p, skills: [...p.skills, name] }));
//       setSkillInput("");
//       await fetchSkills();
//     }
//   };

//   const handleCreateMaster = async (type, name) => {
//     try {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/masters/${type}`,
//         {
//           method: "POST",
//           headers: { "Content-Type": "application/json" },
//           body: JSON.stringify({ name: name.trim() }),
//         },
//       );
//       return res.ok;
//     } catch {
//       return false;
//     }
//   };

//   const handleAddAssetAPI = async (assetName) => {
//     if (!assetName.trim()) return;
//     const loadingToast = toast.loading(`Linking asset...`);
//     try {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/assets`,
//         {
//           method: "POST",
//           headers: { "Content-Type": "application/json" },
//           body: JSON.stringify({ name: assetName.trim() }),
//         },
//       );
//       if (res.ok) {
//         toast.success("Linked", { id: loadingToast });
//         await fetchAssets(effectiveId);
//         return true;
//       }
//     } catch {
//       toast.error("Sync failed", { id: loadingToast });
//     }
//     return false;
//   };

//   const handleSaveExperienceAPI = async (i) => {
//     console.log(formData);
//     const exp = formData.experiences[i];

//     if (
//       !exp.company_name?.trim() ||
//       !exp.job_title?.trim() ||
//       !exp.start_date ||
//       !exp.end_date
//     ) {
//       toast.error("Required: Company, Role, Start Date, End Date");
//       return;
//     }

//     const loadingToast = toast.loading("Saving experience...");

//     try {
//       const fd = new FormData();

//       // Required
//       fd.append("company_name", exp.company_name);
//       fd.append("job_title", exp.job_title);
//       fd.append("start_date", exp.start_date);
//       fd.append("end_date", exp.end_date);

//       // Optional (send empty safely)
//       fd.append(
//         "previous_ctc",
//         exp.previous_ctc ? Number(exp.previous_ctc) : "",
//       );

//       fd.append("location", exp.location ? exp.location : "");
//       fd.append("description", exp.description ? exp.description : "");

//       // LINK MODE
//       if (exp.uploadMode === "link") {
//         fd.append("exp_letter_link", exp.exp_letter_link || "");
//         // Do NOT overwrite existing file if link mode
//       }

//       // FILE MODE
//       else {
//         // Case 1: New file selected â†’ upload
//         if (exp.expLetterFile instanceof File) {
//           fd.append("exp_letter_file", exp.expLetterFile);
//         }

//         // Case 2: No new file BUT already saved file exists â†’ keep old
//         else if (exp.experience_letter_path) {
//           fd.append("experience_letter_path", exp.experience_letter_path);
//         }

//         // Case 3: Nothing exists â†’ send nothing (important)
//       }

//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/experiences`,
//         {
//           method: "POST",
//           body: fd, // â— Don't set Content-Type manually
//         },
//       );

//       if (!res.ok) {
//         const err = await res.text();
//         console.error(err);
//         throw new Error(err);
//       }

//       toast.success("Experience Saved âœ…", { id: loadingToast });
//     } catch (err) {
//       console.error(err);
//       toast.error("Failed to save experience âŒ", { id: loadingToast });
//     }
//   };

//   // const fetchPincodeDetails = async (pincode) => {
//   //   if (!/^\d{6}$/.test(pincode)) return;
//   //   setIsFetchingPincode(true);
//   //   try {
//   //     const res = await fetch(
//   //       `https://api.postalpincode.in/pincode/${pincode}`,
//   //     );
//   //     const data = await res.json();
//   //     if (data[0]?.Status === "Success") {
//   //       setCityOptions(data[0].PostOffice.map((o) => o.Name));
//   //       setFormData((p) => ({
//   //         ...p,
//   //         city: data[0].PostOffice[0].Name,
//   //         state: data[0].PostOffice[0].State,
//   //       }));
//   //     }
//   //   } finally {
//   //     setIsFetchingPincode(false);
//   //   }
//   // };

//   //   const fetchPincodeDetails = async (pincode) => {
//   //   if (!/^\d{6}$/.test(pincode)) return;

//   //   setIsFetchingPincode(true);

//   //   try {
//   //     const res = await fetch(
//   //       `https://api.postalpincode.in/pincode/${pincode}`
//   //     );
//   //     const data = await res.json();

//   //     if (data[0]?.Status === "Success" && data[0].PostOffice?.length > 0) {
//   //       const po = data[0].PostOffice[0];

//   //       setCityOptions(data[0].PostOffice.map((o) => o.Name));

//   //       setFormData((prev) => ({
//   //         ...prev,
//   //         city: po.Name || "",
//   //         district: po.District || "",   // â­ FIXED
//   //         state: po.State || "",
//   //         country: po.Country || "India" // â­ FIXED
//   //       }));
//   //     }
//   //   } catch (err) {
//   //     console.error("Pincode fetch error", err);
//   //   } finally {
//   //     setIsFetchingPincode(false);
//   //   }
//   // };

//   const fetchPincodeDetails = async (pincode) => {
//     if (!/^\d{6}$/.test(pincode)) return;

//     setIsFetchingPincode(true);

//     try {
//       const res = await fetch(
//         `https://api.postalpincode.in/pincode/${pincode}`,
//       );
//       const data = await res.json();

//       if (data[0]?.Status === "Success" && data[0].PostOffice?.length > 0) {
//         const postOffices = data[0].PostOffice;

//         setCityOptions(postOffices); // â­ store full objects

//         const first = postOffices[0];

//         setFormData((prev) => ({
//           ...prev,
//           city: first.Name || "",
//           district: first.District || "",
//           state: first.State || "",
//           country: first.Country || "India",
//         }));
//       } else {
//         setCityOptions([]);
//       }
//     } catch (err) {
//       console.error(err);
//       setCityOptions([]);
//     } finally {
//       setIsFetchingPincode(false);
//     }
//   };

//   const STEP_FIELDS = {
//     1: [
//       "name",
//       "email",
//       "phone",
//       "gender",
//       "dob",
//       "position",
//       "experience",
//       "education",
//       "department",
//       "about_me",
//       "languages_spoken",
//     ],

//     2: [
//       "address",
//       "address2",
//       "location",
//       "pincode",
//       "city",
//       "district",
//       "state",
//       "country",
//     ],

//     3: ["experiences"],

//     4: ["skills", "assets"],

//     5: ["resume_link", "cvFile", "certificateFiles", "certificateLinks"],
//   };

//   const fixResumeUrl = (url) => {
//     if (!url) return "";

//     // remove wrong https//
//     let clean = url.replace(/^https\/\//, "");

//     // if already full valid http/https â†’ keep it
//     if (clean.startsWith("http://") || clean.startsWith("https://")) {
//       return clean;
//     }

//     // attach correct base URL
//     return `https://apihrr.goelectronix.co.in/${clean.replace(/^\/+/, "")}`;
//   };

//   const fixResumeUrl2 = (url) => {
//     if (!url) return "";

//     let clean = url.trim();

//     // Fix broken https//
//     clean = clean.replace(/^https\/\//, "https://");

//     // ðŸ”´ If URL is https://uploads/... â†’ replace domain
//     if (clean.startsWith("https://uploads")) {
//       return clean.replace(
//         "https://uploads",
//         "https://apihrr.goelectronix.co.in/uploads",
//       );
//     }

//     // Already full valid URL â†’ return
//     if (clean.startsWith("http://") || clean.startsWith("https://")) {
//       return clean;
//     }

//     // Remove starting slash
//     clean = clean.replace(/^\/+/, "");

//     // Attach backend base
//     return `https://apihrr.goelectronix.co.in/${clean}`;
//   };

//   const hasExistingExperience =
//     Array.isArray(formData.experiences) && formData.experiences.length > 0;

//   const saveStepData = async (stepNumber) => {
//     try {
//       const apiData = new FormData();
//       const fields = STEP_FIELDS[stepNumber] || [];

//       fields.forEach((key) => {
//         if (key === "languages_spoken") {
//           apiData.append(
//             "languages_spoken",
//             (formData.languages_spoken || []).join(","),
//           );
//         } else if (key === "skills" || key === "assets") {
//           // apiData.append(key, JSON.stringify(formData[key] || []));
//           apiData.append(key, (formData[key] || []).join(","));
//         } else if (key === "experiences") {
//           apiData.append(
//             "experience_details",
//             JSON.stringify(formData.experiences || []),
//           );
//         } else if (key === "cvFile" && formData.cvFile) {
//           // apiData.append("resume", formData.cvFile);
//           apiData.append("resumepdf", formData.cvFile);
//         }
//         // CASE 2: Resume LINK
//         else if (key === "resume_link" && formData.resume_link) {
//           apiData.append("resume_link", formData.resume_link);
//         } else if (key === "certificateFiles") {
//           formData.certificateFiles.forEach((file) => {
//             apiData.append("certificates", file);
//           });
//         } else if (key === "certificateLinks") {
//           apiData.append(
//             "certificate_links",
//             JSON.stringify(
//               formData.certificateLinks.filter((l) => l && l.trim()),
//             ),
//           );
//         } else {
//           apiData.append(key, formData[key] ?? "");
//         }
//       });

//       apiData.append("full_name", formData.name || "");

//       await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//         {
//           method: "PATCH",
//           body: apiData,
//         },
//       );

//       toast.success(`Step ${stepNumber} saved`);
//     } catch (err) {
//       console.error(err);
//       toast.error("Auto save failed");
//     }
//   };

//   const handleSubmit = async (e) => {
//     e.preventDefault();
//     setLoading(true);

//     const loadingToast = toast.loading("Executing Final PATCH Sync...");

//     try {
//       const apiData = new FormData();

//       // ðŸ”¹ Append ALL simple fields (NO skipping empty)
//       for (const key in formData) {
//         if (
//           ![
//             "experiences",
//             "certificateFiles",
//             "languages_spoken",
//             "cvFile",
//             "skills",
//             "assets",
//           ].includes(key)
//         ) {
//           apiData.append(key, formData[key] ?? "");
//         }
//       }

//       // ðŸ”¹ Required backend fields
//       apiData.append("full_name", formData.name || "");

//       apiData.append(
//         "languages_spoken",
//         (formData.languages_spoken || []).join(","),
//       );

//       apiData.append("skills", (formData.skills || []).join(","));
//       apiData.append("assets", (formData.assets || []).join(","));

//       // // ðŸ”¹ Resume FILE
//       // if (formData.cvFile) {
//       //   apiData.append("resume", formData.cvFile);
//       // }

//       // // ðŸ”¹ Resume LINK
//       // if (formData.resume_link) {
//       //   apiData.append("resume_path", formData.resume_link);
//       // }

//       // CASE 1: Upload PDF
//       if (formData.cvFile) {
//         apiData.append("resumepdf", formData.cvFile); // âœ… correct key
//       }

//       // CASE 2: Resume Link
//       else if (formData.resume_link) {
//         apiData.append("resume_link", formData.resume_link); // âœ… correct key
//       }

//       // CASE 3: Keep existing resume (no change)
//       else if (existingResume) {
//         apiData.append("resume_link", existingResume);
//       }

//       // ðŸ”¹ Certificates FILES
//       formData.certificateFiles.forEach((file) => {
//         apiData.append("certificates", file);
//       });

//       // ðŸ”¹ Certificate LINKS
//       apiData.append(
//         "certificate_links",
//         JSON.stringify(formData.certificateLinks.filter((l) => l && l.trim())),
//       );

//       // ðŸ”¹ Debug â€” SEE WHAT GOES TO API
//       for (let pair of apiData.entries()) {
//         console.log(pair[0], pair[1]);
//       }

//       const response = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//         {
//           method: "PATCH",
//           body: apiData,
//         },
//       );

//       if (!response.ok) {
//         const err = await response.text();
//         console.error(err);
//         throw new Error("API Failed");
//       }

//       toast.success("Candidate Synchronized ðŸŽ‰", { id: loadingToast });
//     } catch (err) {
//       console.error(err);
//       toast.error("Commit failed âŒ", { id: loadingToast });
//     } finally {
//       setLoading(false);
//     }
//   };

//   const numberToIndianWords = (num) => {
//     if (!num || isNaN(num)) return "";

//     const ones = [
//       "",
//       "One",
//       "Two",
//       "Three",
//       "Four",
//       "Five",
//       "Six",
//       "Seven",
//       "Eight",
//       "Nine",
//       "Ten",
//       "Eleven",
//       "Twelve",
//       "Thirteen",
//       "Fourteen",
//       "Fifteen",
//       "Sixteen",
//       "Seventeen",
//       "Eighteen",
//       "Nineteen",
//     ];

//     const tens = [
//       "",
//       "",
//       "Twenty",
//       "Thirty",
//       "Forty",
//       "Fifty",
//       "Sixty",
//       "Seventy",
//       "Eighty",
//       "Ninety",
//     ];

//     const twoDigits = (n) =>
//       n < 20
//         ? ones[n]
//         : tens[Math.floor(n / 10)] + (n % 10 ? " " + ones[n % 10] : "");

//     const threeDigits = (n) => {
//       if (n === 0) return "";
//       if (n < 100) return twoDigits(n);
//       return (
//         ones[Math.floor(n / 100)] +
//         " Hundred" +
//         (n % 100 ? " " + twoDigits(n % 100) : "")
//       );
//     };

//     const crore = Math.floor(num / 10000000);
//     const lakh = Math.floor((num % 10000000) / 100000);
//     const thousand = Math.floor((num % 100000) / 1000);
//     const hundred = num % 1000;

//     let result = "";

//     if (crore) result += twoDigits(crore) + " Crore ";
//     if (lakh) result += twoDigits(lakh) + " Lakh ";
//     if (thousand) result += twoDigits(thousand) + " Thousand ";
//     if (hundred) result += threeDigits(hundred);

//     return result.trim() + " per annum";
//   };

//   const today = new Date();

//   // 18 years ago (max allowed DOB)
//   const maxDate = new Date(
//     today.getFullYear() - 18,
//     today.getMonth(),
//     today.getDate(),
//   )
//     .toISOString()
//     .split("T")[0];

//   // 70 years ago (min allowed DOB)
//   const minDate = new Date(
//     today.getFullYear() - 70,
//     today.getMonth(),
//     today.getDate(),
//   )
//     .toISOString()
//     .split("T")[0];

//   const [dobError, setDobError] = useState("");

//   const handleDobChange = (value) => {
//     setFormData({ ...formData, dob: value });

//     if (!value) {
//       setDobError("Date of Birth is required");
//       return;
//     }

//     const selected = new Date(value);

//     if (selected > new Date(maxDate)) {
//       setDobError("Age must be at least 18 years");
//     } else if (selected < new Date(minDate)) {
//       setDobError("Age must be below 70 years");
//     } else {
//       setDobError("");
//     }
//   };

//   if (fetchingData)
//     return (
//       <div className="min-h-screen flex flex-col items-center justify-center bg-slate-50 gap-4">
//         <Loader2 className="h-10 w-10 animate-spin text-blue-600" />
//         <p className="text-[11px] font-black uppercase tracking-[0.2em] text-slate-400">
//           Loading Data Load {effectiveId}...
//         </p>
//       </div>
//     );

//   return (
//     <div className="min-h-screen bg-[#F8FAFC] p-4 md:p-12 antialiased">
//       <div className="max-w-6xl mx-auto space-y-8" ref={dropdownContainerRef}>
//         {/* ROADMAP HEADER */}
//         <div className="flex flex-col lg:flex-row justify-between items-center bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 gap-8">
//           <div className="flex items-center gap-6">
//             <div className="h-16 w-16 bg-slate-900 rounded-[1.5rem] flex items-center justify-center text-white shadow-2xl">
//               <Database size={32} />
//             </div>
//             <div>
//               <h2 className="text-2xl font-black text-slate-900 tracking-tight leading-none">
//                 {id ? "Profile" : "Manual Registry"}
//               </h2>
//               <div className="flex items-center gap-2 mt-1 text-blue-600">
//                 <ShieldCheck size={14} />
//               </div>
//             </div>
//           </div>

//           <div className="flex-1 max-w-2xl w-full px-4">
//             <div className="relative flex justify-between items-center w-full">
//               <div className="absolute top-1/2 left-0 w-full h-0.5 bg-slate-100 -translate-y-1/2 z-0" />
//               <div
//                 className="absolute top-1/2 left-0 h-0.5 bg-blue-600 -translate-y-1/2 z-0 transition-all duration-700"
//                 style={{ width: `${((step - 1) / (totalSteps - 1)) * 100}%` }}
//               />
//               {[1, 2, 3, 4, 5].map((num) => (
//                 <div
//                   key={num}
//                   className="relative z-10 flex flex-col items-center gap-2"
//                 >
//                   <div
//                     className={`h-8 w-8 rounded-full flex items-center justify-center text-[10px] font-black transition-all border-4 ${step === num ? "bg-blue-600 text-white border-blue-100 scale-110 shadow-lg" : step > num ? "bg-emerald-500 text-white border-emerald-50" : "bg-white text-slate-300 border-slate-50"}`}
//                   >
//                     {step > num ? <Check size={14} strokeWidth={4} /> : num}
//                   </div>
//                   <span
//                     className={`absolute -bottom-6 text-[8px] font-black uppercase tracking-tighter transition-colors duration-300 ${step === num ? "text-blue-600" : "text-slate-300"}`}
//                   >
//                     {num === 1 && "Identity"} {num === 2 && "Location"}{" "}
//                     {num === 3 && "Experience"} {num === 4 && "Inventory"}{" "}
//                     {num === 5 && "Documents"}
//                   </span>
//                 </div>
//               ))}
//             </div>
//           </div>
//           <div className="bg-slate-50 border border-slate-200 rounded-2xl px-6 py-3 flex items-center gap-3 shadow-inner">
//             <div className="text-right">
//               <p className="text-[8px] font-black text-slate-400 uppercase leading-none">
//                 Status
//               </p>
//               <p className="text-sm font-black text-slate-900 mt-1">
//                 {Math.round((step / totalSteps) * 100)}%
//               </p>
//             </div>
//             <div className="h-8 w-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center">
//               <Check size={18} />
//             </div>
//           </div>
//         </div>

//         <form onSubmit={handleSubmit}>
//           <div className="space-y-12">
//             {/* STEP 1: IDENTITY & CAREER */}
//             {step === 1 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8 duration-500">
//                 <div className="flex items-center gap-4 pb-4 border-b border-slate-100">
//                   <User size={18} className="text-blue-600" />
//                   <h3 className="text-sm font-black text-slate-800 uppercase tracking-widest">
//                     Basic Candidate profile
//                   </h3>
//                 </div>
//                 <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
//                   <FormField label="Full Name" required>
//                     <input
//                       placeholder="Legal Name"
//                       value={formData.name}
//                       onChange={(e) =>
//                         setFormData({ ...formData, name: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <FormField label="Email" required>
//                     <input
//                       type="email"
//                       placeholder="name@domain.com"
//                       value={formData.email}
//                       onChange={(e) =>
//                         setFormData({ ...formData, email: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <FormField label="Phone" required>
//                     <div className="flex items-center bg-slate-50 border border-slate-200 rounded-xl overflow-hidden focus-within:bg-white focus-within:border-blue-500 transition-all shadow-sm">
//                       <span className="px-3 text-[11px] font-black text-slate-400">
//                         +91
//                       </span>
//                       <input
//                         maxLength={10}
//                         value={formData.phone}
//                         onChange={(e) =>
//                           setFormData({ ...formData, phone: e.target.value })
//                         }
//                         className="w-full px-3 py-2 bg-transparent text-[13px] font-bold outline-none"
//                       />
//                     </div>
//                   </FormField>
//                   <FormField label="Gender">
//                     <select
//                       value={formData.gender}
//                       onChange={(e) =>
//                         setFormData({ ...formData, gender: e.target.value })
//                       }
//                       className={inputStyle}
//                     >
//                       <option value="">Select</option>
//                       <option value="male">Male</option>
//                       <option value="female">Female</option>
//                       <option value="transgender">Transgender</option>
//                       <option value="prefer_not_to_say">
//                         Prefer not to say
//                       </option>
//                     </select>
//                   </FormField>
//                 </div>

//                 <div className="grid grid-cols-1 md:grid-cols-2 gap-8 pt-4">
//                   <FormField label="Date of Birth">
//                     <input
//                       type="date"
//                       min={minDate}
//                       max={maxDate}
//                       value={formData.dob}
//                       onChange={(e) =>
//                         setFormData({ ...formData, dob: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <FormField label="Languages">
//                     <div className="bg-slate-50 border border-slate-200 rounded-xl p-3 max-h-32 overflow-y-auto grid grid-cols-2 gap-3 shadow-inner">
//                       {[
//                         "English",
//                         "Hindi",
//                         "Marathi",
//                         "Gujarati",
//                         "Tamil",
//                         "Telugu",
//                       ].map((lang) => (
//                         <label
//                           key={lang}
//                           className="flex items-center gap-2 text-[11px] font-medium text-slate-600 cursor-pointer hover:text-blue-600 transition-colors"
//                         >
//                           <input
//                             type="checkbox"
//                             checked={formData.languages_spoken.includes(lang)}
//                             onChange={() => {
//                               const u = formData.languages_spoken.includes(lang)
//                                 ? formData.languages_spoken.filter(
//                                     (l) => l !== lang,
//                                   )
//                                 : [...formData.languages_spoken, lang];
//                               setFormData({ ...formData, languages_spoken: u });
//                             }}
//                             className="w-3.5 h-3.5 accent-blue-600 rounded"
//                           />{" "}
//                           {lang}
//                         </label>
//                       ))}
//                     </div>
//                   </FormField>
//                 </div>
//                 <FormField label="Bio Summary">
//                   <textarea
//                     rows={3}
//                     value={formData.about_me}
//                     onChange={(e) =>
//                       setFormData({ ...formData, about_me: e.target.value })
//                     }
//                     className={inputStyle + " resize-none"}
//                   />
//                 </FormField>
//                 <div className="flex justify-end pt-4">
//                   <button
//                     type="button"
//                     // onClick={() => setStep(2)}
//                     onClick={async () => {
//                       await saveStepData(1);
//                       setStep(2);
//                     }}
//                     className={`px-12 py-3 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest shadow-xl active:scale-95 transition-all`}
//                   >
//                     Next Phase â†’
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 2: GEOGRAPHY */}
//             {step === 2 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8">
//                 <div className="flex items-center gap-3 pb-4 border-b border-slate-100">
//                   <MapPin size={18} className="text-blue-600" />
//                   <h3 className="text-xs font-black text-slate-800 uppercase tracking-widest">
//                     location Data
//                   </h3>
//                 </div>
//                 <div className="space-y-8">
//                   <FormField label="Address 1" required>
//                     <input
//                       value={formData.address}
//                       onChange={(e) =>
//                         setFormData({ ...formData, address: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                     <FormField label="Address 2" required>
//                       <input
//                         value={formData.location}
//                         onChange={(e) =>
//                           setFormData({ ...formData, location: e.target.value })
//                         }
//                         className={inputStyle}
//                       />
//                     </FormField>
//                     <FormField label="Pincode" required>
//                       <input
//                         maxLength={6}
//                         placeholder="000000"
//                         value={formData.pincode}
//                         onChange={(e) => {
//                           setFormData({ ...formData, pincode: e.target.value });
//                           if (e.target.value.length === 6)
//                             fetchPincodeDetails(e.target.value);
//                         }}
//                         className={inputStyle}
//                       />
//                     </FormField>
//                   </div>
//                   <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
//                     {/* <FormField label="City">
//                       <input
//                         // value={formData.city}
//                         value={isFetchingPincode ? "Fetching..." : formData.city}
//                         readOnly
//                         className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                       />
//                     </FormField> */}
//                     <FormField label="City">
//                       {isFetchingPincode ? (
//                         <input
//                           value="Fetching..."
//                           readOnly
//                           className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-400 shadow-inner"
//                         />
//                       ) : cityOptions.length > 1 ? (
//                         <select
//                           value={formData.city}
//                           onChange={(e) => {
//                             const selected = cityOptions.find(
//                               (c) => c.Name === e.target.value,
//                             );

//                             setFormData((prev) => ({
//                               ...prev,
//                               city: selected?.Name || "",
//                               district: selected?.District || "",
//                               state: selected?.State || "",
//                               country: selected?.Country || "India",
//                             }));
//                           }}
//                           className="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl text-xs font-bold text-slate-700 shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100"
//                         >
//                           {cityOptions.map((c, i) => (
//                             <option key={i} value={c.Name}>
//                               {c.Name}
//                             </option>
//                           ))}
//                         </select>
//                       ) : (
//                         <input
//                           value={formData.city || ""}
//                           readOnly
//                           className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                         />
//                       )}
//                     </FormField>

//                     <FormField label="District">
//                       <input
//                         // value={formData.district}
//                         value={
//                           isFetchingPincode ? "Fetching..." : formData.district
//                         }
//                         readOnly
//                         className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                       />
//                     </FormField>
//                     <FormField label="State">
//                       <input
//                         // value={formData.state}
//                         value={
//                           isFetchingPincode ? "Fetching..." : formData.state
//                         }
//                         readOnly
//                         className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                       />
//                     </FormField>
//                     <FormField label="Country">
//                       <input
//                         // value={formData.country}
//                         value={
//                           isFetchingPincode ? "Fetching..." : formData.country
//                         }
//                         readOnly
//                         onChange={(e) =>
//                           setFormData({ ...formData, country: e.target.value })
//                         }
//                         className={inputStyle}
//                       />
//                     </FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-between pt-8 border-t border-slate-50">
//                   <button
//                     onClick={() => setStep(1)}
//                     type="button"
//                     className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase hover:text-slate-900 transition-all shadow-sm"
//                   >
//                     â† Back
//                   </button>
//                   <button
//                     //  onClick={() => setStep(3)}
//                     onClick={async () => {
//                       await saveStepData(2);
//                       setStep(3);
//                     }}
//                     type="button"
//                     className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase shadow-xl transition-all"
//                   >
//                     Continue â†’
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 3: EXPERIENCE */}
//             {step === 3 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
//                 <div className="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-sm transition-all overflow-hidden">
//                   <div className="flex flex-col md:flex-row items-center justify-between gap-6">
//                     <div className="flex items-center gap-4 text-slate-900 font-black">
//                       <Briefcase size={24} className="text-blue-600" />
//                       <div>
//                         <h3 className="text-sm uppercase tracking-widest">
//                           Are you Fresher?
//                         </h3>
//                         <p className="text-[10px] font-bold text-slate-400 mt-1">
//                           Select current career status
//                         </p>
//                       </div>
//                     </div>
//                     <div className="flex bg-slate-100 p-1.5 rounded-[1.5rem] border border-slate-200 w-full md:w-auto">
//                       {/* <button
//                         type="button"
//                         onClick={() => {
//                           setIsFresher(true);
//                           setFormData({ ...formData, experiences: [] });
//                         }}
//                         className={`px-8 py-2.5 rounded-2xl text-[10px] font-black transition-all ${isFresher === true ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}
//                       >
//                         Yes
//                       </button> */}
//                       <button
//                         type="button"
//                         disabled={hasExistingExperience} // â­ disable when experience present
//                         onClick={() => {
//                           if (hasExistingExperience) return; // safety
//                           setIsFresher(true);
//                           setFormData({ ...formData, experiences: [] });
//                         }}
//                         className={`px-8 py-2.5 rounded-2xl text-[10px] font-black transition-all
//   ${
//     hasExistingExperience
//       ? "bg-slate-100 text-slate-300 cursor-not-allowed" // disabled style
//       : isFresher === true
//         ? "bg-white text-blue-600 shadow-sm border"
//         : "text-slate-400"
//   }`}
//                       >
//                         Yes
//                       </button>

//                       <button
//                         type="button"
//                         onClick={() => {
//                           setIsFresher(false);

//                           if (
//                             !formData.experiences ||
//                             formData.experiences.length === 0
//                           ) {
//                             setFormData({
//                               ...formData,
//                               experiences: [
//                                 {
//                                   company_name: "",
//                                   job_title: "",
//                                   start_date: "",
//                                   end_date: "",
//                                   industry: "",
//                                   previous_ctc: "",
//                                   location: "",
//                                   description: "",
//                                   exp_letter_link: "",
//                                   uploadMode: "file",
//                                 },
//                               ],
//                             });
//                           }
//                         }}
//                         className={`px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === false ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}
//                       >
//                         No
//                       </button>
//                     </div>
//                   </div>
//                 </div>

//                 {isFresher === false && (
//                   <div className="bg-white p-6 md:p-10 rounded-[3.5rem] border border-slate-200 shadow-xl space-y-10 animate-in fade-in duration-500 shadow-slate-100">
//                     <div className="flex flex-col sm:flex-row justify-between items-start border-b border-slate-100 pb-8">
//                       <div className="flex items-center gap-4">
//                         <div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg">
//                           <History size={20} />
//                         </div>
//                         <h3 className="text-sm font-black text-slate-900 uppercase">
//                           Career Timeline
//                         </h3>
//                       </div>
//                       <button
//                         type="button"
//                         onClick={() =>
//                           setFormData({
//                             ...formData,
//                             experiences: [
//                               ...formData.experiences,
//                               {
//                                 company_name: "",
//                                 job_title: "",
//                                 start_date: "",
//                                 industry: "",
//                                 end_date: "",
//                                 previous_ctc: "",
//                                 location: "",
//                                 description: "",
//                                 exp_letter_link: "",
//                                 uploadMode: "file",
//                               },
//                             ],
//                           })
//                         }
//                         className="px-6 py-3 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase shadow-lg active:scale-95 transition-all"
//                       >
//                         + Add Experiance
//                       </button>
//                     </div>
//                     <div className="space-y-10 max-h-[600px] overflow-y-auto pr-4 custom-scrollbar-professional">
//                       {formData.experiences.map((exp, i) => (
//                         <div
//                           key={i}
//                           className="relative bg-slate-50/50 border border-slate-200 p-8 rounded-[2.5rem] space-y-8 animate-in zoom-in-95 group hover:bg-white transition-all shadow-inner"
//                         >
//                           <button
//                             type="button"
//                             onClick={() => {
//                               if (formData.experiences.length === 1) return;
//                               setFormData({
//                                 ...formData,
//                                 experiences: formData.experiences.filter(
//                                   (_, idx) => idx !== i,
//                                 ),
//                               });
//                             }}
//                             className="absolute -top-3 -right-3 h-10 w-10 bg-white border border-slate-200 text-red-500 rounded-full flex items-center justify-center shadow-lg transition-all opacity-0 group-hover:opacity-100 z-20"
//                           >
//                             <Trash2 size={18} />
//                           </button>
//                           <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
//                             <FormField label="Employer">
//                               <input
//                                 value={exp.company_name}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].company_name = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                             <FormField label="Designation">
//                               <input
//                                 value={exp.job_title}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].job_title = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                             <FormField label="Industry">
//                               <select
//                                 value={exp.industry || ""}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].industry = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               >
//                                 <option value="">Select Industry</option>
//                                 <option>Information Technology</option>
//                                 <option>Software Development</option>
//                                 <option>Banking & Finance</option>
//                                 <option>Healthcare</option>
//                                 <option>Education</option>
//                                 <option>Manufacturing</option>
//                                 <option>Retail</option>
//                                 <option>Telecom</option>
//                                 <option>Construction</option>
//                                 <option>Logistics</option>
//                                 <option>Marketing & Advertising</option>
//                                 <option>HR / Recruitment</option>
//                                 <option>Government</option>
//                                 <option>Other</option>
//                               </select>
//                             </FormField>
//                           </div>

//                           <div className="grid grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8">
//                             <FormField label="Start">
//                               <input
//                                 type="date"
//                                 value={exp.start_date}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].start_date = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                             <FormField label="End">
//                               <input
//                                 type="date"
//                                 value={exp.end_date}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].end_date = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                             {/* <FormField label="CTC">
//                               <input
//                                 type="number"
//                                 placeholder="â‚¹"
//                                 value={exp.previous_ctc}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].previous_ctc = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField> */}
//                             {/* <FormField label="CTC">
//   <div>
//     <input
//       type="number"
//       placeholder="â‚¹"
//       value={exp.previous_ctc}
//       onChange={(e) => {
//         const u = [...formData.experiences];
//         u[i].previous_ctc = e.target.value;
//         setFormData({ ...formData, experiences: u });
//       }}
//       className={inputStyle}
//     />

//     {exp.previous_ctc && (
//       <p className="text-[10px] font-bold text-blue-600 mt-1 ml-1">
//         {numberToIndianWords(Number(exp.previous_ctc))}
//       </p>
//     )}
//   </div>
// </FormField> */}

//                             <FormField label="Annual CTC">
//                               <div className="relative">
//                                 {/* Visual Wrapper for Input */}
//                                 <div className="flex items-center bg-slate-50 border border-slate-200 rounded-2xl overflow-hidden focus-within:bg-white focus-within:border-blue-500 focus-within:ring-4 focus-within:ring-blue-500/10 transition-all duration-300 shadow-sm">
//                                   {/* Currency Identity */}
//                                   <div className="px-5 py-3 border-r border-slate-200/60 bg-slate-100/50 flex items-center justify-center">
//                                     <span className="text-sm font-black text-blue-600">
//                                       â‚¹
//                                     </span>
//                                   </div>

//                                   {/* Your Existing Input & Logic */}
//                                   <input
//                                     type="number"
//                                     placeholder="0.00"
//                                     value={exp.previous_ctc}
//                                     onChange={(e) => {
//                                       const u = [...formData.experiences];
//                                       u[i].previous_ctc = e.target.value;
//                                       setFormData({
//                                         ...formData,
//                                         experiences: u,
//                                       });
//                                     }}
//                                     className="w-full px-4 py-3 bg-transparent text-[13px] font-bold text-slate-700 outline-none placeholder:text-slate-300"
//                                   />

//                                   {/* Industry Standard Suffix */}
//                                   <div className="pr-5">
//                                     <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">
//                                       LPA
//                                     </span>
//                                   </div>
//                                 </div>

//                                 {/* Your Existing Word Conversion Logic with Professional Styling */}
//                                 {exp.previous_ctc && (
//                                   <div className="absolute -bottom-6 left-1 flex items-center gap-2 animate-in fade-in slide-in-from-top-1">
//                                     <div className="h-1.5 w-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.4)]" />
//                                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest italic">
//                                       {numberToIndianWords(
//                                         Number(exp.previous_ctc),
//                                       )}{" "}
//                                       Rupees
//                                     </p>
//                                   </div>
//                                 )}
//                               </div>
//                             </FormField>

//                             <FormField label="City">
//                               <input
//                                 value={exp.location}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].location = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                           </div>

//                           <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
//                             <FormField label="Job Description">
//                               <textarea
//                                 rows={5}
//                                 value={exp.description}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].description = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={
//                                   inputStyle +
//                                   " resize-none h-full min-h-[140px]"
//                                 }
//                               />
//                             </FormField>
//                             <div className="space-y-3">
//                               <div className="flex justify-between items-center px-1">
//                                 <p className="text-[10px] font-black text-slate-400 uppercase">
//                                   Experience Letter
//                                 </p>
//                                 <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200">
//                                   <button
//                                     type="button"
//                                     onClick={() => {
//                                       const u = [...formData.experiences];
//                                       u[i].uploadMode = "file";
//                                       setFormData({
//                                         ...formData,
//                                         experiences: u,
//                                       });
//                                     }}
//                                     className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode !== "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                                   >
//                                     FILE
//                                   </button>
//                                   <button
//                                     type="button"
//                                     onClick={() => {
//                                       const u = [...formData.experiences];
//                                       u[i].uploadMode = "link";
//                                       setFormData({
//                                         ...formData,
//                                         experiences: u,
//                                       });
//                                     }}
//                                     className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                                   >
//                                     URL
//                                   </button>
//                                 </div>
//                               </div>
//                               <div className="bg-white/50 border border-slate-100 rounded-3xl p-4 min-h-[140px] flex flex-col justify-center">
//                                 {/* {exp.uploadMode !== "link" ? (
//                                   <label className="flex flex-col items-center justify-center gap-3 w-full h-full border-2 border-dashed border-slate-200 rounded-2xl hover:bg-blue-50/30 cursor-pointer group p-4 transition-all">
//                                     <FileUp
//                                       size={24}
//                                       className="text-slate-400 group-hover:text-blue-500"
//                                     />
//                                     <span className="text-[9px] font-bold text-slate-500 uppercase tracking-widest text-center">
//                                       {exp.exp_letter_file_path
//                                         ? "Saved File Present"
//                                         : exp.expLetterFile
//                                           ? exp.expLetterFile.name
//                                           : "Drop PDF Validation"}
//                                     </span>
//                                     <input
//                                       type="file"
//                                       accept=".pdf"
//                                       className="hidden"
//                                       onChange={(e) => {
//                                         const u = [...formData.experiences];
//                                         u[i].expLetterFile = e.target.files[0];
//                                         setFormData({
//                                           ...formData,
//                                           experiences: u,
//                                         });
//                                       }}
//                                     />
//                                   </label>
//                                 )
//                                  : ( */}

//                                 {exp.uploadMode !== "link" ? (
//                                   <label className="flex flex-col items-center justify-center gap-3 w-full h-full border-2 border-dashed border-slate-200 rounded-2xl hover:bg-blue-50/30 cursor-pointer group p-4 transition-all">
//                                     <FileUp
//                                       size={24}
//                                       className="text-slate-400 group-hover:text-blue-500"
//                                     />

//                                     {/* TEXT STATUS */}
//                                     <span className="text-[9px] font-bold text-slate-500 uppercase tracking-widest text-center">
//                                       {exp.expLetterFile
//                                         ? exp.expLetterFile.name
//                                         : exp.experience_letter_path
//                                           ? "Existing Experience Letter Available"
//                                           : "Drop PDF Validation"}
//                                     </span>

//                                     {/* VIEW EXISTING FILE */}
//                                     {exp.experience_letter_path &&
//                                       !exp.expLetterFile && (
//                                         <a
//                                           // href={exp.experience_letter_path}
//                                           href={fixResumeUrl2(
//                                             exp.experience_letter_path,
//                                           )}
//                                           target="_blank"
//                                           rel="noreferrer"
//                                           className="text-blue-600 text-[10px] underline"
//                                           onClick={(e) => e.stopPropagation()}
//                                         >
//                                           View Current File
//                                         </a>
//                                       )}

//                                     <input
//                                       type="file"
//                                       accept=".pdf"
//                                       className="hidden"
//                                       onChange={(e) => {
//                                         const u = [...formData.experiences];
//                                         u[i].expLetterFile = e.target.files[0];
//                                         setFormData({
//                                           ...formData,
//                                           experiences: u,
//                                         });
//                                       }}
//                                     />
//                                   </label>
//                                 ) : (
//                                   <div className="relative">
//                                     <LinkIcon
//                                       size={16}
//                                       className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                                     />
//                                     <input
//                                       placeholder="Storage URI"
//                                       value={exp.exp_letter_link || ""}
//                                       onChange={(e) => {
//                                         const u = [...formData.experiences];
//                                         u[i].exp_letter_link = e.target.value;
//                                         setFormData({
//                                           ...formData,
//                                           experiences: u,
//                                         });
//                                       }}
//                                       className={inputStyle + " pl-11"}
//                                     />
//                                   </div>
//                                 )}
//                               </div>
//                             </div>
//                           </div>
//                           <div className="flex justify-between pt-2 border-t border-slate-50">
//                             <button
//                               type="button"
//                               onClick={() =>
//                                 setFormData({
//                                   ...formData,
//                                   experiences: [
//                                     ...formData.experiences,
//                                     {
//                                       company_name: "",
//                                       job_title: "",
//                                       start_date: "",
//                                       industry: "",
//                                       end_date: "",
//                                       previous_ctc: "",
//                                       location: "",
//                                       description: "",
//                                       exp_letter_link: "",
//                                       uploadMode: "file",
//                                     },
//                                   ],
//                                 })
//                               }
//                               className="px-6 py-3 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase shadow-lg active:scale-95 transition-all"
//                             >
//                               + Add Experiance
//                             </button>
//                             <button
//                               type="button"
//                               onClick={() => handleSaveExperienceAPI(i)}
//                               className="flex items-center gap-2 px-8 py-3 bg-emerald-50 text-emerald-600 border border-emerald-100 rounded-2xl text-[10px] font-black uppercase hover:bg-emerald-500 hover:text-white transition-all active:scale-95 shadow-sm"
//                             >
//                               <Check size={16} strokeWidth={3} /> Save Record
//                             </button>
//                           </div>
//                         </div>
//                       ))}
//                     </div>
//                   </div>
//                 )}
//                 <div className="flex justify-between pt-4">
//                   <button
//                     onClick={() => setStep(2)}
//                     type="button"
//                     className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase shadow-sm transition-all hover:text-slate-900 flex items-center gap-2"
//                   >
//                     â† Back
//                   </button>
//                   <button
//                     onClick={async () => {
//                       await saveStepData(3);
//                       setStep(4);
//                     }}
//                     type="button"
//                     disabled={isFresher === null}
//                     className={`px-12 py-4 rounded-2xl text-xs font-black uppercase shadow-xl transition-all active:scale-95 ${isFresher !== null ? "bg-blue-600 text-white shadow-blue-600/30 hover:bg-blue-700" : "bg-slate-200 text-slate-400 cursor-not-allowed"}`}
//                   >
//                     Next Phase â†’
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 4: INVENTORY */}
//             {step === 4 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 overflow-visible">
//                 <div className="bg-white border border-slate-200 rounded-[3.5rem] shadow-xl overflow-visible shadow-slate-200/50">
//                   <div className="bg-slate-50/50 px-10 py-6 border-b border-slate-200 flex items-center justify-between rounded-t-[3.5rem]">
//                     <div className="flex items-center gap-4">
//                       <div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg">
//                         <Cpu size={20} />
//                       </div>
//                       <div>
//                         <h3 className="text-sm font-black text-slate-900 uppercase tracking-widest leading-none">
//                           Skills & Assets
//                         </h3>
//                       </div>
//                     </div>
//                   </div>
//                   <div className="p-8 md:p-12 space-y-12 overflow-visible">
//                     <FormField label="Skills">
//                       <div className="space-y-6">
//                         <div className="flex flex-col sm:flex-row gap-4 items-end">
//                           <div className="relative max-w-md w-full">
//                             <Plus
//                               size={16}
//                               className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                             />
//                             <input
//                               value={skillInput}
//                               onChange={(e) => setSkillInput(e.target.value)}
//                               onKeyDown={(e) => {
//                                 if (e.key === "Enter") {
//                                   e.preventDefault();
//                                   const name = skillInput.trim();
//                                   if (!name) return;

//                                   // prevent duplicate
//                                   if (!formData.skills.includes(name)) {
//                                     setFormData((prev) => ({
//                                       ...prev,
//                                       skills: [...prev.skills, name],
//                                     }));
//                                   }

//                                   setSkillInput("");
//                                 }
//                               }}
//                               placeholder="Register skill..."
//                               className={inputStyle + " pl-12"}
//                             />
//                           </div>
//                         </div>

//                         <div className="flex flex-wrap gap-3 p-1 w-full min-h-[40px]">
//                           {[
//                             ...new Set([...dynamicSkills, ...formData.skills]),
//                           ].map((skill) => {
//                             const isSelected = formData.skills.includes(skill);

//                             return (
//                               <button
//                                 key={skill}
//                                 type="button"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     skills: isSelected
//                                       ? formData.skills.filter(
//                                           (s) => s !== skill,
//                                         )
//                                       : [...formData.skills, skill],
//                                   })
//                                 }
//                                 className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${
//                                   isSelected
//                                     ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200"
//                                     : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"
//                                 }`}
//                               >
//                                 {skill}
//                                 {isSelected && (
//                                   <Check size={14} strokeWidth={3} />
//                                 )}
//                               </button>
//                             );
//                           })}
//                         </div>
//                       </div>
//                     </FormField>
//                     {/* <FormField label="Enterprise Hardware Matrix"><div className="space-y-6 pt-8 border-t border-slate-100"><div className="relative max-w-md w-full"><Layers size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={assetInput} onChange={(e) => setAssetInput(e.target.value)} onKeyDown={async (e) => { if(e.key === 'Enter') { e.preventDefault(); const v = assetInput.trim(); if(v && !formData.assets.includes(v)) { const ok = await handleAddAssetAPI(v); if(ok) { setFormData({...formData, assets: [...formData.assets, v]}); setAssetInput(""); } } } }} placeholder="Link hardware..." className={inputStyle + " pl-12"} /></div><div className="flex flex-wrap gap-3 p-1">{dynamicAssets.map((asset) => { const isSelected = formData.assets.includes(asset); return (<button key={asset} type="button" onClick={async () => { if(!isSelected) { const ok = await handleAddAssetAPI(asset); if(ok) setFormData({...formData, assets: [...formData.assets, asset]}); } else { setFormData({...formData, assets: formData.assets.filter(a => a !== asset)}); } }} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${isSelected ? "bg-slate-900 border-slate-900 text-white shadow-lg shadow-slate-200" : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`}>{asset} {isSelected && <Check size={14} strokeWidth={3} className="animate-in zoom-in" />}</button>); })}</div></div></FormField> */}
//                     <div className="space-y-6 pt-8 border-t border-slate-100">
//                       <FormField label="Assets">
//                         <div className="space-y-6">
//                           {/* Search & Manual Add Input */}
//                           <div className="relative max-w-md">
//                             <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">
//                               <Layers size={16} />
//                             </div>
//                             <input
//                               value={assetInput}
//                               onChange={(e) => setAssetInput(e.target.value)}
//                               // onKeyDown={async (e) => {
//                               //   if (e.key === "Enter") {
//                               //     e.preventDefault();
//                               //     const v = assetInput.trim();
//                               //     if (v && !formData.assets.includes(v)) {
//                               //       if (success) {
//                               //         setFormData({
//                               //           ...formData,
//                               //           assets: [...formData.assets, v],
//                               //         });
//                               //         setAssetInput("");
//                               //       }
//                               //     }
//                               //   }
//                               // }}
//                               onKeyDown={(e) => {
//                                 if (e.key === "Enter") {
//                                   e.preventDefault();
//                                   const v = assetInput.trim();
//                                   if (!v) return;

//                                   // Prevent duplicate
//                                   if (!formData.assets.includes(v)) {
//                                     setFormData((prev) => ({
//                                       ...prev,
//                                       assets: [...prev.assets, v],
//                                     }));
//                                   }

//                                   setAssetInput("");
//                                 }
//                               }}
//                               placeholder="Type hardware name and press Enter..."
//                               className="w-full pl-12 pr-4 py-3.5 bg-slate-50 border border-slate-200 rounded-2xl text-xs font-bold outline-none focus:bg-white focus:border-slate-900 focus:ring-4 focus:ring-slate-900/5 transition-all shadow-inner"
//                             />
//                           </div>

//                           {/* Asset Cloud */}
//                           {/* <div className="flex flex-wrap gap-3 p-1">
//                             {ASSET_OPTIONS.map((asset) => {
//                               const isSelected =
//                                 formData.assets.includes(asset);
//                               return (
//                                 <button
//                                   key={asset}
//                                   type="button"
//                                   onClick={async () => {
//                                     if (!isSelected) {
//                                       // API INTEGRATION on selection
//                                       const success =
//                                         await handleAddAssetAPI(asset);
//                                       if (success) {
//                                         setFormData({
//                                           ...formData,
//                                           assets: [...formData.assets, asset],
//                                         });
//                                       }
//                                     } else {
//                                       // Optional: Add delete API call here if needed
//                                       setFormData({
//                                         ...formData,
//                                         assets: formData.assets.filter(
//                                           (a) => a !== asset,
//                                         ),
//                                       });
//                                     }
//                                   }}
//                                   className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase tracking-wider transition-all duration-300 border-2 active:scale-90
//                                   ${
//                                     isSelected
//                                       ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200"
//                                       : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"
//                                   }`}
//                                 >
//                                   {asset}
//                                   {isSelected && (
//                                     <Check
//                                       size={14}
//                                       strokeWidth={3}
//                                       className="animate-in zoom-in"
//                                     />
//                                   )}
//                                 </button>
//                               );
//                             })}

                           
//                             {formData.assets
//                               .filter((a) => !ASSET_OPTIONS.includes(a))
//                               .map((customAsset) => (
//                                 <button
//                                   key={customAsset}
//                                   type="button"
//                                   onClick={() =>
//                                     setFormData({
//                                       ...formData,
//                                       assets: formData.assets.filter(
//                                         (a) => a !== customAsset,
//                                       ),
//                                     })
//                                   }
//                                   className="flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase tracking-wider bg-slate-900 border-2 border-slate-900 text-white shadow-lg active:scale-90"
//                                 >
//                                   {customAsset}{" "}
//                                   <Check size={14} strokeWidth={3} />
//                                 </button>
//                               ))}
//                           </div> */}

//                           {/* <div className="flex flex-wrap gap-3 p-1 w-full min-h-[40px]">

//   {[...new Set([...dynamicAssets, ...formData.assets])]
//     .filter(Boolean)
//     .map((asset) => {
//       const isSelected = formData.assets.includes(asset);

//       return (
//         <button
//           key={asset}
//           type="button"
//           onClick={() =>
//             setFormData((prev) => ({
//               ...prev,
//               assets: isSelected
//                 ? prev.assets.filter((a) => a !== asset)
//                 : [...prev.assets, asset],
//             }))
//           }
//           className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90
//           ${
//             isSelected
//               ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200"
//               : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"
//           }`}
//         >
//           {asset}
//           {isSelected && <Check size={14} strokeWidth={3} />}
//         </button>
//       );
//     })}
// </div> */}
//                           <div className="flex flex-wrap gap-3 p-1 w-full min-h-[40px]">
//                             {[
//                               ...new Set([
//                                 ...dynamicAssets,
//                                 ...formData.assets,
//                               ]),
//                             ].filter(
//                               (a) => typeof a === "string" && a.trim() !== "",
//                             ).length === 0 ? (
//                               /* âŒ NO ASSETS */
//                               <div className="w-full text-center py-6 bg-slate-50 border border-dashed border-slate-200 rounded-2xl">
//                                 <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">
//                                   No assets available
//                                 </p>
//                               </div>
//                             ) : (
//                               /* âœ… ASSET CHIPS */
//                               [
//                                 ...new Set([
//                                   ...dynamicAssets,
//                                   ...formData.assets,
//                                 ]),
//                               ]
//                                 .filter(
//                                   (a) =>
//                                     typeof a === "string" && a.trim() !== "",
//                                 )
//                                 .map((asset) => {
//                                   const isSelected =
//                                     formData.assets.includes(asset);

//                                   return (
//                                     <button
//                                       key={asset}
//                                       type="button"
//                                       onClick={() =>
//                                         setFormData((prev) => ({
//                                           ...prev,
//                                           assets: isSelected
//                                             ? prev.assets.filter(
//                                                 (a) => a !== asset,
//                                               )
//                                             : [...prev.assets, asset],
//                                         }))
//                                       }
//                                       className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90
//             ${
//               isSelected
//                 ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200"
//                 : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"
//             }`}
//                                     >
//                                       {asset}
//                                       {isSelected && (
//                                         <Check size={14} strokeWidth={3} />
//                                       )}
//                                     </button>
//                                   );
//                                 })
//                             )}
//                           </div>
//                         </div>
//                       </FormField>
//                     </div>
//                   </div>
//                 </div>
//                 <div className="flex justify-between items-center pt-4">
//                   <button
//                     onClick={() => setStep(3)}
//                     type="button"
//                     className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[11px] font-black uppercase transition-all shadow-sm hover:text-slate-900 flex items-center gap-2 transition-all"
//                   >
//                     <ChevronLeft size={16} /> Back
//                   </button>

//                   <button
//                     onClick={async () => {
//                       await saveStepData(4);
//                       setStep(5);
//                     }}
//                     type="button"
//                     className="px-12 py-4 bg-blue-600 text-white rounded-xl text-[11px] font-black uppercase shadow-xl active:scale-95 transition-all flex items-center gap-2 whitespace-nowrap"
//                   >
//                     Next Phase <ChevronRight size={14} />
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 5: DOCUMENT VAULT */}

//             {step === 5 && (
//               <div className="space-y-8 animate-in slide-in-from-bottom-8 duration-500">
//                 <div className="bg-white rounded-[2rem] shadow-2xl shadow-slate-200/50 border border-slate-200 overflow-hidden relative">
//                   {/* SECTION HEADER: Enterprise Indigo Theme */}
//                   <div className="bg-slate-50 px-8 py-6 border-b border-slate-200 flex items-center justify-between">
//                     <div className="flex items-center gap-5">
//                       <div className="h-12 w-12 bg-slate-900 rounded-2xl flex items-center justify-center text-white shadow-lg">
//                         <ShieldCheck size={24} />
//                       </div>
//                       <div>
//                         <h3 className="text-lg font-bold text-slate-900 tracking-tight">
//                           Document upload
//                         </h3>
//                         <p className="text-[11px] font-semibold text-slate-500 uppercase tracking-widest">
//                           Document Verification
//                         </p>
//                       </div>
//                     </div>
//                     <div className="hidden md:flex items-center gap-2 px-4 py-1.5 bg-blue-50 border border-blue-100 rounded-full">
//                       <div className="h-1.5 w-1.5 rounded-full bg-blue-500 animate-pulse" />
//                       <span className="text-[10px] font-bold text-blue-600 uppercase tracking-tighter">
//                         ready to save
//                       </span>
//                     </div>
//                   </div>

//                   <div className="p-8 md:p-12 space-y-12">
//                     <div className="grid grid-cols-1 lg:grid-cols-2 gap-12">
//                       {/* 1. MASTER RESUME SECTION */}
//                       <div className="space-y-6">
//                         <div className="flex justify-between items-center px-1">
//                           <div className="flex items-center gap-2">
//                             <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">
//                               01. Resume
//                             </span>
//                           </div>
//                           <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200 scale-90">
//                             <button
//                               type="button"
//                               onClick={() => setResumeMode("file")}
//                               className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === "file" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500 hover:text-slate-700"}`}
//                             >
//                               FILE
//                             </button>
//                             <button
//                               type="button"
//                               onClick={() => setResumeMode("link")}
//                               className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                             >
//                               URL
//                             </button>
//                           </div>
//                         </div>

//                         {resumeMode === "file" ? (
//                           <label className="flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-slate-200 rounded-3xl bg-slate-50/50 hover:bg-white hover:border-blue-500 transition-all cursor-pointer group">
//                             <div className="flex flex-col items-center gap-3">
//                               <div className="p-4 bg-white rounded-2xl shadow-sm border border-slate-100 group-hover:scale-110 transition-transform duration-500">
//                                 <FileUp
//                                   size={28}
//                                   className="text-slate-400 group-hover:text-blue-500"
//                                 />
//                               </div>
//                               {/* <span className="text-[11px] font-bold text-slate-500 uppercase tracking-widest">
//                                 {formData.cvFile
//                                   ? formData.cvFile.name
//                                   : "Commit Resume PDF"}
//                               </span> */}
//                               <span className="text-[11px] font-bold text-slate-500 uppercase tracking-widest">
//                                 {formData.cvFile
//                                   ? formData.cvFile.name
//                                   : existingResume
//                                     ? "Existing Resume Available"
//                                     : "Commit Resume PDF"}
//                               </span>

//                               {/* VIEW EXISTING RESUME */}
//                               {existingResume && !formData.cvFile && (
//                                 // <a
//                                 //   href={existingResume}
//                                 //   target="_blank"
//                                 //   rel="noreferrer"
//                                 //   className="text-blue-600 text-xs underline mt-1"
//                                 // >
//                                 //   View Current Resume
//                                 // </a>
//                                 <a
//                                   href={fixResumeUrl(existingResume)}
//                                   target="_blank"
//                                   rel="noreferrer"
//                                   className="text-blue-600 text-xs underline mt-1"
//                                 >
//                                   View Current Resume
//                                 </a>
//                               )}
//                             </div>
//                             <input
//                               type="file"
//                               accept=".pdf"
//                               className="hidden"
//                               onChange={(e) =>
//                                 setFormData({
//                                   ...formData,
//                                   cvFile: e.target.files[0],
//                                   resume_link: "",
//                                 })
//                               }
//                             />
//                           </label>
//                         ) : (
//                           <div className="relative">
//                             <LinkIcon
//                               size={18}
//                               className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                             />
//                             <input
//                               placeholder="Enter Public Storage URI..."
//                               value={formData.resume_link}
//                               onChange={(e) =>
//                                 setFormData({
//                                   ...formData,
//                                   resume_link: e.target.value,
//                                   cvFile: null,
//                                 })
//                               }
//                               className={inputStyle + " pl-12"}
//                             />
//                           </div>
//                         )}
//                       </div>

//                       {/* 2. CREDENTIALS MATRIX SECTION */}
//                       <div className="space-y-6">
//                         <div className="flex justify-between items-center px-1">
//                           <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">
//                             02. certificate
//                           </span>
//                           <div className="flex gap-2">
//                             <label className="cursor-pointer h-10 w-10 bg-slate-900 text-white rounded-xl hover:bg-blue-600 active:scale-90 transition-all flex items-center justify-center shadow-lg shadow-slate-200">
//                               <Plus size={18} />
//                               <input
//                                 type="file"
//                                 multiple
//                                 accept=".pdf"
//                                 className="hidden"
//                                 onChange={(e) =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateFiles: [
//                                       ...formData.certificateFiles,
//                                       ...Array.from(e.target.files),
//                                     ],
//                                   })
//                                 }
//                               />
//                             </label>
//                             <button
//                               type="button"
//                               onClick={() =>
//                                 setFormData({
//                                   ...formData,
//                                   certificateLinks: [
//                                     ...formData.certificateLinks,
//                                     "",
//                                   ],
//                                 })
//                               }
//                               className="h-10 w-10 bg-white text-slate-600 rounded-xl border border-slate-200 hover:border-blue-500 hover:text-blue-500 active:scale-90 transition-all flex items-center justify-center shadow-sm"
//                             >
//                               <LinkIcon size={18} />
//                             </button>
//                           </div>
//                         </div>

//                         <div className="grid grid-cols-1 gap-4 max-h-[220px] overflow-y-auto no-scrollbar pr-1">
//                           {/* EXISTING CERTIFICATES FROM SERVER */}
//                           {existingCertificates.map((url, idx) => (
//                             <div
//                               key={`existing-${idx}`}
//                               className="flex justify-between items-center bg-blue-50 p-4 rounded-2xl border border-blue-100"
//                             >
//                               <div className="flex items-center gap-3">
//                                 <div className="h-2 w-2 rounded-full bg-blue-500" />

//                                 <a
//                                   href={url}
//                                   target="_blank"
//                                   rel="noreferrer"
//                                   className="text-[12px] font-bold text-blue-700 underline truncate max-w-[200px]"
//                                 >
//                                   Existing Certificate {idx + 1}
//                                 </a>
//                               </div>

//                               <X
//                                 size={16}
//                                 className="text-red-400 hover:text-red-600 cursor-pointer"
//                                 onClick={() =>
//                                   setExistingCertificates((prev) =>
//                                     prev.filter((_, i) => i !== idx),
//                                   )
//                                 }
//                               />
//                             </div>
//                           ))}

//                           {formData.certificateFiles.map((file, idx) => (
//                             <div
//                               key={idx}
//                               className="flex justify-between items-center bg-slate-50 p-4 rounded-2xl border border-slate-100 hover:border-blue-300 transition-colors"
//                             >
//                               <div className="flex items-center gap-3">
//                                 <div className="h-2 w-2 rounded-full bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)]" />
//                                 <span className="text-[12px] font-bold text-slate-700 truncate max-w-[200px]">
//                                   {file.name}
//                                 </span>
//                               </div>
//                               <X
//                                 size={16}
//                                 className="text-slate-300 hover:text-red-500 cursor-pointer transition-all hover:rotate-90"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateFiles:
//                                       formData.certificateFiles.filter(
//                                         (_, i) => i !== idx,
//                                       ),
//                                   })
//                                 }
//                               />
//                             </div>
//                           ))}
//                           {formData.certificateLinks.map((link, idx) => (
//                             <div
//                               key={idx}
//                               className="flex gap-3 animate-in slide-in-from-right-4"
//                             >
//                               <div className="relative flex-1">
//                                 <Globe
//                                   size={16}
//                                   className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                                 />
//                                 <input
//                                   value={link}
//                                   placeholder="Public URI..."
//                                   onChange={(e) => {
//                                     const u = [...formData.certificateLinks];
//                                     u[idx] = e.target.value;
//                                     setFormData({
//                                       ...formData,
//                                       certificateLinks: u,
//                                     });
//                                   }}
//                                   className={inputStyle + " pl-11 !py-2.5"}
//                                 />
//                               </div>
//                               <button
//                                 type="button"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateLinks:
//                                       formData.certificateLinks.filter(
//                                         (_, i) => i !== idx,
//                                       ),
//                                   })
//                                 }
//                                 className="text-slate-300 hover:text-red-500 bg-slate-50 h-10 w-10 rounded-xl border border-slate-200 flex items-center justify-center"
//                               >
//                                 <Trash2 size={16} />
//                               </button>
//                             </div>
//                           ))}
//                           {formData.certificateFiles.length === 0 &&
//                             formData.certificateLinks.filter((l) => l)
//                               .length === 0 && (
//                               <div className="py-8 text-center bg-slate-50/50 border border-dashed border-slate-200 rounded-2xl">
//                                 <p className="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">
//                                   No secondary artifacts registered
//                                 </p>
//                               </div>
//                             )}
//                         </div>
//                       </div>
//                     </div>

//                     {/* METADATA INFO CARD */}
//                     <div className="bg-slate-900 rounded-3xl p-6 flex flex-col md:flex-row items-center justify-between gap-6 shadow-2xl">
//                       <div className="flex items-center gap-4">
//                         <div className="h-10 w-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400">
//                           <History size={20} />
//                         </div>
//                         <div>
//                           <p className="text-white text-xs font-bold tracking-wide uppercase">
//                             Final Validation
//                           </p>
//                           <p className="text-slate-400 text-[10px] uppercase font-semibold tracking-tighter">
//                             Employee Id {effectiveId} â€¢ Ready to submit
//                           </p>
//                         </div>
//                       </div>
//                       <button
//                         type="submit"
//                         // onClick={handleSubmit}
//                         onClick={async () => {
//                           setLoading(true);

//                           await saveStepData(5); // ðŸ”¥ FINAL API CALL HERE

//                           setLoading(false);

//                           toast.success("Candidate Saved âœ”");

//                           navigate("/candidate"); // redirect after save
//                         }}
//                         className="w-full md:w-auto px-10 py-3.5 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl text-[11px] font-black uppercase tracking-widest transition-all shadow-xl shadow-blue-600/20 active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3"
//                       >
//                         {loading ? (
//                           <Loader2 className="animate-spin" size={18} />
//                         ) : (
//                           <>
//                             <Database size={18} />
//                             <span>Submit data</span>
//                           </>
//                         )}
//                       </button>
//                     </div>
//                   </div>

//                   {/* FOOTER ACTIONS */}
//                   <div className="flex justify-center pt-2 pb-8">
//                     <button
//                       type="button"
//                       onClick={() => setStep(4)}
//                       className="text-[10px] font-bold text-slate-400 uppercase tracking-widest hover:text-slate-900 transition-colors flex items-center gap-2 group"
//                     >
//                       <ChevronLeft
//                         size={16}
//                         className="group-hover:-translate-x-1 transition-transform"
//                       />
//                       Return to back page
//                     </button>
//                   </div>
//                 </div>
//               </div>
//             )}
//           </div>
//         </form>
//       </div>
//       <style
//         dangerouslySetInnerHTML={{
//           __html: `.custom-scrollbar-professional::-webkit-scrollbar { width: 6px; }.custom-scrollbar-professional::-webkit-scrollbar-track { background: transparent; }.custom-scrollbar-professional::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 20px; }.custom-scrollbar-professional::-webkit-scrollbar-thumb:hover { background: #CBD5E1; }`,
//         }}
//       />
//     </div>
//   );
// };

// export default ManualEntryPage;
//************************************************working code phase 1 18/02/26************************************************************ */
// import React, { useState, useEffect, useRef } from "react";
// import { useParams, useNavigate } from "react-router-dom";
// import {
//   Check,
//   Award,
//   User,
//   Briefcase,
//   MapPin,
//   Loader2,
//   Plus,
//   Trash2,
//   Layers,
//   Cpu,
//   Database,
//   Globe,
//   ShieldCheck,
//   History,
//   X,
//   Edit3,
//   LinkIcon,
//   FileUp,
//   ChevronRight,
//   ChevronLeft,
//   ChevronDown,
// } from "lucide-react";
// import toast from "react-hot-toast";
// import { candidateService } from "../../services/candidateService";
// import { departmentService } from "../../services/department.service";

// const FormField = ({ label, required, error, children }) => (
//   <div className="space-y-1 w-full">
//     <label className="text-[10px] md:text-[11px] font-black text-slate-500 uppercase tracking-widest ml-1 flex justify-between items-center">
//       <span>{label}</span>
//       <span
//         className={`font-bold normal-case ${required ? "text-red-500" : "text-slate-300"}`}
//       >
//         {required ? "Required" : "Optional"}
//       </span>
//     </label>
//     {children}
//     {error && (
//       <p className="text-[9px] text-red-500 font-bold uppercase tracking-tighter ml-1">
//         {error}
//       </p>
//     )}
//   </div>
// );

// const ManualEntryPage = () => {
//   const { id } = useParams();
//   const navigate = useNavigate();
//   const effectiveId = id || "666";
//   const ASSET_OPTIONS = [
//     "Laptop",
//     "Mouse",
//     "Keyboard",
//     "Monitor",
//     "Headset",
//     "Mobile",
//     "ID Card",
//     "SIM Card",
//   ];
//   // Professional Enterprise Input Style
//   const inputStyle =
//     "w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-[13px] font-bold outline-none focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-500/5 transition-all shadow-sm";

//   // 1. INITIALIZE ALL STATES
//   const [step, setStep] = useState(1);
//   const [loading, setLoading] = useState(false);
//   const [fetchingData, setFetchingData] = useState(false);
//   const [errors, setErrors] = useState({});
//   const [isFetchingPincode, setIsFetchingPincode] = useState(false);
//   const [cityOptions, setCityOptions] = useState([]);
//   const [resumeMode, setResumeMode] = useState("file");
//   const [skillInput, setSkillInput] = useState("");
//   const [assetInput, setAssetInput] = useState("");
//   const [isFresher, setIsFresher] = useState(null);
//   const [deptSearch, setDeptSearch] = useState("");
//   const [eduSearch, setEduSearch] = useState("");
//   const [dynamicSkills, setDynamicSkills] = useState([]);
//   const [dynamicAssets, setDynamicAssets] = useState([]);
//   const [showSkillDrop, setShowSkillDrop] = useState(false);
//   const [showAssetDrop, setShowAssetDrop] = useState(false);
//   const [skillFocused, setSkillFocused] = useState(false);
//   const [departments, setDepartments] = useState([]);
// //   // Controls the visibility of the Add/Edit form
// // const [isAddingNew, setIsAddingNew] = useState(false);
// // const [editingIndex, setEditingIndex] = useState(null);

// // // Temporary state for the form so we don't overwrite live data until 'Save' is clicked
// // const emptyExp = {
// //   company_name: "",
// //   job_title: "",
// //   start_date: "",
// //   end_date: "",
// //   industry: "",
// //   previous_ctc: "",
// //   location: "",
// //   description: "",
// //   uploadMode: "file",
// // };
// // const [tempExp, setTempExp] = useState(emptyExp);

// // // Opens the form with existing data for editing
// // const handleStartEdit = (index) => {
// //   setEditingIndex(index);
// //   setTempExp(formData.experiences[index]);
// //   setIsAddingNew(false);
// // };

// // // Saves the form data back into the main formData
// // const handleConfirmSave = () => {
// //   const updatedExperiences = [...formData.experiences];

// //   if (editingIndex !== null) {
// //     // Update existing
// //     updatedExperiences[editingIndex] = tempExp;
// //   } else {
// //     // Add new
// //     updatedExperiences.push(tempExp);
// //   }

// //   setFormData({ ...formData, experiences: updatedExperiences });

// //   // Reset UI back to list view
// //   setEditingIndex(null);
// //   setIsAddingNew(false);
// //   setTempExp(emptyExp);
// // };

// // // Deletes a record
// // const handleDelete = (index) => {
// //   const updated = formData.experiences.filter((_, idx) => idx !== index);
// //   setFormData({ ...formData, experiences: updated });
// // };

//   const dropdownContainerRef = useRef(null);
//   const careerStepRef = useRef(null);

//   const [formData, setFormData] = useState({
//     name: "",
//     email: "",
//     phone: "",
//     address: "",
//     address2: "",
//     location: "",
//     pincode: "",
//     state: "",
//     city: "",
//     district: "",
//     country: "India",
//     position: "",
//     education: "",
//     gender: "",
//     dob: "",
//     experience: "",
//     about_me: "",
//     languages_spoken: [],
//     skills: [],
//     assets: [],
//     department: "",
//     cvFile: null,
//     resume_link: "",
//     certificateFiles: [],
//     certificateLinks: [""],
//     experiences: [],
//   });

//   const totalSteps = 5;

//   const educationOptions = [
//     "SSC / 10th",
//     "HSC / 12th",
//     "ITI",
//     "Diploma",
//     "Polytechnic",

//     "B.A",
//     "B.Com",
//     "B.Sc",
//     "BCA",
//     "BBA",
//     "B.Tech",
//     "BE",
//     "B.Pharm",
//     "B.Ed",

//     "M.A",
//     "M.Com",
//     "M.Sc",
//     "MCA",
//     "MBA",
//     "M.Tech",
//     "ME",
//     "M.Pharm",
//     "M.Ed",

//     "PGDM",
//     "Post Graduate Diploma",

//     "PhD / Doctorate",
//   ];

//   const POSITION_OPTIONS = [
//     // IT / Software
//     "Frontend Developer",
//     "Backend Developer",
//     "Full Stack Developer",
//     "Software Engineer",
//     "Senior Software Engineer",
//     "Lead Developer",
//     "DevOps Engineer",
//     "QA Engineer",
//     "Automation Tester",
//     "Manual Tester",
//     "UI/UX Designer",
//     "Mobile App Developer",
//     "Android Developer",
//     "iOS Developer",
//     "Data Analyst",
//     "Data Scientist",
//     "Machine Learning Engineer",
//     "AI Engineer",
//     "Cloud Engineer",
//     "System Administrator",
//     "Network Engineer",
//     "Cyber Security Analyst",

//     // Management / Office
//     "Project Manager",
//     "Product Manager",
//     "Operations Manager",
//     "Team Lead",
//     "Business Analyst",
//     "HR Executive",
//     "HR Manager",
//     "Recruiter",
//     "Office Administrator",

//     // Non-IT / General
//     "Accountant",
//     "Finance Executive",
//     "Sales Executive",
//     "Marketing Executive",
//     "Digital Marketing Specialist",
//     "Customer Support Executive",
//     "Technical Support Engineer",
//     "Field Executive",
//     "Supervisor",
//     "Store Manager",
//     "Warehouse Executive",

//     // Fresher / Entry
//     "Intern",
//     "Trainee",
//     "Graduate Engineer Trainee",
//     "Apprentice",
//   ];

//   const filteredEducation = educationOptions.filter((e) =>
//     e.toLowerCase().includes(eduSearch.toLowerCase()),
//   );
//   const filteredDepartments = departments.filter((d) =>
//     (d.name || "").toLowerCase().includes(deptSearch.toLowerCase()),
//   );
//   const isStep1Valid =
//     formData.name && /^\S+@\S+\.\S+$/.test(formData.email) && formData.phone;

//   // 2. HYDRATION LOGIC (GET API)
//   useEffect(() => {
//     const hydrateNode = async () => {
//       setFetchingData(true);
//       try {
//         const response = await fetch(
//           `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//         );
//         if (!response.ok) throw new Error();
//         const data = await response.json();

//         if (data) {
//           // const safeParse = (str) => {
//           //   if (!str) return [];
//           //   try {
//           //     if (Array.isArray(str)) {
//           //       if (typeof str[0] === "string" && str[0].startsWith("["))
//           //         return JSON.parse(str.join(""));
//           //       return str;
//           //     }
//           //     return JSON.parse(str);
//           //   } catch {
//           //     return [];
//           //   }
//           // };

//           const safeParse = (value) => {
//   if (!value) return [];

//   try {
//     // Already array â†’ fix broken JSON pieces
//     if (Array.isArray(value)) {
//       const joined = value.join("");
//       if (joined.startsWith("[")) {
//         return JSON.parse(joined);
//       }
//       return value;
//     }

//     // If string JSON
//     if (typeof value === "string" && value.startsWith("[")) {
//       return JSON.parse(value);
//     }

//     // If CSV string â†’ convert to array
//     if (typeof value === "string") {
//       return value.split(",").map((s) => s.trim()).filter(Boolean);
//     }

//     return [];
//   } catch {
//     return [];
//   }
// };

//           setFormData((prev) => ({
//             ...prev,
//             name: data.full_name || "",
//             email: data.email || "",
//             phone: data.phone || "",
//             gender: data.gender || "",
//             dob: data.dob || "",
//             address: data.address || "",
//             address2: data.address2 || "",
//             location: data.location || "",
//             pincode: data.pincode || "",
//             city: data.city || "",
//             state: data.state || "",
//             district: data.district || "",
//             country: data.country || "India",
//             position: data.position || "",
//             experience: data.experience || "",
//             education: data.education || "",
//             department: data.department || "",
//             about_me: data.about_me || "",
//             resume_link: data.resume_path || "",
//             languages_spoken: safeParse(data.languages_spoken),
//             experiences: data.experiences || [],
//             skills: safeParse(data.skills),
//             assets: safeParse(data.assets),
//           }));

//           setIsFresher(!data.experiences || data.experiences.length === 0);
//         }

//         const deptData = await departmentService.getAll();
//         setDepartments(deptData || []);
//         await fetchSkills();
//         await fetchAssets(effectiveId);
//       } catch (err) {
//         console.warn("Initializing Empty Node");
//       } finally {
//         setFetchingData(false);
//       }
//     };
//     hydrateNode();
//   }, [effectiveId]);

//   // Click Outside to close dropdowns
//   useEffect(() => {
//     const handleClickOutside = (event) => {
//       if (
//         dropdownContainerRef.current &&
//         !dropdownContainerRef.current.contains(event.target)
//       ) {
//         setShowSkillDrop(false);
//         setShowAssetDrop(false);
//         setSkillFocused(false);
//       }
//     };
//     document.addEventListener("mousedown", handleClickOutside);
//     return () => document.removeEventListener("mousedown", handleClickOutside);
//   }, []);

//   // 3. HANDLERS
//   const fetchSkills = async () => {
//     try {
//       const res = await fetch(
//         "https://apihrr.goelectronix.co.in/masters/skills",
//       );
//       const data = await res.json();
//       setDynamicSkills(data.map((item) => item.name || item));
//     } catch {}
//   };

//   const fetchAssets = async (cId) => {
//     try {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${cId}/assets`,
//       );
//       const data = await res.json();
//       setDynamicAssets(Array.isArray(data) ? data.map((a) => a.name) : []);
//     } catch {}
//   };

//   const handleManualAddSkill = async () => {
//     const name = skillInput.trim();
//     if (!name) {
//       await fetchSkills();
//       return;
//     }
//     const success = await handleCreateMaster("skills", name);
//     if (success) {
//       if (!formData.skills.includes(name))
//         setFormData((p) => ({ ...p, skills: [...p.skills, name] }));
//       setSkillInput("");
//       await fetchSkills();
//     }
//   };

//   const handleCreateMaster = async (type, name) => {
//     try {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/masters/${type}`,
//         {
//           method: "POST",
//           headers: { "Content-Type": "application/json" },
//           body: JSON.stringify({ name: name.trim() }),
//         },
//       );
//       return res.ok;
//     } catch {
//       return false;
//     }
//   };

//   const handleAddAssetAPI = async (assetName) => {
//     if (!assetName.trim()) return;
//     const loadingToast = toast.loading(`Linking asset...`);
//     try {
//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/assets`,
//         {
//           method: "POST",
//           headers: { "Content-Type": "application/json" },
//           body: JSON.stringify({ name: assetName.trim() }),
//         },
//       );
//       if (res.ok) {
//         toast.success("Linked", { id: loadingToast });
//         await fetchAssets(effectiveId);
//         return true;
//       }
//     } catch {
//       toast.error("Sync failed", { id: loadingToast });
//     }
//     return false;
//   };

//   // const handleSaveExperienceAPI = async (i) => {
//   //   const exp = formData.experiences[i];

//   //   if (
//   //     !exp.company_name ||
//   //     !exp.job_title ||
//   //     !exp.start_date ||
//   //     !exp.end_date
//   //   ) {
//   //     toast.error("Required: Company, Role, Start Date, End Date");
//   //     return;
//   //   }

//   //   const loadingToast = toast.loading("Saving experience...");

//   //   try {
//   //     const fd = new FormData();

//   //     fd.append("company_name", exp.company_name);
//   //     fd.append("job_title", exp.job_title);
//   //     fd.append("start_date", exp.start_date);
//   //     fd.append("end_date", exp.end_date);
//   //     fd.append("previous_ctc", exp.previous_ctc || 0);
//   //     fd.append("location", exp.location || "");
//   //     fd.append("description", exp.description || "");

//   //     // If using link
//   //     if (exp.exp_letter_link) {
//   //       fd.append("experience_letter_path", exp.exp_letter_link);
//   //     }

//   //     // If using file upload
//   //     if (exp.expLetterFile) {
//   //       fd.append("experience_letter", exp.expLetterFile);
//   //     }

//   //     const res = await fetch(
//   //       `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/experiences`,
//   //       {
//   //         method: "POST",
//   //         body: fd, // â— DO NOT set Content-Type manually
//   //       },
//   //     );

//   //     if (!res.ok) {
//   //       const err = await res.text();
//   //       console.error(err);
//   //       throw new Error();
//   //     }

//   //     toast.success("Experience Saved âœ…", { id: loadingToast });
//   //   } catch {
//   //     toast.error("Failed to save experience âŒ", { id: loadingToast });
//   //   }
//   // };

//   const handleSaveExperienceAPI = async (i) => {
//     console.log(formData);
//     const exp = formData.experiences[i];

//     if (
//       !exp.company_name?.trim() ||
//       !exp.job_title?.trim() ||
//       !exp.start_date ||
//       !exp.end_date
//     ) {
//       toast.error("Required: Company, Role, Start Date, End Date");
//       return;
//     }

//     const loadingToast = toast.loading("Saving experience...");

//     try {
//       const fd = new FormData();

//       // Required
//       fd.append("company_name", exp.company_name);
//       fd.append("job_title", exp.job_title);
//       fd.append("start_date", exp.start_date);
//       fd.append("end_date", exp.end_date);

//       // Optional (send empty safely)
//       fd.append(
//         "previous_ctc",
//         exp.previous_ctc ? Number(exp.previous_ctc) : "",
//       );

//       fd.append("location", exp.location ? exp.location : "");
//       fd.append("description", exp.description ? exp.description : "");

//       // // LINK mode
//       // if (exp.uploadMode === "link") {
//       //   fd.append(
//       //     "exp_letter_link",
//       //     exp.exp_letter_link ? exp.exp_letter_link : "",
//       //   );
//       //   fd.append("exp_letter_file", ""); // keep empty
//       // }

//       // // FILE mode
//       // if (exp.uploadMode === "file") {
//       //   if (exp.expLetterFile) {
//       //     fd.append("exp_letter_file", exp.expLetterFile);
//       //   } else {
//       //     fd.append("exp_letter_file", "");
//       //   }
//       //   fd.append("exp_letter_link", ""); // keep empty
//       // }

//       // ---------- Upload Handling (Correct) ----------

// // LINK MODE
// if (exp.uploadMode === "link") {
//   fd.append("exp_letter_link", exp.exp_letter_link || "");
//   // Do NOT overwrite existing file if link mode
// }

// // FILE MODE
// else {
//   // Case 1: New file selected â†’ upload
//   if (exp.expLetterFile instanceof File) {
//     fd.append("exp_letter_file", exp.expLetterFile);
//   }

//   // Case 2: No new file BUT already saved file exists â†’ keep old
//   else if (exp.experience_letter_path) {
//     fd.append("experience_letter_path", exp.experience_letter_path);
//   }

//   // Case 3: Nothing exists â†’ send nothing (important)
// }

//       const res = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/experiences`,
//         {
//           method: "POST",
//           body: fd, // â— Don't set Content-Type manually
//         },
//       );

//       if (!res.ok) {
//         const err = await res.text();
//         console.error(err);
//         throw new Error(err);
//       }

//       toast.success("Experience Saved âœ…", { id: loadingToast });
//     } catch (err) {
//       console.error(err);
//       toast.error("Failed to save experience âŒ", { id: loadingToast });
//     }
//   };

//   const fetchPincodeDetails = async (pincode) => {
//     if (!/^\d{6}$/.test(pincode)) return;
//     setIsFetchingPincode(true);
//     try {
//       const res = await fetch(
//         `https://api.postalpincode.in/pincode/${pincode}`,
//       );
//       const data = await res.json();
//       if (data[0]?.Status === "Success") {
//         setCityOptions(data[0].PostOffice.map((o) => o.Name));
//         setFormData((p) => ({
//           ...p,
//           city: data[0].PostOffice[0].Name,
//           state: data[0].PostOffice[0].State,
//         }));
//       }
//     } finally {
//       setIsFetchingPincode(false);
//     }
//   };

//   const STEP_FIELDS = {
//     1: [
//       "name",
//       "email",
//       "phone",
//       "gender",
//       "dob",
//       "position",
//       "experience",
//       "education",
//       "department",
//       "about_me",
//       "languages_spoken",
//     ],

//     2: [
//       "address",
//       "address2",
//       "location",
//       "pincode",
//       "city",
//       "district",
//       "state",
//       "country",
//     ],

//     3: ["experiences"],

//     4: ["skills", "assets"],

//     5: ["resume_link", "cvFile", "certificateFiles", "certificateLinks"],
//   };

//   const saveStepData = async (stepNumber) => {
//     try {
//       const apiData = new FormData();
//       const fields = STEP_FIELDS[stepNumber] || [];

//       fields.forEach((key) => {
//         if (key === "languages_spoken") {
//           apiData.append(
//             "languages_spoken",
//             (formData.languages_spoken || []).join(","),
//           );
//         } else if (key === "skills" || key === "assets") {
//           // apiData.append(key, JSON.stringify(formData[key] || []));
//           apiData.append(key, (formData[key] || []).join(","));
//         } else if (key === "experiences") {
//           apiData.append(
//             "experience_details",
//             JSON.stringify(formData.experiences || []),
//           );
//         } else if (key === "cvFile" && formData.cvFile) {
//           apiData.append("resume", formData.cvFile);
//         } else if (key === "certificateFiles") {
//           formData.certificateFiles.forEach((file) => {
//             apiData.append("certificates", file);
//           });
//         } else if (key === "certificateLinks") {
//           apiData.append(
//             "certificate_links",
//             JSON.stringify(
//               formData.certificateLinks.filter((l) => l && l.trim()),
//             ),
//           );
//         } else {
//           apiData.append(key, formData[key] ?? "");
//         }
//       });

//       apiData.append("full_name", formData.name || "");

//       await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//         {
//           method: "PATCH",
//           body: apiData,
//         },
//       );

//       toast.success(`Step ${stepNumber} saved`);
//     } catch (err) {
//       console.error(err);
//       toast.error("Auto save failed");
//     }
//   };

//   const handleSubmit = async (e) => {
//     e.preventDefault();
//     setLoading(true);

//     const loadingToast = toast.loading("Executing Final PATCH Sync...");

//     try {
//       const apiData = new FormData();

//       // ðŸ”¹ Append ALL simple fields (NO skipping empty)
//       for (const key in formData) {
//         if (
//           ![
//             "experiences",
//             "certificateFiles",
//             "languages_spoken",
//             "cvFile",
//             "skills",
//             "assets",
//           ].includes(key)
//         ) {
//           apiData.append(key, formData[key] ?? "");
//         }
//       }

//       // ðŸ”¹ Required backend fields
//       apiData.append("full_name", formData.name || "");

//       apiData.append(
//         "languages_spoken",
//         (formData.languages_spoken || []).join(","),
//       );

//       // apiData.append("skills", JSON.stringify(formData.skills || []));
//       // apiData.append("assets", JSON.stringify(formData.assets || []));

//       apiData.append("skills", (formData.skills || []).join(","));
// apiData.append("assets", (formData.assets || []).join(","));

//       // ðŸ”¹ Resume FILE
//       if (formData.cvFile) {
//         apiData.append("resume", formData.cvFile);
//       }

//       // ðŸ”¹ Resume LINK
//       if (formData.resume_link) {
//         apiData.append("resume_path", formData.resume_link);
//       }

//       // ðŸ”¹ Certificates FILES
//       formData.certificateFiles.forEach((file) => {
//         apiData.append("certificates", file);
//       });

//       // ðŸ”¹ Certificate LINKS
//       apiData.append(
//         "certificate_links",
//         JSON.stringify(formData.certificateLinks.filter((l) => l && l.trim())),
//       );

//       // ðŸ”¹ Debug â€” SEE WHAT GOES TO API
//       for (let pair of apiData.entries()) {
//         console.log(pair[0], pair[1]);
//       }

//       const response = await fetch(
//         `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//         {
//           method: "PATCH",
//           body: apiData,
//         },
//       );

//       if (!response.ok) {
//         const err = await response.text();
//         console.error(err);
//         throw new Error("API Failed");
//       }

//       toast.success("Candidate Synchronized ðŸŽ‰", { id: loadingToast });
//     } catch (err) {
//       console.error(err);
//       toast.error("Commit failed âŒ", { id: loadingToast });
//     } finally {
//       setLoading(false);
//     }
//   };

//   const today = new Date();

//   // 18 years ago (max allowed DOB)
//   const maxDate = new Date(
//     today.getFullYear() - 18,
//     today.getMonth(),
//     today.getDate(),
//   )
//     .toISOString()
//     .split("T")[0];

//   // 70 years ago (min allowed DOB)
//   const minDate = new Date(
//     today.getFullYear() - 70,
//     today.getMonth(),
//     today.getDate(),
//   )
//     .toISOString()
//     .split("T")[0];

//   const [dobError, setDobError] = useState("");

//   const handleDobChange = (value) => {
//     setFormData({ ...formData, dob: value });

//     if (!value) {
//       setDobError("Date of Birth is required");
//       return;
//     }

//     const selected = new Date(value);

//     if (selected > new Date(maxDate)) {
//       setDobError("Age must be at least 18 years");
//     } else if (selected < new Date(minDate)) {
//       setDobError("Age must be below 70 years");
//     } else {
//       setDobError("");
//     }
//   };

//   if (fetchingData)
//     return (
//       <div className="min-h-screen flex flex-col items-center justify-center bg-slate-50 gap-4">
//         <Loader2 className="h-10 w-10 animate-spin text-blue-600" />
//         <p className="text-[11px] font-black uppercase tracking-[0.2em] text-slate-400">
//           Loading Data Load {effectiveId}...
//         </p>
//       </div>
//     );

//   return (
//     <div className="min-h-screen bg-[#F8FAFC] p-4 md:p-12 antialiased">
//       <div className="max-w-6xl mx-auto space-y-8" ref={dropdownContainerRef}>
//         {/* ROADMAP HEADER */}
//         <div className="flex flex-col lg:flex-row justify-between items-center bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 gap-8">
//           <div className="flex items-center gap-6">
//             <div className="h-16 w-16 bg-slate-900 rounded-[1.5rem] flex items-center justify-center text-white shadow-2xl">
//               <Database size={32} />
//             </div>
//             <div>
//               <h2 className="text-2xl font-black text-slate-900 tracking-tight leading-none">
//                 {id ? "Profile" : "Manual Registry"}
//               </h2>
//               <div className="flex items-center gap-2 mt-1 text-blue-600">
//                 <ShieldCheck size={14} />
//               </div>
//             </div>
//           </div>

//           <div className="flex-1 max-w-2xl w-full px-4">
//             <div className="relative flex justify-between items-center w-full">
//               <div className="absolute top-1/2 left-0 w-full h-0.5 bg-slate-100 -translate-y-1/2 z-0" />
//               <div
//                 className="absolute top-1/2 left-0 h-0.5 bg-blue-600 -translate-y-1/2 z-0 transition-all duration-700"
//                 style={{ width: `${((step - 1) / (totalSteps - 1)) * 100}%` }}
//               />
//               {[1, 2, 3, 4, 5].map((num) => (
//                 <div
//                   key={num}
//                   className="relative z-10 flex flex-col items-center gap-2"
//                 >
//                   <div
//                     className={`h-8 w-8 rounded-full flex items-center justify-center text-[10px] font-black transition-all border-4 ${step === num ? "bg-blue-600 text-white border-blue-100 scale-110 shadow-lg" : step > num ? "bg-emerald-500 text-white border-emerald-50" : "bg-white text-slate-300 border-slate-50"}`}
//                   >
//                     {step > num ? <Check size={14} strokeWidth={4} /> : num}
//                   </div>
//                   <span
//                     className={`absolute -bottom-6 text-[8px] font-black uppercase tracking-tighter transition-colors duration-300 ${step === num ? "text-blue-600" : "text-slate-300"}`}
//                   >
//                     {num === 1 && "Identity"} {num === 2 && "Location"}{" "}
//                     {num === 3 && "Experience"} {num === 4 && "Inventory"}{" "}
//                     {num === 5 && "Documents"}
//                   </span>
//                 </div>
//               ))}
//             </div>
//           </div>
//           <div className="bg-slate-50 border border-slate-200 rounded-2xl px-6 py-3 flex items-center gap-3 shadow-inner">
//             <div className="text-right">
//               <p className="text-[8px] font-black text-slate-400 uppercase leading-none">
//                 Status
//               </p>
//               <p className="text-sm font-black text-slate-900 mt-1">
//                 {Math.round((step / totalSteps) * 100)}%
//               </p>
//             </div>
//             <div className="h-8 w-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center">
//               <Check size={18} />
//             </div>
//           </div>
//         </div>

//         <form onSubmit={handleSubmit}>
//           <div className="space-y-12">
//             {/* STEP 1: IDENTITY & CAREER */}
//             {step === 1 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8 duration-500">
//                 <div className="flex items-center gap-4 pb-4 border-b border-slate-100">
//                   <User size={18} className="text-blue-600" />
//                   <h3 className="text-sm font-black text-slate-800 uppercase tracking-widest">
//                     Basic Candidate profile
//                   </h3>
//                 </div>
//                 <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
//                   <FormField label="Full Name" required>
//                     <input
//                       placeholder="Legal Name"
//                       value={formData.name}
//                       onChange={(e) =>
//                         setFormData({ ...formData, name: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <FormField label="Email" required>
//                     <input
//                       type="email"
//                       placeholder="name@domain.com"
//                       value={formData.email}
//                       onChange={(e) =>
//                         setFormData({ ...formData, email: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <FormField label="Phone" required>
//                     <div className="flex items-center bg-slate-50 border border-slate-200 rounded-xl overflow-hidden focus-within:bg-white focus-within:border-blue-500 transition-all shadow-sm">
//                       <span className="px-3 text-[11px] font-black text-slate-400">
//                         +91
//                       </span>
//                       <input
//                         maxLength={10}
//                         value={formData.phone}
//                         onChange={(e) =>
//                           setFormData({ ...formData, phone: e.target.value })
//                         }
//                         className="w-full px-3 py-2 bg-transparent text-[13px] font-bold outline-none"
//                       />
//                     </div>
//                   </FormField>
//                   <FormField label="Gender">
//                     <select
//                       value={formData.gender}
//                       onChange={(e) =>
//                         setFormData({ ...formData, gender: e.target.value })
//                       }
//                       className={inputStyle}
//                     >
//                       <option value="">Select</option>
//                       <option value="male">Male</option>
//                       <option value="female">Female</option>
//                       <option value="transgender">Transgender</option>
//                       <option value="prefer_not_to_say">
//                         Prefer not to say
//                       </option>
//                     </select>
//                   </FormField>
//                 </div>

//                 <div className="grid grid-cols-1 md:grid-cols-2 gap-8 pt-4">
//                   <FormField label="Date of Birth">
//                     <input
//                       type="date"
//                       min={minDate}
//                       max={maxDate}
//                       value={formData.dob}
//                       onChange={(e) =>
//                         setFormData({ ...formData, dob: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <FormField label="Languages">
//                     <div className="bg-slate-50 border border-slate-200 rounded-xl p-3 max-h-32 overflow-y-auto grid grid-cols-2 gap-3 shadow-inner">
//                       {[
//                         "English",
//                         "Hindi",
//                         "Marathi",
//                         "Gujarati",
//                         "Tamil",
//                         "Telugu",
//                       ].map((lang) => (
//                         <label
//                           key={lang}
//                           className="flex items-center gap-2 text-[11px] font-medium text-slate-600 cursor-pointer hover:text-blue-600 transition-colors"
//                         >
//                           <input
//                             type="checkbox"
//                             checked={formData.languages_spoken.includes(lang)}
//                             onChange={() => {
//                               const u = formData.languages_spoken.includes(lang)
//                                 ? formData.languages_spoken.filter(
//                                     (l) => l !== lang,
//                                   )
//                                 : [...formData.languages_spoken, lang];
//                               setFormData({ ...formData, languages_spoken: u });
//                             }}
//                             className="w-3.5 h-3.5 accent-blue-600 rounded"
//                           />{" "}
//                           {lang}
//                         </label>
//                       ))}
//                     </div>
//                   </FormField>
//                 </div>
//                 <FormField label="Bio Summary">
//                   <textarea
//                     rows={3}
//                     value={formData.about_me}
//                     onChange={(e) =>
//                       setFormData({ ...formData, about_me: e.target.value })
//                     }
//                     className={inputStyle + " resize-none"}
//                   />
//                 </FormField>
//                 <div className="flex justify-end pt-4">
//                   <button
//                     type="button"
//                     // onClick={() => setStep(2)}
//                     onClick={async () => {
//                       await saveStepData(1);
//                       setStep(2);
//                     }}
//                     className={`px-12 py-3 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest shadow-xl active:scale-95 transition-all`}
//                   >
//                     Next Phase â†’
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 2: GEOGRAPHY */}
//             {step === 2 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8">
//                 <div className="flex items-center gap-3 pb-4 border-b border-slate-100">
//                   <MapPin size={18} className="text-blue-600" />
//                   <h3 className="text-xs font-black text-slate-800 uppercase tracking-widest">
//                     location Data
//                   </h3>
//                 </div>
//                 <div className="space-y-8">
//                   <FormField label="Address 1" required>
//                     <input
//                       value={formData.address}
//                       onChange={(e) =>
//                         setFormData({ ...formData, address: e.target.value })
//                       }
//                       className={inputStyle}
//                     />
//                   </FormField>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                     <FormField label="Address 2" required>
//                       <input
//                         value={formData.location}
//                         onChange={(e) =>
//                           setFormData({ ...formData, location: e.target.value })
//                         }
//                         className={inputStyle}
//                       />
//                     </FormField>
//                     <FormField label="Pincode" required>
//                       <input
//                         maxLength={6}
//                         placeholder="000000"
//                         value={formData.pincode}
//                         onChange={(e) => {
//                           setFormData({ ...formData, pincode: e.target.value });
//                           if (e.target.value.length === 6)
//                             fetchPincodeDetails(e.target.value);
//                         }}
//                         className={inputStyle}
//                       />
//                     </FormField>
//                   </div>
//                   <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
//                     <FormField label="City">
//                       <input
//                         value={formData.city}
//                         readOnly
//                         className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                       />
//                     </FormField>
//                     <FormField label="District">
//                       <input
//                         value={formData.district}
//                         readOnly
//                         className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                       />
//                     </FormField>
//                     <FormField label="State">
//                       <input
//                         value={formData.state}
//                         readOnly
//                         className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner"
//                       />
//                     </FormField>
//                     <FormField label="Country">
//                       <input
//                         value={formData.country}
//                         readOnly
//                         onChange={(e) =>
//                           setFormData({ ...formData, country: e.target.value })
//                         }
//                         className={inputStyle}
//                       />
//                     </FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-between pt-8 border-t border-slate-50">
//                   <button
//                     onClick={() => setStep(1)}
//                     type="button"
//                     className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase hover:text-slate-900 transition-all shadow-sm"
//                   >
//                     â† Back
//                   </button>
//                   <button
//                     //  onClick={() => setStep(3)}
//                     onClick={async () => {
//                       await saveStepData(2);
//                       setStep(3);
//                     }}
//                     type="button"
//                     className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase shadow-xl transition-all"
//                   >
//                     Continue â†’
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 3: EXPERIENCE */}
//             {step === 3 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
//                 <div className="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-sm transition-all overflow-hidden">
//                   <div className="flex flex-col md:flex-row items-center justify-between gap-6">
//                     <div className="flex items-center gap-4 text-slate-900 font-black">
//                       <Briefcase size={24} className="text-blue-600" />
//                       <div>
//                         <h3 className="text-sm uppercase tracking-widest">
//                           Are you Fresher?
//                         </h3>
//                         <p className="text-[10px] font-bold text-slate-400 mt-1">
//                           Select current career status
//                         </p>
//                       </div>
//                     </div>
//                     <div className="flex bg-slate-100 p-1.5 rounded-[1.5rem] border border-slate-200 w-full md:w-auto">
//                       <button
//                         type="button"
//                         onClick={() => {
//                           setIsFresher(true);
//                           setFormData({ ...formData, experiences: [] });
//                         }}
//                         className={`px-8 py-2.5 rounded-2xl text-[10px] font-black transition-all ${isFresher === true ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}
//                       >
//                         Yes
//                       </button>
//                       <button
//                         type="button"
//                         // onClick={() => setIsFresher(false)}
//                         //                         onClick={() => {
//                         //   setIsFresher(false);

//                         //   // If no experience exists â†’ add one default block
//                         //   if (!formData.experiences || formData.experiences.length === 0) {
//                         //     setFormData({
//                         //       ...formData,
//                         //       experiences: [
//                         //         {
//                         //           company_name: "",
//                         //           job_title: "",
//                         //           start_date: "",
//                         //           end_date: "",
//                         //           previous_ctc: "",
//                         //           location: "",
//                         //           description: "",
//                         //           exp_letter_link: "",
//                         //           experience_letter_path: "",
//                         //           uploadMode: "file",
//                         //         },
//                         //       ],
//                         //     });
//                         //   }
//                         // }}

//                         onClick={() => {
//                           setIsFresher(false);

//                           if (
//                             !formData.experiences ||
//                             formData.experiences.length === 0
//                           ) {
//                             setFormData({
//                               ...formData,
//                               experiences: [
//                                 {
//                                   company_name: "",
//                                   job_title: "",
//                                   start_date: "",
//                                   end_date: "",
//                                   industry: "",
//                                   previous_ctc: "",
//                                   location: "",
//                                   description: "",
//                                   exp_letter_link: "",
//                                   uploadMode: "file",
//                                 },
//                               ],
//                             });
//                           }
//                         }}
//                         className={`px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === false ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}
//                       >
//                         No
//                       </button>
//                     </div>
//                   </div>
//                 </div>

//                 {isFresher === false && (
//                   <div className="bg-white p-6 md:p-10 rounded-[3.5rem] border border-slate-200 shadow-xl space-y-10 animate-in fade-in duration-500 shadow-slate-100">
//                     <div className="flex flex-col sm:flex-row justify-between items-start border-b border-slate-100 pb-8">
//                       <div className="flex items-center gap-4">
//                         <div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg">
//                           <History size={20} />
//                         </div>
//                         <h3 className="text-sm font-black text-slate-900 uppercase">
//                           Career Timeline
//                         </h3>
//                       </div>
//                       <button
//                         type="button"
//                         //   onClick={() => setFormData({ ...formData, experiences: [...formData.experiences, { company_name: "", job_title: "", uploadMode: "file" }] })}
//                         // onClick={() =>
//                         //   setFormData({
//                         //     ...formData,
//                         //     experiences: [
//                         //       ...formData.experiences,
//                         //       {
//                         //         company_name: "",
//                         //         job_title: "",
//                         //         start_date: "",
//                         //         end_date: "",
//                         //         previous_ctc: "",
//                         //         location: "",
//                         //         description: "",
//                         //         exp_letter_link: "",
//                         //         experience_letter_path: "",
//                         //         uploadMode: "file",
//                         //       },
//                         //     ],
//                         //   })
//                         // }
//                         onClick={() =>
//                           setFormData({
//                             ...formData,
//                             experiences: [
//                               ...formData.experiences,
//                               {
//                                 company_name: "",
//                                 job_title: "",
//                                 start_date: "",
//                                 industry: "",
//                                 end_date: "",
//                                 previous_ctc: "",
//                                 location: "",
//                                 description: "",
//                                 exp_letter_link: "",
//                                 uploadMode: "file",
//                               },
//                             ],
//                           })
//                         }
//                         className="px-6 py-3 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase shadow-lg active:scale-95 transition-all"
//                       >
//                         + Add Experiance
//                       </button>
//                     </div>
//                     <div className="space-y-10 max-h-[600px] overflow-y-auto pr-4 custom-scrollbar-professional">
//                       {formData.experiences.map((exp, i) => (
//                         <div
//                           key={i}
//                           className="relative bg-slate-50/50 border border-slate-200 p-8 rounded-[2.5rem] space-y-8 animate-in zoom-in-95 group hover:bg-white transition-all shadow-inner"
//                         >
//                           <button
//                             type="button"
//                             // onClick={() =>
//                             //   setFormData({
//                             //     ...formData,
//                             //     experiences: formData.experiences.filter(
//                             //       (_, idx) => idx !== i,
//                             //     ),
//                             //   })
//                             // }
//                             onClick={() => {
//                               if (formData.experiences.length === 1) return;
//                               setFormData({
//                                 ...formData,
//                                 experiences: formData.experiences.filter(
//                                   (_, idx) => idx !== i,
//                                 ),
//                               });
//                             }}
//                             className="absolute -top-3 -right-3 h-10 w-10 bg-white border border-slate-200 text-red-500 rounded-full flex items-center justify-center shadow-lg transition-all opacity-0 group-hover:opacity-100 z-20"
//                           >
//                             <Trash2 size={18} />
//                           </button>
//                           <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
//                             <FormField label="Employer">
//                               <input
//                                 value={exp.company_name}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].company_name = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                             <FormField label="Designation">
//                               <input
//                                 value={exp.job_title}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].job_title = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                             <FormField label="Industry">
//                               <select
//                                 value={exp.industry || ""}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].industry = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               >
//                                 <option value="">Select Industry</option>
//                                 <option>Information Technology</option>
//                                 <option>Software Development</option>
//                                 <option>Banking & Finance</option>
//                                 <option>Healthcare</option>
//                                 <option>Education</option>
//                                 <option>Manufacturing</option>
//                                 <option>Retail</option>
//                                 <option>Telecom</option>
//                                 <option>Construction</option>
//                                 <option>Logistics</option>
//                                 <option>Marketing & Advertising</option>
//                                 <option>HR / Recruitment</option>
//                                 <option>Government</option>
//                                 <option>Other</option>
//                               </select>
//                             </FormField>
//                           </div>

//                           <div className="grid grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8">
//                             <FormField label="Start">
//                               <input
//                                 type="date"
//                                 value={exp.start_date}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].start_date = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                             <FormField label="End">
//                               <input
//                                 type="date"
//                                 value={exp.end_date}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].end_date = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                             <FormField label="CTC">
//                               <input
//                                 type="number"
//                                 placeholder="â‚¹"
//                                 value={exp.previous_ctc}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].previous_ctc = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                             <FormField label="City">
//                               <input
//                                 value={exp.location}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].location = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={inputStyle}
//                               />
//                             </FormField>
//                           </div>

//                           <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
//                             <FormField label="Job Description">
//                               <textarea
//                                 rows={5}
//                                 value={exp.description}
//                                 onChange={(e) => {
//                                   const u = [...formData.experiences];
//                                   u[i].description = e.target.value;
//                                   setFormData({ ...formData, experiences: u });
//                                 }}
//                                 className={
//                                   inputStyle +
//                                   " resize-none h-full min-h-[140px]"
//                                 }
//                               />
//                             </FormField>
//                             <div className="space-y-3">
//                               <div className="flex justify-between items-center px-1">
//                                 <p className="text-[10px] font-black text-slate-400 uppercase">
//                                 Experience Letter
//                                 </p>
//                                 <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200">
//                                   <button
//                                     type="button"
//                                     onClick={() => {
//                                       const u = [...formData.experiences];
//                                       u[i].uploadMode = "file";
//                                       setFormData({
//                                         ...formData,
//                                         experiences: u,
//                                       });
//                                     }}
//                                     className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode !== "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                                   >
//                                     FILE
//                                   </button>
//                                   <button
//                                     type="button"
//                                     onClick={() => {
//                                       const u = [...formData.experiences];
//                                       u[i].uploadMode = "link";
//                                       setFormData({
//                                         ...formData,
//                                         experiences: u,
//                                       });
//                                     }}
//                                     className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                                   >
//                                     URL
//                                   </button>
//                                 </div>
//                               </div>
//                               <div className="bg-white/50 border border-slate-100 rounded-3xl p-4 min-h-[140px] flex flex-col justify-center">
//                                 {exp.uploadMode !== "link" ? (
//                                   <label className="flex flex-col items-center justify-center gap-3 w-full h-full border-2 border-dashed border-slate-200 rounded-2xl hover:bg-blue-50/30 cursor-pointer group p-4 transition-all">
//                                     <FileUp
//                                       size={24}
//                                       className="text-slate-400 group-hover:text-blue-500"
//                                     />
//                                     <span className="text-[9px] font-bold text-slate-500 uppercase tracking-widest text-center">
//                                       {exp.exp_letter_file_path
//                                         ? "Saved File Present"
//                                         : exp.expLetterFile
//                                           ? exp.expLetterFile.name
//                                           : "Drop PDF Validation"}
//                                     </span>
//                                     <input
//                                       type="file"
//                                       accept=".pdf"
//                                       className="hidden"
//                                       onChange={(e) => {
//                                         const u = [...formData.experiences];
//                                         u[i].expLetterFile = e.target.files[0];
//                                         setFormData({
//                                           ...formData,
//                                           experiences: u,
//                                         });
//                                       }}
//                                     />
//                                   </label>
//                                 ) : (
//                                   <div className="relative">
//                                     <LinkIcon
//                                       size={16}
//                                       className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                                     />
//                                     <input
//                                       placeholder="Storage URI"
//                                       // value={
//                                       //   exp.exp_letter_link ||
//                                       //   exp.experience_letter_path ||
//                                       //   ""
//                                       // }
//                                       value={exp.exp_letter_link || ""}
//                                       onChange={(e) => {
//                                         const u = [...formData.experiences];
//                                         u[i].exp_letter_link = e.target.value;
//                                         setFormData({
//                                           ...formData,
//                                           experiences: u,
//                                         });
//                                       }}
//                                       className={inputStyle + " pl-11"}
//                                     />
//                                   </div>
//                                 )}
//                               </div>
//                             </div>
//                           </div>
//                           <div className="flex justify-end pt-2 border-t border-slate-50">
//                             <button
//                               type="button"
//                               onClick={() => handleSaveExperienceAPI(i)}
//                               className="flex items-center gap-2 px-8 py-3 bg-emerald-50 text-emerald-600 border border-emerald-100 rounded-2xl text-[10px] font-black uppercase hover:bg-emerald-500 hover:text-white transition-all active:scale-95 shadow-sm"
//                             >
//                               <Check size={16} strokeWidth={3} /> Save Record
//                             </button>
//                           </div>
//                         </div>
//                       ))}
//                     </div>
//                   </div>
//                 )}
//                 <div className="flex justify-between pt-4">
//                   <button
//                     onClick={() => setStep(2)}
//                     type="button"
//                     className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase shadow-sm transition-all hover:text-slate-900 flex items-center gap-2"
//                   >
//                     â† Back
//                   </button>
//                   <button
//                     //  onClick={() => setStep(4)}
//                     onClick={async () => {
//                       await saveStepData(3);
//                       setStep(4);
//                     }}
//                     type="button"
//                     disabled={isFresher === null}
//                     className={`px-12 py-4 rounded-2xl text-xs font-black uppercase shadow-xl transition-all active:scale-95 ${isFresher !== null ? "bg-blue-600 text-white shadow-blue-600/30 hover:bg-blue-700" : "bg-slate-200 text-slate-400 cursor-not-allowed"}`}
//                   >
//                     Next Phase â†’
//                   </button>
//                 </div>
//               </div>
//             )}

//             {/* STEP 4: INVENTORY */}
//             {step === 4 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 overflow-visible">
//                 <div className="bg-white border border-slate-200 rounded-[3.5rem] shadow-xl overflow-visible shadow-slate-200/50">
//                   <div className="bg-slate-50/50 px-10 py-6 border-b border-slate-200 flex items-center justify-between rounded-t-[3.5rem]">
//                     <div className="flex items-center gap-4">
//                       <div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg">
//                         <Cpu size={20} />
//                       </div>
//                       <div>
//                         <h3 className="text-sm font-black text-slate-900 uppercase tracking-widest leading-none">
//                           Skills & Assets
//                         </h3>
//                         {/* <p className="text-[10px] font-bold text-slate-400 uppercase mt-0.5">

//                         </p> */}
//                       </div>
//                     </div>
//                   </div>
//                   <div className="p-8 md:p-12 space-y-12 overflow-visible">
//                     <FormField label="Skills">
//                       <div className="space-y-6">
//                         <div className="flex flex-col sm:flex-row gap-4 items-end">
//                           <div className="relative max-w-md w-full">
//                             <Plus
//                               size={16}
//                               className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                             />
//                             <input
//                               value={skillInput}
//                               onChange={(e) => setSkillInput(e.target.value)}
//                               // onKeyDown={(e) => {
//                               //   if (e.key === "Enter") {
//                               //     e.preventDefault();
//                               //     // handleManualAddSkill();
//                               //   }
//                               // }}
//                               onKeyDown={(e) => {
//   if (e.key === "Enter") {
//     e.preventDefault();
//     const name = skillInput.trim();
//     if (!name) return;

//     // prevent duplicate
//     if (!formData.skills.includes(name)) {
//       setFormData((prev) => ({
//         ...prev,
//         skills: [...prev.skills, name],
//       }));
//     }

//     setSkillInput("");
//   }
// }}

//                               placeholder="Register skill..."
//                               className={inputStyle + " pl-12"}
//                             />
//                           </div>
//                           {/* <button
//                             type="button"
//                             onClick={handleManualAddSkill}
//                             className="px-6 py-3.5 bg-slate-900 hover:bg-blue-600 text-white rounded-2xl transition-all flex items-center gap-2 text-[10px] font-black uppercase tracking-widest shadow-lg shadow-slate-200"
//                           >
//                             <Database size={14} /> Add Skill
//                           </button> */}
//                         </div>
//                         {/* <div className="flex flex-wrap gap-3 p-1">
//                           {dynamicSkills.map((skill) => {
//                             const isSelected = formData.skills.includes(skill); */}
//                             {/* <div className="flex flex-wrap gap-3 p-1">
//   {[...new Set([...dynamicSkills, ...formData.skills])].map((skill) => {
//     const isSelected = formData.skills.includes(skill);

//                             return (
//                               <button
//                                 key={skill}
//                                 type="button"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     skills: isSelected
//                                       ? formData.skills.filter(
//                                           (s) => s !== skill,
//                                         )
//                                       : [...formData.skills, skill],
//                                   })
//                                 }
//                                 className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${isSelected ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200" : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`}
//                               >
//                                 {skill}{" "}
//                                 {isSelected && (
//                                   <Check size={14} strokeWidth={3} />
//                                 )}
//                               </button>
//                             );
//                           })}
//                         </div> */}
//                         <div className="flex flex-wrap gap-3 p-1 w-full min-h-[40px]">
//   {[...new Set([...dynamicSkills, ...formData.skills])].map((skill) => {
//     const isSelected = formData.skills.includes(skill);

//     return (
//       <button
//         key={skill}
//         type="button"
//         onClick={() =>
//           setFormData({
//             ...formData,
//             skills: isSelected
//               ? formData.skills.filter((s) => s !== skill)
//               : [...formData.skills, skill],
//           })
//         }
//         className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${
//           isSelected
//             ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200"
//             : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"
//         }`}
//       >
//         {skill}
//         {isSelected && <Check size={14} strokeWidth={3} />}
//       </button>
//     );
//   })}
// </div>

//                       </div>
//                     </FormField>
//                     {/* <FormField label="Enterprise Hardware Matrix"><div className="space-y-6 pt-8 border-t border-slate-100"><div className="relative max-w-md w-full"><Layers size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={assetInput} onChange={(e) => setAssetInput(e.target.value)} onKeyDown={async (e) => { if(e.key === 'Enter') { e.preventDefault(); const v = assetInput.trim(); if(v && !formData.assets.includes(v)) { const ok = await handleAddAssetAPI(v); if(ok) { setFormData({...formData, assets: [...formData.assets, v]}); setAssetInput(""); } } } }} placeholder="Link hardware..." className={inputStyle + " pl-12"} /></div><div className="flex flex-wrap gap-3 p-1">{dynamicAssets.map((asset) => { const isSelected = formData.assets.includes(asset); return (<button key={asset} type="button" onClick={async () => { if(!isSelected) { const ok = await handleAddAssetAPI(asset); if(ok) setFormData({...formData, assets: [...formData.assets, asset]}); } else { setFormData({...formData, assets: formData.assets.filter(a => a !== asset)}); } }} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${isSelected ? "bg-slate-900 border-slate-900 text-white shadow-lg shadow-slate-200" : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`}>{asset} {isSelected && <Check size={14} strokeWidth={3} className="animate-in zoom-in" />}</button>); })}</div></div></FormField> */}
//                     <div className="space-y-6 pt-8 border-t border-slate-100">
//                       <FormField label="Assets">
//                         <div className="space-y-6">
//                           {/* Search & Manual Add Input */}
//                           <div className="relative max-w-md">
//                             <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">
//                               <Layers size={16} />
//                             </div>
//                             <input
//                               value={assetInput}
//                               onChange={(e) => setAssetInput(e.target.value)}
//                               onKeyDown={async (e) => {
//                                 if (e.key === "Enter") {
//                                   e.preventDefault();
//                                   const v = assetInput.trim();
//                                   if (v && !formData.assets.includes(v)) {
//                                     // API INTEGRATION
//                                     // const success = await handleAddAssetAPI(v);
//                                     if (success) {
//                                       setFormData({
//                                         ...formData,
//                                         assets: [...formData.assets, v],
//                                       });
//                                       setAssetInput("");
//                                     }
//                                   }
//                                 }
//                               }}
//                               placeholder="Type hardware name and press Enter..."
//                               className="w-full pl-12 pr-4 py-3.5 bg-slate-50 border border-slate-200 rounded-2xl text-xs font-bold outline-none focus:bg-white focus:border-slate-900 focus:ring-4 focus:ring-slate-900/5 transition-all shadow-inner"
//                             />
//                           </div>

//                           {/* Asset Cloud */}
//                           <div className="flex flex-wrap gap-3 p-1">
//                             {ASSET_OPTIONS.map((asset) => {
//                               const isSelected =
//                                 formData.assets.includes(asset);
//                               return (
//                                 <button
//                                   key={asset}
//                                   type="button"
//                                   onClick={async () => {
//                                     if (!isSelected) {
//                                       // API INTEGRATION on selection
//                                       const success =
//                                         await handleAddAssetAPI(asset);
//                                       if (success) {
//                                         setFormData({
//                                           ...formData,
//                                           assets: [...formData.assets, asset],
//                                         });
//                                       }
//                                     } else {
//                                       // Optional: Add delete API call here if needed
//                                       setFormData({
//                                         ...formData,
//                                         assets: formData.assets.filter(
//                                           (a) => a !== asset,
//                                         ),
//                                       });
//                                     }
//                                   }}
//                                   className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase tracking-wider transition-all duration-300 border-2 active:scale-90
//                                   ${
//                                     // isSelected
//                                     //   ? "bg-slate-900 border-slate-900 text-white shadow-lg shadow-slate-200"
//                                     //   : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"
//                                     isSelected
//   ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200"
//   : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"
//                                   }`}
//                                 >
//                                   {asset}
//                                   {isSelected && (
//                                     <Check
//                                       size={14}
//                                       strokeWidth={3}
//                                       className="animate-in zoom-in"
//                                     />
//                                   )}
//                                 </button>
//                               );
//                             })}

//                             {/* Custom dynamic assets already in state */}
//                             {formData.assets
//                               .filter((a) => !ASSET_OPTIONS.includes(a))
//                               .map((customAsset) => (
//                                 <button
//                                   key={customAsset}
//                                   type="button"
//                                   onClick={() =>
//                                     setFormData({
//                                       ...formData,
//                                       assets: formData.assets.filter(
//                                         (a) => a !== customAsset,
//                                       ),
//                                     })
//                                   }
//                                   className="flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase tracking-wider bg-slate-900 border-2 border-slate-900 text-white shadow-lg active:scale-90"
//                                 >
//                                   {customAsset}{" "}
//                                   <Check size={14} strokeWidth={3} />
//                                 </button>
//                               ))}
//                           </div>
//                         </div>
//                       </FormField>
//                     </div>
//                   </div>
//                 </div>
//                 <div className="flex justify-between items-center pt-4">
//                   <button
//                     onClick={() => setStep(3)}
//                     type="button"
//                     className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[11px] font-black uppercase transition-all shadow-sm hover:text-slate-900 flex items-center gap-2 transition-all"
//                   >
//                     <ChevronLeft size={16} /> Back
//                   </button>
//                   {/* <button
//                     //  onClick={() => setStep(5)}
//                     onClick={async () => {
//                       await saveStepData(4);
//                       setStep(5);
//                     }}
//                     type="button"
//                     className="px-8 py-2 bg-blue-600 text-white rounded-2xl text-[11px] font-black uppercase shadow-xl active:scale-95 transition-all"
//                   >
//                     Next Phase <ChevronRight size={14} />
//                   </button> */}
//                   <button
//   onClick={async () => {
//     await saveStepData(4);
//     setStep(5);
//   }}
//   type="button"
//   className="px-12 py-4 bg-blue-600 text-white rounded-xl text-[11px] font-black uppercase shadow-xl active:scale-95 transition-all flex items-center gap-2 whitespace-nowrap"
// >
//   Next Phase <ChevronRight size={14} />
// </button>

//                 </div>
//               </div>
//             )}

//             {/* STEP 5: DOCUMENT VAULT */}

//             {step === 5 && (
//               <div className="space-y-8 animate-in slide-in-from-bottom-8 duration-500">
//                 <div className="bg-white rounded-[2rem] shadow-2xl shadow-slate-200/50 border border-slate-200 overflow-hidden relative">
//                   {/* SECTION HEADER: Enterprise Indigo Theme */}
//                   <div className="bg-slate-50 px-8 py-6 border-b border-slate-200 flex items-center justify-between">
//                     <div className="flex items-center gap-5">
//                       <div className="h-12 w-12 bg-slate-900 rounded-2xl flex items-center justify-center text-white shadow-lg">
//                         <ShieldCheck size={24} />
//                       </div>
//                       <div>
//                         <h3 className="text-lg font-bold text-slate-900 tracking-tight">
//                           Registry Artifacts
//                         </h3>
//                         <p className="text-[11px] font-semibold text-slate-500 uppercase tracking-widest">
//                           Document Verification Matrix
//                         </p>
//                       </div>
//                     </div>
//                     <div className="hidden md:flex items-center gap-2 px-4 py-1.5 bg-blue-50 border border-blue-100 rounded-full">
//                       <div className="h-1.5 w-1.5 rounded-full bg-blue-500 animate-pulse" />
//                       <span className="text-[10px] font-bold text-blue-600 uppercase tracking-tighter">
//                         System Ready for PATCH
//                       </span>
//                     </div>
//                   </div>

//                   <div className="p-8 md:p-12 space-y-12">
//                     <div className="grid grid-cols-1 lg:grid-cols-2 gap-12">
//                       {/* 1. MASTER RESUME SECTION */}
//                       <div className="space-y-6">
//                         <div className="flex justify-between items-center px-1">
//                           <div className="flex items-center gap-2">
//                             <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">
//                               01. Resume Node
//                             </span>
//                           </div>
//                           <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200 scale-90">
//                             <button
//                               type="button"
//                               onClick={() => setResumeMode("file")}
//                               className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === "file" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500 hover:text-slate-700"}`}
//                             >
//                               FILE
//                             </button>
//                             <button
//                               type="button"
//                               onClick={() => setResumeMode("link")}
//                               className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === "link" ? "bg-white text-blue-600 shadow-sm" : "text-slate-500"}`}
//                             >
//                               URL
//                             </button>
//                           </div>
//                         </div>

//                         {resumeMode === "file" ? (
//                           <label className="flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-slate-200 rounded-3xl bg-slate-50/50 hover:bg-white hover:border-blue-500 transition-all cursor-pointer group">
//                             <div className="flex flex-col items-center gap-3">
//                               <div className="p-4 bg-white rounded-2xl shadow-sm border border-slate-100 group-hover:scale-110 transition-transform duration-500">
//                                 <FileUp
//                                   size={28}
//                                   className="text-slate-400 group-hover:text-blue-500"
//                                 />
//                               </div>
//                               <span className="text-[11px] font-bold text-slate-500 uppercase tracking-widest">
//                                 {formData.cvFile
//                                   ? formData.cvFile.name
//                                   : "Commit Resume PDF"}
//                               </span>
//                             </div>
//                             <input
//                               type="file"
//                               accept=".pdf"
//                               className="hidden"
//                               onChange={(e) =>
//                                 setFormData({
//                                   ...formData,
//                                   cvFile: e.target.files[0],
//                                   resume_link: "",
//                                 })
//                               }
//                             />
//                           </label>
//                         ) : (
//                           <div className="relative">
//                             <LinkIcon
//                               size={18}
//                               className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                             />
//                             <input
//                               placeholder="Enter Public Storage URI..."
//                               value={formData.resume_link}
//                               onChange={(e) =>
//                                 setFormData({
//                                   ...formData,
//                                   resume_link: e.target.value,
//                                   cvFile: null,
//                                 })
//                               }
//                               className={inputStyle + " pl-12"}
//                             />
//                           </div>
//                         )}
//                       </div>

//                       {/* 2. CREDENTIALS MATRIX SECTION */}
//                       <div className="space-y-6">
//                         <div className="flex justify-between items-center px-1">
//                           <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">
//                             02. Credentials Registry
//                           </span>
//                           <div className="flex gap-2">
//                             <label className="cursor-pointer h-10 w-10 bg-slate-900 text-white rounded-xl hover:bg-blue-600 active:scale-90 transition-all flex items-center justify-center shadow-lg shadow-slate-200">
//                               <Plus size={18} />
//                               <input
//                                 type="file"
//                                 multiple
//                                 accept=".pdf"
//                                 className="hidden"
//                                 onChange={(e) =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateFiles: [
//                                       ...formData.certificateFiles,
//                                       ...Array.from(e.target.files),
//                                     ],
//                                   })
//                                 }
//                               />
//                             </label>
//                             <button
//                               type="button"
//                               onClick={() =>
//                                 setFormData({
//                                   ...formData,
//                                   certificateLinks: [
//                                     ...formData.certificateLinks,
//                                     "",
//                                   ],
//                                 })
//                               }
//                               className="h-10 w-10 bg-white text-slate-600 rounded-xl border border-slate-200 hover:border-blue-500 hover:text-blue-500 active:scale-90 transition-all flex items-center justify-center shadow-sm"
//                             >
//                               <LinkIcon size={18} />
//                             </button>
//                           </div>
//                         </div>

//                         <div className="grid grid-cols-1 gap-4 max-h-[220px] overflow-y-auto no-scrollbar pr-1">
//                           {formData.certificateFiles.map((file, idx) => (
//                             <div
//                               key={idx}
//                               className="flex justify-between items-center bg-slate-50 p-4 rounded-2xl border border-slate-100 hover:border-blue-300 transition-colors"
//                             >
//                               <div className="flex items-center gap-3">
//                                 <div className="h-2 w-2 rounded-full bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)]" />
//                                 <span className="text-[12px] font-bold text-slate-700 truncate max-w-[200px]">
//                                   {file.name}
//                                 </span>
//                               </div>
//                               <X
//                                 size={16}
//                                 className="text-slate-300 hover:text-red-500 cursor-pointer transition-all hover:rotate-90"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateFiles:
//                                       formData.certificateFiles.filter(
//                                         (_, i) => i !== idx,
//                                       ),
//                                   })
//                                 }
//                               />
//                             </div>
//                           ))}
//                           {formData.certificateLinks.map((link, idx) => (
//                             <div
//                               key={idx}
//                               className="flex gap-3 animate-in slide-in-from-right-4"
//                             >
//                               <div className="relative flex-1">
//                                 <Globe
//                                   size={16}
//                                   className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"
//                                 />
//                                 <input
//                                   value={link}
//                                   placeholder="Public URI..."
//                                   onChange={(e) => {
//                                     const u = [...formData.certificateLinks];
//                                     u[idx] = e.target.value;
//                                     setFormData({
//                                       ...formData,
//                                       certificateLinks: u,
//                                     });
//                                   }}
//                                   className={inputStyle + " pl-11 !py-2.5"}
//                                 />
//                               </div>
//                               <button
//                                 type="button"
//                                 onClick={() =>
//                                   setFormData({
//                                     ...formData,
//                                     certificateLinks:
//                                       formData.certificateLinks.filter(
//                                         (_, i) => i !== idx,
//                                       ),
//                                   })
//                                 }
//                                 className="text-slate-300 hover:text-red-500 bg-slate-50 h-10 w-10 rounded-xl border border-slate-200 flex items-center justify-center"
//                               >
//                                 <Trash2 size={16} />
//                               </button>
//                             </div>
//                           ))}
//                           {formData.certificateFiles.length === 0 &&
//                             formData.certificateLinks.filter((l) => l)
//                               .length === 0 && (
//                               <div className="py-8 text-center bg-slate-50/50 border border-dashed border-slate-200 rounded-2xl">
//                                 <p className="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">
//                                   No secondary artifacts registered
//                                 </p>
//                               </div>
//                             )}
//                         </div>
//                       </div>
//                     </div>

//                     {/* METADATA INFO CARD */}
//                     <div className="bg-slate-900 rounded-3xl p-6 flex flex-col md:flex-row items-center justify-between gap-6 shadow-2xl">
//                       <div className="flex items-center gap-4">
//                         <div className="h-10 w-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400">
//                           <History size={20} />
//                         </div>
//                         <div>
//                           <p className="text-white text-xs font-bold tracking-wide uppercase">
//                             Final Validation Note
//                           </p>
//                           <p className="text-slate-400 text-[10px] uppercase font-semibold tracking-tighter">
//                             Hydrating Node {effectiveId} â€¢ PATCH Commit ready
//                           </p>
//                         </div>
//                       </div>
//                       <button
//                         type="submit"
//                         onClick={handleSubmit}
//                         className="w-full md:w-auto px-10 py-3.5 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl text-[11px] font-black uppercase tracking-widest transition-all shadow-xl shadow-blue-600/20 active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3"
//                       >
//                         {loading ? (
//                           <Loader2 className="animate-spin" size={18} />
//                         ) : (
//                           <>
//                             <Database size={18} />
//                             <span>Submit data</span>
//                           </>
//                         )}
//                       </button>
//                     </div>
//                   </div>

//                   {/* FOOTER ACTIONS */}
//                   <div className="flex justify-center pt-2 pb-8">
//                     <button
//                       type="button"
//                       onClick={() => setStep(4)}
//                       className="text-[10px] font-bold text-slate-400 uppercase tracking-widest hover:text-slate-900 transition-colors flex items-center gap-2 group"
//                     >
//                       <ChevronLeft
//                         size={16}
//                         className="group-hover:-translate-x-1 transition-transform"
//                       />
//                       Return to Inventory Matrix
//                     </button>
//                   </div>
//                 </div>
//               </div>
//             )}
//           </div>
//         </form>
//       </div>
//       <style
//         dangerouslySetInnerHTML={{
//           __html: `.custom-scrollbar-professional::-webkit-scrollbar { width: 6px; }.custom-scrollbar-professional::-webkit-scrollbar-track { background: transparent; }.custom-scrollbar-professional::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 20px; }.custom-scrollbar-professional::-webkit-scrollbar-thumb:hover { background: #CBD5E1; }`,
//         }}
//       />
//     </div>
//   );
// };

// export default ManualEntryPage;
//***************************************************************************************************************** */
// import React, { useState, useEffect, useRef } from "react";
// import { useParams, useNavigate } from "react-router-dom";
// import {
//   Check, Award, User, Briefcase, MapPin, Loader2, Plus, Trash2, Layers, Cpu, Database,
//   Globe, ShieldCheck, History, X, LinkIcon, FileUp, ChevronRight, ChevronLeft, ChevronDown
// } from "lucide-react";
// import toast from "react-hot-toast";
// import { candidateService } from "../../services/candidateService";
// import { departmentService } from "../../services/department.service";

// const FormField = ({ label, required, error, children }) => (
//   <div className="space-y-1 w-full">
//     <label className="text-[10px] md:text-[11px] font-black text-slate-500 uppercase tracking-widest ml-1 flex justify-between items-center">
//       <span>{label}</span>
//       <span className={`font-bold normal-case ${required ? "text-red-500" : "text-slate-300"}`}>
//         {required ? "Required" : "Optional"}
//       </span>
//     </label>
//     {children}
//     {error && <p className="text-[9px] text-red-500 font-bold uppercase tracking-tighter ml-1">{error}</p>}
//   </div>
// );

// const ManualEntryPage = () => {
//   const { id } = useParams();
//   const navigate = useNavigate();
//   const effectiveId = id || "666";
//  const ASSET_OPTIONS = ["Laptop", "Mouse", "Keyboard", "Monitor", "Headset", "Mobile", "ID Card", "SIM Card"];
//   // Professional Enterprise Input Style
//   const inputStyle = "w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-[13px] font-bold outline-none focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-500/5 transition-all shadow-sm";

//   // 1. INITIALIZE ALL STATES
//   const [step, setStep] = useState(1);
//   const [loading, setLoading] = useState(false);
//   const [fetchingData, setFetchingData] = useState(false);
//   const [errors, setErrors] = useState({});
//   const [isFetchingPincode, setIsFetchingPincode] = useState(false);
//   const [cityOptions, setCityOptions] = useState([]);
//   const [resumeMode, setResumeMode] = useState("file");
//   const [skillInput, setSkillInput] = useState("");
//   const [assetInput, setAssetInput] = useState("");
//   const [isFresher, setIsFresher] = useState(null);
//   const [deptSearch, setDeptSearch] = useState("");
//   const [eduSearch, setEduSearch] = useState("");
//   const [dynamicSkills, setDynamicSkills] = useState([]);
//   const [dynamicAssets, setDynamicAssets] = useState([]);
//   const [showSkillDrop, setShowSkillDrop] = useState(false);
//   const [showAssetDrop, setShowAssetDrop] = useState(false);
//   const [skillFocused, setSkillFocused] = useState(false);
//   const [departments, setDepartments] = useState([]);

//   const dropdownContainerRef = useRef(null);
//   const careerStepRef = useRef(null);

//   const [formData, setFormData] = useState({
//     name: "", email: "", phone: "", address: "", address2: "", location: "",
//     pincode: "", state: "", city: "", district: "", country: "India", position: "",
//     education: "", gender: "", dob: "", experience: "", about_me: "",
//     languages_spoken: [], skills: [], assets: [], department: "",
//     cvFile: null, resume_link: "", certificateFiles: [], certificateLinks: [""], experiences: [],
//   });

//   const totalSteps = 5;
// //   const POSITION_OPTIONS = ["Frontend Developer", "Backend Developer", "Full Stack Developer", "HR Executive", "UI/UX Designer", "DevOps Engineer", "Project Manager"];
// //   const educationOptions = ["B.Tech", "M.Tech", "B.Sc", "M.Sc", "BCA", "MCA", "MBA", "Diploma", "PhD"];

// const educationOptions = [
//   "SSC / 10th",
//   "HSC / 12th",
//   "ITI",
//   "Diploma",
//   "Polytechnic",

//   "B.A",
//   "B.Com",
//   "B.Sc",
//   "BCA",
//   "BBA",
//   "B.Tech",
//   "BE",
//   "B.Pharm",
//   "B.Ed",

//   "M.A",
//   "M.Com",
//   "M.Sc",
//   "MCA",
//   "MBA",
//   "M.Tech",
//   "ME",
//   "M.Pharm",
//   "M.Ed",

//   "PGDM",
//   "Post Graduate Diploma",

//   "PhD / Doctorate"
// ];

// const POSITION_OPTIONS = [
//   // IT / Software
//   "Frontend Developer",
//   "Backend Developer",
//   "Full Stack Developer",
//   "Software Engineer",
//   "Senior Software Engineer",
//   "Lead Developer",
//   "DevOps Engineer",
//   "QA Engineer",
//   "Automation Tester",
//   "Manual Tester",
//   "UI/UX Designer",
//   "Mobile App Developer",
//   "Android Developer",
//   "iOS Developer",
//   "Data Analyst",
//   "Data Scientist",
//   "Machine Learning Engineer",
//   "AI Engineer",
//   "Cloud Engineer",
//   "System Administrator",
//   "Network Engineer",
//   "Cyber Security Analyst",

//   // Management / Office
//   "Project Manager",
//   "Product Manager",
//   "Operations Manager",
//   "Team Lead",
//   "Business Analyst",
//   "HR Executive",
//   "HR Manager",
//   "Recruiter",
//   "Office Administrator",

//   // Non-IT / General
//   "Accountant",
//   "Finance Executive",
//   "Sales Executive",
//   "Marketing Executive",
//   "Digital Marketing Specialist",
//   "Customer Support Executive",
//   "Technical Support Engineer",
//   "Field Executive",
//   "Supervisor",
//   "Store Manager",
//   "Warehouse Executive",

//   // Fresher / Entry
//   "Intern",
//   "Trainee",
//   "Graduate Engineer Trainee",
//   "Apprentice"
// ];

//   const filteredEducation = educationOptions.filter(e => e.toLowerCase().includes(eduSearch.toLowerCase()));
//   const filteredDepartments = departments.filter(d => (d.name || "").toLowerCase().includes(deptSearch.toLowerCase()));
//   const isStep1Valid = formData.name && /^\S+@\S+\.\S+$/.test(formData.email) && formData.phone;

//   // 2. HYDRATION LOGIC (GET API)
//   useEffect(() => {
//     const hydrateNode = async () => {
//       setFetchingData(true);
//       try {
//         const response = await fetch(`https://apihrr.goelectronix.co.in/candidates/${effectiveId}`);
//         if (!response.ok) throw new Error();
//         const data = await response.json();

//         if (data) {
//           const safeParse = (str) => {
//             if (!str) return [];
//             try {
//               if (Array.isArray(str)) {
//                 if (typeof str[0] === 'string' && str[0].startsWith('[')) return JSON.parse(str.join(''));
//                 return str;
//               }
//               return JSON.parse(str);
//             } catch { return []; }
//           };

//           setFormData(prev => ({
//             ...prev,
//             name: data.full_name || "",
//             email: data.email || "",
//             phone: data.phone || "",
//             gender: data.gender || "",
//             dob: data.dob || "",
//             address: data.address || "",
//             address2: data.address2 || "",
//             location: data.location || "",
//             pincode: data.pincode || "",
//             city: data.city || "",
//             state: data.state || "",
//             district: data.district || "",
//             country: data.country || "India",
//             position: data.position || "",
//             experience: data.experience || "",
//             education: data.education || "",
//             department: data.department || "",
//             about_me: data.about_me || "",
//             resume_link: data.resume_path || "",
//             languages_spoken: safeParse(data.languages_spoken),
//             experiences: data.experiences || [],
//             skills: safeParse(data.skills),
//             assets: safeParse(data.assets),
//           }));

//           setIsFresher(!data.experiences || data.experiences.length === 0);
//         }

//         const deptData = await departmentService.getAll();
//         setDepartments(deptData || []);
//         await fetchSkills();
//         await fetchAssets(effectiveId);
//       } catch (err) { console.warn("Initializing Empty Node"); }
//       finally { setFetchingData(false); }
//     };
//     hydrateNode();
//   }, [effectiveId]);

//   // Click Outside to close dropdowns
//   useEffect(() => {
//     const handleClickOutside = (event) => {
//       if (dropdownContainerRef.current && !dropdownContainerRef.current.contains(event.target)) {
//         setShowSkillDrop(false);
//         setShowAssetDrop(false);
//         setSkillFocused(false);
//       }
//     };
//     document.addEventListener("mousedown", handleClickOutside);
//     return () => document.removeEventListener("mousedown", handleClickOutside);
//   }, []);

//   // 3. HANDLERS
//   const fetchSkills = async () => {
//     try {
//       const res = await fetch("https://apihrr.goelectronix.co.in/masters/skills");
//       const data = await res.json();
//       setDynamicSkills(data.map(item => item.name || item));
//     } catch {}
//   };

//   const fetchAssets = async (cId) => {
//     try {
//       const res = await fetch(`https://apihrr.goelectronix.co.in/candidates/${cId}/assets`);
//       const data = await res.json();
//       setDynamicAssets(Array.isArray(data) ? data.map(a => a.name) : []);
//     } catch {}
//   };

//   const handleManualAddSkill = async () => {
//     const name = skillInput.trim();
//     if (!name) { await fetchSkills(); return; }
//     const success = await handleCreateMaster("skills", name);
//     if (success) {
//       if (!formData.skills.includes(name)) setFormData(p => ({ ...p, skills: [...p.skills, name] }));
//       setSkillInput("");
//       await fetchSkills();
//     }
//   };

//   const handleCreateMaster = async (type, name) => {
//     try {
//       const res = await fetch(`https://apihrr.goelectronix.co.in/masters/${type}`, {
//         method: "POST",
//         headers: { "Content-Type": "application/json" },
//         body: JSON.stringify({ name: name.trim() }),
//       });
//       return res.ok;
//     } catch { return false; }
//   };

//   const handleAddAssetAPI = async (assetName) => {
//     if (!assetName.trim()) return;
//     const loadingToast = toast.loading(`Linking asset...`);
//     try {
//       const res = await fetch(`https://apihrr.goelectronix.co.in/candidates/${effectiveId}/assets`, {
//         method: "POST",
//         headers: { "Content-Type": "application/json" },
//         body: JSON.stringify({ name: assetName.trim() }),
//       });
//       if (res.ok) {
//         toast.success("Linked", { id: loadingToast });
//         await fetchAssets(effectiveId);
//         return true;
//       }
//     } catch { toast.error("Sync failed", { id: loadingToast }); }
//     return false;
//   };

// //   const handleSaveExperienceAPI = async (i) => {
// //     const exp = formData.experiences[i];
// //     if (!exp.company_name || !exp.job_title || !exp.start_date || !exp.end_date) {
// //         toast.error("Required: Company, Role, Start Date, and End Date");
// //         return;
// //     }

// //     const loadingToast = toast.loading(`Committing record...`);
// //     try {
// //       const res = await fetch(`https://apihrr.goelectronix.co.in/candidates/${effectiveId}/experiences`, {
// //         method: "POST",
// //         headers: { "Content-Type": "application/json" },
// //         // body: JSON.stringify({
// //         //   company_name: exp.company_name,
// //         //   job_title: exp.job_title,
// //         //   start_date: exp.start_date,
// //         //   end_date: exp.end_date,
// //         //   previous_ctc: parseFloat(exp.previous_ctc) || 0,
// //         //   location: exp.location || "",
// //         //   description: exp.description || "",
// //         //   experience_letter_path: exp.exp_letter_link || ""
// //         // }),
// //         body: JSON.stringify({
// //   company_name: exp.company_name || "",
// //   job_title: exp.job_title || "",
// //   start_date: exp.start_date || "",
// //   end_date: exp.end_date || "",
// //   previous_ctc: exp.previous_ctc ? Number(exp.previous_ctc) : 0,
// //   location: exp.location || "",
// //   description: exp.description || "",
// //   experience_letter_path: exp.exp_letter_link || "",
// // }),

// //       });
// //       if (res.ok) toast.success("Experience Synced", { id: loadingToast });
// //       else throw new Error();
// //     } catch { toast.error("Validation failed", { id: loadingToast }); }
// //   };

// const handleSaveExperienceAPI = async (i) => {
//   const exp = formData.experiences[i];

//   if (!exp.company_name || !exp.job_title || !exp.start_date || !exp.end_date) {
//     toast.error("Required: Company, Role, Start Date, End Date");
//     return;
//   }

//   const loadingToast = toast.loading("Saving experience...");

//   try {
//     const fd = new FormData();

//     fd.append("company_name", exp.company_name);
//     fd.append("job_title", exp.job_title);
//     fd.append("start_date", exp.start_date);
//     fd.append("end_date", exp.end_date);
//     fd.append("previous_ctc", exp.previous_ctc || 0);
//     fd.append("location", exp.location || "");
//     fd.append("description", exp.description || "");

//     // If using link
//     if (exp.exp_letter_link) {
//       fd.append("experience_letter_path", exp.exp_letter_link);
//     }

//     // If using file upload
//     if (exp.expLetterFile) {
//       fd.append("experience_letter", exp.expLetterFile);
//     }

//     const res = await fetch(
//       `https://apihrr.goelectronix.co.in/candidates/${effectiveId}/experiences`,
//       {
//         method: "POST",
//         body: fd,   // â— DO NOT set Content-Type manually
//       }
//     );

//     if (!res.ok) {
//       const err = await res.text();
//       console.error(err);
//       throw new Error();
//     }

//     toast.success("Experience Saved âœ…", { id: loadingToast });
//   } catch {
//     toast.error("Failed to save experience âŒ", { id: loadingToast });
//   }
// };

//   const fetchPincodeDetails = async (pincode) => {
//     if (!/^\d{6}$/.test(pincode)) return;
//     setIsFetchingPincode(true);
//     try {
//       const res = await fetch(`https://api.postalpincode.in/pincode/${pincode}`);
//       const data = await res.json();
//       if (data[0]?.Status === "Success") {
//         setCityOptions(data[0].PostOffice.map(o => o.Name));
//         setFormData(p => ({...p, city: data[0].PostOffice[0].Name, state: data[0].PostOffice[0].State}));
//       }
//     } finally { setIsFetchingPincode(false); }
//   };

// //   const handleSubmit = async (e) => {
// //     e.preventDefault();
// //     setLoading(true);
// //     const loadingToast = toast.loading("Executing Final PATCH Sync...");
// //     try {
// //       const apiData = new FormData();
// //       Object.keys(formData).forEach(key => {
// //         if (formData[key] && !["experiences", "certificateFiles", "languages_spoken", "cvFile", "skills", "assets"].includes(key)) {
// //           apiData.append(key, formData[key]);
// //         }
// //       });
// //       apiData.append("full_name", formData.name);
// //       apiData.append("experience_details", JSON.stringify(formData.experiences));
// //       apiData.append("languages_spoken", JSON.stringify(formData.languages_spoken));
// //       apiData.append("skills", JSON.stringify(formData.skills));
// //       apiData.append("assets", JSON.stringify(formData.assets));

// //       const response = await fetch(`https://apihrr.goelectronix.co.in/candidates/${effectiveId}`, {
// //         method: "PATCH",
// //         body: apiData,
// //       });

// //       if (response.ok) {
// //         toast.success("Candidate Synchronized ðŸŽ‰", { id: loadingToast });
// //         navigate("/candidates");
// //       } else { throw new Error(); }
// //     } catch { toast.error("Commit failed", { id: loadingToast }); }
// //     finally { setLoading(false); }
// //   };

// const STEP_FIELDS = {
//   1: [
//     "name", "email", "phone", "gender", "dob",
//     "position", "experience", "education", "department",
//     "about_me", "languages_spoken"
//   ],

//   2: [
//     "address", "address2", "location",
//     "pincode", "city", "district", "state", "country"
//   ],

//   3: [
//     "experiences"
//   ],

//   4: [
//     "skills", "assets"
//   ],

//   5: [
//     "resume_link", "cvFile", "certificateFiles", "certificateLinks"
//   ]
// };

// const saveStepData = async (stepNumber) => {
//   try {
//     const apiData = new FormData();
//     const fields = STEP_FIELDS[stepNumber] || [];

//     fields.forEach((key) => {
//       if (key === "languages_spoken") {
//   (formData.languages_spoken || []).forEach((lang) => {
//     apiData.append("languages_spoken", lang);
//   });
// }
// else if (key === "skills" || key === "assets") {
//   apiData.append(key, JSON.stringify(formData[key] || []));
// }

//       else if (key === "experiences") {
//         apiData.append("experience_details", JSON.stringify(formData.experiences || []));
//       }
//       else if (key === "cvFile" && formData.cvFile) {
//         apiData.append("resume", formData.cvFile);
//       }
//       else if (key === "certificateFiles") {
//         formData.certificateFiles.forEach(file => {
//           apiData.append("certificates", file);
//         });
//       }
//       else if (key === "certificateLinks") {
//         apiData.append(
//           "certificate_links",
//           JSON.stringify(formData.certificateLinks.filter(l => l && l.trim()))
//         );
//       }
//       else {
//         apiData.append(key, formData[key] ?? "");
//       }
//     });

//     apiData.append("full_name", formData.name || "");

//     await fetch(`https://apihrr.goelectronix.co.in/candidates/${effectiveId}`, {
//       method: "PATCH",
//       body: apiData,
//     });

//     toast.success(`Step ${stepNumber} saved`);
//   } catch (err) {
//     console.error(err);
//     toast.error("Auto save failed");
//   }
// };

// const handleSubmit = async (e) => {
//   e.preventDefault();
//   setLoading(true);

//   const loadingToast = toast.loading("Executing Final PATCH Sync...");

//   try {
//     const apiData = new FormData();

//     // ðŸ”¹ Append ALL simple fields (NO skipping empty)
//     for (const key in formData) {
//       if (
//         ![
//           "experiences",
//           "certificateFiles",
//           "languages_spoken",
//           "cvFile",
//           "skills",
//           "assets",
//         ].includes(key)
//       ) {
//         apiData.append(key, formData[key] ?? "");
//       }
//     }

//     // ðŸ”¹ Required backend fields
//     apiData.append("full_name", formData.name || "");

//     // ðŸ”¹ Arrays
//     // apiData.append(
//     //   "languages_spoken",
//     //   JSON.stringify(formData.languages_spoken || [])
//     // );
//     (formData.languages_spoken || []).forEach((lang) => {
//   apiData.append("languages_spoken", lang);
// });

//     apiData.append("skills", JSON.stringify(formData.skills || []));
//     apiData.append("assets", JSON.stringify(formData.assets || []));

//     // ðŸ”¹ Resume FILE
//     if (formData.cvFile) {
//       apiData.append("resume", formData.cvFile);
//     }

//     // ðŸ”¹ Resume LINK
//     if (formData.resume_link) {
//       apiData.append("resume_path", formData.resume_link);
//     }

//     // ðŸ”¹ Certificates FILES
//     formData.certificateFiles.forEach((file) => {
//       apiData.append("certificates", file);
//     });

//     // ðŸ”¹ Certificate LINKS
//     apiData.append(
//       "certificate_links",
//       JSON.stringify(
//         formData.certificateLinks.filter((l) => l && l.trim())
//       )
//     );

//     // ðŸ”¹ Debug â€” SEE WHAT GOES TO API
//     for (let pair of apiData.entries()) {
//       console.log(pair[0], pair[1]);
//     }

//     const response = await fetch(
//       `https://apihrr.goelectronix.co.in/candidates/${effectiveId}`,
//       {
//         method: "PATCH",
//         body: apiData,
//       }
//     );

//     if (!response.ok) {
//       const err = await response.text();
//       console.error(err);
//       throw new Error("API Failed");
//     }

//     toast.success("Candidate Synchronized ðŸŽ‰", { id: loadingToast });
//     // navigate("/candidates");
//   } catch (err) {
//     console.error(err);
//     toast.error("Commit failed âŒ", { id: loadingToast });
//   } finally {
//     setLoading(false);
//   }
// };

// const today = new Date();

// // 18 years ago (max allowed DOB)
// const maxDate = new Date(
//   today.getFullYear() - 18,
//   today.getMonth(),
//   today.getDate()
// )
//   .toISOString()
//   .split("T")[0];

// // 70 years ago (min allowed DOB)
// const minDate = new Date(
//   today.getFullYear() - 70,
//   today.getMonth(),
//   today.getDate()
// )
//   .toISOString()
//   .split("T")[0];

// const [dobError, setDobError] = useState("");

// const handleDobChange = (value) => {
//   setFormData({ ...formData, dob: value });

//   if (!value) {
//     setDobError("Date of Birth is required");
//     return;
//   }

//   const selected = new Date(value);

//   if (selected > new Date(maxDate)) {
//     setDobError("Age must be at least 18 years");
//   } else if (selected < new Date(minDate)) {
//     setDobError("Age must be below 70 years");
//   } else {
//     setDobError("");
//   }
// };

//   if (fetchingData) return (
//     <div className="min-h-screen flex flex-col items-center justify-center bg-slate-50 gap-4">
//       <Loader2 className="h-10 w-10 animate-spin text-blue-600" />
//       <p className="text-[11px] font-black uppercase tracking-[0.2em] text-slate-400">Loading Data Load {effectiveId}...</p>
//     </div>
//   );

//   return (
//     <div className="min-h-screen bg-[#F8FAFC] p-4 md:p-12 antialiased">
//       <div className="max-w-6xl mx-auto space-y-8" ref={dropdownContainerRef}>

//         {/* ROADMAP HEADER */}
//         <div className="flex flex-col lg:flex-row justify-between items-center bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 gap-8">
//           <div className="flex items-center gap-6">
//             <div className="h-16 w-16 bg-slate-900 rounded-[1.5rem] flex items-center justify-center text-white shadow-2xl">
//               <Database size={32} />
//             </div>
//             <div>
//               <h2 className="text-2xl font-black text-slate-900 tracking-tight leading-none">{id ? "Profile" : "Manual Registry"}</h2>
//               <div className="flex items-center gap-2 mt-1 text-blue-600">
//                 <ShieldCheck size={14} />
//                 {/* <p className="text-[10px] font-black uppercase tracking-widest leading-none">ID: {effectiveId}</p> */}
//               </div>
//             </div>
//           </div>

//           <div className="flex-1 max-w-2xl w-full px-4">
//             <div className="relative flex justify-between items-center w-full">
//               <div className="absolute top-1/2 left-0 w-full h-0.5 bg-slate-100 -translate-y-1/2 z-0" />
//               <div
//                 className="absolute top-1/2 left-0 h-0.5 bg-blue-600 -translate-y-1/2 z-0 transition-all duration-700"
//                 style={{ width: `${((step - 1) / (totalSteps - 1)) * 100}%` }}
//               />
//               {[1, 2, 3, 4, 5].map((num) => (
//                 <div key={num} className="relative z-10 flex flex-col items-center gap-2">
//                   <div className={`h-8 w-8 rounded-full flex items-center justify-center text-[10px] font-black transition-all border-4 ${step === num ? "bg-blue-600 text-white border-blue-100 scale-110 shadow-lg" : step > num ? "bg-emerald-500 text-white border-emerald-50" : "bg-white text-slate-300 border-slate-50"}`}>
//                     {step > num ? <Check size={14} strokeWidth={4} /> : num}
//                   </div>
//                   <span className={`absolute -bottom-6 text-[8px] font-black uppercase tracking-tighter transition-colors duration-300 ${step === num ? "text-blue-600" : "text-slate-300"}`}>
//                     {num === 1 && "Identity"} {num === 2 && "Location"} {num === 3 && "Experience"} {num === 4 && "Inventory"} {num === 5 && "Documents"}
//                   </span>
//                 </div>
//               ))}
//             </div>
//           </div>
//           <div className="bg-slate-50 border border-slate-200 rounded-2xl px-6 py-3 flex items-center gap-3 shadow-inner">
//             <div className="text-right"><p className="text-[8px] font-black text-slate-400 uppercase leading-none">Status</p><p className="text-sm font-black text-slate-900 mt-1">{Math.round((step / totalSteps) * 100)}%</p></div>
//             <div className="h-8 w-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center"><Check size={18} /></div>
//           </div>
//         </div>

//         <form onSubmit={handleSubmit}>
//           <div className="space-y-12">

//             {/* STEP 1: IDENTITY & CAREER */}
//             {step === 1 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8 duration-500">
//                 <div className="flex items-center gap-4 pb-4 border-b border-slate-100"><User size={18} className="text-blue-600" /><h3 className="text-sm font-black text-slate-800 uppercase tracking-widest">Basic Candidate profile</h3></div>
//                 <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
//                   <FormField label="Full Name" required><input placeholder="Legal Name" value={formData.name} onChange={(e) => setFormData({ ...formData, name: e.target.value })} className={inputStyle} /></FormField>
//                   <FormField label="Email" required><input type="email" placeholder="name@domain.com" value={formData.email} onChange={(e) => setFormData({ ...formData, email: e.target.value })} className={inputStyle} /></FormField>
//                   <FormField label="Phone" required><div className="flex items-center bg-slate-50 border border-slate-200 rounded-xl overflow-hidden focus-within:bg-white focus-within:border-blue-500 transition-all shadow-sm"><span className="px-3 text-[11px] font-black text-slate-400">+91</span><input maxLength={10} value={formData.phone} onChange={(e) => setFormData({ ...formData, phone: e.target.value })} className="w-full px-3 py-2 bg-transparent text-[13px] font-bold outline-none" /></div></FormField>
//                   <FormField label="Gender"><select value={formData.gender} onChange={(e) => setFormData({ ...formData, gender: e.target.value })} className={inputStyle}><option value="">Select</option><option value="male">Male</option><option value="female">Female</option></select></FormField>
//                 </div>

//                 <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 pt-4 border-t border-slate-50 mt-4">
//                   {/* <FormField label="Position" required>
//                     <div className="relative">
//                       <div className="relative group"><input placeholder="Role..." value={formData.position} onFocus={() => { setShowSkillDrop(true); setShowAssetDrop(false); setSkillFocused(false); }} onChange={(e) => setFormData({ ...formData, position: e.target.value })} className={inputStyle} /><ChevronDown size={16} className={`absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 transition-transform ${showSkillDrop ? 'rotate-180' : ''}`} /></div>
//                       {showSkillDrop && (<div className="absolute z-[100] w-full mt-2 bg-white border border-slate-200 rounded-3xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 max-h-60 overflow-y-auto no-scrollbar">{POSITION_OPTIONS.filter(p => p.toLowerCase().includes(formData.position.toLowerCase())).map((pos, i) => (<div key={i} onMouseDown={(e) => { e.preventDefault(); setFormData({ ...formData, position: pos }); setShowSkillDrop(false); }} className="px-6 py-4 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-700 cursor-pointer border-b last:border-0 transition-colors">{pos}</div>))}</div>)}
//                     </div>
//                   </FormField> */}
//                   {/* <FormField label="Total experiance"><input type="number" placeholder="Years" value={formData.experience} onChange={(e) => setFormData({...formData, experience: e.target.value})} className={inputStyle} /></FormField>
//                   <FormField label="Education " required>
//                     <div className="relative">
//                       <div className="relative group"><input placeholder="Degree..." value={eduSearch || formData.education} onFocus={() => { setShowAssetDrop(true); setShowSkillDrop(false); setSkillFocused(false); }} onChange={(e) => { setEduSearch(e.target.value); setFormData({ ...formData, education: e.target.value }); }} className={inputStyle} /><ChevronDown size={16} className={`absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 transition-transform ${showAssetDrop ? 'rotate-180' : ''}`} /></div>
//                       {showAssetDrop && (<div className="absolute z-[100] w-full mt-2 bg-white border border-slate-200 rounded-3xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 max-h-60 overflow-y-auto no-scrollbar">{filteredEducation.map((e, i) => (<div key={i} onMouseDown={(ev) => { ev.preventDefault(); setFormData({ ...formData, education: e }); setEduSearch(""); setShowAssetDrop(false); }} className="px-6 py-4 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-700 cursor-pointer border-b last:border-0 transition-colors">{e}</div>))}</div>)}
//                     </div>
//                   </FormField> */}
//                   {/* <FormField label="Department">
//                     <div className="relative">
//                       <div className="relative group"><input placeholder="Search..." value={deptSearch || formData.department} onFocus={() => { setSkillFocused(true); setShowSkillDrop(false); setShowAssetDrop(false); }} onChange={(e) => { setDeptSearch(e.target.value); setFormData({ ...formData, department: e.target.value }); }} className={inputStyle} /><ChevronDown size={16} className={`absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 transition-transform ${skillFocused ? 'rotate-180' : ''}`} /></div>
//                       {skillFocused && (<div className="absolute z-[100] w-full mt-2 bg-white border border-slate-200 rounded-3xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 max-h-60 overflow-y-auto no-scrollbar">{filteredDepartments.map((d) => (<div key={d.id} onMouseDown={(ev) => { ev.preventDefault(); setFormData({ ...formData, department: d.name }); setDeptSearch(""); setSkillFocused(false); }} className="px-6 py-4 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-700 cursor-pointer border-b last:border-0 transition-colors">{d.name}</div>))}</div>)}
//                     </div>
//                   </FormField> */}
//                 </div>

//                 <div className="grid grid-cols-1 md:grid-cols-2 gap-8 pt-4">
//                   <FormField label="Date of Birth"><input type="date"  min={minDate}
//     max={maxDate}  value={formData.dob} onChange={(e) => setFormData({ ...formData, dob: e.target.value })} className={inputStyle} /></FormField>
//                   <FormField label="Languages"><div className="bg-slate-50 border border-slate-200 rounded-xl p-3 max-h-32 overflow-y-auto grid grid-cols-2 gap-3 shadow-inner">{["English", "Hindi", "Marathi", "Gujarati", "Tamil", "Telugu"].map(lang => (<label key={lang} className="flex items-center gap-2 text-[11px] font-medium text-slate-600 cursor-pointer hover:text-blue-600 transition-colors"><input type="checkbox" checked={formData.languages_spoken.includes(lang)} onChange={() => { const u = formData.languages_spoken.includes(lang) ? formData.languages_spoken.filter(l => l !== lang) : [...formData.languages_spoken, lang]; setFormData({ ...formData, languages_spoken: u }); }} className="w-3.5 h-3.5 accent-blue-600 rounded" /> {lang}</label>))}</div></FormField>
//                 </div>
//                 <FormField label="Bio Summary"><textarea rows={3} value={formData.about_me} onChange={(e) => setFormData({ ...formData, about_me: e.target.value })} className={inputStyle + " resize-none"} /></FormField>
//                 <div className="flex justify-end pt-4"><button type="button"
//                 // onClick={() => setStep(2)}
//                 onClick={async () => {
//   await saveStepData(1);
//   setStep(2);
// }}

//                 className={`px-12 py-3 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest shadow-xl active:scale-95 transition-all`}>Next Phase â†’</button></div>
//               </div>
//             )}

//             {/* STEP 2: GEOGRAPHY */}
//             {step === 2 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8">
//                 <div className="flex items-center gap-3 pb-4 border-b border-slate-100"><MapPin size={18} className="text-blue-600" /><h3 className="text-xs font-black text-slate-800 uppercase tracking-widest">location Data</h3></div>
//                 <div className="space-y-8">
//                   <FormField label="Address 1" required><input value={formData.address} onChange={(e) => setFormData({...formData, address: e.target.value})} className={inputStyle} /></FormField>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                     <FormField label="Address 2" required><input value={formData.location} onChange={(e) => setFormData({...formData, location: e.target.value})} className={inputStyle} /></FormField>
//                     <FormField label="Pincode" required><input maxLength={6} placeholder="000000" value={formData.pincode} onChange={(e) => { setFormData({ ...formData, pincode: e.target.value }); if(e.target.value.length === 6) fetchPincodeDetails(e.target.value); }} className={inputStyle} /></FormField>
//                   </div>
//                   <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
//                     <FormField label="City"><input value={formData.city} readOnly className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner" /></FormField>
//                     <FormField label="District"><input value={formData.district} readOnly className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner" /></FormField>
//                     <FormField label="State"><input value={formData.state} readOnly className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner" /></FormField>
//                     <FormField label="Country"><input value={formData.country}  readOnly onChange={(e) => setFormData({...formData, country: e.target.value})} className={inputStyle} /></FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-between pt-8 border-t border-slate-50"><button onClick={() => setStep(1)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase hover:text-slate-900 transition-all shadow-sm">â† Back</button><button
//                 //  onClick={() => setStep(3)}
//                 onClick={async () => {
//   await saveStepData(2);
//   setStep(3);
// }}

//                   type="button" className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase shadow-xl transition-all">Continue â†’</button></div>
//               </div>
//             )}

//             {/* STEP 3: EXPERIENCE */}
//             {step === 3 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
//                 <div className="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-sm transition-all overflow-hidden">
//                   <div className="flex flex-col md:flex-row items-center justify-between gap-6">
//                     <div className="flex items-center gap-4 text-slate-900 font-black"><Briefcase size={24} className="text-blue-600" /><div><h3 className="text-sm uppercase tracking-widest">Are you Fresher?</h3><p className="text-[10px] font-bold text-slate-400 mt-1">Select current career status</p></div></div>
//                     <div className="flex bg-slate-100 p-1.5 rounded-[1.5rem] border border-slate-200 w-full md:w-auto">
//                       <button type="button" onClick={() => { setIsFresher(true); setFormData({ ...formData, experiences: [] }); }} className={`px-8 py-2.5 rounded-2xl text-[10px] font-black transition-all ${isFresher === true ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}>Yes</button>
//                       <button type="button" onClick={() => setIsFresher(false)} className={`px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === false ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}>No</button>
//                     </div>
//                   </div>
//                 </div>

//                 {isFresher === false && (
//                   <div className="bg-white p-6 md:p-10 rounded-[3.5rem] border border-slate-200 shadow-xl space-y-10 animate-in fade-in duration-500 shadow-slate-100">
//                     <div className="flex flex-col sm:flex-row justify-between items-start border-b border-slate-100 pb-8">
//                       <div className="flex items-center gap-4"><div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg"><History size={20} /></div><h3 className="text-sm font-black text-slate-900 uppercase">Career Timeline</h3></div>
//                       <button type="button"
//                     //   onClick={() => setFormData({ ...formData, experiences: [...formData.experiences, { company_name: "", job_title: "", uploadMode: "file" }] })}
//                    onClick={() =>
//   setFormData({
//     ...formData,
//     experiences: [
//       ...formData.experiences,
//       {
//         company_name: "",
//         job_title: "",
//         start_date: "",
//         end_date: "",
//         previous_ctc: "",
//         location: "",
//         description: "",
//         exp_letter_link: "",
//         experience_letter_path: "",
//         uploadMode: "file",
//       },
//     ],
//   })
// }

//                       className="px-6 py-3 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase shadow-lg active:scale-95 transition-all">+ Add Experiance</button>
//                     </div>
//                     <div className="space-y-10 max-h-[600px] overflow-y-auto pr-4 custom-scrollbar-professional">
//                        {formData.experiences.map((exp, i) => (
//                          <div key={i} className="relative bg-slate-50/50 border border-slate-200 p-8 rounded-[2.5rem] space-y-8 animate-in zoom-in-95 group hover:bg-white transition-all shadow-inner">
//                             <button type="button" onClick={() => setFormData({ ...formData, experiences: formData.experiences.filter((_, idx) => idx !== i) })} className="absolute -top-3 -right-3 h-10 w-10 bg-white border border-slate-200 text-red-500 rounded-full flex items-center justify-center shadow-lg transition-all opacity-0 group-hover:opacity-100 z-20"><Trash2 size={18} /></button>
//                             <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
//                                 <FormField label="Employer"><input value={exp.company_name} onChange={(e) => { const u = [...formData.experiences]; u[i].company_name = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                                 <FormField label="Designation"><input value={exp.job_title} onChange={(e) => { const u = [...formData.experiences]; u[i].job_title = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                             </div>

//                             <div className="grid grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8">
//                                 <FormField label="Start"><input type="date" value={exp.start_date} onChange={(e) => { const u = [...formData.experiences]; u[i].start_date = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                                 <FormField label="End"><input type="date" value={exp.end_date} onChange={(e) => { const u = [...formData.experiences]; u[i].end_date = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                                 <FormField label="CTC"><input type="number" placeholder="â‚¹" value={exp.previous_ctc} onChange={(e) => { const u = [...formData.experiences]; u[i].previous_ctc = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                                 <FormField label="City"><input value={exp.location} onChange={(e) => { const u = [...formData.experiences]; u[i].location = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                              </div>

//                             <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
//                                <FormField label="Core Responsibilities"><textarea rows={5} value={exp.description} onChange={(e) => { const u = [...formData.experiences]; u[i].description = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle + " resize-none h-full min-h-[140px]"} /></FormField>
//                                <div className="space-y-3">
//                                   <div className="flex justify-between items-center px-1"><p className="text-[10px] font-black text-slate-400 uppercase">Artifact</p><div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200"><button type="button" onClick={() => { const u = [...formData.experiences]; u[i].uploadMode = "file"; setFormData({ ...formData, experiences: u }); }} className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode !== 'link' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>FILE</button><button type="button" onClick={() => { const u = [...formData.experiences]; u[i].uploadMode = "link"; setFormData({ ...formData, experiences: u }); }} className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === 'link' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>URL</button></div></div>
//                                   <div className="bg-white/50 border border-slate-100 rounded-3xl p-4 min-h-[140px] flex flex-col justify-center">
//                                     {exp.uploadMode !== 'link' ? (
//                                       <label className="flex flex-col items-center justify-center gap-3 w-full h-full border-2 border-dashed border-slate-200 rounded-2xl hover:bg-blue-50/30 cursor-pointer group p-4 transition-all">
//                                         <FileUp size={24} className="text-slate-400 group-hover:text-blue-500" />
//                                         <span className="text-[9px] font-bold text-slate-500 uppercase tracking-widest text-center">{exp.experience_letter_path ? "Hydrated File Present" : (exp.expLetterFile ? exp.expLetterFile.name : "Drop PDF Validation")}</span>
//                                         <input type="file" accept=".pdf" className="hidden" onChange={(e) => { const u = [...formData.experiences]; u[i].expLetterFile = e.target.files[0]; setFormData({ ...formData, experiences: u }); }} />
//                                       </label>
//                                     ) : (
//                                       <div className="relative"><LinkIcon size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input placeholder="Storage URI" value={exp.exp_letter_link || exp.experience_letter_path || ""} onChange={(e) => { const u = [...formData.experiences]; u[i].exp_letter_link = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle + " pl-11"} /></div>
//                                     )}
//                                   </div>
//                                </div>
//                             </div>
//                             <div className="flex justify-end pt-2 border-t border-slate-50">
//                                 <button type="button" onClick={() => handleSaveExperienceAPI(i)} className="flex items-center gap-2 px-8 py-3 bg-emerald-50 text-emerald-600 border border-emerald-100 rounded-2xl text-[10px] font-black uppercase hover:bg-emerald-500 hover:text-white transition-all active:scale-95 shadow-sm"><Check size={16} strokeWidth={3} /> Save Record</button>
//                             </div>
//                          </div>
//                        ))}
//                     </div>
//                   </div>
//                 )}
//                 <div className="flex justify-between pt-4"><button onClick={() => setStep(2)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase shadow-sm transition-all hover:text-slate-900 flex items-center gap-2">â† Back</button><button
//                 //  onClick={() => setStep(4)}
//                 onClick={async () => {
//   await saveStepData(3);
//   setStep(4);
// }}

//                   type="button" disabled={isFresher === null} className={`px-12 py-4 rounded-2xl text-xs font-black uppercase shadow-xl transition-all active:scale-95 ${isFresher !== null ? "bg-blue-600 text-white shadow-blue-600/30 hover:bg-blue-700" : "bg-slate-200 text-slate-400 cursor-not-allowed"}`}>Next Phase â†’</button></div>
//               </div>
//             )}

//             {/* STEP 4: INVENTORY */}
//             {step === 4 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 overflow-visible">
//                 <div className="bg-white border border-slate-200 rounded-[3.5rem] shadow-xl overflow-visible shadow-slate-200/50">
//                   <div className="bg-slate-50/50 px-10 py-6 border-b border-slate-200 flex items-center justify-between rounded-t-[3.5rem]"><div className="flex items-center gap-4"><div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg"><Cpu size={20} /></div><div><h3 className="text-sm font-black text-slate-900 uppercase tracking-widest leading-none">Inventory Matrix</h3><p className="text-[10px] font-bold text-slate-400 uppercase mt-0.5">Hydrate expertise and hardware</p></div></div></div>
//                   <div className="p-8 md:p-12 space-y-12 overflow-visible">
//                     <FormField label="Technical Matrix"><div className="space-y-6"><div className="flex flex-col sm:flex-row gap-4 items-end"><div className="relative max-w-md w-full"><Plus size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={skillInput} onChange={(e) => setSkillInput(e.target.value)} onKeyDown={(e) => { if(e.key === 'Enter') { e.preventDefault(); handleManualAddSkill(); } }} placeholder="Register skill..." className={inputStyle + " pl-12"} /></div><button type="button" onClick={handleManualAddSkill} className="px-6 py-3.5 bg-slate-900 hover:bg-blue-600 text-white rounded-2xl transition-all flex items-center gap-2 text-[10px] font-black uppercase tracking-widest shadow-lg shadow-slate-200"><Database size={14} /> Add Skill</button></div><div className="flex flex-wrap gap-3 p-1">{dynamicSkills.map((skill) => { const isSelected = formData.skills.includes(skill); return (<button key={skill} type="button" onClick={() => setFormData({...formData, skills: isSelected ? formData.skills.filter(s => s !== skill) : [...formData.skills, skill]})} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${isSelected ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200" : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`}>{skill} {isSelected && <Check size={14} strokeWidth={3} />}</button>); })}</div></div></FormField>
//                     {/* <FormField label="Enterprise Hardware Matrix"><div className="space-y-6 pt-8 border-t border-slate-100"><div className="relative max-w-md w-full"><Layers size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={assetInput} onChange={(e) => setAssetInput(e.target.value)} onKeyDown={async (e) => { if(e.key === 'Enter') { e.preventDefault(); const v = assetInput.trim(); if(v && !formData.assets.includes(v)) { const ok = await handleAddAssetAPI(v); if(ok) { setFormData({...formData, assets: [...formData.assets, v]}); setAssetInput(""); } } } }} placeholder="Link hardware..." className={inputStyle + " pl-12"} /></div><div className="flex flex-wrap gap-3 p-1">{dynamicAssets.map((asset) => { const isSelected = formData.assets.includes(asset); return (<button key={asset} type="button" onClick={async () => { if(!isSelected) { const ok = await handleAddAssetAPI(asset); if(ok) setFormData({...formData, assets: [...formData.assets, asset]}); } else { setFormData({...formData, assets: formData.assets.filter(a => a !== asset)}); } }} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${isSelected ? "bg-slate-900 border-slate-900 text-white shadow-lg shadow-slate-200" : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`}>{asset} {isSelected && <Check size={14} strokeWidth={3} className="animate-in zoom-in" />}</button>); })}</div></div></FormField> */}
//                       <div className="space-y-6 pt-8 border-t border-slate-100">

//                               <FormField label="Enterprise Hardware Matrix">
//                       <div className="space-y-6">
//                         {/* Search & Manual Add Input */}
//                         <div className="relative max-w-md">
//                           <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">
//                             <Layers size={16} />
//                           </div>
//                           <input
//                             value={assetInput}
//                             onChange={(e) => setAssetInput(e.target.value)}
//                             onKeyDown={async (e) => {
//                               if(e.key === 'Enter') {
//                                 e.preventDefault();
//                                 const v = assetInput.trim();
//                                 if(v && !formData.assets.includes(v)) {
//                                   // API INTEGRATION
//                                   const success = await handleAddAssetAPI(v);
//                                   if(success) {
//                                     setFormData({...formData, assets: [...formData.assets, v]});
//                                     setAssetInput("");
//                                   }
//                                 }
//                               }
//                             }}
//                             placeholder="Type hardware name and press Enter..."
//                             className="w-full pl-12 pr-4 py-3.5 bg-slate-50 border border-slate-200 rounded-2xl text-xs font-bold outline-none focus:bg-white focus:border-slate-900 focus:ring-4 focus:ring-slate-900/5 transition-all shadow-inner"
//                           />
//                         </div>

//                         {/* Asset Cloud */}
//                         <div className="flex flex-wrap gap-3 p-1">
//                           {ASSET_OPTIONS.map((asset) => {
//                             const isSelected = formData.assets.includes(asset);
//                             return (
//                               <button
//                                 key={asset}
//                                 type="button"
//                                 onClick={async () => {
//                                   if (!isSelected) {
//                                     // API INTEGRATION on selection
//                                     const success = await handleAddAssetAPI(asset);
//                                     if(success) {
//                                       setFormData({...formData, assets: [...formData.assets, asset]});
//                                     }
//                                   } else {
//                                     // Optional: Add delete API call here if needed
//                                     setFormData({...formData, assets: formData.assets.filter(a => a !== asset)});
//                                   }
//                                 }}
//                                 className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase tracking-wider transition-all duration-300 border-2 active:scale-90
//                                   ${isSelected
//                                     ? "bg-slate-900 border-slate-900 text-white shadow-lg shadow-slate-200"
//                                     : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`}
//                               >
//                                 {asset}
//                                 {isSelected && <Check size={14} strokeWidth={3} className="animate-in zoom-in" />}
//                               </button>
//                             );
//                           })}

//                           {/* Custom dynamic assets already in state */}
//                           {formData.assets.filter(a => !ASSET_OPTIONS.includes(a)).map((customAsset) => (
//                              <button
//                               key={customAsset}
//                               type="button"
//                               onClick={() => setFormData({...formData, assets: formData.assets.filter(a => a !== customAsset)})}
//                               className="flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase tracking-wider bg-slate-900 border-2 border-slate-900 text-white shadow-lg active:scale-90"
//                             >
//                               {customAsset} <Check size={14} strokeWidth={3} />
//                             </button>
//                           ))}
//                         </div>
//                       </div>
//                     </FormField>
//                             </div>
//                   </div>
//                 </div>
//                 <div className="flex justify-between items-center pt-4"><button onClick={() => setStep(3)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[11px] font-black uppercase transition-all shadow-sm hover:text-slate-900 flex items-center gap-2 transition-all"><ChevronLeft size={16}/> Back</button><button
//                 //  onClick={() => setStep(5)}
//                 onClick={async () => {
//   await saveStepData(4);
//   setStep(5);
// }}

//                  type="button" className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-[11px] font-black uppercase shadow-xl active:scale-95 transition-all">Vault Registry <ChevronRight size={16}/></button></div>
//               </div>
//             )}

//             {/* STEP 5: DOCUMENT VAULT */}
//             {/* {step === 5 && (
//               <div className="space-y-8 animate-in slide-in-from-bottom-12 duration-700">
//                 <div className="bg-white p-8 md:p-16 rounded-[4rem] shadow-xl shadow-slate-200/60 border border-slate-200 space-y-12 overflow-hidden relative">
//                   <div className="absolute top-0 right-0 p-12 text-slate-100 opacity-40 rotate-12 scale-150"><ShieldCheck size={240} /></div>
//                   <div className="flex items-center gap-5 pb-8 border-b border-slate-100 relative z-10"><div className="h-14 w-14 bg-blue-600 rounded-2xl flex items-center justify-center shadow-lg"><ShieldCheck size={28} className="text-white" /></div><div><h3 className="text-xl font-black text-slate-900 uppercase tracking-widest leading-none">Registry Artifacts</h3><p className="text-[10px] font-black text-slate-400 uppercase mt-2">Document Verification Matrix</p></div></div>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-16 relative z-10">
//                     <div className="space-y-8 p-1"><div className="flex justify-between items-center"><p className="text-[11px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2"><span className="h-1.5 w-1.5 rounded-full bg-blue-600" /> Resume Profile</p><div className="flex bg-slate-50 p-1 rounded-xl border border-slate-200"><button type="button" onClick={() => setResumeMode("file")} className={`px-5 py-2 text-[10px] font-black rounded-lg transition-all ${resumeMode === 'file' ? 'bg-white text-slate-900 shadow-sm border' : 'text-slate-400'}`}>FILE</button><button type="button" onClick={() => setResumeMode("link")} className={`px-5 py-2 text-[10px] font-black rounded-lg transition-all ${resumeMode === 'link' ? 'bg-white text-slate-900 shadow-sm border' : 'text-slate-400'}`}>URL</button></div></div>
//                     {resumeMode === 'file' ? (<label className="block p-12 border-2 border-dashed border-slate-200 rounded-[3rem] hover:border-blue-500 transition-all cursor-pointer group text-center bg-white shadow-inner"><FileUp size={40} className="mx-auto text-slate-300 group-hover:text-blue-500 mb-5 duration-500" /><p className="text-[10px] font-black text-slate-900 uppercase truncate px-4">{formData.cvFile ? formData.cvFile.name : "Select Resume PDF"}</p><input type="file" accept=".pdf" className="hidden" onChange={(e) => setFormData({...formData, cvFile: e.target.files[0], resume_link: ""})} /></label>) : <input placeholder="Enter URI Storage Link" value={formData.resume_link} onChange={(e) => setFormData({...formData, resume_link: e.target.value, cvFile: null})} className={inputStyle} />}</div>

//                           <div className="pt-8 border-t border-slate-100 space-y-8 relative z-10">
//                              <div className="flex justify-between items-center mb-2">
//                                 <p className="text-[11px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2">
//                                   <span className="h-1.5 w-1.5 rounded-full bg-emerald-500" /> 3. Credentials Matrix
//                                 </p>
//                                 <div className="flex gap-4">
//                                   <label className="cursor-pointer h-12 w-12 bg-white text-slate-400 rounded-2xl hover:text-emerald-600 border border-slate-200 active:scale-90 transition-all flex items-center justify-center shadow-sm">
//                                     <FileUp size={20}/><input type="file" multiple accept=".pdf" className="hidden" onChange={(e) => setFormData({...formData, certificateFiles: [...formData.certificateFiles, ...Array.from(e.target.files)]})}/>
//                                   </label>
//                                   <button type="button" onClick={() => setFormData({...formData, certificateLinks: [...formData.certificateLinks, ""]})} className="h-12 w-12 bg-white text-slate-400 rounded-2xl hover:text-emerald-600 border border-slate-200 active:scale-90 flex items-center justify-center shadow-sm">
//                                     <LinkIcon size={20}/>
//                                   </button>
//                                 </div>
//                              </div>
//                              <div className="grid grid-cols-1 md:grid-cols-2 gap-8 max-h-[400px] overflow-y-auto no-scrollbar pr-2">
//                                {formData.certificateFiles.map((file, idx) => (
//                                   <div key={idx} className="flex justify-between items-center bg-slate-50 p-6 rounded-[2rem] border border-slate-100 text-xs text-slate-900 font-bold animate-in zoom-in-95 hover:border-emerald-200 transition-colors shadow-sm">
//                                     <div className="flex items-center gap-4 truncate max-w-[85%]">
//                                       <div className="h-2 w-2 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.4)]" />
//                                       {file.name}
//                                     </div>
//                                     <X size={20} className="text-slate-300 hover:text-red-500 cursor-pointer transition-all hover:rotate-90" onClick={() => setFormData({...formData, certificateFiles: formData.certificateFiles.filter((_, i) => i !== idx)})}/>
//                                   </div>
//                                ))}
//                                {formData.certificateLinks.map((link, idx) => (
//                                   <div key={idx} className="flex gap-4 animate-in slide-in-from-right-4">
//                                     <div className="relative flex-1">
//                                       <Globe size={18} className="absolute left-6 top-1/2 -translate-y-1/2 text-slate-300" />
//                                       <input value={link} placeholder="Credential Link" onChange={(e) => { const u = [...formData.certificateLinks]; u[idx] = e.target.value; setFormData({...formData, certificateLinks: u}); }} className="w-full bg-white border border-slate-200 rounded-[2rem] pl-16 pr-6 py-5 text-sm font-bold text-slate-900 outline-none focus:border-emerald-500 shadow-sm" />
//                                     </div>
//                                     <button type="button" onClick={() => setFormData({...formData, certificateLinks: formData.certificateLinks.filter((_, i) => i !== idx)})} className="text-slate-300 hover:text-red-500 bg-white h-16 w-16 rounded-[2rem] border border-slate-200 transition-all flex items-center justify-center shadow-sm">
//                                       <Trash2 size={24}/>
//                                     </button>
//                                   </div>
//                                ))}
//                              </div>
//                           </div>
//                   </div>
//                   <div className="pt-16 border-t border-slate-100 flex flex-col items-center gap-8 relative z-10"><button type="submit" disabled={loading} className="w-full md:max-w-xl flex items-center justify-center gap-5 bg-blue-600 hover:bg-blue-700 text-white font-black py-7 rounded-[3rem] shadow-2xl active:scale-[0.98] uppercase disabled:opacity-50 tracking-widest leading-none">{loading ? <Loader2 className="animate-spin" size={28} /> : <><Database size={24} /><span>Finalize Patch commit</span></>}</button><button type="button" onClick={() => setStep(4)} className="text-[10px] font-black text-slate-400 uppercase tracking-widest hover:text-slate-900 flex items-center gap-2 transition-all"><ChevronLeft size={16}/> Return to Previous Module</button></div>
//                 </div>
//               </div>
//             )} */}

//             {step === 5 && (
//   <div className="space-y-8 animate-in slide-in-from-bottom-8 duration-500">
//     <div className="bg-white rounded-[2rem] shadow-2xl shadow-slate-200/50 border border-slate-200 overflow-hidden relative">

//       {/* SECTION HEADER: Enterprise Indigo Theme */}
//       <div className="bg-slate-50 px-8 py-6 border-b border-slate-200 flex items-center justify-between">
//         <div className="flex items-center gap-5">
//           <div className="h-12 w-12 bg-slate-900 rounded-2xl flex items-center justify-center text-white shadow-lg">
//             <ShieldCheck size={24} />
//           </div>
//           <div>
//             <h3 className="text-lg font-bold text-slate-900 tracking-tight">Registry Artifacts</h3>
//             <p className="text-[11px] font-semibold text-slate-500 uppercase tracking-widest">Document Verification Matrix</p>
//           </div>
//         </div>
//         <div className="hidden md:flex items-center gap-2 px-4 py-1.5 bg-blue-50 border border-blue-100 rounded-full">
//           <div className="h-1.5 w-1.5 rounded-full bg-blue-500 animate-pulse" />
//           <span className="text-[10px] font-bold text-blue-600 uppercase tracking-tighter">System Ready for PATCH</span>
//         </div>
//       </div>

//       <div className="p-8 md:p-12 space-y-12">
//         <div className="grid grid-cols-1 lg:grid-cols-2 gap-12">

//           {/* 1. MASTER RESUME SECTION */}
//           <div className="space-y-6">
//             <div className="flex justify-between items-center px-1">
//               <div className="flex items-center gap-2">
//                 <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">01. Resume Node</span>
//               </div>
//               <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200 scale-90">
//                 <button type="button" onClick={() => setResumeMode("file")} className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === 'file' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>FILE</button>
//                 <button type="button" onClick={() => setResumeMode("link")} className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${resumeMode === 'link' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>URL</button>
//               </div>
//             </div>

//             {resumeMode === 'file' ? (
//               <label className="flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-slate-200 rounded-3xl bg-slate-50/50 hover:bg-white hover:border-blue-500 transition-all cursor-pointer group">
//                 <div className="flex flex-col items-center gap-3">
//                   <div className="p-4 bg-white rounded-2xl shadow-sm border border-slate-100 group-hover:scale-110 transition-transform duration-500">
//                     <FileUp size={28} className="text-slate-400 group-hover:text-blue-500" />
//                   </div>
//                   <span className="text-[11px] font-bold text-slate-500 uppercase tracking-widest">
//                     {formData.cvFile ? formData.cvFile.name : "Commit Resume PDF"}
//                   </span>
//                 </div>
//                 <input type="file" accept=".pdf" className="hidden" onChange={(e) => setFormData({...formData, cvFile: e.target.files[0], resume_link: ""})} />
//               </label>
//             ) : (
//               <div className="relative">
//                 <LinkIcon size={18} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" />
//                 <input placeholder="Enter Public Storage URI..." value={formData.resume_link} onChange={(e) => setFormData({...formData, resume_link: e.target.value, cvFile: null})} className={inputStyle + " pl-12"} />
//               </div>
//             )}
//           </div>

//           {/* 2. CREDENTIALS MATRIX SECTION */}
//           <div className="space-y-6">
//             <div className="flex justify-between items-center px-1">
//               <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">02. Credentials Registry</span>
//               <div className="flex gap-2">
//                 <label className="cursor-pointer h-10 w-10 bg-slate-900 text-white rounded-xl hover:bg-blue-600 active:scale-90 transition-all flex items-center justify-center shadow-lg shadow-slate-200">
//                   <Plus size={18}/><input type="file" multiple accept=".pdf" className="hidden" onChange={(e) => setFormData({...formData, certificateFiles: [...formData.certificateFiles, ...Array.from(e.target.files)]})}/>
//                 </label>
//                 <button type="button" onClick={() => setFormData({...formData, certificateLinks: [...formData.certificateLinks, ""]})} className="h-10 w-10 bg-white text-slate-600 rounded-xl border border-slate-200 hover:border-blue-500 hover:text-blue-500 active:scale-90 transition-all flex items-center justify-center shadow-sm">
//                   <LinkIcon size={18}/>
//                 </button>
//               </div>
//             </div>

//             <div className="grid grid-cols-1 gap-4 max-h-[220px] overflow-y-auto no-scrollbar pr-1">
//               {formData.certificateFiles.map((file, idx) => (
//                 <div key={idx} className="flex justify-between items-center bg-slate-50 p-4 rounded-2xl border border-slate-100 hover:border-blue-300 transition-colors">
//                   <div className="flex items-center gap-3">
//                     <div className="h-2 w-2 rounded-full bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)]" />
//                     <span className="text-[12px] font-bold text-slate-700 truncate max-w-[200px]">{file.name}</span>
//                   </div>
//                   <X size={16} className="text-slate-300 hover:text-red-500 cursor-pointer transition-all hover:rotate-90" onClick={() => setFormData({...formData, certificateFiles: formData.certificateFiles.filter((_, i) => i !== idx)})}/>
//                 </div>
//               ))}
//               {formData.certificateLinks.map((link, idx) => (
//                 <div key={idx} className="flex gap-3 animate-in slide-in-from-right-4">
//                   <div className="relative flex-1">
//                     <Globe size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" />
//                     <input value={link} placeholder="Public URI..." onChange={(e) => { const u = [...formData.certificateLinks]; u[idx] = e.target.value; setFormData({...formData, certificateLinks: u}); }} className={inputStyle + " pl-11 !py-2.5"} />
//                   </div>
//                   <button type="button" onClick={() => setFormData({...formData, certificateLinks: formData.certificateLinks.filter((_, i) => i !== idx)})} className="text-slate-300 hover:text-red-500 bg-slate-50 h-10 w-10 rounded-xl border border-slate-200 flex items-center justify-center">
//                     <Trash2 size={16}/>
//                   </button>
//                 </div>
//               ))}
//               {formData.certificateFiles.length === 0 && formData.certificateLinks.filter(l => l).length === 0 && (
//                 <div className="py-8 text-center bg-slate-50/50 border border-dashed border-slate-200 rounded-2xl">
//                   <p className="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">No secondary artifacts registered</p>
//                 </div>
//               )}
//             </div>
//           </div>
//         </div>

//         {/* METADATA INFO CARD */}
//         <div className="bg-slate-900 rounded-3xl p-6 flex flex-col md:flex-row items-center justify-between gap-6 shadow-2xl">
//           <div className="flex items-center gap-4">
//             <div className="h-10 w-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400">
//               <History size={20} />
//             </div>
//             <div>
//               <p className="text-white text-xs font-bold tracking-wide uppercase">Final Validation Note</p>
//               <p className="text-slate-400 text-[10px] uppercase font-semibold tracking-tighter">Hydrating Node {effectiveId} â€¢ PATCH Commit ready</p>
//             </div>
//           </div>
//           <button type="submit"
//            onClick={handleSubmit}
//            className="w-full md:w-auto px-10 py-3.5 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl text-[11px] font-black uppercase tracking-widest transition-all shadow-xl shadow-blue-600/20 active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3">
//             {loading ? <Loader2 className="animate-spin" size={18} /> : <><Database size={18}/><span>Submit data</span></>}
//           </button>
//         </div>
//       </div>

//       {/* FOOTER ACTIONS */}
//       <div className="flex justify-center pt-2 pb-8">
//         <button type="button" onClick={() => setStep(4)} className="text-[10px] font-bold text-slate-400 uppercase tracking-widest hover:text-slate-900 transition-colors flex items-center gap-2 group">
//           <ChevronLeft size={16} className="group-hover:-translate-x-1 transition-transform" />
//           Return to Inventory Matrix
//         </button>
//       </div>
//     </div>
//   </div>
// )}
//           </div>
//         </form>
//       </div>
//       <style dangerouslySetInnerHTML={{ __html: `.custom-scrollbar-professional::-webkit-scrollbar { width: 6px; }.custom-scrollbar-professional::-webkit-scrollbar-track { background: transparent; }.custom-scrollbar-professional::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 20px; }.custom-scrollbar-professional::-webkit-scrollbar-thumb:hover { background: #CBD5E1; }`}} />
//     </div>
//   );
// };

// export default ManualEntryPage;
//******************************************************************************************************************* */
// import React, { useState, useEffect, useRef } from "react";
// import { useParams, useNavigate } from "react-router-dom";
// import {
//   Check, FileText, Award, User, Briefcase, MapPin, Mail, Phone,
//   Loader2, Plus, Trash2, Layers, Cpu, ExternalLink, Database,
//   Globe, ShieldCheck, History, X, LinkIcon, FileUp, ChevronRight, ChevronLeft, ChevronDown
// } from "lucide-react";
// import toast from "react-hot-toast";
// import { candidateService } from "../../services/candidateService";
// import { departmentService } from "../../services/department.service";

// const FormField = ({ label, required, error, children }) => (
//   <div className="space-y-1.5 w-full">
//     <label className="text-[10px] md:text-[11px] font-black text-slate-500 uppercase tracking-widest ml-1 flex justify-between items-center">
//       <span>{label}</span>
//       <span className={`font-bold normal-case ${required ? "text-red-500" : "text-slate-300"}`}>
//         {required ? "Required" : "Optional"}
//       </span>
//     </label>
//     {children}
//     {error && <p className="text-[9px] text-red-500 font-bold uppercase tracking-tighter ml-1">{error}</p>}
//   </div>
// );

// const ManualEntryPage = () => {
//   const { id } = useParams();
//   const navigate = useNavigate();
//   const effectiveId = id || "666";
//   const dropdownContainerRef = useRef(null);
//   const careerStepRef = useRef(null);

//   // Small & Professional Input Style
//   const inputStyle = "w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-[13px] font-bold outline-none focus:bg-white focus:border-blue-500 transition-all shadow-sm";

//   // 1. INITIALIZE ALL STATES
//   const [step, setStep] = useState(1);
//   const [loading, setLoading] = useState(false);
//   const [fetchingData, setFetchingData] = useState(false);
//   const [errors, setErrors] = useState({});
//   const [isFetchingPincode, setIsFetchingPincode] = useState(false);
//   const [cityOptions, setCityOptions] = useState([]);
//   const [resumeMode, setResumeMode] = useState("file");
//   const [skillInput, setSkillInput] = useState("");
//   const [assetInput, setAssetInput] = useState("");
//   const [isFresher, setIsFresher] = useState(null);
//   const [deptSearch, setDeptSearch] = useState("");
//   const [eduSearch, setEduSearch] = useState("");
//   const [skillFocused, setSkillFocused] = useState(false);
//   const [dynamicSkills, setDynamicSkills] = useState([]);
//   const [dynamicAssets, setDynamicAssets] = useState([]);
//   const [showSkillDrop, setShowSkillDrop] = useState(false);
//   const [showAssetDrop, setShowAssetDrop] = useState(false);
//   const [departments, setDepartments] = useState([]);

//   const [formData, setFormData] = useState({
//     name: "", email: "", phone: "", address1: "", address2: "", location: "",
//     pincode: "", state: "", city: "", district: "", country: "India", position: "",
//     education: "", gender: "", dob: "", experience: "", about_me: "",
//     languages_spoken: [], skills: [], assets: [], department: "",
//     cvFile: null, resume_link: "", certificateFiles: [], certificateLinks: [""], experiences: [],
//   });

//   // 2. STATIC DATA & FILTER LOGIC
//   const totalSteps = 5;
//   const POSITION_OPTIONS = ["Frontend Developer", "Backend Developer", "Full Stack Developer", "HR Executive", "UI/UX Designer", "DevOps Engineer"];
//   const educationOptions = ["B.Tech", "M.Tech", "B.Sc", "M.Sc", "BCA", "MCA", "MBA", "Diploma", "PhD"];

//   const filteredEducation = educationOptions.filter(e => e.toLowerCase().includes(eduSearch.toLowerCase()));
//   const filteredDepartments = departments.filter(d => (d.name || "").toLowerCase().includes(deptSearch.toLowerCase()));
//   const isStep1Valid = formData.name && /^\S+@\S+\.\S+$/.test(formData.email) && formData.phone;

//   // 3. HYDRATION LOGIC (GET Candidate 666)
//   useEffect(() => {
//     const hydrateCandidate = async () => {
//       setFetchingData(true);
//       try {
//         const response = await fetch(`https://apihrr.goelectronix.co.in/candidates/${effectiveId}`);
//         const data = await response.json();

//         if (data) {
//           const safeParse = (str) => {
//             if (!str) return [];
//             try {
//               if (Array.isArray(str)) {
//                 if (typeof str[0] === 'string' && str[0].startsWith('[')) return JSON.parse(str.join(''));
//                 return str;
//               }
//               return JSON.parse(str);
//             } catch { return []; }
//           };

//           setFormData(prev => ({
//             ...prev,
//             name: data.full_name || "",
//             email: data.email || "",
//             phone: data.phone || "",
//             gender: data.gender || "",
//             dob: data.dob || "",
//             address1: data.address1 || "",
//             address2: data.address2 || "",
//             location: data.location || "",
//             pincode: data.pincode || "",
//             city: data.city || "",
//             state: data.state || "",
//             district: data.district || "",
//             country: data.country || "India",
//             position: data.position || "",
//             experience: data.experience || "",
//             education: data.education || "",
//             department: data.department || "",
//             about_me: data.about_me || "",
//             resume_link: data.resume_path || "",
//             languages_spoken: safeParse(data.languages_spoken),
//             experiences: data.experiences || [],
//             skills: safeParse(data.skills),
//             assets: safeParse(data.assets),
//           }));
//           setIsFresher(!data.experiences || data.experiences.length === 0);
//         }

//         const deptData = await departmentService.getAll();
//         setDepartments(deptData || []);
//         fetchSkills();
//         fetchAssets(effectiveId);
//       } catch (err) { console.warn("Node initialization mode."); }
//       finally { setFetchingData(false); }
//     };
//     hydrateCandidate();
//   }, [effectiveId]);

//   // Click Outside to close dropdowns
//   useEffect(() => {
//     const handleClickOutside = (event) => {
//       if (dropdownContainerRef.current && !dropdownContainerRef.current.contains(event.target)) {
//         setShowSkillDrop(false);
//         setShowAssetDrop(false);
//         setSkillFocused(false);
//       }
//     };
//     document.addEventListener("mousedown", handleClickOutside);
//     return () => document.removeEventListener("mousedown", handleClickOutside);
//   }, []);

//   // 4. HANDLERS
//   const fetchSkills = async () => {
//     try {
//       const res = await fetch("https://apihrr.goelectronix.co.in/masters/skills");
//       const data = await res.json();
//       setDynamicSkills(data.map(item => item.name || item));
//     } catch {}
//   };

//   const fetchAssets = async (cId) => {
//     try {
//       const res = await fetch(`https://apihrr.goelectronix.co.in/candidates/${cId}/assets`);
//       const data = await res.json();
//       setDynamicAssets(Array.isArray(data) ? data.map(a => a.name) : []);
//     } catch {}
//   };

//   const handleManualAddSkill = async () => {
//     const name = skillInput.trim();
//     if (!name) { await fetchSkills(); return; }
//     const success = await handleCreateMaster("skills", name);
//     if (success) {
//       if (!formData.skills.includes(name)) setFormData(p => ({ ...p, skills: [...p.skills, name] }));
//       setSkillInput("");
//       await fetchSkills();
//     }
//   };

//   const handleCreateMaster = async (type, name) => {
//     try {
//       const res = await fetch(`https://apihrr.goelectronix.co.in/masters/${type}`, {
//         method: "POST",
//         headers: { "Content-Type": "application/json" },
//         body: JSON.stringify({ name: name.trim() }),
//       });
//       return res.ok;
//     } catch { return false; }
//   };

//   const handleAddAssetAPI = async (assetName) => {
//     if (!assetName.trim()) return;
//     const loadingToast = toast.loading(`Assigning asset...`);
//     try {
//       const res = await fetch(`https://apihrr.goelectronix.co.in/candidates/588/assets`, {
//         method: "POST",
//         headers: { "Content-Type": "application/json" },
//         body: JSON.stringify({ name: assetName.trim() }),
//       });
//       if (res.ok) {
//         toast.success("Linked", { id: loadingToast });
//         await fetchAssets(588);
//         return true;
//       }
//     } catch { toast.error("Sync failed", { id: loadingToast }); }
//     return false;
//   };

//   const fetchPincodeDetails = async (pincode) => {
//     if (!/^\d{6}$/.test(pincode)) return;
//     setIsFetchingPincode(true);
//     try {
//       const res = await fetch(`https://api.postalpincode.in/pincode/${pincode}`);
//       const data = await res.json();
//       if (data[0]?.Status === "Success") {
//         setCityOptions(data[0].PostOffice.map(o => o.Name));
//       }
//     } finally { setIsFetchingPincode(false); }
//   };

//   const validateField = (field, value) => {
//     let error = "";
//     if (["name", "email", "phone"].includes(field) && !value) error = "Required field";
//     setErrors(prev => ({ ...prev, [field]: error }));
//     return !error;
//   };

//    const ASSET_OPTIONS = ["Laptop", "Mouse", "Keyboard", "Monitor", "Headset", "Mobile", "ID Card", "SIM Card"];

//   const handleSubmit = async (e) => {
//     e.preventDefault();
//     setLoading(true);
//     const loadingToast = toast.loading("Executing PATCH Sync to Node 588...");
//     try {
//       const apiData = new FormData();
//       Object.keys(formData).forEach(key => {
//         if (formData[key] && !["experiences", "certificateFiles", "languages_spoken", "cvFile", "skills", "assets"].includes(key)) {
//           apiData.append(key, formData[key]);
//         }
//       });
//       apiData.append("full_name", formData.name);
//       apiData.append("experience_details", JSON.stringify(formData.experiences));
//       apiData.append("languages_spoken", JSON.stringify(formData.languages_spoken));
//       apiData.append("skills", JSON.stringify(formData.skills));
//       apiData.append("assets", JSON.stringify(formData.assets));

//       const response = await fetch(`https://apihrr.goelectronix.co.in/candidates/588`, {
//         method: "PATCH",
//         body: apiData,
//       });

//       if (response.ok) {
//         toast.success("Profile Synchronized ðŸŽ‰", { id: loadingToast });
//       } else { throw new Error(); }
//     } catch { toast.error("Commit failed", { id: loadingToast }); }
//     finally { setLoading(false); }
//   };

//   const handleSaveExperienceAPI = async (expIndex) => {
//     const exp = formData.experiences[expIndex];
//     if (!exp.company_name || !exp.job_title) {
//         toast.error("Company and Designation are required");
//         return;
//     }

//     const loadingToast = toast.loading(`Committing ${exp.company_name} to server...`);
//     try {
//         const payload = {
//             company_name: exp.company_name,
//             job_title: exp.job_title,
//             start_date: exp.start_date || "",
//             end_date: exp.end_date || "",
//             previous_ctc: parseFloat(exp.previous_ctc) || 0,
//             location: exp.location || "",
//             description: exp.description || "",
//             experience_letter_path: exp.exp_letter_link || ""
//         };

//         const response = await fetch(`https://apihrr.goelectronix.co.in/candidates/${id}/experiences`, {
//             method: "POST",
//             headers: { "Content-Type": "application/json" },
//             body: JSON.stringify(payload),
//         });

//         if (response.ok) {
//             toast.success(`${exp.company_name} record synchronized`, { id: loadingToast });
//         } else {
//             throw new Error();
//         }
//     } catch (error) {
//         toast.error("Failed to save experience record", { id: loadingToast });
//     }
//   };

//   if (fetchingData) return (
//     <div className="min-h-screen flex flex-col items-center justify-center bg-slate-50 gap-4">
//       <Loader2 className="h-10 w-10 animate-spin text-blue-600" />
//       <p className="text-[11px] font-black uppercase tracking-[0.3em] text-slate-400">Loading Node {effectiveId}...</p>
//     </div>
//   );

//   return (
//     <div className="min-h-screen bg-[#F8FAFC] p-4 md:p-12 antialiased">
//       <div className="max-w-6xl mx-auto space-y-8" ref={dropdownContainerRef}>

//         {/* HEADER & ROADMAP */}
//         <div className="flex flex-col lg:flex-row justify-between items-center bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 gap-8">
//           <div className="flex items-center gap-6">
//             <div className="h-16 w-16 bg-slate-900 rounded-[1.5rem] flex items-center justify-center text-white shadow-2xl">
//               <Database size={32} />
//             </div>
//             <div>
//               <h2 className="text-2xl font-black text-slate-900 tracking-tight leading-none">{id ? "Edit Registry" : "Manual Registry"}</h2>
//               <div className="flex items-center gap-2 mt-2 text-blue-600">
//                 <ShieldCheck size={14} />
//                 <p className="text-[10px] font-black uppercase tracking-widest leading-none">Node Sync ID: {effectiveId}</p>
//               </div>
//             </div>
//           </div>

//           <div className="flex-1 max-w-2xl w-full px-4">
//             <div className="relative flex justify-between items-center w-full">
//               <div className="absolute top-1/2 left-0 w-full h-0.5 bg-slate-100 -translate-y-1/2 z-0" />
//               <div className="absolute top-1/2 left-0 h-0.5 bg-blue-600 -translate-y-1/2 z-0 transition-all duration-700" style={{ width: `${((step - 1) / (totalSteps - 1)) * 100}%` }} />
//               {[1, 2, 3, 4, 5].map((num) => (
//                 <div key={num} className="relative z-10 flex flex-col items-center gap-2">
//                   <div className={`h-8 w-8 rounded-full flex items-center justify-center text-[10px] font-black transition-all border-4 ${step === num ? "bg-blue-600 text-white border-blue-100 scale-110 shadow-lg" : step > num ? "bg-emerald-500 text-white border-emerald-50" : "bg-white text-slate-300 border-slate-50"}`}>
//                     {step > num ? <Check size={14} strokeWidth={4} /> : num}
//                   </div>
//                 </div>
//               ))}
//             </div>
//           </div>
//           <div className="bg-slate-50 border border-slate-200 rounded-2xl px-6 py-3 flex items-center gap-3">
//             <div className="text-right"><p className="text-[8px] font-black text-slate-400 uppercase tracking-widest leading-none">Status</p><p className="text-sm font-black text-slate-900 mt-1">{Math.round((step / totalSteps) * 100)}%</p></div>
//             <div className="h-8 w-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center shadow-inner"><Check size={18} /></div>
//           </div>
//         </div>

//         <form onSubmit={handleSubmit}>
//           <div className="space-y-12">

//             {/* STEP 1: IDENTITY & PROFESSIONAL (MERGED) */}
//             {step === 1 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8 duration-500">
//                 <div className="flex items-center gap-4 pb-4 border-b border-slate-100"><User size={18} className="text-blue-600" /><h3 className="text-sm font-black text-slate-800 uppercase tracking-widest">Identification Profile</h3></div>

//                 <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
//                   <FormField label="Full Name" required error={errors.name}><input placeholder="Legal Name" value={formData.name} onChange={(e) => setFormData({ ...formData, name: e.target.value })} className={inputStyle} /></FormField>
//                   <FormField label="Email" required error={errors.email}><input type="email" placeholder="name@domain.com" value={formData.email} onChange={(e) => setFormData({ ...formData, email: e.target.value })} className={inputStyle} /></FormField>
//                   <FormField label="Phone" required><div className="flex items-center bg-slate-50 border border-slate-200 rounded-xl overflow-hidden focus-within:bg-white focus-within:border-blue-500 transition-all shadow-sm"><span className="px-3 text-[11px] font-black text-slate-400">+91</span><input maxLength={10} value={formData.phone} onChange={(e) => setFormData({ ...formData, phone: e.target.value })} className="w-full px-3 py-2 bg-transparent text-[13px] font-bold outline-none" /></div></FormField>
//                   <FormField label="Gender Selection"><select value={formData.gender} onChange={(e) => setFormData({ ...formData, gender: e.target.value })} className={inputStyle}><option value="">Select</option><option value="male">Male</option><option value="female">Female</option></select></FormField>
//                 </div>

//                 <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 pt-4 border-t border-slate-50 mt-4">
//                   <FormField label="Position Hub" required>
//                     <div className="relative">
//                       <div className="relative group"><input placeholder="Select role..." value={formData.position} onFocus={() => { setShowSkillDrop(true); setShowAssetDrop(false); setSkillFocused(false); }} onChange={(e) => setFormData({ ...formData, position: e.target.value })} className={inputStyle} /><ChevronDown size={16} className={`absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 transition-transform ${showSkillDrop ? 'rotate-180' : ''}`} /></div>
//                       {showSkillDrop && (<div className="absolute z-[100] w-full mt-2 bg-white border border-slate-200 rounded-3xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 max-h-60 overflow-y-auto no-scrollbar">{POSITION_OPTIONS.filter(p => p.toLowerCase().includes(formData.position.toLowerCase())).map((pos, i) => (<div key={i} onMouseDown={(e) => { e.preventDefault(); setFormData({ ...formData, position: pos }); setShowSkillDrop(false); }} className="px-6 py-4 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-700 cursor-pointer border-b last:border-0 transition-colors">{pos}</div>))}</div>)}
//                     </div>
//                   </FormField>
//                   <FormField label="Seniority Level"><input type="number" placeholder="Total Years" value={formData.experience} onChange={(e) => setFormData({ ...formData, experience: e.target.value })} className={inputStyle} /></FormField>
//                   <FormField label="Education Unit" required>
//                     <div className="relative">
//                       <div className="relative group"><input placeholder="Degree..." value={eduSearch || formData.education} onFocus={() => { setShowAssetDrop(true); setShowSkillDrop(false); setSkillFocused(false); }} onChange={(e) => { setEduSearch(e.target.value); setFormData({ ...formData, education: e.target.value }); }} className={inputStyle} /><ChevronDown size={16} className={`absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 transition-transform ${showAssetDrop ? 'rotate-180' : ''}`} /></div>
//                       {showAssetDrop && (<div className="absolute z-[100] w-full mt-2 bg-white border border-slate-200 rounded-3xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 max-h-60 overflow-y-auto no-scrollbar">{filteredEducation.map((e, i) => (<div key={i} onMouseDown={(ev) => { ev.preventDefault(); setFormData({ ...formData, education: e }); setEduSearch(""); setShowAssetDrop(false); }} className="px-6 py-4 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-700 cursor-pointer border-b last:border-0 transition-colors">{e}</div>))}</div>)}
//                     </div>
//                   </FormField>
//                   <FormField label="Corporate Department">
//                     <div className="relative">
//                       <div className="relative group"><input placeholder="Search dept..." value={deptSearch || formData.department} onFocus={() => { setSkillFocused(true); setShowSkillDrop(false); setShowAssetDrop(false); }} onChange={(e) => { setDeptSearch(e.target.value); setFormData({ ...formData, department: e.target.value }); }} className={inputStyle} /><ChevronDown size={16} className={`absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 transition-transform ${skillFocused ? 'rotate-180' : ''}`} /></div>
//                       {skillFocused && (<div className="absolute z-[100] w-full mt-2 bg-white border border-slate-200 rounded-3xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 max-h-60 overflow-y-auto no-scrollbar">{filteredDepartments.map((d) => (<div key={d.id} onMouseDown={(ev) => { ev.preventDefault(); setFormData({ ...formData, department: d.name }); setDeptSearch(""); setSkillFocused(false); }} className="px-6 py-4 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-700 cursor-pointer border-b last:border-0 transition-colors">{d.name}</div>))}</div>)}
//                     </div>
//                   </FormField>
//                 </div>

//                 <div className="grid grid-cols-1 md:grid-cols-2 gap-8 pt-4">
//                   <FormField label="Date of Birth"><input type="date" value={formData.dob} onChange={(e) => setFormData({ ...formData, dob: e.target.value })} className={inputStyle} /></FormField>
//                   <FormField label="Languages Spoken"><div className="bg-slate-50 border border-slate-200 rounded-xl p-3 max-h-32 overflow-y-auto grid grid-cols-2 gap-3 shadow-inner">{["English", "Hindi", "Marathi", "Gujarati", "Tamil", "Telugu"].map(lang => (<label key={lang} className="flex items-center gap-2 text-[11px] font-medium text-slate-600 cursor-pointer hover:text-blue-600 transition-colors"><input type="checkbox" checked={formData.languages_spoken.includes(lang)} onChange={() => { const u = formData.languages_spoken.includes(lang) ? formData.languages_spoken.filter(l => l !== lang) : [...formData.languages_spoken, lang]; setFormData({ ...formData, languages_spoken: u }); }} className="w-3.5 h-3.5 accent-blue-600 rounded" /> {lang}</label>))}</div></FormField>
//                 </div>
//                 <FormField label="Bio Profile Summary"><textarea rows={3} value={formData.about_me} onChange={(e) => setFormData({ ...formData, about_me: e.target.value })} className={inputStyle + " resize-none"} /></FormField>
//                 <div className="flex justify-end pt-4"><button type="button" onClick={() => setStep(2)} className={`px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest shadow-xl active:scale-95 transition-all`}>Next Phase <ChevronRight size={16} className="inline ml-2" /></button></div>
//               </div>
//             )}

//             {/* STEP 2: GEOGRAPHY */}
//             {step === 2 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8">
//                 <div className="flex items-center gap-3 pb-4 border-b border-slate-100"><MapPin size={18} className="text-blue-600" /><h3 className="text-xs font-black text-slate-800 uppercase tracking-widest">Geolocation Registry</h3></div>
//                 <div className="space-y-8">
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                     <FormField label="Address line 1" required><input placeholder="Building/Flat/Street" value={formData.address1} onChange={(e) => setFormData({...formData, address1: e.target.value})} className={inputStyle} /></FormField>
//                     <FormField label="Address line 2" required><input placeholder="Landmark/Locality" value={formData.address2} onChange={(e) => setFormData({...formData, address2: e.target.value})} className={inputStyle} /></FormField>
//                   </div>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                     <FormField label="Location/Area Hub" required><input value={formData.location} onChange={(e) => setFormData({...formData, location: e.target.value})} className={inputStyle} /></FormField>
//                     <FormField label="Pincode Map" required><div className="relative"><input maxLength={6} placeholder="000000" value={formData.pincode} onChange={(e) => { const v = e.target.value.replace(/\D/g, ""); setFormData({ ...formData, pincode: v }); if(v.length === 6) fetchPincodeDetails(v); }} className={inputStyle} />{isFetchingPincode && <Loader2 size={18} className="absolute right-4 top-1/2 -translate-y-1/2 animate-spin text-blue-500" />}</div></FormField>
//                   </div>
//                   <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
//                     <FormField label="City Registry">
//                       <div className="relative group">
//                         {cityOptions.length > 1 ? (
//                           <><select value={formData.city} onChange={(e) => setFormData({ ...formData, city: e.target.value })} className={inputStyle + " appearance-none"}><option value="">Select City</option>{cityOptions.map((c, i) => (<option key={i} value={c}>{c}</option>))}</select><ChevronDown size={16} className="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400"/></>
//                         ) : (<input value={formData.city} readOnly placeholder="System Identified" className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner" />)}
//                       </div>
//                     </FormField>
//                     <FormField label="District Registry"><input value={formData.district} readOnly className="w-full px-4 py-4 bg-slate-100 border-none rounded-2xl text-sm font-bold text-slate-500 shadow-inner" /></FormField>
//                     <FormField label="State Node"><input value={formData.state} readOnly className="w-full px-4 py-4 bg-slate-100 border-none rounded-2xl text-sm font-bold text-slate-500 shadow-inner" /></FormField>
//                     <FormField label="Country Hub"><input value={formData.country} onChange={(e) => setFormData({...formData, country: e.target.value})} className={inputStyle} /></FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-between pt-8 border-t border-slate-50"><button onClick={() => setStep(1)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase hover:text-slate-900 transition-all shadow-sm">â† Back</button><button onClick={() => setStep(3)} type="button" className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase shadow-xl transition-all">Continue â†’</button></div>
//               </div>
//             )}

//             {/* STEP 3: EXPERIENCE */}
//             {step === 3 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
//                 <div className="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-sm transition-all overflow-hidden">
//                   <div className="flex flex-col md:flex-row items-center justify-between gap-6">
//                     <div className="flex items-center gap-4 text-slate-900 font-black"><Briefcase size={24} className="text-blue-600" /><div><h3 className="text-sm uppercase tracking-widest leading-none">Are you a Fresher?</h3><p className="text-[10px] font-bold text-slate-400 uppercase tracking-wider mt-1.5">Select status</p></div></div>
//                     <div className="flex bg-slate-100 p-1.5 rounded-[1.5rem] border border-slate-200 w-full md:w-auto">
//                       <button type="button" onClick={() => { setIsFresher(true); setFormData({ ...formData, experiences: [] }); }} className={`px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === true ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}>Yes</button>
//                       <button type="button" onClick={() => setIsFresher(false)} className={`px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === false ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}>No</button>
//                     </div>
//                   </div>
//                 </div>

//                 {isFresher === false && (
//                   <div className="bg-white p-6 md:p-10 rounded-[3.5rem] border border-slate-200 shadow-xl space-y-10 animate-in fade-in duration-500 shadow-slate-100">
//                     <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center border-b border-slate-100 pb-8 gap-4">
//                       <div className="flex items-center gap-4"><div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg"><History size={20} /></div><h3 className="text-sm font-black text-slate-900 uppercase">Career Timeline</h3></div>
//                       <button type="button" onClick={() => setFormData({ ...formData, experiences: [...formData.experiences, { company_name: "", job_title: "", uploadMode: "file" }] })} className="px-6 py-3 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase shadow-lg active:scale-95 transition-all">+ Add Organization</button>
//                     </div>
//                     <div className="space-y-10 max-h-[600px] overflow-y-auto pr-4 custom-scrollbar-professional">
//                        {formData.experiences.map((exp, i) => (
//                          <div key={i} className="relative bg-slate-50/50 border border-slate-200 p-6 md:p-10 rounded-[2.5rem] space-y-8 group transition-all hover:bg-white hover:shadow-xl shadow-inner animate-in zoom-in-95">
//                             <button type="button" onClick={() => setFormData({ ...formData, experiences: formData.experiences.filter((_, idx) => idx !== i) })} className="absolute -top-3 -right-3 h-10 w-10 bg-white border border-slate-200 text-red-500 rounded-full flex items-center justify-center shadow-lg transition-all opacity-0 group-hover:opacity-100 z-20"><Trash2 size={18} /></button>
//                             <div className="grid grid-cols-1 md:grid-cols-2 gap-8"><FormField label="Employer"><input placeholder="Organization" value={exp.company_name} onChange={(e) => { const u = [...formData.experiences]; u[i].company_name = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField><FormField label="Role"><input placeholder="Designation" value={exp.job_title} onChange={(e) => { const u = [...formData.experiences]; u[i].job_title = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField></div>
//                             <div className="grid grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8">
//                                 <FormField label="Start"><input type="date" value={exp.start_date} onChange={(e) => { const u = [...formData.experiences]; u[i].start_date = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                                 <FormField label="End"><input type="date" value={exp.end_date} onChange={(e) => { const u = [...formData.experiences]; u[i].end_date = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                                 <FormField label="CTC"><input type="number" placeholder="â‚¹" value={exp.previous_ctc} onChange={(e) => { const u = [...formData.experiences]; u[i].previous_ctc = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                                 <FormField label="Loc"><input placeholder="City" value={exp.location} onChange={(e) => { const u = [...formData.experiences]; u[i].location = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                              </div>
//                             <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
//                                <FormField label="Responsibilities / Remarks"><textarea rows={5} placeholder="Describe impact..." value={exp.description} onChange={(e) => { const u = [...formData.experiences]; u[i].description = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle + " resize-none min-h-[140px]"} /></FormField>
//                                <div className="space-y-3">
//                                   <div className="flex justify-between items-center px-1"><p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Artifact</p><div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200"><button type="button" onClick={() => { const u = [...formData.experiences]; u[i].uploadMode = "file"; setFormData({ ...formData, experiences: u }); }} className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === 'file' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>FILE</button><button type="button" onClick={() => { const u = [...formData.experiences]; u[i].uploadMode = "link"; setFormData({ ...formData, experiences: u }); }} className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === 'link' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>URL</button></div></div>
//                                   <div className="bg-white/50 border border-slate-100 rounded-3xl p-4 min-h-[140px] flex flex-col justify-center">
//                                     {exp.uploadMode === 'file' ? (<label className="flex flex-col items-center justify-center gap-3 w-full h-full border-2 border-dashed border-slate-200 rounded-2xl hover:bg-blue-50/30 transition-all cursor-pointer group p-4"><FileUp size={24} className="text-slate-400 group-hover:text-blue-500 transition-colors" /><span className="text-[9px] font-bold text-slate-500 uppercase tracking-widest text-center truncate px-2">{exp.experience_letter_path ? "Hydrated File Present" : (exp.expLetterFile ? exp.expLetterFile.name : "Drop PDF Validation")}</span><input type="file" accept=".pdf" className="hidden" onChange={(e) => { const u = [...formData.experiences]; u[i].expLetterFile = e.target.files[0]; setFormData({ ...formData, experiences: u }); }} /></label>) : (<div className="relative"><LinkIcon size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input placeholder="Storage URI" value={exp.exp_letter_link || exp.experience_letter_path || ""} onChange={(e) => { const u = [...formData.experiences]; u[i].exp_letter_link = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle + " pl-11"} /></div>)}
//                                   </div>
//                                </div>
//                             </div>
//                             <div className="flex justify-end pt-2 border-t border-slate-50"><button type="button"
//                             //  onClick={() => toast.success("Synced record")}
//                             onClick={() => handleSaveExperienceAPI(i)}
//                               className="flex items-center gap-2 px-8 py-3 bg-emerald-50 text-emerald-600 border border-emerald-100 rounded-2xl text-[10px] font-black uppercase hover:bg-emerald-500 hover:text-white transition-all active:scale-95 shadow-sm"><Check size={16} strokeWidth={3} /> Save Record</button></div>
//                          </div>
//                        ))}
//                     </div>
//                   </div>
//                 )}
//                 <div className="flex justify-between pt-4"><button onClick={() => setStep(2)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase shadow-sm transition-all hover:text-slate-900 flex items-center gap-2">â† Back</button><button onClick={() => setStep(4)} type="button" disabled={isFresher === null} className={`px-12 py-4 rounded-2xl text-xs font-black uppercase shadow-xl transition-all active:scale-95 ${isFresher !== null ? "bg-blue-600 text-white shadow-blue-600/30 hover:bg-blue-700" : "bg-slate-200 text-slate-400 cursor-not-allowed"}`}>Next Phase â†’</button></div>
//               </div>
//             )}

//             {/* STEP 4: INVENTORY */}
//             {step === 4 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 overflow-visible">
//                 <div className="bg-white border border-slate-200 rounded-[3.5rem] shadow-xl overflow-visible shadow-slate-200/50">
//                   <div className="bg-slate-50/50 px-10 py-6 border-b border-slate-200 flex items-center justify-between rounded-t-[3.5rem]"><div className="flex items-center gap-4"><div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg"><Cpu size={20} /></div><div><h3 className="text-sm font-black text-slate-900 uppercase tracking-widest leading-none">Inventory Matrix</h3><p className="text-[10px] font-bold text-slate-400 uppercase mt-1">Select skills and physical candidate assets</p></div></div></div>
//                   <div className="p-8 md:p-12 space-y-12 overflow-visible">
//                     <FormField label="Technical Matrix"><div className="space-y-6"><div className="flex flex-col sm:flex-row gap-4 items-end"><div className="relative max-w-md w-full"><Plus size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={skillInput} onChange={(e) => setSkillInput(e.target.value)} onKeyDown={(e) => { if(e.key === 'Enter') { e.preventDefault(); handleManualAddSkill(); } }} placeholder="Register skill..." className={inputStyle + " pl-12"} /></div><button type="button" onClick={handleManualAddSkill} className="px-6 py-3.5 bg-slate-900 hover:bg-blue-600 text-white rounded-2xl transition-all active:scale-95 flex items-center gap-2 text-[10px] font-black uppercase tracking-widest shadow-lg"><Database size={14} /> Sync Registry</button></div><div className="flex flex-wrap gap-3 p-1">{dynamicSkills.map((skill) => { const isSelected = formData.skills.includes(skill); return (<button key={skill} type="button" onClick={() => setFormData({...formData, skills: isSelected ? formData.skills.filter(s => s !== skill) : [...formData.skills, skill]})} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${isSelected ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200" : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`}>{skill} {isSelected && <Check size={14} strokeWidth={3} />}</button>); })}</div></div></FormField>
//                     {/* <FormField label="Hardware Matrix Hub"><div className="space-y-6 pt-8 border-t border-slate-100"><div className="relative max-w-md w-full"><Layers size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={assetInput} onChange={(e) => setAssetInput(e.target.value)} onKeyDown={async (e) => { if(e.key === 'Enter') { e.preventDefault(); const v = assetInput.trim(); if(v && !formData.assets.includes(v)) { const ok = await handleAddAssetAPI(v); if(ok) { setFormData({...formData, assets: [...formData.assets, v]}); setAssetInput(""); } } } }} placeholder="Register asset..." className={inputStyle + " pl-12"} /></div><div className="flex flex-wrap gap-3 p-1">{dynamicAssets.map((asset) => { const isSelected = formData.assets.includes(asset); return (<button key={asset} type="button" onClick={async () => { if(!isSelected) { const ok = await handleAddAssetAPI(asset); if(ok) setFormData({...formData, assets: [...formData.assets, asset]}); } else { setFormData({...formData, assets: formData.assets.filter(a => a !== asset)}); } }} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black border-2 transition-all active:scale-90 ${isSelected ? "bg-slate-900 text-white shadow-lg" : "bg-white border-slate-100 text-slate-500"}`}>{asset} {isSelected && <Check size={14} strokeWidth={3} />}</button>); })}</div></div></FormField> */}
//                     {/* ASSET ALLOCATION CLOUD */}
//                             <div className="space-y-6 pt-8 border-t border-slate-100">

//                               <FormField label="Enterprise Hardware Matrix">
//                       <div className="space-y-6">
//                         {/* Search & Manual Add Input */}
//                         <div className="relative max-w-md">
//                           <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">
//                             <Layers size={16} />
//                           </div>
//                           <input
//                             value={assetInput}
//                             onChange={(e) => setAssetInput(e.target.value)}
//                             onKeyDown={async (e) => {
//                               if(e.key === 'Enter') {
//                                 e.preventDefault();
//                                 const v = assetInput.trim();
//                                 if(v && !formData.assets.includes(v)) {
//                                   // API INTEGRATION
//                                   const success = await handleAddAssetAPI(v);
//                                   if(success) {
//                                     setFormData({...formData, assets: [...formData.assets, v]});
//                                     setAssetInput("");
//                                   }
//                                 }
//                               }
//                             }}
//                             placeholder="Type hardware name and press Enter..."
//                             className="w-full pl-12 pr-4 py-3.5 bg-slate-50 border border-slate-200 rounded-2xl text-xs font-bold outline-none focus:bg-white focus:border-slate-900 focus:ring-4 focus:ring-slate-900/5 transition-all shadow-inner"
//                           />
//                         </div>

//                         {/* Asset Cloud */}
//                         <div className="flex flex-wrap gap-3 p-1">
//                           {ASSET_OPTIONS.map((asset) => {
//                             const isSelected = formData.assets.includes(asset);
//                             return (
//                               <button
//                                 key={asset}
//                                 type="button"
//                                 onClick={async () => {
//                                   if (!isSelected) {
//                                     // API INTEGRATION on selection
//                                     const success = await handleAddAssetAPI(asset);
//                                     if(success) {
//                                       setFormData({...formData, assets: [...formData.assets, asset]});
//                                     }
//                                   } else {
//                                     // Optional: Add delete API call here if needed
//                                     setFormData({...formData, assets: formData.assets.filter(a => a !== asset)});
//                                   }
//                                 }}
//                                 className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase tracking-wider transition-all duration-300 border-2 active:scale-90
//                                   ${isSelected
//                                     ? "bg-slate-900 border-slate-900 text-white shadow-lg shadow-slate-200"
//                                     : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`}
//                               >
//                                 {asset}
//                                 {isSelected && <Check size={14} strokeWidth={3} className="animate-in zoom-in" />}
//                               </button>
//                             );
//                           })}

//                           {/* Custom dynamic assets already in state */}
//                           {formData.assets.filter(a => !ASSET_OPTIONS.includes(a)).map((customAsset) => (
//                              <button
//                               key={customAsset}
//                               type="button"
//                               onClick={() => setFormData({...formData, assets: formData.assets.filter(a => a !== customAsset)})}
//                               className="flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase tracking-wider bg-slate-900 border-2 border-slate-900 text-white shadow-lg active:scale-90"
//                             >
//                               {customAsset} <Check size={14} strokeWidth={3} />
//                             </button>
//                           ))}
//                         </div>
//                       </div>
//                     </FormField>
//                             </div>
//                   </div>
//                 </div>
//                 <div className="flex justify-between items-center pt-4"><button onClick={() => setStep(3)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[11px] font-black uppercase transition-all shadow-sm hover:text-slate-900 flex items-center gap-2 transition-all"><ChevronLeft size={16}/> Back</button><button onClick={() => setStep(5)} type="button" className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-[11px] font-black uppercase shadow-xl active:scale-95 transition-all">Vault Registry <ChevronRight size={16}/></button></div>
//               </div>
//             )}

//             {/* STEP 5: DOCUMENT VAULT */}
//             {step === 5 && (
//               <div className="space-y-8 animate-in slide-in-from-bottom-12 duration-700">
//                 <div className="bg-white p-8 md:p-16 rounded-[4rem] shadow-xl shadow-slate-200/60 border border-slate-200 space-y-12 overflow-hidden relative">
//                   <div className="absolute top-0 right-0 p-12 text-slate-100 opacity-40 rotate-12 scale-150"><ShieldCheck size={240} /></div>
//                   <div className="flex items-center gap-5 pb-8 border-b border-slate-100 relative z-10"><div className="h-14 w-14 bg-blue-600 rounded-2xl flex items-center justify-center shadow-lg shadow-blue-200"><ShieldCheck size={28} className="text-white" /></div><div><h3 className="text-xl font-black text-slate-900 uppercase tracking-widest leading-none">Registry Artifacts</h3><p className="text-[10px] font-black text-slate-400 uppercase mt-2">Document Verification Matrix</p></div></div>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-16 relative z-10">
//                     <div className="space-y-8 p-1"><div className="flex justify-between items-center"><p className="text-[11px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2"><span className="h-1.5 w-1.5 rounded-full bg-blue-600" /> Resume Profile</p><div className="flex bg-slate-50 p-1 rounded-xl border border-slate-200"><button type="button" onClick={() => setResumeMode("file")} className={`px-5 py-2 text-[10px] font-black rounded-lg transition-all ${resumeMode === 'file' ? 'bg-white text-slate-900 shadow-sm border' : 'text-slate-400'}`}>FILE</button><button type="button" onClick={() => setResumeMode("link")} className={`px-5 py-2 text-[10px] font-black rounded-lg transition-all ${resumeMode === 'link' ? 'bg-white text-slate-900 shadow-sm border' : 'text-slate-400'}`}>URL</button></div></div>
//                     {resumeMode === 'file' ? (<label className="block p-12 border-2 border-dashed border-slate-200 rounded-[3rem] hover:border-blue-500 transition-all cursor-pointer group text-center bg-white shadow-inner"><FileUp size={40} className="mx-auto text-slate-300 group-hover:text-blue-500 mb-5 duration-500" /><p className="text-[10px] font-black text-slate-900 uppercase truncate px-4">{formData.cvFile ? formData.cvFile.name : "Select Resume PDF"}</p><input type="file" accept=".pdf" className="hidden" onChange={(e) => setFormData({...formData, cvFile: e.target.files[0], resume_link: ""})} /></label>) : <input placeholder="Cloud URI storage Link" value={formData.resume_link} onChange={(e) => setFormData({...formData, resume_link: e.target.value, cvFile: null})} className={inputStyle} />}</div>
//                     <div className="space-y-8 p-1"><div className="flex justify-between items-center"><p className="text-[11px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2"><span className="h-1.5 w-1.5 rounded-full bg-slate-400" /> Validation Metadata</p></div><div className="text-xs text-slate-400 font-bold uppercase leading-relaxed p-6 bg-slate-50 rounded-3xl border border-dashed shadow-inner">Hydrated Node from Candidate {effectiveId}. Final PATCH Synchronize will commit artifact changes to database repository.</div></div>
//                   </div>
//                   <div className="pt-16 border-t border-slate-100 flex flex-col items-center gap-8 relative z-10"><button type="submit" disabled={loading} className="w-full md:max-w-xl flex items-center justify-center gap-5 bg-blue-600 hover:bg-blue-700 text-white font-black py-7 rounded-[3rem] shadow-2xl active:scale-[0.98] uppercase disabled:opacity-50 tracking-widest leading-none">{loading ? <Loader2 className="animate-spin" size={28} /> : <><Database size={24} /><span>Finalize Patch Commit</span></>}</button><button type="button" onClick={() => setStep(4)} className="text-[10px] font-black text-slate-400 uppercase tracking-widest hover:text-slate-900 flex items-center gap-2 transition-all"><ChevronLeft size={16}/> Return to Inventory</button></div>
//                 </div>
//               </div>
//             )}
//           </div>
//         </form>
//       </div>
//       <style dangerouslySetInnerHTML={{ __html: `.custom-scrollbar-professional::-webkit-scrollbar { width: 6px; }.custom-scrollbar-professional::-webkit-scrollbar-track { background: transparent; }.custom-scrollbar-professional::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 20px; }.custom-scrollbar-professional::-webkit-scrollbar-thumb:hover { background: #CBD5E1; }`}} />
//     </div>
//   );
// };

// export default ManualEntryPage;
//******************************************************************************************************* */
// import React, { useState, useEffect, useRef } from "react";
// import { useParams, useNavigate } from "react-router-dom";
// import {
//   Check, Award, User, Briefcase, MapPin, Loader2, Plus, Trash2, Layers, Cpu, Database,
//   Globe, ShieldCheck, History, X, LinkIcon, FileUp, ChevronRight, ChevronLeft, ChevronDown
// } from "lucide-react";
// import toast from "react-hot-toast";
// import { candidateService } from "../../services/candidateService";
// import { departmentService } from "../../services/department.service";

// const FormField = ({ label, required, error, children }) => (
//   <div className="space-y-1.5 w-full">
//     <label className="text-[10px] md:text-[11px] font-black text-slate-500 uppercase tracking-widest ml-1 flex justify-between items-center">
//       <span>{label}</span>
//       <span className={`font-bold normal-case ${required ? "text-red-500" : "text-slate-300"}`}>
//         {required ? "Required" : "Optional"}
//       </span>
//     </label>
//     {children}
//     {error && <p className="text-[9px] text-red-500 font-bold uppercase tracking-tighter ml-1">{error}</p>}
//   </div>
// );

// const ManualEntryPage = () => {
//   const { id } = useParams();
//   const navigate = useNavigate();
//   const effectiveId = id || "666";

//   // --- STYLES ---
//   const inputStyle = "w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-[13px] font-bold outline-none focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-500/5 transition-all shadow-sm";

//   // --- STATES ---
//   const [step, setStep] = useState(1);
//   const [loading, setLoading] = useState(false);
//   const [fetchingData, setFetchingData] = useState(false);
//   const [errors, setErrors] = useState({});
//   const [isFetchingPincode, setIsFetchingPincode] = useState(false);
//   const [cityOptions, setCityOptions] = useState([]);
//   const [resumeMode, setResumeMode] = useState("file");
//   const [skillInput, setSkillInput] = useState("");
//   const [assetInput, setAssetInput] = useState("");
//   const [isFresher, setIsFresher] = useState(null);
//   const [deptSearch, setDeptSearch] = useState("");
//   const [eduSearch, setEduSearch] = useState("");
//   const [dynamicSkills, setDynamicSkills] = useState([]);
//   const [dynamicAssets, setDynamicAssets] = useState([]);
//   const [showSkillDrop, setShowSkillDrop] = useState(false);
//   const [showAssetDrop, setShowAssetDrop] = useState(false);
//   const [skillFocused, setSkillFocused] = useState(false);
//   const [departments, setDepartments] = useState([]);

//   const dropdownContainerRef = useRef(null);
//   const careerStepRef = useRef(null);

//   const [formData, setFormData] = useState({
//     name: "", email: "", phone: "", address1: "", address2: "", location: "",
//     pincode: "", state: "", city: "", district: "", country: "India", position: "",
//     education: "", gender: "", dob: "", experience: "", about_me: "",
//     languages_spoken: [], skills: [], assets: [], department: "",
//     cvFile: null, resume_link: "", certificateFiles: [], certificateLinks: [""], experiences: [],
//   });

//   const totalSteps = 6;
//   const POSITION_OPTIONS = ["Frontend Developer", "Backend Developer", "Full Stack Developer", "HR Executive", "UI/UX Designer", "DevOps Engineer"];
//   const educationOptions = ["B.Tech", "M.Tech", "B.Sc", "M.Sc", "BCA", "MCA", "MBA", "Diploma", "PhD"];

//   const filteredEducation = educationOptions.filter(e => e.toLowerCase().includes(eduSearch.toLowerCase()));
//   const filteredDepartments = departments.filter(d => (d.name || "").toLowerCase().includes(deptSearch.toLowerCase()));

//   // --- HYDRATION LOGIC (GET API) ---
//   useEffect(() => {
//     const hydrateCandidate = async () => {
//       setFetchingData(true);
//       try {
//         const response = await fetch(`https://apihrr.goelectronix.co.in/candidates/${effectiveId}`);
//         const data = await response.json();

//         if (data) {
//           const safeParse = (str) => {
//             if (!str) return [];
//             try {
//               if (Array.isArray(str)) {
//                 if (typeof str[0] === 'string' && str[0].startsWith('[')) return JSON.parse(str.join(''));
//                 return str;
//               }
//               return JSON.parse(str);
//             } catch { return []; }
//           };

//           setFormData(prev => ({
//             ...prev,
//             name: data.full_name || "",
//             email: data.email || "",
//             phone: data.phone || "",
//             gender: data.gender || "",
//             dob: data.dob || "",
//             address1: data.address1 || "",
//             address2: data.address2 || "",
//             location: data.location || "",
//             pincode: data.pincode || "",
//             city: data.city || "",
//             state: data.state || "",
//             district: data.district || "",
//             position: data.position || "",
//             experience: data.experience || "",
//             education: data.education || "",
//             department: data.department || "",
//             about_me: data.about_me || "",
//             resume_link: data.resume_path || "",
//             languages_spoken: safeParse(data.languages_spoken),
//             experiences: data.experiences || [],
//             skills: safeParse(data.skills),
//             assets: safeParse(data.assets),
//           }));

//           setIsFresher(!data.experiences || data.experiences.length === 0);
//         }

//         const deptData = await departmentService.getAll();
//         setDepartments(deptData || []);
//         fetchSkills();
//         fetchAssets(effectiveId);
//       } catch (err) { console.error("Hydration failed"); }
//       finally { setFetchingData(false); }
//     };
//     hydrateCandidate();
//   }, [effectiveId]);

//   // Click Outside Handler
//   useEffect(() => {
//     const handleClickOutside = (event) => {
//       if (dropdownContainerRef.current && !dropdownContainerRef.current.contains(event.target)) {
//         setShowSkillDrop(false);
//         setShowAssetDrop(false);
//         setSkillFocused(false);
//       }
//     };
//     document.addEventListener("mousedown", handleClickOutside);
//     return () => document.removeEventListener("mousedown", handleClickOutside);
//   }, []);

//   // --- HANDLERS ---
//   const fetchSkills = async () => {
//     try {
//       const res = await fetch("https://apihrr.goelectronix.co.in/masters/skills");
//       const data = await res.json();
//       setDynamicSkills(data.map(item => item.name || item));
//     } catch {}
//   };

//   const fetchAssets = async (cId) => {
//     try {
//       const res = await fetch(`https://apihrr.goelectronix.co.in/candidates/${cId}/assets`);
//       const data = await res.json();
//       setDynamicAssets(Array.isArray(data) ? data.map(a => a.name) : []);
//     } catch {}
//   };

//   const handleManualAddSkill = async () => {
//     const name = skillInput.trim();
//     if (!name) { await fetchSkills(); return; }
//     const success = await handleCreateMaster("skills", name);
//     if (success) {
//       if (!formData.skills.includes(name)) setFormData(p => ({ ...p, skills: [...p.skills, name] }));
//       setSkillInput("");
//       await fetchSkills();
//     }
//   };

//   const handleCreateMaster = async (type, name) => {
//     try {
//       const res = await fetch(`https://apihrr.goelectronix.co.in/masters/${type}`, {
//         method: "POST",
//         headers: { "Content-Type": "application/json" },
//         body: JSON.stringify({ name: name.trim() }),
//       });
//       return res.ok;
//     } catch { return false; }
//   };

//   const handleAddAssetAPI = async (assetName) => {
//     if (!assetName.trim()) return;
//     const loadingToast = toast.loading(`Linking asset...`);
//     try {
//       const res = await fetch(`https://apihrr.goelectronix.co.in/candidates/${effectiveId}/assets`, {
//         method: "POST",
//         headers: { "Content-Type": "application/json" },
//         body: JSON.stringify({ name: assetName.trim() }),
//       });
//       if (res.ok) {
//         toast.success("Linked", { id: loadingToast });
//         fetchAssets(effectiveId);
//         return true;
//       }
//     } catch { toast.error("Sync failed", { id: loadingToast }); }
//     return false;
//   };

//   const fetchPincodeDetails = async (pincode) => {
//     if (!/^\d{6}$/.test(pincode)) return;
//     setIsFetchingPincode(true);
//     try {
//       const res = await fetch(`https://api.postalpincode.in/pincode/${pincode}`);
//       const data = await res.json();
//       if (data[0]?.Status === "Success") {
//         setCityOptions(data[0].PostOffice.map(o => o.Name));
//       }
//     } finally { setIsFetchingPincode(false); }
//   };

//   const handleSubmit = async (e) => {
//     e.preventDefault();
//     setLoading(true);
//     const loadingToast = toast.loading("Executing Sync...");
//     try {
//       const apiData = new FormData();
//       Object.keys(formData).forEach(key => {
//         if (formData[key] && !["experiences", "certificateFiles", "languages_spoken", "cvFile", "skills", "assets"].includes(key)) {
//           apiData.append(key, formData[key]);
//         }
//       });
//       apiData.append("full_name", formData.name);
//       apiData.append("experience_details", JSON.stringify(formData.experiences));
//       apiData.append("languages_spoken", JSON.stringify(formData.languages_spoken));
//       apiData.append("skills", JSON.stringify(formData.skills));
//       apiData.append("assets", JSON.stringify(formData.assets));

//       const response = await fetch(`https://apihrr.goelectronix.co.in/candidates/${effectiveId}`, {
//         method: "PATCH",
//         body: apiData,
//       });

//       if (response.ok) {
//         toast.success("Committed successfully ðŸŽ‰", { id: loadingToast });
//         navigate("/candidates");
//       } else throw new Error();
//     } catch { toast.error("Commit failed", { id: loadingToast }); }
//     finally { setLoading(false); }
//   };

//   if (fetchingData) return (
//     <div className="min-h-screen flex flex-col items-center justify-center bg-slate-50 gap-4">
//       <Loader2 className="h-10 w-10 animate-spin text-blue-600" />
//       <p className="text-[10px] font-black uppercase tracking-[0.2em] text-slate-400">Loading Node {effectiveId}...</p>
//     </div>
//   );

//   return (
//     <div className="min-h-screen bg-[#F8FAFC] p-4 md:p-12 antialiased">
//       <div className="max-w-6xl mx-auto space-y-8" ref={dropdownContainerRef}>

//         {/* ROADMAP HEADER */}
//         <div className="flex flex-col lg:flex-row justify-between items-center bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 gap-8">
//           <div className="flex items-center gap-6">
//             <div className="h-16 w-16 bg-slate-900 rounded-[1.5rem] flex items-center justify-center text-white shadow-2xl">
//               <Database size={32} />
//             </div>
//             <div>
//               <h2 className="text-2xl font-black text-slate-900 tracking-tight leading-none">Manual Registry</h2>
//               <div className="flex items-center gap-2 mt-2 text-blue-600">
//                 <ShieldCheck size={14} />
//                 <p className="text-[10px] font-black uppercase tracking-widest leading-none">Candidate Node: {effectiveId}</p>
//               </div>
//             </div>
//           </div>

//           <div className="flex-1 max-w-2xl w-full px-4">
//             <div className="relative flex justify-between items-center w-full">
//               <div className="absolute top-1/2 left-0 w-full h-0.5 bg-slate-100 -translate-y-1/2 z-0" />
//               <div
//                 className="absolute top-1/2 left-0 h-0.5 bg-blue-600 -translate-y-1/2 z-0 transition-all duration-700"
//                 style={{ width: `${((step - 1) / (totalSteps - 1)) * 100}%` }}
//               />
//               {[1, 2, 3, 4, 5].map((num) => (
//                 <div key={num} className="relative z-10 flex flex-col items-center gap-2">
//                   <div className={`h-8 w-8 rounded-full flex items-center justify-center text-[10px] font-black transition-all border-4 ${step === num ? "bg-blue-600 text-white border-blue-100 scale-110 shadow-lg shadow-blue-200" : step > num ? "bg-emerald-500 text-white border-emerald-50" : "bg-white text-slate-300 border-slate-50"}`}>
//                     {step > num ? <Check size={14} strokeWidth={4} /> : num}
//                   </div>
//                 </div>
//               ))}
//             </div>
//           </div>

//           <div className="bg-slate-50 border border-slate-200 rounded-2xl px-6 py-3 flex items-center gap-3">
//             <div className="text-right"><p className="text-[8px] font-black text-slate-400 uppercase tracking-widest leading-none">Complete</p><p className="text-sm font-black text-slate-900 leading-none mt-1">{Math.round((step / totalSteps) * 100)}%</p></div>
//             <div className={`h-8 w-8 rounded-lg flex items-center justify-center ${step === 6 ? 'bg-emerald-100 text-emerald-600' : 'bg-blue-100 text-blue-600'}`}><Check size={18} /></div>
//           </div>
//         </div>

//         <form onSubmit={handleSubmit}>
//           <div className="space-y-12">

//             {/* STEP 1: IDENTITY & PROFESSIONAL DATA */}
//             {step === 1 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8 duration-500">
//                 <div className="flex items-center gap-4 pb-4 border-b border-slate-100"><User size={18} className="text-blue-600" /><h3 className="text-sm font-black text-slate-800 uppercase tracking-widest">Hydrate Identification Profile</h3></div>
//                 <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
//                   <FormField label="Full Name" required><input placeholder="Legal Name" value={formData.name} onChange={(e) => setFormData({ ...formData, name: e.target.value })} className={inputStyle} /></FormField>
//                   <FormField label="Email" required><input type="email" placeholder="name@domain.com" value={formData.email} onChange={(e) => setFormData({ ...formData, email: e.target.value })} className={inputStyle} /></FormField>
//                   <FormField label="Phone" required><div className="flex items-center bg-slate-50 border border-slate-200 rounded-xl overflow-hidden focus-within:bg-white focus-within:border-blue-500 transition-all shadow-sm"><span className="px-5 text-[11px] font-black text-slate-400">+91</span><input maxLength={10} value={formData.phone} onChange={(e) => setFormData({ ...formData, phone: e.target.value })} className="w-full px-5 py-4 bg-transparent text-sm font-bold outline-none" /></div></FormField>
//                   <FormField label="Gender Selection"><select value={formData.gender} onChange={(e) => setFormData({ ...formData, gender: e.target.value })} className={inputStyle}><option value="">Select</option><option value="male">Male</option><option value="female">Female</option></select></FormField>
//                 </div>

//                 <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 pt-4 border-t border-slate-50 mt-4">
//                   <FormField label="Position Hub" required>
//                     <div className="relative">
//                       <div className="relative group"><input placeholder="Select role..." value={formData.position} onFocus={() => { setShowSkillDrop(true); setShowAssetDrop(false); setSkillFocused(false); }} onChange={(e) => setFormData({ ...formData, position: e.target.value })} className={inputStyle} /><ChevronDown size={16} className={`absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 transition-transform ${showSkillDrop ? 'rotate-180' : ''}`} /></div>
//                       {showSkillDrop && (<div className="absolute z-[100] w-full mt-2 bg-white border border-slate-200 rounded-3xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 max-h-60 overflow-y-auto no-scrollbar">{POSITION_OPTIONS.filter(p => p.toLowerCase().includes(formData.position.toLowerCase())).map((pos, i) => (<div key={i} onMouseDown={(e) => { e.preventDefault(); setFormData({ ...formData, position: pos }); setShowSkillDrop(false); }} className="px-6 py-4 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-700 cursor-pointer border-b last:border-0">{pos}</div>))}</div>)}
//                     </div>
//                   </FormField>
//                   <FormField label="Seniority (Yrs)"><input type="number" value={formData.experience} onChange={(e) => setFormData({...formData, experience: e.target.value})} className={inputStyle} /></FormField>
//                   <FormField label="Education Unit" required>
//                     <div className="relative">
//                       <div className="relative group"><input placeholder="Degree..." value={eduSearch || formData.education} onFocus={() => { setShowAssetDrop(true); setShowSkillDrop(false); setSkillFocused(false); }} onChange={(e) => { setEduSearch(e.target.value); setFormData({ ...formData, education: e.target.value }); }} className={inputStyle} /><ChevronDown size={16} className={`absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 transition-transform ${showAssetDrop ? 'rotate-180' : ''}`} /></div>
//                       {showAssetDrop && (<div className="absolute z-[100] w-full mt-2 bg-white border border-slate-200 rounded-3xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 max-h-60 overflow-y-auto no-scrollbar">{filteredEducation.map((e, i) => (<div key={i} onMouseDown={(ev) => { ev.preventDefault(); setFormData({ ...formData, education: e }); setEduSearch(""); setShowAssetDrop(false); }} className="px-6 py-4 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-600 cursor-pointer border-b last:border-0">{e}</div>))}</div>)}
//                     </div>
//                   </FormField>
//                   <FormField label="Corporate Department">
//                     <div className="relative">
//                       <div className="relative group"><input placeholder="Search dept..." value={deptSearch || formData.department} onFocus={() => { setSkillFocused(true); setShowSkillDrop(false); setShowAssetDrop(false); }} onChange={(e) => { setDeptSearch(e.target.value); setFormData({ ...formData, department: e.target.value }); }} className={inputStyle} /><ChevronDown size={16} className={`absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 transition-transform ${skillFocused ? 'rotate-180' : ''}`} /></div>
//                       {skillFocused && (<div className="absolute z-[100] w-full mt-2 bg-white border border-slate-200 rounded-3xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 max-h-60 overflow-y-auto no-scrollbar">{filteredDepartments.map((d) => (<div key={d.id} onMouseDown={(ev) => { ev.preventDefault(); setFormData({ ...formData, department: d.name }); setDeptSearch(""); setSkillFocused(false); }} className="px-6 py-4 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-700 cursor-pointer border-b last:border-0">{d.name}</div>))}</div>)}
//                     </div>
//                   </FormField>
//                 </div>

//                 <div className="grid grid-cols-1 md:grid-cols-2 gap-8 pt-4">
//                   <FormField label="Date of Birth"><input type="date" value={formData.dob} onChange={(e) => setFormData({ ...formData, dob: e.target.value })} className={inputStyle} /></FormField>
//                   <FormField label="Languages Spoken"><div className="bg-slate-50 border border-slate-200 rounded-xl p-3 max-h-32 overflow-y-auto grid grid-cols-2 gap-3 shadow-inner">{["English", "Hindi", "Marathi", "Gujarati", "Tamil", "Telugu"].map(lang => (<label key={lang} className="flex items-center gap-2 text-[11px] font-medium text-slate-600 cursor-pointer hover:text-blue-600"><input type="checkbox" checked={formData.languages_spoken.includes(lang)} onChange={() => { const u = formData.languages_spoken.includes(lang) ? formData.languages_spoken.filter(l => l !== lang) : [...formData.languages_spoken, lang]; setFormData({ ...formData, languages_spoken: u }); }} className="w-3.5 h-3.5 accent-blue-600 rounded" /> {lang}</label>))}</div></FormField>
//                 </div>
//                 <FormField label="Profile Overview"><textarea rows={3} value={formData.about_me} onChange={(e) => setFormData({ ...formData, about_me: e.target.value })} className={inputStyle + " resize-none"} /></FormField>
//                 <div className="flex justify-end pt-4"><button type="button" onClick={() => setStep(2)} className={`px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest shadow-xl active:scale-95 transition-all`}>Next Phase <ChevronRight size={16} className="inline ml-2" /></button></div>
//               </div>
//             )}

//             {/* STEP 2: GEOGRAPHY */}
//             {step === 2 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8">
//                 <div className="flex items-center gap-3 pb-4 border-b border-slate-100"><MapPin size={18} className="text-blue-600" /><h3 className="text-xs font-black text-slate-800 uppercase tracking-widest">Geolocation Registry</h3></div>
//                 <div className="space-y-8">
//                   <FormField label="Street Address" required><input value={formData.address1} onChange={(e) => setFormData({...formData, address1: e.target.value})} className={inputStyle} /></FormField>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                     <FormField label="Location" required><input value={formData.location} onChange={(e) => setFormData({...formData, location: e.target.value})} className={inputStyle} /></FormField>
//                     <FormField label="Pincode Map" required><input maxLength={6} value={formData.pincode} onChange={(e) => { setFormData({ ...formData, pincode: e.target.value }); if(e.target.value.length === 6) fetchPincodeDetails(e.target.value); }} className={inputStyle} /></FormField>
//                   </div>
//                   <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
//                     <FormField label="City Registry"><input value={formData.city} readOnly className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner" /></FormField>
//                     <FormField label="District Registry"><input value={formData.district} readOnly className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner" /></FormField>
//                     <FormField label="State Node"><input value={formData.state} readOnly className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner" /></FormField>
//                     <FormField label="Country Hub"><input value={formData.country} onChange={(e) => setFormData({...formData, country: e.target.value})} className={inputStyle} /></FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-between pt-8 border-t border-slate-50"><button onClick={() => setStep(1)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase transition-all shadow-sm">â† Back</button><button onClick={() => setStep(3)} type="button" className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase shadow-xl transition-all">Continue â†’</button></div>
//               </div>
//             )}

//             {/* STEP 3: EXPERIENCE */}
//             {step === 3 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
//                 <div className="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-sm overflow-hidden">
//                   <div className="flex flex-col md:flex-row items-center justify-between gap-6">
//                     <div className="flex items-center gap-4 text-slate-900 font-black"><Briefcase size={24} className="text-blue-600" /><div><h3 className="text-sm uppercase tracking-widest leading-none">Are you a Fresher?</h3><p className="text-[10px] font-bold text-slate-400 uppercase mt-1">Select current career status</p></div></div>
//                     <div className="flex bg-slate-100 p-1.5 rounded-[1.5rem] border border-slate-200 w-full md:w-auto">
//                       <button type="button" onClick={() => { setIsFresher(true); setFormData({ ...formData, experiences: [] }); }} className={`px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === true ? "bg-white text-blue-600 shadow-sm" : "text-slate-400"}`}>Yes</button>
//                       <button type="button" onClick={() => setIsFresher(false)} className={`px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === false ? "bg-white text-blue-600 shadow-sm" : "text-slate-400"}`}>No</button>
//                     </div>
//                   </div>
//                 </div>

//                 {isFresher === false && (
//                   <div className="bg-white p-6 md:p-10 rounded-[3.5rem] border border-slate-200 shadow-xl space-y-10 animate-in fade-in duration-500 shadow-slate-100">
//                     <div className="flex flex-col sm:flex-row justify-between items-start border-b border-slate-100 pb-8 gap-4">
//                       <div className="flex items-center gap-4"><div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg"><History size={20} /></div><h3 className="text-sm font-black text-slate-900 uppercase">Career Timeline</h3></div>
//                       <button type="button" onClick={() => setFormData({ ...formData, experiences: [...formData.experiences, { company_name: "", job_title: "", uploadMode: "file" }] })} className="px-6 py-3 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase shadow-lg transition-all active:scale-95">+ Add Organization</button>
//                     </div>
//                     <div className="space-y-10 max-h-[600px] overflow-y-auto pr-4 custom-scrollbar-professional">
//                        {formData.experiences.map((exp, i) => (
//                          <div key={i} className="relative bg-slate-50/50 border border-slate-200 p-8 rounded-[2.5rem] space-y-8 animate-in zoom-in-95 group hover:bg-white transition-all shadow-inner">
//                             <button type="button" onClick={() => setFormData({ ...formData, experiences: formData.experiences.filter((_, idx) => idx !== i) })} className="absolute -top-3 -right-3 h-10 w-10 bg-white border border-slate-200 text-red-500 rounded-full flex items-center justify-center shadow-lg transition-all opacity-0 group-hover:opacity-100 z-20"><Trash2 size={18} /></button>
//                             <div className="grid grid-cols-1 md:grid-cols-2 gap-8"><FormField label="Employer"><input value={exp.company_name} onChange={(e) => { const u = [...formData.experiences]; u[i].company_name = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField><FormField label="Designation"><input value={exp.job_title} onChange={(e) => { const u = [...formData.experiences]; u[i].job_title = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField></div>

//                             <div className="grid grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8">
//                                 <FormField label="Start Date"><input type="date" value={exp.start_date} onChange={(e) => { const u = [...formData.experiences]; u[i].start_date = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                                 <FormField label="End Date"><input type="date" value={exp.end_date} onChange={(e) => { const u = [...formData.experiences]; u[i].end_date = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                                 <FormField label="Annual CTC"><input type="number" value={exp.previous_ctc} onChange={(e) => { const u = [...formData.experiences]; u[i].previous_ctc = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                                 <FormField label="City"><input value={exp.location} onChange={(e) => { const u = [...formData.experiences]; u[i].location = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                              </div>

//                             <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
//                                <FormField label="Responsibilities / Summary"><textarea rows={5} placeholder="Describe impact..." value={exp.description} onChange={(e) => { const u = [...formData.experiences]; u[i].description = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle + " resize-none min-h-[140px]"} /></FormField>
//                                <div className="space-y-3">
//                                   <div className="flex justify-between items-center px-1"><p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Artifact Node</p><div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200"><button type="button" onClick={() => { const u = [...formData.experiences]; u[i].uploadMode = "file"; setFormData({ ...formData, experiences: u }); }} className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === 'file' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>FILE</button><button type="button" onClick={() => { const u = [...formData.experiences]; u[i].uploadMode = "link"; setFormData({ ...formData, experiences: u }); }} className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === 'link' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>URL</button></div></div>
//                                   <div className="bg-white/50 border border-slate-100 rounded-3xl p-4 min-h-[140px] flex flex-col justify-center">
//                                     {exp.uploadMode === 'file' ? (<label className="flex flex-col items-center justify-center gap-3 w-full h-full border-2 border-dashed border-slate-200 rounded-2xl hover:bg-blue-50/30 transition-all cursor-pointer group p-4"><FileUp size={24} className="text-slate-400 group-hover:text-blue-500" /><span className="text-[9px] font-bold text-slate-500 uppercase tracking-widest text-center">{exp.experience_letter_path ? "Attachment Hydrated" : (exp.expLetterFile ? exp.expLetterFile.name : "Drop PDF Validation")}</span><input type="file" accept=".pdf" className="hidden" onChange={(e) => { const u = [...formData.experiences]; u[i].expLetterFile = e.target.files[0]; setFormData({ ...formData, experiences: u }); }} /></label>) : (<div className="relative"><LinkIcon size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input placeholder="Storage URI" value={exp.exp_letter_link || exp.experience_letter_path || ""} onChange={(e) => { const u = [...formData.experiences]; u[i].exp_letter_link = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle + " pl-11"} /></div>)}
//                                   </div>
//                                </div>
//                             </div>
//                             <div className="flex justify-end pt-2 border-t border-slate-50"><button type="button" onClick={() => toast.success("Record Synced")} className="flex items-center gap-2 px-8 py-3 bg-emerald-50 text-emerald-600 border border-emerald-100 rounded-2xl text-[10px] font-black uppercase hover:bg-emerald-500 hover:text-white transition-all active:scale-95 shadow-sm"><Check size={16} strokeWidth={3} /> Save Record</button></div>
//                          </div>
//                        ))}
//                     </div>
//                   </div>
//                 )}
//                 <div className="flex justify-between pt-4"><button onClick={() => setStep(2)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase shadow-sm transition-all hover:text-slate-900 flex items-center gap-2"><ChevronLeft size={16}/> Back</button><button onClick={() => setStep(4)} type="button" disabled={isFresher === null} className={`px-12 py-4 rounded-2xl text-xs font-black uppercase shadow-xl transition-all active:scale-95 ${isFresher !== null ? "bg-blue-600 text-white shadow-blue-600/30 hover:bg-blue-700" : "bg-slate-200 text-slate-400 cursor-not-allowed"}`}>Next Phase â†’</button></div>
//               </div>
//             )}

//             {/* STEP 4: INVENTORY */}
//             {/* {step === 4 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 overflow-visible">
//                 <div className="bg-white border border-slate-200 rounded-[3.5rem] shadow-xl overflow-visible shadow-slate-200/50">
//                   <div className="bg-slate-50/50 px-10 py-6 border-b border-slate-200 flex items-center justify-between rounded-t-[3.5rem]"><div className="flex items-center gap-4"><div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg"><Cpu size={20} /></div><div><h3 className="text-sm font-black text-slate-900 uppercase tracking-widest leading-none">Expertise Matrix</h3><p className="text-[10px] font-bold text-slate-400 uppercase mt-0.5">Hydrate skills and hardware</p></div></div></div>
//                   <div className="p-8 md:p-12 space-y-12 overflow-visible">
//                     <FormField label="Technical Matrix"><div className="space-y-6"><div className="flex flex-col sm:flex-row gap-4 items-end"><div className="relative max-w-md w-full"><Plus size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={skillInput} onChange={(e) => setSkillInput(e.target.value)} onKeyDown={(e) => { if(e.key === 'Enter') { e.preventDefault(); handleManualAddSkill(); } }} placeholder="Register skill..." className={inputStyle + " pl-12"} /></div><button type="button" onClick={handleManualAddSkill} className="px-6 py-3.5 bg-slate-900 hover:bg-blue-600 text-white rounded-2xl transition-all flex items-center gap-2 text-[10px] font-black uppercase tracking-widest shadow-lg"><Database size={14} /> Sync Registry</button></div><div className="flex flex-wrap gap-3 p-1">{dynamicSkills.map((skill) => { const isSelected = formData.skills.includes(skill); return (<button key={skill} type="button" onClick={() => setFormData({...formData, skills: isSelected ? formData.skills.filter(s => s !== skill) : [...formData.skills, skill]})} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${isSelected ? "bg-blue-600 border-blue-600 text-white shadow-lg" : "bg-white border-slate-100 text-slate-500 hover:border-blue-200"}`}>{skill} {isSelected && <Check size={14} strokeWidth={3} />}</button>); })}</div></div></FormField>
//                     <FormField label="Hardware Matrix"><div className="space-y-6 pt-8 border-t border-slate-100"><div className="relative max-w-md w-full"><Layers size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={assetInput} onChange={(e) => setAssetInput(e.target.value)} onKeyDown={async (e) => { if(e.key === 'Enter') { e.preventDefault(); const v = assetInput.trim(); if(v && !formData.assets.includes(v)) { const ok = await handleAddAssetAPI(v); if(ok) { setFormData({...formData, assets: [...formData.assets, v]}); setAssetInput(""); } } } }} placeholder="Link hardware..." className={inputStyle + " pl-12"} /></div><div className="flex flex-wrap gap-3 p-1">{dynamicAssets.map((asset) => { const isSelected = formData.assets.includes(asset); return (<button key={asset} type="button" onClick={async () => { if(!isSelected) { const ok = await handleAddAssetAPI(asset); if(ok) setFormData({...formData, assets: [...formData.assets, asset]}); } else { setFormData({...formData, assets: formData.assets.filter(a => a !== asset)}); } }} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black border-2 transition-all active:scale-90 ${isSelected ? "bg-slate-900 text-white shadow-lg" : "bg-white border-slate-100 text-slate-500"}`}>{asset} {isSelected && <Check size={14} strokeWidth={3} />}</button>); })}</div></div></FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-between items-center pt-4"><button onClick={() => setStep(3)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[11px] font-black uppercase transition-all shadow-sm hover:text-slate-900 flex items-center gap-2 transition-all"><ChevronLeft size={16}/> Previous Phase</button><button onClick={() => setStep(5)} type="button" className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-[11px] font-black uppercase shadow-xl active:scale-95 flex items-center gap-2 transition-all">Vault Registry <ChevronRight size={16}/></button></div>
//               </div>
//             )} */}
//              {step === 4 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 overflow-visible">
//                 <div className="bg-white border border-slate-200 rounded-[3.5rem] shadow-xl overflow-visible shadow-slate-200/50">
//                   <div className="bg-slate-50/50 px-10 py-6 border-b border-slate-200 flex items-center justify-between rounded-t-[3.5rem]"><div className="flex items-center gap-4"><div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg"><Cpu size={20} /></div><div><h3 className="text-sm font-black text-slate-900 uppercase tracking-widest leading-none">Inventory Matrix</h3><p className="text-[10px] font-bold text-slate-400 uppercase mt-0.5">Hydrate node expertise</p></div></div></div>
//                   <div className="p-8 md:p-12 space-y-12 overflow-visible">
//                     <FormField label="Technical Matrix"><div className="space-y-6"><div className="flex flex-col sm:flex-row gap-4 items-end"><div className="relative max-w-md w-full"><Plus size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={skillInput} onChange={(e) => setSkillInput(e.target.value)} onKeyDown={(e) => { if(e.key === 'Enter') { e.preventDefault(); handleManualAddSkill(); } }} placeholder="Register skill..." className={inputStyle + " pl-12"} /></div><button type="button" onClick={handleManualAddSkill} className="px-6 py-3.5 bg-slate-900 hover:bg-blue-600 text-white rounded-2xl transition-all flex items-center gap-2 text-[10px] font-black uppercase tracking-widest shadow-lg"><Database size={14} /> Sync Registry</button></div><div className="flex flex-wrap gap-3 p-1">{dynamicSkills.map((skill) => { const isSelected = formData.skills.includes(skill); return (<button key={skill} type="button" onClick={() => setFormData({...formData, skills: isSelected ? formData.skills.filter(s => s !== skill) : [...formData.skills, skill]})} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black border-2 active:scale-90 ${isSelected ? "bg-blue-600 border-blue-600 text-white shadow-lg" : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`}>{skill} {isSelected && <Check size={14} strokeWidth={3} />}</button>); })}</div></div></FormField>
//                     <FormField label="Hardware Inventory"><div className="space-y-6 pt-8 border-t border-slate-100"><div className="relative max-w-md w-full"><Layers size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={assetInput} onChange={(e) => setAssetInput(e.target.value)} onKeyDown={async (e) => { if(e.key === 'Enter') { e.preventDefault(); const v = assetInput.trim(); if(v && !formData.assets.includes(v)) { const ok = await handleAddAssetAPI(v); if(ok) { setFormData({...formData, assets: [...formData.assets, v]}); setAssetInput(""); } } } }} placeholder="Assign asset..." className={inputStyle + " pl-12"} /></div><div className="flex flex-wrap gap-3 p-1">{dynamicAssets.map((asset) => { const isSelected = formData.assets.includes(asset); return (<button key={asset} type="button" onClick={async () => { if(!isSelected) { const ok = await handleAddAssetAPI(asset); if(ok) setFormData({...formData, assets: [...formData.assets, asset]}); } else { setFormData({...formData, assets: formData.assets.filter(a => a !== asset)}); } }} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all border-2 active:scale-90 ${isSelected ? "bg-slate-900 text-white shadow-lg" : "bg-white border-slate-100 text-slate-500"}`}>{asset} {isSelected && <Check size={14} strokeWidth={3} />}</button>); })}</div></div></FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-between items-center pt-4"><button onClick={() => setStep(4)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase transition-all shadow-sm hover:text-slate-900 flex items-center gap-2"><ChevronLeft size={16}/> Previous Phase</button><button onClick={() => setStep(6)} type="button" className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase shadow-xl active:scale-95 flex items-center gap-2">Vault Registry <ChevronRight size={16}/></button></div>
//               </div>
//             )}

//             {/* STEP 5: DOCUMENT VAULT */}
//             {step === 5 && (
//               <div className="space-y-8 animate-in slide-in-from-bottom-12 duration-700">
//                 <div className="bg-white p-8 md:p-16 rounded-[4rem] shadow-xl shadow-slate-200/60 border border-slate-200 space-y-12 overflow-hidden relative">
//                   <div className="absolute top-0 right-0 p-12 text-slate-100 opacity-40 rotate-12 scale-150"><ShieldCheck size={240} /></div>
//                   <div className="flex items-center gap-5 pb-8 border-b border-slate-100 relative z-10"><div className="h-14 w-14 bg-blue-600 rounded-2xl flex items-center justify-center shadow-lg"><ShieldCheck size={28} className="text-white" /></div><div><h3 className="text-xl font-black text-slate-900 uppercase tracking-widest leading-none">Registry Artifacts</h3><p className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mt-2">Document Verification Matrix</p></div></div>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-16 relative z-10">
//                     <div className="space-y-8 p-1"><div className="flex justify-between items-center"><p className="text-[11px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2"><span className="h-1.5 w-1.5 rounded-full bg-blue-600" /> Resume Profile</p><div className="flex bg-slate-50 p-1 rounded-xl border border-slate-200"><button type="button" onClick={() => setResumeMode("file")} className={`px-5 py-2 text-[10px] font-black rounded-lg transition-all ${resumeMode === 'file' ? 'bg-white text-slate-900 shadow-sm border' : 'text-slate-400'}`}>FILE</button><button type="button" onClick={() => setResumeMode("link")} className={`px-5 py-2 text-[10px] font-black rounded-lg transition-all ${resumeMode === 'link' ? 'bg-white text-slate-900 shadow-sm border' : 'text-slate-400'}`}>URL</button></div></div>
//                     {resumeMode === 'file' ? (<label className="block p-12 border-2 border-dashed border-slate-200 rounded-[3rem] hover:border-blue-500 transition-all cursor-pointer group text-center bg-white shadow-inner"><FileUp size={40} className="mx-auto text-slate-300 group-hover:text-blue-500 mb-5 duration-500" /><p className="text-[10px] font-black text-slate-900 uppercase truncate px-4">{formData.cvFile ? formData.cvFile.name : "Select Resume PDF"}</p><input type="file" accept=".pdf" className="hidden" onChange={(e) => setFormData({...formData, cvFile: e.target.files[0], resume_link: ""})} /></label>) : <input placeholder="Enter URI Storage Link" value={formData.resume_link} onChange={(e) => setFormData({...formData, resume_link: e.target.value, cvFile: null})} className={inputStyle} />}</div>
//                     <div className="space-y-8 p-1"><div className="flex justify-between items-center"><p className="text-[11px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2"><span className="h-1.5 w-1.5 rounded-full bg-slate-400" /> Registry Node</p></div><div className="text-xs text-slate-400 font-bold uppercase leading-relaxed p-6 bg-slate-50 rounded-3xl border border-dashed shadow-inner">Data hydrated from Candidate {effectiveId}. Final PATCH Synchronize will commit changes to candidate repository. Ensure all artifacts are valid.</div></div>
//                   </div>
//                   <div className="pt-16 border-t border-slate-100 flex flex-col items-center gap-8 relative z-10"><button type="submit" disabled={loading} className="w-full md:max-w-xl flex items-center justify-center gap-5 bg-blue-600 hover:bg-blue-700 text-white font-black py-7 rounded-[3rem] shadow-2xl active:scale-[0.98] uppercase tracking-widest disabled:opacity-50">{loading ? <Loader2 className="animate-spin" size={28} /> : <><Database size={24} /><span>Finalize Patch Commit</span></>}</button><button type="button" onClick={() => setStep(4)} className="text-[10px] font-black text-slate-400 uppercase tracking-widest hover:text-slate-900 flex items-center gap-2 transition-all"><ChevronLeft size={16}/> Return to Expertise</button></div>
//                 </div>
//               </div>
//             )}
//           </div>
//         </form>
//       </div>
//       <style dangerouslySetInnerHTML={{ __html: `.custom-scrollbar-professional::-webkit-scrollbar { width: 6px; }.custom-scrollbar-professional::-webkit-scrollbar-track { background: transparent; }.custom-scrollbar-professional::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 20px; }.custom-scrollbar-professional::-webkit-scrollbar-thumb:hover { background: #CBD5E1; }`}} />
//     </div>
//   );
// };

// export default ManualEntryPage;
//********************************************************************************************************* */
// import React, { useState, useEffect, useRef } from "react";
// import { useParams, useNavigate } from "react-router-dom";
// import {
//   Check, FileText, Award, User, Briefcase, MapPin, Mail, Phone,
//   Loader2, Plus, Trash2, Layers, Cpu, ExternalLink, Database,
//   Globe, ShieldCheck, History, X, LinkIcon, FileUp, ChevronRight, ChevronLeft, ChevronDown
// } from "lucide-react";
// import toast from "react-hot-toast";
// import { candidateService } from "../../services/candidateService";
// import { departmentService } from "../../services/department.service";

// const FormField = ({ label, required, error, children }) => (
//   <div className="space-y-1.5 w-full">
//     <label className="text-[10px] md:text-[11px] font-black text-slate-500 uppercase tracking-widest ml-1 flex justify-between items-center">
//       <span>{label}</span>
//       <span className={`font-bold normal-case ${required ? "text-red-500" : "text-slate-300"}`}>
//         {required ? "Required" : "Optional"}
//       </span>
//     </label>
//     {children}
//     {error && <p className="text-[9px] text-red-500 font-bold uppercase tracking-tighter ml-1">{error}</p>}
//   </div>
// );

// const ManualEntryPage = () => {
//   const { id } = useParams();
//   const navigate = useNavigate();
//   const effectiveId = id || "666";
//   const dropdownContainerRef = useRef(null);
//   const careerStepRef = useRef(null);

//   // Define inputStyle correctly for all sections
//   const inputStyle = "w-full px-5 py-3.5 bg-slate-50 border border-slate-200 rounded-2xl text-[13px] font-bold outline-none focus:bg-white focus:border-blue-500 transition-all shadow-sm";

//   // 1. STATES
//   const [step, setStep] = useState(1);
//   const [loading, setLoading] = useState(false);
//   const [fetchingData, setFetchingData] = useState(false);
//   const [errors, setErrors] = useState({});
//   const [isFetchingPincode, setIsFetchingPincode] = useState(false);
//   const [cityOptions, setCityOptions] = useState([]);
//   const [resumeMode, setResumeMode] = useState("file");
//   const [expLetterMode, setExpLetterMode] = useState("file");
//   const [skillInput, setSkillInput] = useState("");
//   const [assetInput, setAssetInput] = useState("");
//   const [isFresher, setIsFresher] = useState(null);
//   const [deptSearch, setDeptSearch] = useState("");
//   const [eduSearch, setEduSearch] = useState("");
//   const [skillFocused, setSkillFocused] = useState(false);
//   const [dynamicSkills, setDynamicSkills] = useState([]);
//   const [dynamicAssets, setDynamicAssets] = useState([]);
//   const [showSkillDrop, setShowSkillDrop] = useState(false);
//   const [showAssetDrop, setShowAssetDrop] = useState(false);
//   const [departments, setDepartments] = useState([]);

//   const [formData, setFormData] = useState({
//     name: "", email: "", phone: "", address: "", address1: "", address2: "", location: "",
//     pincode: "", state: "", city: "", district: "", country: "India", position: "",
//     education: "", gender: "", dob: "", experience: "", about_me: "",
//     languages_spoken: [], skills: [], assets: [], department: "",
//     cvFile: null, resume_link: "", expLetterFile: null,
//     experience_letter_link: "", certificateFiles: [], certificateLinks: [""], experiences: [],
//   });

//   // 2. STATIC DATA
//   const totalSteps = 6;
//   const POSITION_OPTIONS = ["Frontend Developer", "Backend Developer", "Full Stack Developer", "HR Executive", "UI/UX Designer", "DevOps Engineer"];
//   const educationOptions = ["B.Tech", "M.Tech", "B.Sc", "M.Sc", "BCA", "MCA", "MBA", "Diploma", "PhD"];

//   const filteredEducation = educationOptions.filter(e => e.toLowerCase().includes(eduSearch.toLowerCase()));
//   const filteredDepartments = departments.filter(d => (d.name || "").toLowerCase().includes(deptSearch.toLowerCase()));
//   const isStep1Valid = formData.name && formData.email && formData.phone;

//   // 3. HYDRATION EFFECTS
//   useEffect(() => { window.scrollTo({ top: 0, behavior: "smooth" }); }, [step]);

//   useEffect(() => {
//     const hydrateForm = async () => {
//       setFetchingData(true);
//       try {
//         const response = await fetch(`https://apihrr.goelectronix.co.in/candidates/${effectiveId}`);
//         const data = await response.json();

//         if (data) {
//           const safeParse = (str) => {
//             try { return str ? JSON.parse(str) : []; } catch { return []; }
//           };

//           setFormData(prev => ({
//             ...prev,
//             name: data.full_name || "",
//             email: data.email || "",
//             phone: data.phone || "",
//             gender: data.gender || "",
//             dob: data.dob || "",
//             address1: data.address1 || "",
//             address2: data.address2 || "",
//             location: data.location || "",
//             pincode: data.pincode || "",
//             city: data.city || "",
//             state: data.state || "",
//             district: data.district || "",
//             country: data.country || "India",
//             position: data.position || "",
//             experience: data.experience || "",
//             education: data.education || "",
//             department: data.department || "",
//             about_me: data.about_me || "",
//             resume_link: data.resume_link || "",
//             languages_spoken: safeParse(data.languages_spoken),
//             experiences: safeParse(data.experience_details),
//             skills: safeParse(data.skills),
//             assets: safeParse(data.assets),
//           }));

//           const loadedExp = safeParse(data.experience_details);
//           setIsFresher(loadedExp.length === 0);
//         }

//         const deptData = await departmentService.getAll();
//         setDepartments(deptData || []);
//         fetchSkills();
//         fetchAssets(effectiveId);
//       } catch (err) { console.warn("No node found for hydration"); }
//       finally { setFetchingData(false); }
//     };
//     hydrateForm();
//   }, [effectiveId]);

//   // Click Outside logic
//   useEffect(() => {
//     const handleClickOutside = (event) => {
//       if (dropdownContainerRef.current && !dropdownContainerRef.current.contains(event.target)) {
//         setShowSkillDrop(false);
//         setShowAssetDrop(false);
//         setSkillFocused(false);
//       }
//     };
//     document.addEventListener("mousedown", handleClickOutside);
//     return () => document.removeEventListener("mousedown", handleClickOutside);
//   }, []);

//   // 4. HANDLERS
//   const fetchSkills = async () => {
//     try {
//       const response = await fetch("https://apihrr.goelectronix.co.in/masters/skills");
//       const data = await response.json();
//       setDynamicSkills(data.map(item => item.name || item));
//     } catch { console.error("Skill sync failed"); }
//   };

//   const fetchAssets = async (cId) => {
//     try {
//       const response = await fetch(`https://apihrr.goelectronix.co.in/candidates/${cId}/assets`);
//       const data = await response.json();
//       setDynamicAssets(Array.isArray(data) ? data.map(a => a.name) : []);
//     } catch { console.error("Asset sync failed"); }
//   };

//   const handleManualAddSkill = async () => {
//     const name = skillInput.trim();
//     if (!name) { await fetchSkills(); return; }
//     const success = await handleCreateMaster("skills", name);
//     if (success) {
//       if (!formData.skills.includes(name)) setFormData(p => ({ ...p, skills: [...p.skills, name] }));
//       setSkillInput("");
//       await fetchSkills();
//     }
//   };

//   const handleCreateMaster = async (type, name) => {
//     try {
//       const res = await fetch(`https://apihrr.goelectronix.co.in/masters/${type}`, {
//         method: "POST",
//         headers: { "Content-Type": "application/json" },
//         body: JSON.stringify({ name: name.trim() }),
//       });
//       return res.ok;
//     } catch { return false; }
//   };

//   const handleAddAssetAPI = async (assetName) => {
//     if (!assetName.trim()) return;
//     const loadingToast = toast.loading(`Registering Asset...`);
//     try {
//       const res = await fetch(`https://apihrr.goelectronix.co.in/candidates/${effectiveId}/assets`, {
//         method: "POST",
//         headers: { "Content-Type": "application/json" },
//         body: JSON.stringify({ name: assetName.trim() }),
//       });
//       if (res.ok) {
//         toast.success("Asset Linked", { id: loadingToast });
//         await fetchAssets(effectiveId);
//         return true;
//       }
//       throw new Error();
//     } catch { toast.error("Linking failed", { id: loadingToast }); return false; }
//   };

//   const fetchPincodeDetails = async (pincode) => {
//     if (!/^\d{6}$/.test(pincode)) return;
//     setIsFetchingPincode(true);
//     try {
//       const res = await fetch(`https://api.postalpincode.in/pincode/${pincode}`);
//       const data = await res.json();
//       if (data[0]?.Status === "Success") {
//         setCityOptions(data[0].PostOffice.map(o => o.Name));
//       }
//     } finally { setIsFetchingPincode(false); }
//   };

//   const validateField = (field, value) => {
//     let error = "";
//     if (["name", "email", "phone"].includes(field) && !value) error = "Required field";
//     setErrors(prev => ({ ...prev, [field]: error }));
//     return !error;
//   };

//   const handleSubmit = async (e) => {
//     e.preventDefault();
//     setLoading(true);
//     const loadingToast = toast.loading("Executing PATCH Sync...");
//     try {
//       const apiData = new FormData();
//       Object.keys(formData).forEach(key => {
//         if (formData[key] && !["experiences", "certificateFiles", "languages_spoken", "cvFile", "skills", "assets"].includes(key)) {
//           apiData.append(key, formData[key]);
//         }
//       });
//       apiData.append("full_name", formData.name);
//       apiData.append("experience_details", JSON.stringify(formData.experiences));
//       apiData.append("languages_spoken", JSON.stringify(formData.languages_spoken));
//       apiData.append("skills", JSON.stringify(formData.skills));
//       apiData.append("assets", JSON.stringify(formData.assets));

//       // PATCHING TO CANDIDATE 588 as requested
//       const response = await fetch(`https://apihrr.goelectronix.co.in/candidates/588`, {
//         method: "PATCH",
//         body: apiData,
//       });

//       if (response.ok) {
//         toast.success("Sync Node 588 Successful ðŸŽ‰", { id: loadingToast });
//       } else { throw new Error(); }
//     } catch { toast.error("Sync Failed", { id: loadingToast }); }
//     finally { setLoading(false); }
//   };

//   if (fetchingData) return (
//     <div className="min-h-screen flex flex-col items-center justify-center bg-slate-50 gap-4">
//       <Loader2 className="h-10 w-10 animate-spin text-blue-600" />
//       <p className="text-[11px] font-black uppercase tracking-[0.2em] text-slate-400">Pulling Data Node {effectiveId}...</p>
//     </div>
//   );

//   return (
//     <div className="min-h-screen bg-[#F8FAFC] p-4 md:p-12 antialiased">
//       <div className="max-w-6xl mx-auto space-y-8" ref={dropdownContainerRef}>

//         {/* ROADMAP HEADER */}
//         <div className="flex flex-col lg:flex-row justify-between items-center bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 gap-8">
//           <div className="flex items-center gap-6">
//             <div className="h-16 w-16 bg-slate-900 rounded-[1.5rem] flex items-center justify-center text-white shadow-2xl">
//               <Database size={32} />
//             </div>
//             <div>
//               <h2 className="text-2xl font-black text-slate-900 tracking-tight">{id ? "Edit Registry" : "Manual Registry"}</h2>
//               <div className="flex items-center gap-2 mt-1 text-blue-600">
//                 <ShieldCheck size={14} />
//                 <p className="text-[10px] font-black uppercase tracking-widest">Hydrating Node: {effectiveId}</p>
//               </div>
//             </div>
//           </div>

//           <div className="flex-1 max-w-2xl w-full px-4">
//             <div className="relative flex justify-between items-center w-full">
//               <div className="absolute top-1/2 left-0 w-full h-0.5 bg-slate-100 -translate-y-1/2 z-0" />
//               <div className="absolute top-1/2 left-0 h-0.5 bg-blue-600 -translate-y-1/2 z-0 transition-all duration-700" style={{ width: `${((step - 1) / (totalSteps - 1)) * 100}%` }} />
//               {[1, 2, 3, 4, 5, 6].map((num) => (
//                 <div key={num} className="relative z-10 flex flex-col items-center gap-2">
//                   <div className={`h-8 w-8 rounded-full flex items-center justify-center text-[10px] font-black transition-all duration-500 border-4 ${step === num ? "bg-blue-600 text-white border-blue-100 scale-110 shadow-lg" : step > num ? "bg-emerald-500 text-white border-emerald-50" : "bg-white text-slate-300 border-slate-50"}`}>
//                     {step > num ? <Check size={14} strokeWidth={4} /> : num}
//                   </div>
//                 </div>
//               ))}
//             </div>
//           </div>
//           <div className="bg-slate-50 border border-slate-200 rounded-2xl px-6 py-3 flex items-center gap-3">
//             <div className="text-right"><p className="text-[8px] font-black text-slate-400 uppercase leading-none">Sync</p><p className="text-sm font-black text-slate-900 mt-1">{Math.round((step / totalSteps) * 100)}%</p></div>
//             <div className="h-8 w-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center"><Check size={18} /></div>
//           </div>
//         </div>

//         <form onSubmit={handleSubmit}>
//           <div className="space-y-12">

//             {/* STEP 1: IDENTITY */}
//             {step === 1 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8 duration-500">
//                 <div className="flex items-center gap-4 pb-4 border-b border-slate-100"><User size={18} className="text-blue-600" /><h3 className="text-sm font-black text-slate-800 uppercase tracking-widest">Identification</h3></div>
//                 <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                   <FormField label="Full Name" required error={errors.name}><input placeholder="Legal Name" value={formData.name} onChange={(e) => setFormData({ ...formData, name: e.target.value })} className={inputStyle} /></FormField>
//                   <FormField label="Email Address" required error={errors.email}><input type="email" placeholder="name@domain.com" value={formData.email} onChange={(e) => setFormData({ ...formData, email: e.target.value })} className={inputStyle} /></FormField>
//                   <FormField label="Phone Number" required><div className="flex items-center bg-slate-50 border border-slate-200 rounded-xl overflow-hidden focus-within:bg-white focus-within:border-blue-500 transition-all shadow-sm"><span className="px-5 text-[11px] font-black text-slate-400">+91</span><input maxLength={10} value={formData.phone} onChange={(e) => setFormData({ ...formData, phone: e.target.value })} className="w-full px-5 py-4 bg-transparent text-sm font-bold outline-none" /></div></FormField>
//                   <FormField label="Gender Selection"><select value={formData.gender} onChange={(e) => setFormData({ ...formData, gender: e.target.value })} className={inputStyle}><option value="">Select</option><option value="male">Male</option><option value="female">Female</option></select></FormField>
//                   <FormField label="Date of Birth"><input type="date" value={formData.dob} onChange={(e) => setFormData({ ...formData, dob: e.target.value })} className={inputStyle} /></FormField>
//                   <FormField label="Languages"><div className="bg-slate-50 border border-slate-200 rounded-2xl p-5 max-h-40 overflow-y-auto grid grid-cols-2 gap-4 shadow-inner">{["English", "Hindi", "Marathi", "Gujarati", "Tamil", "Telugu"].map(lang => (<label key={lang} className="flex items-center gap-3 text-[11px] font-bold text-slate-600 cursor-pointer hover:text-blue-600"><input type="checkbox" checked={formData.languages_spoken.includes(lang)} onChange={() => { const u = formData.languages_spoken.includes(lang) ? formData.languages_spoken.filter(l => l !== lang) : [...formData.languages_spoken, lang]; setFormData({ ...formData, languages_spoken: u }); }} className="w-4 h-4 accent-blue-600" /> {lang}</label>))}</div></FormField>
//                 </div>
//                 <FormField label="Profile Bio"><textarea rows={4} placeholder="Brief summary..." value={formData.about_me} onChange={(e) => setFormData({ ...formData, about_me: e.target.value })} className={inputStyle + " resize-none"} /></FormField>
//                 <div className="flex justify-end pt-4"><button type="button" disabled={!isStep1Valid} onClick={() => setStep(2)} className={`flex items-center gap-3 px-12 py-4 rounded-2xl text-xs font-black uppercase tracking-widest shadow-xl transition-all active:scale-95 ${isStep1Valid ? "bg-blue-600 text-white" : "bg-slate-200 text-slate-400 cursor-not-allowed"}`}>Next Phase <ChevronRight size={16}/></button></div>
//               </div>
//             )}

//             {/* STEP 2: GEOGRAPHY */}
//             {step === 2 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8">
//                 <div className="flex items-center gap-3 pb-4 border-b border-slate-100"><MapPin size={18} className="text-blue-600" /><h3 className="text-xs font-black text-slate-800 uppercase tracking-widest">Geolocation Registry</h3></div>
//                 <div className="space-y-8">
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                     <FormField label="Address line 1" required><input placeholder="Street" value={formData.address1} onChange={(e) => setFormData({...formData, address1: e.target.value})} className={inputStyle} /></FormField>
//                     <FormField label="Address line 2" required><input placeholder="Locality" value={formData.address2} onChange={(e) => setFormData({...formData, address2: e.target.value})} className={inputStyle} /></FormField>
//                   </div>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                     <FormField label="Location/Area Hub" required><input value={formData.location} onChange={(e) => setFormData({...formData, location: e.target.value})} className={inputStyle} /></FormField>
//                     <FormField label="Pincode Mapping" required><div className="relative"><input maxLength={6} value={formData.pincode} onChange={(e) => { setFormData({ ...formData, pincode: e.target.value }); if (e.target.value.length === 6) fetchPincodeDetails(e.target.value); }} className={inputStyle} />{isFetchingPincode && <Loader2 size={18} className="absolute right-4 top-1/2 -translate-y-1/2 animate-spin text-blue-500" />}</div></FormField>
//                   </div>
//                   <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
//                     <FormField label="City"><div className="relative group">{cityOptions.length > 1 ? (<><select value={formData.city} onChange={(e) => setFormData({ ...formData, city: e.target.value })} className={inputStyle + " appearance-none cursor-pointer"}><option value="">Select City</option>{cityOptions.map((c, i) => (<option key={i} value={c}>{c}</option>))}</select><ChevronDown size={16} className="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400"/></>) : (<input value={formData.city} readOnly className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner" />)}</div></FormField>
//                     <FormField label="District"><input value={formData.district} readOnly className="w-full px-6 py-4 bg-slate-100 border-none rounded-2xl text-sm font-bold text-slate-500 shadow-inner" /></FormField>
//                     <FormField label="State"><input value={formData.state} readOnly className="w-full px-6 py-4 bg-slate-100 border-none rounded-2xl text-sm font-bold text-slate-500 shadow-inner" /></FormField>
//                     <FormField label="Country"><input value={formData.country} onChange={(e) => setFormData({...formData, country: e.target.value})} className={inputStyle} /></FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-between pt-8 border-t border-slate-50"><button onClick={() => setStep(1)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase hover:text-slate-900 transition-all shadow-sm">â† Back</button><button onClick={() => setStep(3)} type="button" className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase shadow-xl transition-all">Continue â†’</button></div>
//               </div>
//             )}

//             {/* STEP 3: EXPERIENCE */}
//             {/* {step === 3 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
//                 <div className="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-sm transition-all overflow-hidden">
//                   <div className="flex flex-col md:flex-row items-center justify-between gap-6">
//                     <div className="flex items-center gap-4 text-slate-900 font-black"><Briefcase size={24} className="text-blue-600" /><div><h3 className="text-sm uppercase tracking-widest leading-none">Are you a Fresher?</h3><p className="text-[10px] font-bold text-slate-400 mt-1">Select career status</p></div></div>
//                     <div className="flex bg-slate-100 p-1.5 rounded-[1.5rem] border border-slate-200 w-full md:w-auto">
//                       <button type="button" onClick={() => { setIsFresher(true); setFormData({ ...formData, experiences: [] }); }} className={`px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === true ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}>Yes</button>
//                       <button type="button" onClick={() => setIsFresher(false)} className={`px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === false ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}>No</button>
//                     </div>
//                   </div>
//                 </div>

//                 {isFresher === false && (
//                   <div className="bg-white p-6 md:p-10 rounded-[3.5rem] border border-slate-200 shadow-xl space-y-10 animate-in fade-in zoom-in-95">
//                     <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center border-b border-slate-100 pb-8 gap-4">
//                       <div className="flex items-center gap-4"><div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg"><History size={20} /></div><h3 className="text-sm font-black text-slate-900 uppercase tracking-widest">Experience Timeline</h3></div>
//                       <button type="button" onClick={() => setFormData({ ...formData, experiences: [...formData.experiences, { company_name: "", job_title: "", uploadMode: "file" }] })} className="px-6 py-3 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase shadow-lg transition-all active:scale-95">+ Add Org</button>
//                     </div>
//                     <div className="space-y-10 max-h-[600px] overflow-y-auto pr-4 custom-scrollbar-professional">
//                        {formData.experiences.map((exp, i) => (
//                          <div key={i} className="relative bg-slate-50/50 border border-slate-200 p-8 rounded-[2.5rem] space-y-8 animate-in zoom-in-95 group hover:bg-white transition-all shadow-inner">
//                             <button type="button" onClick={() => setFormData({ ...formData, experiences: formData.experiences.filter((_, idx) => idx !== i) })} className="absolute -top-3 -right-3 h-10 w-10 bg-white border border-slate-200 text-red-500 rounded-full flex items-center justify-center shadow-lg transition-all opacity-0 group-hover:opacity-100 z-20"><Trash2 size={18} /></button>
//                             <div className="grid grid-cols-1 md:grid-cols-2 gap-8"><FormField label="Employer"><input value={exp.company_name} onChange={(e) => { const u = [...formData.experiences]; u[i].company_name = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField><FormField label="Designation"><input value={exp.job_title} onChange={(e) => { const u = [...formData.experiences]; u[i].job_title = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField></div>
//                             <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
//                                <FormField label="Responsibilities"><textarea rows={5} value={exp.description} onChange={(e) => { const u = [...formData.experiences]; u[i].description = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle + " resize-none min-h-[140px]"} /></FormField>
//                                <div className="space-y-3">
//                                   <div className="flex justify-between px-1"><p className="text-[10px] font-black text-slate-400 uppercase">Experience Letter</p><div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200"><button type="button" onClick={() => { const u = [...formData.experiences]; u[i].uploadMode = "file"; setFormData({ ...formData, experiences: u }); }} className={`px-4 py-1.5 text-[9px] font-black rounded-lg ${exp.uploadMode === 'file' ? 'bg-white text-blue-600 shadow-sm border' : 'text-slate-500'}`}>FILE</button><button type="button" onClick={() => { const u = [...formData.experiences]; u[i].uploadMode = "link"; setFormData({ ...formData, experiences: u }); }} className={`px-4 py-1.5 text-[9px] font-black rounded-lg ${exp.uploadMode === 'link' ? 'bg-white text-blue-600 shadow-sm border' : 'text-slate-500'}`}>URL</button></div></div>
//                                   <div className="bg-white/50 border border-slate-100 rounded-3xl p-4 min-h-[140px] flex flex-col justify-center">
//                                     {exp.uploadMode === 'file' ? (<label className="flex flex-col items-center justify-center gap-3 w-full h-full border-2 border-dashed border-slate-200 rounded-2xl hover:bg-blue-50/30 cursor-pointer group p-4"><FileUp size={24} className="text-slate-400 group-hover:text-blue-500" /><span className="text-[9px] font-bold text-slate-500 uppercase tracking-widest text-center">{exp.expLetterFile ? exp.expLetterFile.name : "Drop PDF"}</span><input type="file" className="hidden" onChange={(e) => { const u = [...formData.experiences]; u[i].expLetterFile = e.target.files[0]; setFormData({ ...formData, experiences: u }); }} /></label>) : (<div className="relative"><LinkIcon size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input placeholder="Storage Link" value={exp.exp_letter_link} onChange={(e) => { const u = [...formData.experiences]; u[i].exp_letter_link = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle + " pl-11"} /></div>)}
//                                   </div>
//                                </div>
//                             </div>
//                             <div className="flex justify-end pt-2 border-t border-slate-50"><button type="button" onClick={() => toast.success("Synced locally")} className="flex items-center gap-2 px-8 py-3 bg-emerald-50 text-emerald-600 border border-emerald-100 rounded-2xl text-[10px] font-black uppercase hover:bg-emerald-500 hover:text-white transition-all active:scale-95 shadow-sm"><Check size={16} strokeWidth={3} /> Save Record</button></div>
//                          </div>
//                        ))}
//                     </div>
//                   </div>
//                 )}
//                 <div className="flex justify-between pt-4"><button onClick={() => setStep(2)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase shadow-sm">â† Back</button><button onClick={() => setStep(4)} type="button" disabled={isFresher === null} className={`px-12 py-4 rounded-2xl text-xs font-black uppercase shadow-xl transition-all active:scale-95 ${isFresher !== null ? "bg-blue-600 text-white shadow-blue-600/30" : "bg-slate-200 text-slate-400 cursor-not-allowed"}`}>Next Phase â†’</button></div>
//               </div>
//             )} */}

//             {/* {step === 3 && (
//   <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
//     <div className="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-sm transition-all overflow-hidden">
//       <div className="flex flex-col md:flex-row items-center justify-between gap-6">
//         <div className="flex items-center gap-4 text-slate-900 font-black">
//           <Briefcase size={24} className="text-blue-600" />
//           <div>
//             <h3 className="text-sm uppercase tracking-widest leading-none">Are you a Fresher?</h3>
//             <p className="text-[10px] font-bold text-slate-400 mt-1">Select career status</p>
//           </div>
//         </div>
//         <div className="flex bg-slate-100 p-1.5 rounded-[1.5rem] border border-slate-200 w-full md:w-auto">
//           <button
//             type="button"
//             onClick={() => { setIsFresher(true); setFormData({ ...formData, experiences: [] }); }}
//             className={`px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === true ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}
//           > Yes </button>
//           <button
//             type="button"
//             onClick={() => setIsFresher(false)}
//             className={`px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === false ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}
//           > No </button>
//         </div>
//       </div>
//     </div>

//     {isFresher === false && (
//       <div className="bg-white p-6 md:p-10 rounded-[3.5rem] border border-slate-200 shadow-xl space-y-10 animate-in fade-in zoom-in-95">
//         <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center border-b border-slate-100 pb-8 gap-4">
//           <div className="flex items-center gap-4">
//             <div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg"><History size={20} /></div>
//             <h3 className="text-sm font-black text-slate-900 uppercase tracking-widest">Experience Timeline</h3>
//           </div>
//           <button
//             type="button"
//             onClick={() => setFormData({ ...formData, experiences: [...formData.experiences, { company_name: "", job_title: "", start_date: "", end_date: "", previous_ctc: 0, location: "", description: "", uploadMode: "file" }] })}
//             className="px-6 py-3 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase shadow-lg active:scale-95 transition-all"
//           > + Add Org </button>
//         </div>

//         <div className="space-y-10 max-h-[600px] overflow-y-auto pr-4 custom-scrollbar-professional">
//           {formData.experiences.map((exp, i) => (
//             <div key={i} className="relative bg-slate-50/50 border border-slate-200 p-8 rounded-[2.5rem] space-y-8 animate-in zoom-in-95 group hover:bg-white transition-all shadow-inner">
//               <button
//                 type="button"
//                 onClick={() => setFormData({ ...formData, experiences: formData.experiences.filter((_, idx) => idx !== i) })}
//                 className="absolute -top-3 -right-3 h-10 w-10 bg-white border border-slate-200 text-red-500 rounded-full flex items-center justify-center shadow-lg hover:bg-red-500 hover:text-white transition-all opacity-0 group-hover:opacity-100 z-20"
//               > <Trash2 size={18} /> </button>

//               <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
//                 <FormField label="Employer">
//                   <input
//                     placeholder="Company Name"
//                     value={exp.company_name}
//                     onChange={(e) => { const u = [...formData.experiences]; u[i].company_name = e.target.value; setFormData({ ...formData, experiences: u }); }}
//                     className={inputStyle}
//                   />
//                 </FormField>
//                 <FormField label="Designation">
//                   <input
//                     placeholder="Job Title"
//                     value={exp.job_title}
//                     onChange={(e) => { const u = [...formData.experiences]; u[i].job_title = e.target.value; setFormData({ ...formData, experiences: u }); }}
//                     className={inputStyle}
//                   />
//                 </FormField>
//               </div>

//               <div className="grid grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8">
//                 <FormField label="Start Date">
//                   <input type="date" value={exp.start_date} onChange={(e) => { const u = [...formData.experiences]; u[i].start_date = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} />
//                 </FormField>
//                 <FormField label="End Date">
//                   <input type="date" value={exp.end_date} onChange={(e) => { const u = [...formData.experiences]; u[i].end_date = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} />
//                 </FormField>
//                 <FormField label="Previous CTC">
//                   <input type="number" placeholder="â‚¹" value={exp.previous_ctc} onChange={(e) => { const u = [...formData.experiences]; u[i].previous_ctc = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} />
//                 </FormField>
//                 <FormField label="Office Location">
//                   <input placeholder="City" value={exp.location} onChange={(e) => { const u = [...formData.experiences]; u[i].location = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} />
//                 </FormField>
//               </div>

//               <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
//                 <FormField label="Responsibilities / Remarks">
//                   <textarea
//                     rows={5}
//                     placeholder="Describe your impact..."
//                     value={exp.description}
//                     onChange={(e) => { const u = [...formData.experiences]; u[i].description = e.target.value; setFormData({ ...formData, experiences: u }); }}
//                     className={inputStyle + " resize-none min-h-[140px]"}
//                   />
//                 </FormField>
//                 <div className="space-y-3">
//                   <div className="flex justify-between px-1">
//                     <p className="text-[10px] font-black text-slate-400 uppercase">Experience Letter</p>
//                     <div className="flex bg-slate-100 p-1 rounded-xl border">
//                       <button type="button" onClick={() => { const u = [...formData.experiences]; u[i].uploadMode = "file"; setFormData({ ...formData, experiences: u }); }} className={`px-4 py-1 text-[9px] font-black rounded-lg ${exp.uploadMode === 'file' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>FILE</button>
//                       <button type="button" onClick={() => { const u = [...formData.experiences]; u[i].uploadMode = "link"; setFormData({ ...formData, experiences: u }); }} className={`px-4 py-1 text-[9px] font-black rounded-lg ${exp.uploadMode === 'link' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>URL</button>
//                     </div>
//                   </div>
//                   <div className="bg-white/50 border border-slate-100 rounded-3xl p-4 min-h-[140px] flex flex-col justify-center">
//                     {exp.uploadMode === 'file' ? (
//                       <label className="flex flex-col items-center justify-center gap-3 w-full h-full border-2 border-dashed border-slate-200 rounded-2xl hover:bg-blue-50/30 cursor-pointer group p-4">
//                         <FileUp size={24} className="text-slate-400 group-hover:text-blue-500" />
//                         <span className="text-[9px] font-bold text-slate-500 uppercase tracking-widest text-center">
//                           {exp.experience_letter_path ? "Existing File Present" : (exp.expLetterFile ? exp.expLetterFile.name : "Drop PDF")}
//                         </span>
//                         <input type="file" className="hidden" onChange={(e) => { const u = [...formData.experiences]; u[i].expLetterFile = e.target.files[0]; setFormData({ ...formData, experiences: u }); }} />
//                       </label>
//                     ) : (
//                       <div className="relative">
//                         <LinkIcon size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" />
//                         <input placeholder="URI Storage Link" value={exp.exp_letter_link || exp.experience_letter_path || ""} onChange={(e) => { const u = [...formData.experiences]; u[i].exp_letter_link = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle + " pl-11"} />
//                       </div>
//                     )}
//                   </div>
//                 </div>
//               </div>
//               <div className="flex justify-end pt-2 border-t border-slate-50">
//                 <button type="button" onClick={() => toast.success("Entry details captured")} className="flex items-center gap-2 px-8 py-3 bg-emerald-50 text-emerald-600 border border-emerald-100 rounded-2xl text-[10px] font-black uppercase hover:bg-emerald-500 hover:text-white transition-all active:scale-95 shadow-sm">
//                   <Check size={16} strokeWidth={3} /> Save Record
//                 </button>
//               </div>
//             </div>
//           ))}
//         </div>
//       </div>
//     )}

//     <div className="flex justify-between pt-4">
//       <button onClick={() => setStep(2)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase shadow-sm">â† Back</button>
//       <button onClick={() => setStep(4)} type="button" disabled={isFresher === null} className={`px-12 py-4 rounded-2xl text-xs font-black uppercase shadow-xl transition-all active:scale-95 ${isFresher !== null ? "bg-blue-600 text-white shadow-blue-600/30 hover:bg-blue-700" : "bg-slate-200 text-slate-400 cursor-not-allowed"}`}>Next Phase â†’</button>
//     </div>
//   </div>
// )} */}    {step === 3 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
//                 <div className="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-sm transition-all overflow-hidden">
//                   <div className="flex flex-col md:flex-row items-center justify-between gap-6">
//                     <div className="flex items-center gap-4 text-slate-900 font-black">
//                       <Briefcase size={24} className="text-blue-600" />
//                       <div><h3 className="text-sm uppercase tracking-widest leading-none">Are you a Fresher?</h3><p className="text-[10px] font-bold text-slate-400 uppercase tracking-wider mt-1.5">Select career status</p></div>
//                     </div>
//                     <div className="flex bg-slate-100 p-1.5 rounded-[1.5rem] border border-slate-200 w-full md:w-auto">
//                       <button type="button" onClick={() => { setIsFresher(true); setFormData({ ...formData, experiences: [] }); }} className={`px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === true ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}>Yes</button>
//                       <button type="button" onClick={() => setIsFresher(false)} className={`px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === false ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}>No</button>
//                     </div>
//                   </div>
//                 </div>

//                 {isFresher === false && (
//                   <div className="bg-white p-6 md:p-10 rounded-[3.5rem] border border-slate-200 shadow-xl space-y-10 animate-in fade-in zoom-in-95">
//                     <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center border-b border-slate-100 pb-8 gap-4">
//                       <div className="flex items-center gap-4"><div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg"><History size={20} /></div><h3 className="text-sm font-black text-slate-900 uppercase tracking-widest">Experience Timeline</h3></div>
//                       <button type="button" onClick={() => setFormData({ ...formData, experiences: [...formData.experiences, { company_name: "", job_title: "", uploadMode: "file" }] })} className="px-6 py-3 bg-slate-900 text-white rounded-2xl text-[10px] font-black uppercase shadow-lg transition-all active:scale-95">+ Add Organization</button>
//                     </div>
//                     <div className="space-y-10 max-h-[600px] overflow-y-auto pr-4 custom-scrollbar-professional">
//                        {formData.experiences.length > 0 ? (
//                          formData.experiences.map((exp, i) => (
//                           <div key={i} className="relative bg-slate-50/50 border border-slate-200 p-8 rounded-[2.5rem] space-y-8 group transition-all hover:bg-white hover:shadow-xl shadow-inner animate-in zoom-in-95">
//                              <button type="button" onClick={() => setFormData({ ...formData, experiences: formData.experiences.filter((_, idx) => idx !== i) })} className="absolute -top-3 -right-3 h-10 w-10 bg-white border border-slate-200 text-red-500 rounded-full flex items-center justify-center shadow-lg opacity-0 group-hover:opacity-100 z-20 transition-all"><Trash2 size={18} /></button>

//                              <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
//                                <FormField label="Employer"><input placeholder="Organization" value={exp.company_name} onChange={(e) => { const u = [...formData.experiences]; u[i].company_name = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                                <FormField label="Designation"><input placeholder="Job Title" value={exp.job_title} onChange={(e) => { const u = [...formData.experiences]; u[i].job_title = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                              </div>

//                              <div className="grid grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8">
//                                 <FormField label="Start Date"><input type="date" value={exp.start_date} onChange={(e) => { const u = [...formData.experiences]; u[i].start_date = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                                 <FormField label="End Date"><input type="date" value={exp.end_date} onChange={(e) => { const u = [...formData.experiences]; u[i].end_date = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                                 <FormField label="Annual CTC"><input type="number" value={exp.previous_ctc} onChange={(e) => { const u = [...formData.experiences]; u[i].previous_ctc = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                                 <FormField label="Office City"><input value={exp.location} onChange={(e) => { const u = [...formData.experiences]; u[i].location = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                              </div>

//                              <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
//                                 <FormField label="Remarks / Summary"><textarea rows={5} value={exp.description} onChange={(e) => { const u = [...formData.experiences]; u[i].description = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle + " resize-none min-h-[140px]"} /></FormField>
//                                 <div className="space-y-3">
//                                    <div className="flex justify-between items-center px-1"><p className="text-[10px] font-black text-slate-400 uppercase">Verification Artifact</p><div className="flex bg-slate-100 p-1 rounded-xl border"><button type="button" onClick={() => { const u = [...formData.experiences]; u[i].uploadMode = "file"; setFormData({ ...formData, experiences: u }); }} className={`px-4 py-1 text-[9px] font-black rounded-lg ${exp.uploadMode !== 'link' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>FILE</button><button type="button" onClick={() => { const u = [...formData.experiences]; u[i].uploadMode = "link"; setFormData({ ...formData, experiences: u }); }} className={`px-4 py-1 text-[9px] font-black rounded-lg ${exp.uploadMode === 'link' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>URL</button></div></div>
//                                    <div className="bg-white/50 border border-slate-100 rounded-3xl p-4 min-h-[140px] flex flex-col justify-center">
//                                      {exp.uploadMode !== 'link' ? (
//                                        <label className="flex flex-col items-center justify-center gap-3 w-full h-full border-2 border-dashed border-slate-200 rounded-2xl hover:bg-blue-50/30 cursor-pointer group p-4 transition-all">
//                                          <FileUp size={24} className="text-slate-400 group-hover:text-blue-500" />
//                                          <span className="text-[9px] font-bold text-slate-500 uppercase tracking-widest text-center">
//                                            {exp.experience_letter_path ? "Node Attachment Present" : (exp.expLetterFile ? exp.expLetterFile.name : "Drop PDF Validation")}
//                                          </span>
//                                          <input type="file" accept=".pdf" className="hidden" onChange={(e) => { const u = [...formData.experiences]; u[i].expLetterFile = e.target.files[0]; setFormData({ ...formData, experiences: u }); }} />
//                                        </label>
//                                      ) : (
//                                        <div className="relative"><LinkIcon size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input placeholder="URI Storage Link" value={exp.exp_letter_link || exp.experience_letter_path || ""} onChange={(e) => { const u = [...formData.experiences]; u[i].exp_letter_link = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle + " pl-11"} /></div>
//                                      )}
//                                    </div>
//                                 </div>
//                              </div>
//                              <div className="flex justify-end pt-2 border-t border-slate-50"><button type="button" onClick={() => toast.success("Node Details Saved")} className="flex items-center gap-2 px-8 py-3 bg-emerald-50 text-emerald-600 border border-emerald-100 rounded-2xl text-[10px] font-black uppercase hover:bg-emerald-500 hover:text-white transition-all active:scale-95 shadow-sm"><Check size={16} strokeWidth={3} /> Save Record</button></div>
//                           </div>
//                         ))
//                        ) : (
//                          <div className="py-20 text-center bg-slate-50 border-2 border-dashed border-slate-200 rounded-[3rem]"><History size={32} className="mx-auto text-slate-300 mb-4"/><p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">No Employment Artifacts Submited</p></div>
//                        )}
//                     </div>
//                   </div>
//                 )}
//                 <div className="flex justify-between pt-4"><button onClick={() => setStep(2)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase shadow-sm transition-all hover:text-slate-900 flex items-center gap-2"><ChevronLeft size={16}/> Back</button><button onClick={() => setStep(4)} type="button" disabled={isFresher === null} className={`px-12 py-4 rounded-2xl text-xs font-black uppercase shadow-xl transition-all active:scale-95 ${isFresher !== null ? "bg-blue-600 text-white shadow-blue-600/30" : "bg-slate-200 text-slate-400 cursor-not-allowed"}`}>Next Phase â†’</button></div>
//               </div>
//             )}

//             {/* STEP 4: CAREER */}
// {step === 4 && (
//   <div ref={careerStepRef} className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-12 animate-in slide-in-from-right-8 overflow-visible">
//     <div className="flex items-center gap-4 pb-4 border-b border-slate-100"><Award size={20} className="text-blue-600" /><h3 className="text-[14px] font-black text-slate-900 uppercase tracking-widest">Career Hub</h3></div>
//     <div className="grid grid-cols-1 md:grid-cols-2 gap-12 overflow-visible">
//       <FormField label="Assigned Position"><div className="relative overflow-visible"><div className="relative group"><input placeholder="Select role..." value={formData.position} onFocus={() => { setShowSkillDrop(true); setShowAssetDrop(false); setSkillFocused(false); }} onChange={(e) => setFormData({ ...formData, position: e.target.value })} className={inputStyle} /><ChevronDown size={16} className={`absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 transition-transform ${showSkillDrop ? 'rotate-180' : ''}`} /></div>
//       {showSkillDrop && (<div className="absolute z-[100] w-full mt-2 bg-white border border-slate-200 rounded-3xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 max-h-60 overflow-y-auto no-scrollbar">{POSITION_OPTIONS.filter(p => p.toLowerCase().includes(formData.position.toLowerCase())).map((pos, i) => (<div key={i} onMouseDown={(e) => { e.preventDefault(); setFormData({ ...formData, position: pos }); setShowSkillDrop(false); }} className="px-6 py-4 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-700 cursor-pointer border-b last:border-none transition-colors">{pos}</div>))}</div>)}</div></FormField>
//       <FormField label="Seniority (Years)"><input type="number" value={formData.experience} onFocus={() => { setShowSkillDrop(false); setShowAssetDrop(false); setSkillFocused(false); }} onChange={(e) => setFormData({ ...formData, experience: e.target.value })} className={inputStyle} /></FormField>
//     </div>
//     <div className="grid grid-cols-1 md:grid-cols-2 gap-12 overflow-visible">
//       <FormField label="Education"><div className="relative overflow-visible"><div className="relative group"><input placeholder="Search degree..." value={eduSearch || formData.education} onFocus={() => { setShowAssetDrop(true); setShowSkillDrop(false); setSkillFocused(false); }} onChange={(e) => { setEduSearch(e.target.value); setFormData({ ...formData, education: e.target.value }); }} className={inputStyle} /><ChevronDown size={16} className={`absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 transition-transform ${showAssetDrop ? 'rotate-180' : ''}`} /></div>
//       {showAssetDrop && (<div className="absolute z-[100] w-full mt-2 bg-white border border-slate-200 rounded-3xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 max-h-60 overflow-y-auto no-scrollbar">{filteredEducation.map((e, i) => (<div key={i} onMouseDown={(ev) => { ev.preventDefault(); setFormData({ ...formData, education: e }); setEduSearch(""); setShowAssetDrop(false); }} className="px-6 py-4 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-600 cursor-pointer border-b last:border-none">{e}</div>))}</div>)}</div></FormField>
//       <FormField label="Department"><div className="relative overflow-visible"><div className="relative group"><input placeholder="Search..." value={deptSearch || formData.department} onFocus={() => { setSkillFocused(true); setShowSkillDrop(false); setShowAssetDrop(false); }} onChange={(e) => { setDeptSearch(e.target.value); setFormData({ ...formData, department: e.target.value }); }} className={inputStyle} /><ChevronDown size={16} className={`absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 transition-transform ${skillFocused ? 'rotate-180' : ''}`} /></div>
//       {skillFocused && (<div className="absolute z-[100] w-full mt-2 bg-white border border-slate-200 rounded-3xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 max-h-60 overflow-y-auto no-scrollbar">{filteredDepartments.map((d) => (<div key={d.id} onMouseDown={(ev) => { ev.preventDefault(); setFormData({ ...formData, department: d.name }); setDeptSearch(""); setSkillFocused(false); }} className="px-6 py-4 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-700 cursor-pointer border-b last:border-none">{d.name}</div>))}</div>)}</div></FormField>
//     </div>
//     <div className="flex justify-between pt-8 border-t border-slate-50"><button onClick={() => setStep(3)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[11px] font-black uppercase transition-all shadow-sm">â† Back</button><button onClick={() => setStep(5)} type="button" className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-[11px] font-black uppercase shadow-xl transition-all">Next Phase â†’</button></div>
//   </div>
// )}

//             {/* STEP 5: INVENTORY */}
// {step === 5 && (
//   <div className="space-y-8 animate-in slide-in-from-right-8 overflow-visible">
//     <div className="bg-white border border-slate-200 rounded-[3.5rem] shadow-xl overflow-visible shadow-slate-200/50">
//       <div className="bg-slate-50/50 px-10 py-6 border-b border-slate-200 flex items-center justify-between rounded-t-[3.5rem]"><div className="flex items-center gap-4"><div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg"><Cpu size={20} /></div><div><h3 className="text-sm font-black text-slate-900 uppercase tracking-widest leading-none">Inventory Matrix</h3><p className="text-[10px] font-bold text-slate-400 uppercase mt-0.5">Hydrate node expertise</p></div></div></div>
//       <div className="p-8 md:p-12 space-y-12 overflow-visible">
//         <FormField label="Technical Matrix"><div className="space-y-6"><div className="flex flex-col sm:flex-row gap-4 items-end"><div className="relative max-w-md w-full"><Plus size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={skillInput} onChange={(e) => setSkillInput(e.target.value)} onKeyDown={(e) => { if(e.key === 'Enter') { e.preventDefault(); handleManualAddSkill(); } }} placeholder="Register skill..." className={inputStyle + " pl-12"} /></div><button type="button" onClick={handleManualAddSkill} className="px-6 py-3.5 bg-slate-900 hover:bg-blue-600 text-white rounded-2xl transition-all flex items-center gap-2 text-[10px] font-black uppercase tracking-widest shadow-lg"><Database size={14} /> Sync Registry</button></div><div className="flex flex-wrap gap-3 p-1">{dynamicSkills.map((skill) => { const isSelected = formData.skills.includes(skill); return (<button key={skill} type="button" onClick={() => setFormData({...formData, skills: isSelected ? formData.skills.filter(s => s !== skill) : [...formData.skills, skill]})} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black border-2 active:scale-90 ${isSelected ? "bg-blue-600 border-blue-600 text-white shadow-lg" : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`}>{skill} {isSelected && <Check size={14} strokeWidth={3} />}</button>); })}</div></div></FormField>
//         <FormField label="Hardware Inventory"><div className="space-y-6 pt-8 border-t border-slate-100"><div className="relative max-w-md w-full"><Layers size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={assetInput} onChange={(e) => setAssetInput(e.target.value)} onKeyDown={async (e) => { if(e.key === 'Enter') { e.preventDefault(); const v = assetInput.trim(); if(v && !formData.assets.includes(v)) { const ok = await handleAddAssetAPI(v); if(ok) { setFormData({...formData, assets: [...formData.assets, v]}); setAssetInput(""); } } } }} placeholder="Assign asset..." className={inputStyle + " pl-12"} /></div><div className="flex flex-wrap gap-3 p-1">{dynamicAssets.map((asset) => { const isSelected = formData.assets.includes(asset); return (<button key={asset} type="button" onClick={async () => { if(!isSelected) { const ok = await handleAddAssetAPI(asset); if(ok) setFormData({...formData, assets: [...formData.assets, asset]}); } else { setFormData({...formData, assets: formData.assets.filter(a => a !== asset)}); } }} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all border-2 active:scale-90 ${isSelected ? "bg-slate-900 text-white shadow-lg" : "bg-white border-slate-100 text-slate-500"}`}>{asset} {isSelected && <Check size={14} strokeWidth={3} />}</button>); })}</div></div></FormField>
//       </div>
//     </div>
//     <div className="flex justify-between items-center pt-4"><button onClick={() => setStep(4)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase transition-all shadow-sm hover:text-slate-900 flex items-center gap-2"><ChevronLeft size={16}/> Previous Phase</button><button onClick={() => setStep(6)} type="button" className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase shadow-xl active:scale-95 flex items-center gap-2">Vault Registry <ChevronRight size={16}/></button></div>
//   </div>
// )}

//             {/* STEP 6: DOCUMENT VAULT */}
//             {step === 6 && (
//               <div className="space-y-8 animate-in slide-in-from-bottom-12 duration-700">
//                 <div className="bg-white p-8 md:p-16 rounded-[4rem] shadow-xl shadow-slate-200/60 border border-slate-200 space-y-12 overflow-hidden relative">
//                   <div className="absolute top-0 right-0 p-12 text-slate-100 opacity-40 rotate-12 scale-150"><ShieldCheck size={240} /></div>
//                   <div className="flex items-center gap-5 pb-8 border-b border-slate-100 relative z-10"><div className="h-14 w-14 bg-blue-600 rounded-2xl flex items-center justify-center shadow-lg"><ShieldCheck size={28} className="text-white" /></div><div><h3 className="text-xl font-black text-slate-900 uppercase tracking-widest leading-none">Registry Artifacts</h3><p className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mt-2">Document Verification Matrix</p></div></div>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-16 relative z-10">
//                     <div className="space-y-8 p-1"><div className="flex justify-between items-center"><p className="text-[11px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2"><span className="h-1.5 w-1.5 rounded-full bg-blue-600" /> Resume Profile</p><div className="flex bg-slate-50 p-1 rounded-xl border border-slate-200"><button type="button" onClick={() => setResumeMode("file")} className={`px-5 py-2 text-[10px] font-black rounded-lg transition-all ${resumeMode === 'file' ? 'bg-white text-slate-900 shadow-sm border' : 'text-slate-400'}`}>FILE</button><button type="button" onClick={() => setResumeMode("link")} className={`px-5 py-2 text-[10px] font-black rounded-lg transition-all ${resumeMode === 'link' ? 'bg-white text-slate-900 shadow-sm border' : 'text-slate-400'}`}>URL</button></div></div>
//                     {resumeMode === 'file' ? (<label className="block p-12 border-2 border-dashed border-slate-200 rounded-[3rem] hover:border-blue-500 transition-all cursor-pointer group text-center bg-white shadow-inner"><FileUp size={40} className="mx-auto text-slate-300 group-hover:text-blue-500 mb-5 duration-500" /><p className="text-[10px] font-black text-slate-900 uppercase truncate px-4">{formData.cvFile ? formData.cvFile.name : "Select Resume PDF"}</p><input type="file" accept=".pdf" className="hidden" onChange={(e) => setFormData({...formData, cvFile: e.target.files[0], resume_link: ""})} /></label>) : <input placeholder="Cloud URI Link" value={formData.resume_link} onChange={(e) => setFormData({...formData, resume_link: e.target.value, cvFile: null})} className={inputStyle} />}</div>
//                     <div className="space-y-8 p-1"><div className="flex justify-between items-center"><p className="text-[11px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2"><span className="h-1.5 w-1.5 rounded-full bg-slate-400" /> Validation Node</p></div><div className="text-xs text-slate-400 font-bold uppercase leading-relaxed p-6 bg-slate-50 rounded-3xl border border-dashed shadow-inner">Candidate hydrated from Node {effectiveId}. Final PATCH Synchronize will commit registry artifacts to database repository.</div></div>
//                   </div>
//                   <div className="pt-16 border-t border-slate-100 flex flex-col items-center gap-8 relative z-10"><button type="submit" disabled={loading} className="w-full md:max-w-xl flex items-center justify-center gap-5 bg-blue-600 hover:bg-blue-700 text-white font-black py-7 rounded-[3rem] shadow-2xl active:scale-[0.98] uppercase tracking-widest disabled:opacity-50">{loading ? <Loader2 className="animate-spin" size={28} /> : <><Database size={24} /><span>Finalize PATCH Sync</span></>}</button><button type="button" onClick={() => setStep(5)} className="text-[10px] font-black text-slate-400 uppercase tracking-widest hover:text-slate-900 flex items-center gap-2 transition-all"><ChevronLeft size={16}/> Return to Previous Module</button></div>
//                 </div>
//               </div>
//             )}
//           </div>
//         </form>
//       </div>
//       <style dangerouslySetInnerHTML={{ __html: `.custom-scrollbar-professional::-webkit-scrollbar { width: 6px; }.custom-scrollbar-professional::-webkit-scrollbar-track { background: transparent; }.custom-scrollbar-professional::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 20px; }.custom-scrollbar-professional::-webkit-scrollbar-thumb:hover { background: #CBD5E1; }`}} />
//     </div>
//   );
// };

// export default ManualEntryPage;

/******************************************************************************* */
// import React, { useState, useEffect, useRef } from "react";
// import { useParams, useNavigate } from "react-router-dom";
// import {
//   Check, Award, User, Briefcase, MapPin, Loader2, Plus, Trash2, Layers, Cpu, Database,
//   Globe, ShieldCheck, History, X, LinkIcon, FileUp, ChevronRight, ChevronLeft, ChevronDown
// } from "lucide-react";
// import toast from "react-hot-toast";
// import { candidateService } from "../../services/candidateService";
// import { departmentService } from "../../services/department.service";

// const FormField = ({ label, required, error, children }) => (
//   <div className="space-y-1.5 w-full">
//     <label className="text-[10px] md:text-[11px] font-black text-slate-500 uppercase tracking-widest ml-1 flex justify-between items-center">
//       <span>{label}</span>
//       <span className={`font-bold normal-case ${required ? "text-red-500" : "text-slate-300"}`}>
//         {required ? "Required" : "Optional"}
//       </span>
//     </label>
//     {children}
//     {error && <p className="text-[9px] text-red-500 font-bold uppercase tracking-tighter ml-1">{error}</p>}
//   </div>
// );

// const ManualEntryPage = () => {
//   const { id } = useParams();
//   const navigate = useNavigate();
//   const effectiveId = id || "666";

//   // --- STYLES ---
//   const inputStyle = "w-full px-5 py-3 bg-slate-50 border border-slate-200 rounded-2xl text-[13px] font-bold outline-none focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-500/5 transition-all shadow-sm";

//   // --- STATES ---
//   const [step, setStep] = useState(1);
//   const [loading, setLoading] = useState(false);
//   const [fetchingData, setFetchingData] = useState(false);
//   const [errors, setErrors] = useState({});
//   const [isFetchingPincode, setIsFetchingPincode] = useState(false);
//   const [cityOptions, setCityOptions] = useState([]);
//   const [resumeMode, setResumeMode] = useState("file");
//   const [skillInput, setSkillInput] = useState("");
//   const [assetInput, setAssetInput] = useState("");
//   const [isFresher, setIsFresher] = useState(null);
//   const [deptSearch, setDeptSearch] = useState("");
//   const [eduSearch, setEduSearch] = useState("");
//   const [dynamicSkills, setDynamicSkills] = useState([]);
//   const [dynamicAssets, setDynamicAssets] = useState([]);
//   const [showSkillDrop, setShowSkillDrop] = useState(false);
//   const [showAssetDrop, setShowAssetDrop] = useState(false);
//   const [skillFocused, setSkillFocused] = useState(false);
//   const [departments, setDepartments] = useState([]);

//   const dropdownContainerRef = useRef(null);
//   const careerStepRef = useRef(null);

//   const [formData, setFormData] = useState({
//     name: "", email: "", phone: "", address1: "", address2: "", location: "",
//     pincode: "", state: "", city: "", district: "", country: "India", position: "",
//     education: "", gender: "", dob: "", experience: "", about_me: "",
//     languages_spoken: [], skills: [], assets: [], department: "",
//     cvFile: null, resume_link: "", certificateFiles: [], certificateLinks: [""], experiences: [],
//   });

//   const totalSteps = 5;
//   const POSITION_OPTIONS = ["Frontend Developer", "Backend Developer", "Full Stack Developer", "HR Executive", "UI/UX Designer", "DevOps Engineer"];
//   const educationOptions = ["B.Tech", "M.Tech", "B.Sc", "M.Sc", "BCA", "MCA", "MBA", "Diploma", "PhD"];

//   const filteredEducation = educationOptions.filter(e => e.toLowerCase().includes(eduSearch.toLowerCase()));
//   const filteredDepartments = departments.filter(d => (d.name || "").toLowerCase().includes(deptSearch.toLowerCase()));
//   const isStep1Valid = formData.name && formData.email && formData.phone && formData.position && formData.education;

//   // --- HYDRATION LOGIC (GET CANDIDATE 666) ---
//   useEffect(() => {
//     const hydrateData = async () => {
//       setFetchingData(true);
//       try {
//         const response = await fetch(`https://apihrr.goelectronix.co.in/candidates/${effectiveId}`);
//         const data = await response.json();

//         if (data) {
//           const safeParse = (str) => {
//             try { return str ? JSON.parse(str) : []; } catch { return []; }
//           };

//           setFormData({
//             ...formData,
//             name: data.full_name || "",
//             email: data.email || "",
//             phone: data.phone || "",
//             gender: data.gender || "",
//             dob: data.dob || "",
//             address1: data.address1 || "",
//             address2: data.address2 || "",
//             location: data.location || "",
//             pincode: data.pincode || "",
//             city: data.city || "",
//             state: data.state || "",
//             district: data.district || "",
//             country: data.country || "India",
//             position: data.position || "",
//             experience: data.experience || "",
//             education: data.education || "",
//             department: data.department || "",
//             about_me: data.about_me || "",
//             resume_link: data.resume_link || "",
//             languages_spoken: safeParse(data.languages_spoken),
//             experiences: safeParse(data.experience_details),
//             skills: safeParse(data.skills),
//             assets: safeParse(data.assets),
//           });

//           if (safeParse(data.experience_details).length > 0) setIsFresher(false);
//           else if (data.experience_details) setIsFresher(true);
//         }

//         const deptData = await departmentService.getAll();
//         setDepartments(deptData || []);
//         fetchSkills();
//         fetchAssets(effectiveId);
//       } catch (err) {
//         toast.error("Candidate node not found");
//       } finally {
//         setFetchingData(false);
//       }
//     };
//     hydrateData();
//   }, [effectiveId]);

//   // Click Outside logic
//   useEffect(() => {
//     const handleClickOutside = (event) => {
//       if (dropdownContainerRef.current && !dropdownContainerRef.current.contains(event.target)) {
//         setShowSkillDrop(false);
//         setShowAssetDrop(false);
//         setSkillFocused(false);
//       }
//     };
//     document.addEventListener("click", handleClickOutside);
//     return () => document.removeEventListener("click", handleClickOutside);
//   }, []);

//   // --- API HANDLERS ---
//   const fetchSkills = async () => {
//     try {
//       const response = await fetch("https://apihrr.goelectronix.co.in/masters/skills");
//       const data = await response.json();
//       setDynamicSkills(data.map(item => item.name || item));
//     } catch {}
//   };

//   const fetchAssets = async (cId) => {
//     try {
//       const response = await fetch(`https://apihrr.goelectronix.co.in/candidates/${cId}/assets`);
//       const data = await response.json();
//       setDynamicAssets(Array.isArray(data) ? data.map(a => a.name) : []);
//     } catch {}
//   };

//   const handleManualAddSkill = async () => {
//     const name = skillInput.trim();
//     if (!name) { await fetchSkills(); return; }
//     const success = await handleCreateMaster("skills", name);
//     if (success) {
//       if (!formData.skills.includes(name)) setFormData(p => ({ ...p, skills: [...p.skills, name] }));
//       setSkillInput("");
//       await fetchSkills();
//     }
//   };

//   const handleCreateMaster = async (type, name) => {
//     try {
//       const res = await fetch(`https://apihrr.goelectronix.co.in/masters/${type}`, {
//         method: "POST",
//         headers: { "Content-Type": "application/json" },
//         body: JSON.stringify({ name: name.trim() }),
//       });
//       return res.ok;
//     } catch { return false; }
//   };

//   const handleAddAssetAPI = async (assetName) => {
//     if (!assetName.trim()) return;
//     const loadingToast = toast.loading(`Linking asset...`);
//     try {
//       const res = await fetch(`https://apihrr.goelectronix.co.in/candidates/${effectiveId}/assets`, {
//         method: "POST",
//         headers: { "Content-Type": "application/json" },
//         body: JSON.stringify({ name: assetName.trim() }),
//       });
//       if (res.ok) {
//         toast.success("Asset Assigned", { id: loadingToast });
//         fetchAssets(effectiveId);
//         return true;
//       }
//     } catch { toast.error("Sync Failed", { id: loadingToast }); }
//     return false;
//   };

//   const fetchPincodeDetails = async (pincode) => {
//     if (!/^\d{6}$/.test(pincode)) return;
//     setIsFetchingPincode(true);
//     try {
//       const res = await fetch(`https://api.postalpincode.in/pincode/${pincode}`);
//       const data = await res.json();
//       if (data[0]?.Status === "Success") {
//         setCityOptions(data[0].PostOffice.map(o => o.Name));
//         const first = data[0].PostOffice[0];
//         setFormData(p => ({ ...p, city: first.Name, state: first.State, district: first.District }));
//       }
//     } finally { setIsFetchingPincode(false); }
//   };

//   const validateField = (field, value) => {
//     let error = "";
//     if (["name", "email", "phone"].includes(field) && !value) error = "Required field";
//     setErrors(prev => ({ ...prev, [field]: error }));
//     return !error;
//   };

//   const handleSubmit = async (e) => {
//     e.preventDefault();
//     setLoading(true);
//     const loadingToast = toast.loading("Executing PATCH...");
//     try {
//       const apiData = new FormData();
//       Object.keys(formData).forEach(key => {
//         if (formData[key] && !["experiences", "certificateFiles", "languages_spoken", "cvFile", "skills", "assets"].includes(key)) {
//           apiData.append(key, formData[key]);
//         }
//       });
//       apiData.append("full_name", formData.name);
//       apiData.append("experience_details", JSON.stringify(formData.experiences));
//       apiData.append("languages_spoken", JSON.stringify(formData.languages_spoken));
//       apiData.append("skills", JSON.stringify(formData.skills));
//       apiData.append("assets", JSON.stringify(formData.assets));

//       const res = await fetch(`https://apihrr.goelectronix.co.in/candidates/${effectiveId}`, {
//         method: "PATCH",
//         body: apiData,
//       });

//       if (res.ok) {
//         toast.success("Node Synchronized ðŸŽ‰", { id: loadingToast });
//       } else throw new Error();
//     } catch {
//       toast.error("Commit Failed", { id: loadingToast });
//     } finally { setLoading(false); }
//   };

//   if (fetchingData) return (
//     <div className="min-h-screen flex flex-col items-center justify-center bg-slate-50 gap-4">
//       <Loader2 className="h-12 w-12 animate-spin text-blue-600" />
//       <p className="text-[10px] font-black uppercase tracking-[0.3em] text-slate-400">Pulling Data Node {effectiveId}...</p>
//     </div>
//   );

//   return (
//     <div className="min-h-screen bg-[#F8FAFC] p-4 md:p-12 antialiased" ref={dropdownContainerRef}>
//       <div className="max-w-6xl mx-auto space-y-6">

//         {/* HEADER */}
//         <div className="flex flex-col lg:flex-row justify-between items-center bg-white p-6 md:p-8 rounded-[2rem] border border-slate-200 shadow-xl shadow-slate-100 gap-8">
//           <div className="flex items-center gap-5">
//             <div className="h-14 w-14 bg-slate-900 rounded-2xl flex items-center justify-center text-white shadow-lg"><Database size={28} /></div>
//             <div>
//               <h2 className="text-xl font-bold text-slate-900">{id ? "Edit Registry" : "Manual Registry"}</h2>
//               <div className="flex items-center gap-2 mt-1 text-blue-600"><ShieldCheck size={14} /><p className="text-[10px] font-bold uppercase tracking-wider">Node: {effectiveId}</p></div>
//             </div>
//           </div>

//           <div className="flex-1 max-w-xl w-full px-4">
//             <div className="relative flex justify-between items-center w-full">
//               <div className="absolute top-1/2 left-0 w-full h-px bg-slate-100 -translate-y-1/2 z-0" />
//               <div className="absolute top-1/2 left-0 h-px bg-blue-600 -translate-y-1/2 z-0 transition-all duration-700" style={{ width: `${((step - 1) / (totalSteps - 1)) * 100}%` }} />
//               {[1, 2, 3, 4, 5].map((num) => (
//                 <div key={num} className="relative z-10 flex flex-col items-center gap-2">
//                   <div className={`h-7 w-7 rounded-full flex items-center justify-center text-[10px] font-bold transition-all border-2 ${step === num ? "bg-blue-600 text-white border-blue-200 scale-110 shadow-md" : step > num ? "bg-emerald-500 text-white border-emerald-100" : "bg-white text-slate-300 border-slate-100"}`}>
//                     {step > num ? <Check size={12} strokeWidth={4} /> : num}
//                   </div>
//                 </div>
//               ))}
//             </div>
//           </div>
//         </div>

//         <form onSubmit={handleSubmit}>
//           <div className="space-y-8">

//             {/* STEP 1: IDENTITY & CAREER CONTEXT (MERGED) */}
//             {step === 1 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-12 animate-in slide-in-from-right-4 duration-500">
//                 <div className="space-y-8">
//                   <div className="flex items-center gap-3 pb-3 border-b border-slate-100"><User size={18} className="text-blue-600" /><h3 className="text-xs font-bold text-slate-800 uppercase tracking-widest">Core Profile</h3></div>
//                   <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
//                     <FormField label="Full Name" required><input placeholder="Name" value={formData.name} onChange={(e) => setFormData({...formData, name: e.target.value})} className={inputStyle} /></FormField>
//                     <FormField label="Email" required><input type="email" placeholder="Email" value={formData.email} onChange={(e) => setFormData({...formData, email: e.target.value})} className={inputStyle} /></FormField>
//                     <FormField label="Phone" required><input placeholder="Mobile" value={formData.phone} onChange={(e) => setFormData({...formData, phone: e.target.value})} className={inputStyle} /></FormField>
//                     <FormField label="Gender"><select value={formData.gender} onChange={(e) => setFormData({...formData, gender: e.target.value})} className={inputStyle}><option value="">Select</option><option value="male">Male</option><option value="female">Female</option></select></FormField>
//                   </div>
//                 </div>

//                 <div className="space-y-8 pt-4 border-t border-slate-50">
//                   <div className="flex items-center gap-3 pb-3 border-b border-slate-100 text-blue-600"><Briefcase size={18}/><h3 className="text-xs font-bold text-slate-800 uppercase tracking-widest">Professional Context</h3></div>
//                   <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
//                     <FormField label="Position" required><input list="pos-opts" placeholder="Role" value={formData.position} onChange={(e) => setFormData({...formData, position: e.target.value})} className={inputStyle} /><datalist id="pos-opts">{POSITION_OPTIONS.map((p, i) => <option key={i} value={p}/>)}</datalist></FormField>
//                     <FormField label="Exp (Yrs)"><input type="number" value={formData.experience} onChange={(e) => setFormData({...formData, experience: e.target.value})} className={inputStyle} /></FormField>
//                     <FormField label="Education" required><input placeholder="Degree" value={formData.education} onChange={(e) => setFormData({...formData, education: e.target.value})} className={inputStyle} /></FormField>
//                     <FormField label="Department"><div className="relative"><input placeholder="Search..." value={deptSearch || formData.department} onChange={(e) => { setDeptSearch(e.target.value); setFormData({...formData, department: e.target.value}); }} className={inputStyle} />{deptSearch && filteredDepartments.length > 0 && <div className="absolute z-50 w-full mt-1 bg-white border border-slate-200 rounded-xl shadow-xl overflow-hidden">{filteredDepartments.map((d) => <div key={d.id} onClick={() => { setFormData({...formData, department: d.name}); setDeptSearch(""); }} className="px-4 py-2 text-xs font-medium text-slate-600 hover:bg-blue-50 cursor-pointer">{d.name}</div>)}</div>}</div></FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-end pt-4"><button type="button" disabled={!isStep1Valid} onClick={() => setStep(2)} className="px-10 py-3 bg-blue-600 text-white rounded-xl text-[11px] font-bold uppercase tracking-widest shadow-lg">Next Phase</button></div>
//               </div>
//             )}

//             {/* STEP 2: GEOGRAPHY (PREVIOUS DATA POPULATED) */}
//             {step === 2 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8">
//                 <div className="flex items-center gap-3 pb-4 border-b border-slate-100"><MapPin size={18} className="text-blue-600" /><h3 className="text-xs font-black text-slate-800 uppercase tracking-widest">Geolocation Registry</h3></div>
//                 <div className="space-y-8">
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                     <FormField label="Address line 1" required><input placeholder="Building/Street" value={formData.address1} onChange={(e) => setFormData({...formData, address1: e.target.value})} className={inputStyle} /></FormField>
//                     <FormField label="Address line 2" required><input placeholder="Landmark" value={formData.address2} onChange={(e) => setFormData({...formData, address2: e.target.value})} className={inputStyle} /></FormField>
//                   </div>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                     <FormField label="Location Area" required><input placeholder="City Hub" value={formData.location} onChange={(e) => setFormData({...formData, location: e.target.value})} className={inputStyle} /></FormField>
//                     <FormField label="Pincode Mapping" required><div className="relative"><input maxLength={6} placeholder="000000" value={formData.pincode} onChange={(e) => { const v = e.target.value.replace(/\D/g, ""); setFormData({ ...formData, pincode: v }); if (v.length === 6) fetchPincodeDetails(v); }} className={inputStyle} />{isFetchingPincode && <Loader2 size={18} className="absolute right-4 top-1/2 -translate-y-1/2 animate-spin text-blue-500" />}</div></FormField>
//                   </div>
//                   <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
//                     <FormField label="City"><div className="relative">{cityOptions.length > 1 ? (<><select value={formData.city} onChange={(e) => setFormData({ ...formData, city: e.target.value })} className={inputStyle + " appearance-none"}><option value="">Select City</option>{cityOptions.map((c, i) => (<option key={i} value={c}>{c}</option>))}</select><ChevronDown size={16} className="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400"/></>) : (<input value={formData.city} readOnly className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner" />)}</div></FormField>
//                     <FormField label="District"><input value={formData.district} readOnly className="w-full px-6 py-4 bg-slate-100 border-none rounded-2xl text-sm font-bold text-slate-500 shadow-inner" /></FormField>
//                     <FormField label="State"><input value={formData.state} readOnly className="w-full px-6 py-4 bg-slate-100 border-none rounded-2xl text-sm font-bold text-slate-500 shadow-inner" /></FormField>
//                     <FormField label="Country"><input value={formData.country} onChange={(e) => setFormData({...formData, country: e.target.value})} className={inputStyle} /></FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-between pt-8 border-t border-slate-50"><button onClick={() => setStep(1)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase shadow-sm">â† Back</button><button onClick={() => setStep(3)} type="button" className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase shadow-xl">Continue â†’</button></div>
//               </div>
//             )}

//             {/* STEP 3: EXPERIENCE (WITH PER-RECORD ACTIONS) */}
//             {step === 3 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
//                 <div className="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-sm overflow-hidden">
//                   <div className="flex flex-col md:flex-row items-center justify-between gap-6">
//                     <div className="flex items-center gap-4 text-slate-900 font-black"><Briefcase size={24} className="text-blue-600" /><div><h3 className="text-sm uppercase tracking-widest">Fresher Status?</h3><p className="text-[10px] font-bold text-slate-400 mt-1">Select current career status</p></div></div>
//                     <div className="flex bg-slate-100 p-1.5 rounded-[1.5rem] border border-slate-200 w-full md:w-auto">
//                       <button type="button" onClick={() => { setIsFresher(true); setFormData({ ...formData, experiences: [] }); }} className={`px-8 py-2.5 rounded-2xl text-[10px] font-black transition-all ${isFresher === true ? "bg-white text-blue-600 shadow-sm" : "text-slate-400"}`}>Yes, I am</button>
//                       <button type="button" onClick={() => setIsFresher(false)} className={`px-8 py-2.5 rounded-2xl text-[10px] font-black transition-all ${isFresher === false ? "bg-white text-blue-600 shadow-sm" : "text-slate-400"}`}>No, Experienced</button>
//                     </div>
//                   </div>
//                 </div>
//                 {isFresher === false && (
//                   <div className="bg-white p-6 md:p-10 rounded-[3.5rem] border border-slate-200 shadow-xl space-y-10 animate-in fade-in duration-500">
//                     <div className="flex flex-col sm:flex-row justify-between items-center border-b border-slate-100 pb-8 gap-4">
//                       <div className="flex items-center gap-4"><div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg"><History size={20} /></div><h3 className="text-sm font-black text-slate-900 uppercase">Career Timeline</h3></div>
//                       <button type="button" onClick={() => setFormData({ ...formData, experiences: [...formData.experiences, { company_name: "", job_title: "", uploadMode: "file" }] })} className="px-6 py-3 bg-slate-900 hover:bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase transition-all shadow-lg active:scale-95">+ Add Organization</button>
//                     </div>
//                     <div className="space-y-10 max-h-[600px] overflow-y-auto pr-4 custom-scrollbar-professional">
//                        {formData.experiences.map((exp, i) => (
//                          <div key={i} className="relative bg-slate-50/50 border border-slate-200 p-8 rounded-[2.5rem] space-y-8 animate-in zoom-in-95 shadow-inner">
//                             <button type="button" onClick={() => setFormData({ ...formData, experiences: formData.experiences.filter((_, idx) => idx !== i) })} className="absolute -top-3 -right-3 h-10 w-10 bg-white border border-slate-200 text-red-500 rounded-full flex items-center justify-center shadow-lg transition-all opacity-0 group-hover:opacity-100 z-20"><Trash2 size={18} /></button>
//                             <div className="grid grid-cols-1 md:grid-cols-2 gap-8"><FormField label="Employer"><input placeholder="Organization" value={exp.company_name} onChange={(e) => { const u = [...formData.experiences]; u[i].company_name = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField><FormField label="Designation"><input placeholder="Job Title" value={exp.job_title} onChange={(e) => { const u = [...formData.experiences]; u[i].job_title = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField></div>
//                             <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
//                                <FormField label="Responsibilities"><textarea rows={5} placeholder="Describe scope..." value={exp.description} onChange={(e) => { const u = [...formData.experiences]; u[i].description = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle + " resize-none min-h-[140px]"} /></FormField>
//                                <div className="space-y-3">
//                                   <div className="flex justify-between items-center px-1"><p className="text-[10px] font-black text-slate-400 uppercase">Artifact</p><div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200"><button type="button" onClick={() => { const u = [...formData.experiences]; u[i].uploadMode = "file"; setFormData({ ...formData, experiences: u }); }} className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === 'file' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>FILE</button><button type="button" onClick={() => { const u = [...formData.experiences]; u[i].uploadMode = "link"; setFormData({ ...formData, experiences: u }); }} className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === 'link' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>URL</button></div></div>
//                                   <div className="bg-white/50 border border-slate-100 rounded-3xl p-4 min-h-[140px] flex flex-col justify-center">
//                                     {exp.uploadMode === 'file' ? (<label className="flex flex-col items-center justify-center gap-3 w-full h-full border-2 border-dashed border-slate-200 rounded-2xl hover:bg-blue-50/30 transition-all cursor-pointer group p-4"><FileUp size={24} className="text-slate-400 group-hover:text-blue-500" /><span className="text-[9px] font-bold text-slate-500 uppercase tracking-widest text-center truncate px-2">{exp.expLetterFile ? exp.expLetterFile.name : "Drop PDF Validation"}</span><input type="file" accept=".pdf" className="hidden" onChange={(e) => { const u = [...formData.experiences]; u[i].expLetterFile = e.target.files[0]; setFormData({ ...formData, experiences: u }); }} /></label>) : (<div className="relative"><LinkIcon size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input placeholder="Storage URI Link" value={exp.exp_letter_link} onChange={(e) => { const u = [...formData.experiences]; u[i].exp_letter_link = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle + " pl-11"} /></div>)}
//                                   </div>
//                                </div>
//                             </div>
//                             <div className="flex justify-end pt-2 border-t border-slate-50"><button type="button" onClick={() => toast.success("Node Updated")} className="flex items-center gap-2 px-8 py-3 bg-emerald-50 text-emerald-600 border border-emerald-100 rounded-2xl text-[10px] font-black uppercase hover:bg-emerald-500 hover:text-white transition-all active:scale-95 shadow-sm"><Check size={16} strokeWidth={3} /> Save Record</button></div>
//                          </div>
//                        ))}
//                     </div>
//                   </div>
//                 )}
//                 <div className="flex justify-between pt-4"><button onClick={() => setStep(2)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase shadow-sm hover:text-slate-900 transition-all">â† Back</button><button onClick={() => setStep(4)} type="button" disabled={isFresher === null} className={`px-12 py-4 rounded-2xl text-xs font-black uppercase shadow-xl transition-all active:scale-95 ${isFresher !== null ? "bg-blue-600 text-white" : "bg-slate-200 text-slate-400 cursor-not-allowed"}`}>Next Phase â†’</button></div>
//               </div>
//             )}

//             {/* STEP 4: INVENTORY (DYNAMIC SYNC) */}
//             {step === 4 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 overflow-visible">
//                 <div className="bg-white border border-slate-200 rounded-[3.5rem] shadow-xl overflow-visible shadow-slate-200/50">
//                   <div className="bg-slate-50/50 px-10 py-6 border-b border-slate-200 flex items-center justify-between rounded-t-[3.5rem]"><div className="flex items-center gap-4"><div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg"><Cpu size={20} /></div><div><h3 className="text-sm font-black text-slate-900 uppercase tracking-widest leading-none">Expertise Matrix</h3><p className="text-[10px] font-bold text-slate-400 uppercase mt-0.5">Manage skills and physical assets</p></div></div></div>
//                   <div className="p-8 md:p-12 space-y-12 overflow-visible">
//                     <FormField label="Technical Matrix"><div className="space-y-6"><div className="flex flex-col sm:flex-row gap-4 items-end"><div className="relative max-w-md w-full"><Plus size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={skillInput} onChange={(e) => setSkillInput(e.target.value)} onKeyDown={(e) => { if(e.key === 'Enter') { e.preventDefault(); handleManualAddSkill(); } }} placeholder="Register skill..." className={inputStyle + " pl-12"} /></div><button type="button" onClick={handleManualAddSkill} className="px-6 py-3.5 bg-slate-900 hover:bg-blue-600 text-white rounded-2xl transition-all flex items-center gap-2 text-[10px] font-black uppercase shadow-lg"><Database size={14} /> Sync Registry</button></div><div className="flex flex-wrap gap-3 p-1">{dynamicSkills.map((skill) => { const isSelected = formData.skills.includes(skill); return (<button key={skill} type="button" onClick={() => setFormData({...formData, skills: isSelected ? formData.skills.filter(s => s !== skill) : [...formData.skills, skill]})} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${isSelected ? "bg-blue-600 border-blue-600 text-white shadow-lg shadow-blue-200" : "bg-white border-slate-100 text-slate-500 hover:border-blue-200 hover:text-blue-600"}`}>{skill} {isSelected && <Check size={14} strokeWidth={3} />}</button>); })}</div></div></FormField>
//                     <FormField label="Hardware Matrix"><div className="space-y-6 pt-8 border-t border-slate-100"><div className="relative max-w-md w-full"><Layers size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={assetInput} onChange={(e) => setAssetInput(e.target.value)} onKeyDown={async (e) => { if(e.key === 'Enter') { e.preventDefault(); const v = assetInput.trim(); if(v && !formData.assets.includes(v)) { const ok = await handleAddAssetAPI(v); if(ok) { setFormData({...formData, assets: [...formData.assets, v]}); setAssetInput(""); } } } }} placeholder="Link hardware..." className={inputStyle + " pl-12"} /></div><div className="flex flex-wrap gap-3 p-1">{dynamicAssets.map((asset) => { const isSelected = formData.assets.includes(asset); return (<button key={asset} type="button" onClick={async () => { if(!isSelected) { const ok = await handleAddAssetAPI(asset); if(ok) setFormData({...formData, assets: [...formData.assets, asset]}); } else { setFormData({...formData, assets: formData.assets.filter(a => a !== asset)}); } }} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase border-2 active:scale-90 transition-all ${isSelected ? "bg-slate-900 text-white shadow-lg" : "bg-white border-slate-100 text-slate-500"}`}>{asset} {isSelected && <Check size={14} strokeWidth={3} />}</button>); })}</div></div></FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-between items-center pt-4"><button onClick={() => setStep(3)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-[1.5rem] text-xs font-black uppercase tracking-widest hover:text-slate-900 transition-all shadow-sm flex items-center gap-2"><ChevronLeft size={16}/> Previous Phase</button><button onClick={() => setStep(5)} type="button" className="px-12 py-4 bg-blue-600 text-white rounded-[1.5rem] text-xs font-black uppercase shadow-xl active:scale-95 flex items-center gap-2 transition-all">Vault Registry <ChevronRight size={16}/></button></div>
//               </div>
//             )}

//             {/* STEP 5: DOCUMENT VAULT */}
//             {step === 5 && (
//               <div className="space-y-8 animate-in slide-in-from-bottom-12 duration-700">
//                 <div className="bg-white p-8 md:p-16 rounded-[4rem] shadow-xl shadow-slate-200/60 border border-slate-200 space-y-12 overflow-hidden relative">
//                   <div className="absolute top-0 right-0 p-12 text-slate-100 opacity-40 rotate-12 scale-150"><ShieldCheck size={240} /></div>
//                   <div className="flex items-center gap-5 pb-8 border-b border-slate-100 relative z-10"><div className="h-14 w-14 bg-blue-600 rounded-2xl flex items-center justify-center shadow-lg"><ShieldCheck size={28} className="text-white" /></div><div><h3 className="text-xl font-black text-slate-900 uppercase tracking-widest leading-none">Registry Artifacts</h3><p className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mt-2">Document Verification Matrix</p></div></div>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-16 relative z-10">
//                     <div className="space-y-8 p-1"><div className="flex justify-between items-center"><p className="text-[11px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2"><span className="h-1.5 w-1.5 rounded-full bg-blue-600" /> Resume Profile</p><div className="flex bg-slate-50 p-1 rounded-xl border border-slate-200"><button type="button" onClick={() => setResumeMode("file")} className={`px-5 py-2 text-[10px] font-black rounded-lg transition-all ${resumeMode === 'file' ? 'bg-white text-slate-900 shadow-sm border' : 'text-slate-400'}`}>FILE</button><button type="button" onClick={() => setResumeMode("link")} className={`px-5 py-2 text-[10px] font-black rounded-lg transition-all ${resumeMode === 'link' ? 'bg-white text-slate-900 shadow-sm border' : 'text-slate-400'}`}>URL</button></div></div>
//                     {resumeMode === 'file' ? (<label className="block p-12 border-2 border-dashed border-slate-200 rounded-[3rem] hover:border-blue-500 transition-all cursor-pointer group text-center bg-white"><FileUp size={40} className="mx-auto text-slate-300 group-hover:text-blue-500 mb-5 duration-500" /><p className="text-[10px] font-black text-slate-900 uppercase truncate px-4">{formData.cvFile ? formData.cvFile.name : "Select Resume PDF"}</p><input type="file" accept=".pdf" className="hidden" onChange={(e) => setFormData({...formData, cvFile: e.target.files[0], resume_link: ""})} /></label>) : <input placeholder="Enter Public Storage Link" value={formData.resume_link} onChange={(e) => setFormData({...formData, resume_link: e.target.value, cvFile: null})} className={inputStyle} />}</div>
//                     <div className="space-y-8 p-1"><div className="flex justify-between items-center"><p className="text-[11px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2"><span className="h-1.5 w-1.5 rounded-full bg-slate-400" /> Registry Node</p></div><div className="text-xs text-slate-400 font-bold uppercase leading-relaxed p-6 bg-slate-50 rounded-3xl border border-dashed border-slate-200 shadow-inner">Data hydrated from Candidate 666. Final PATCH Synchronization will commit state changes to candidate repository. Ensure all artifacts are valid.</div></div>
//                   </div>
//                   <div className="pt-16 border-t border-slate-100 flex flex-col items-center gap-8 relative z-10"><button type="submit" disabled={loading} className="w-full md:max-w-xl flex items-center justify-center gap-5 bg-blue-600 hover:bg-blue-700 text-white font-black py-7 rounded-[3rem] shadow-2xl active:scale-[0.98] uppercase disabled:opacity-50">{loading ? <Loader2 className="animate-spin" size={28} /> : <><Database size={24} /><span>Finalize Patch Commit</span></>}</button><button type="button" onClick={() => setStep(4)} className="text-[10px] font-black text-slate-400 uppercase tracking-widest hover:text-slate-900 flex items-center gap-2 transition-all"><ChevronLeft size={16}/> Return to Expertise</button></div>
//                 </div>
//               </div>
//             )}
//           </div>
//         </form>
//       </div>
//       <style dangerouslySetInnerHTML={{ __html: `.custom-scrollbar-professional::-webkit-scrollbar { width: 6px; }.custom-scrollbar-professional::-webkit-scrollbar-track { background: transparent; }.custom-scrollbar-professional::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 20px; }.custom-scrollbar-professional::-webkit-scrollbar-thumb:hover { background: #CBD5E1; }`}} />
//     </div>
//   );
// };

// export default ManualEntryPage;

// import React, { useState, useEffect, useRef } from "react";
// import { useParams, useNavigate } from "react-router-dom"; // Added for routing
// import {
//   Check, FileText, Award, User, Briefcase, MapPin, Mail, Phone,
//   Loader2, Plus, Trash2, Layers, Cpu, ExternalLink, Database,
//   Globe, ShieldCheck, History, X, LinkIcon, FileUp, ChevronRight, ChevronLeft, ChevronDown
// } from "lucide-react";
// import toast from "react-hot-toast";
// import { candidateService } from "../../services/candidateService";
// import { departmentService } from "../../services/department.service";

// const FormField = ({ label, required, error, children }) => (
//   <div className="space-y-1.5 w-full">
//     <label className="text-[10px] md:text-[11px] font-black text-slate-500 uppercase tracking-widest ml-1 flex justify-between items-center">
//       <span>{label}</span>
//       <span className={`font-bold normal-case ${required ? "text-red-500" : "text-slate-300"}`}>
//         {required ? "Required" : "Optional"}
//       </span>
//     </label>
//     {children}
//     {error && <p className="text-[9px] text-red-500 font-bold uppercase tracking-tighter ml-1">{error}</p>}
//   </div>
// );

// const ManualEntryPage = () => {
//   const { id } = useParams(); // Capture the ID from /editentry/:id
//   const navigate = useNavigate();

//   // 1. INITIALIZE ALL STATES
//   const [step, setStep] = useState(1);
//   const [loading, setLoading] = useState(false);
//   const [fetchingData, setFetchingData] = useState(false); // New state for loading existing data
//   const [errors, setErrors] = useState({});
//   const [isFetchingPincode, setIsFetchingPincode] = useState(false);
//   const [cityOptions, setCityOptions] = useState([]);
//   const [resumeMode, setResumeMode] = useState("file");
//   const [skillInput, setSkillInput] = useState("");
//   const [assetInput, setAssetInput] = useState("");
//   const [isFresher, setIsFresher] = useState(null);
//   const [deptSearch, setDeptSearch] = useState("");
//   const [eduSearch, setEduSearch] = useState("");
//   const dropdownContainerRef = useRef(null);
//   const careerStepRef = useRef(null);
//   const [dynamicSkills, setDynamicSkills] = useState([]);
//   const [dynamicAssets, setDynamicAssets] = useState([]);
//   const [showSkillDrop, setShowSkillDrop] = useState(false);
//   const [showAssetDrop, setShowAssetDrop] = useState(false);
//   const [skillFocused, setSkillFocused] = useState(false);
//   const [departments, setDepartments] = useState([]);

//   const [formData, setFormData] = useState({
//     name: "", email: "", phone: "", address1: "", address2: "", location: "",
//     pincode: "", state: "", city: "", district: "", country: "India", position: "",
//     education: "", gender: "", dob: "", experience: "", about_me: "",
//     languages_spoken: [], skills: [], assets: [], department: "",
//     cvFile: null, resume_link: "", certificateFiles: [], certificateLinks: [""], experiences: [],
//   });

//   // 2. STATIC DATA
//   const totalSteps = 6;
//   const POSITION_OPTIONS = ["Frontend Developer", "Backend Developer", "Full Stack Developer", "HR Executive", "UI/UX Designer", "DevOps Engineer", "Data Analyst"];
//   const educationOptions = ["B.Tech", "M.Tech", "B.Sc", "M.Sc", "BCA", "MCA", "MBA", "Diploma", "PhD"];

//   const filteredEducation = educationOptions.filter(e => e.toLowerCase().includes(eduSearch.toLowerCase()));
//   const filteredDepartments = departments.filter(d => (d.name || "").toLowerCase().includes(deptSearch.toLowerCase()));
//   const isStep1Valid = formData.name && /^\S+@\S+\.\S+$/.test(formData.email) && formData.phone;

//   // 3. EFFECTS
//   useEffect(() => { window.scrollTo({ top: 0, behavior: "smooth" }); }, [step]);

//   useEffect(() => {
//     const loadInitialData = async () => {
//       try {
//         const deptData = await departmentService.getAll();
//         setDepartments(deptData || []);
//         await fetchSkills();

//         // IF IN EDIT MODE (ID EXISTS)
//         if (id) {
//           setFetchingData(true);
//           const candidateData = await candidateService.getById(id); // Ensure this method exists in your service
//           if (candidateData) {
//             setFormData({
//               ...formData,
//               ...candidateData,
//               name: candidateData.full_name || "",
//               experiences: candidateData.experience_details ? JSON.parse(candidateData.experience_details) : [],
//               skills: candidateData.skills ? JSON.parse(candidateData.skills) : [],
//               assets: candidateData.assets ? JSON.parse(candidateData.assets) : [],
//               languages_spoken: candidateData.languages_spoken ? JSON.parse(candidateData.languages_spoken) : [],
//             });
//             if (candidateData.experience_details && JSON.parse(candidateData.experience_details).length > 0) {
//               setIsFresher(false);
//             }
//           }
//           await fetchAssets(id);
//         }
//       } catch (err) { toast.error("Failed to load registry data"); }
//       finally { setFetchingData(false); }
//     };
//     loadInitialData();
//   }, [id]);

//   useEffect(() => {
//     const handleClickOutside = (event) => {
//       if (dropdownContainerRef.current && !dropdownContainerRef.current.contains(event.target)) {
//         setShowSkillDrop(false);
//         setShowAssetDrop(false);
//         setSkillFocused(false);
//       }
//     };
//     document.addEventListener("click", handleClickOutside);
//     return () => document.removeEventListener("click", handleClickOutside);
//   }, []);

//   // 4. HANDLERS
//   const fetchSkills = async () => {
//     try {
//       const response = await fetch("https://apihrr.goelectronix.co.in/masters/skills");
//       const data = await response.json();
//       setDynamicSkills(data.map(item => item.name || item));
//     } catch { console.error("Skill registry unavailable"); }
//   };

//   const fetchAssets = async (candidateId = 45) => {
//     try {
//       const response = await fetch(`https://apihrr.goelectronix.co.in/candidates/${candidateId}/assets`);
//       const data = await response.json();
//       setDynamicAssets(Array.isArray(data) ? data.map(a => a.name) : []);
//     } catch { console.error("Asset registry unavailable"); }
//   };

//   const handleManualAddSkill = async () => {
//     const name = skillInput.trim();
//     if (!name) { await fetchSkills(); return; }
//     const success = await handleCreateMaster("skills", name);
//     if (success) {
//       if (!formData.skills.includes(name)) setFormData(p => ({ ...p, skills: [...p.skills, name] }));
//       setSkillInput("");
//       await fetchSkills();
//     }
//   };

//   const handleCreateMaster = async (type, name) => {
//     try {
//       const res = await fetch(`https://apihrr.goelectronix.co.in/masters/${type}`, {
//         method: "POST",
//         headers: { "Content-Type": "application/json" },
//         body: JSON.stringify({ name: name.trim() }),
//       });
//       return res.ok;
//     } catch { return false; }
//   };

//   const handleAddAssetAPI = async (assetName) => {
//     if (!assetName.trim()) return;
//     const targetId = id || 45; // Use URL ID if editing
//     const loadingToast = toast.loading(`Linking ${assetName}...`);
//     try {
//       const res = await fetch(`https://apihrr.goelectronix.co.in/candidates/${targetId}/assets`, {
//         method: "POST",
//         headers: { "Content-Type": "application/json" },
//         body: JSON.stringify({ name: assetName.trim() }),
//       });
//       if (res.ok) {
//         toast.success("Asset Linked", { id: loadingToast });
//         await fetchAssets(targetId);
//         return true;
//       }
//       throw new Error();
//     } catch { toast.error("Link failed", { id: loadingToast }); return false; }
//   };

//   const fetchPincodeDetails = async (pincode) => {
//     if (!/^\d{6}$/.test(pincode)) return;
//     setIsFetchingPincode(true);
//     try {
//       const res = await fetch(`https://api.postalpincode.in/pincode/${pincode}`);
//       const data = await res.json();
//       if (data[0]?.Status === "Success") {
//         setCityOptions(data[0].PostOffice.map(o => o.Name));
//       }
//     } finally { setIsFetchingPincode(false); }
//   };

//   const validateField = (field, value) => {
//     let error = "";
//     if (["name", "email", "phone"].includes(field) && !value) error = "Required field";
//     setErrors(prev => ({ ...prev, [field]: error }));
//     return !error;
//   };

//   // INTEGRATED PATCH / SUBMIT LOGIC
//   const handleSubmit = async (e) => {
//     e.preventDefault();
//     setLoading(true);
//     const loadingToast = toast.loading(id ? "Patching Registry..." : "Creating Entry...");
//     try {
//       const apiData = new FormData();
//       Object.keys(formData).forEach(key => {
//         if (formData[key] && !["experiences", "certificateFiles", "languages_spoken", "cvFile", "skills", "assets"].includes(key)) {
//           apiData.append(key, formData[key]);
//         }
//       });
//       apiData.append("full_name", formData.name);
//       apiData.append("experience_details", JSON.stringify(formData.experiences));
//       apiData.append("languages_spoken", JSON.stringify(formData.languages_spoken));
//       apiData.append("skills", JSON.stringify(formData.skills));
//       apiData.append("assets", JSON.stringify(formData.assets));
//       if (formData.cvFile) apiData.append("resumepdf", formData.cvFile);

//       const targetUrl = id ? `https://apihrr.goelectronix.co.in/candidates/${id}` : `https://apihrr.goelectronix.co.in/candidates`;
//       const method = id ? "PATCH" : "POST";

//       const response = await fetch(targetUrl, {
//         method: method,
//         body: apiData,
//       });

//       if (response.ok) {
//         toast.success(id ? "Record Patched Successfully" : "Profile Synchronized ðŸŽ‰", { id: loadingToast });
//         navigate("/candidates"); // Redirect back to list
//       } else { throw new Error(); }
//     } catch { toast.error("Registry Commit Failed", { id: loadingToast }); }
//     finally { setLoading(false); }
//   };

//   const inputStyle = "w-full px-5 py-4 bg-slate-50 border border-slate-200 rounded-2xl text-xs font-bold outline-none focus:bg-white focus:border-blue-500 transition-all";

//   if (fetchingData) return (
//     <div className="min-h-screen flex items-center justify-center bg-slate-50">
//       <div className="text-center space-y-4">
//         <Loader2 className="h-12 w-12 animate-spin text-blue-600 mx-auto" />
//         <p className="text-xs font-black text-slate-400 uppercase tracking-widest">Hydrating Candidate Node...</p>
//       </div>
//     </div>
//   );

//   return (
//     <div className="min-h-screen bg-[#F8FAFC] p-4 md:p-12 antialiased">
//       <div className="max-w-5xl mx-auto space-y-8" ref={dropdownContainerRef}>

//         {/* HEADER & ROADMAP */}
//         <div className="flex flex-col lg:flex-row justify-between items-center bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 gap-8">
//           <div className="flex items-center gap-6">
//             <div className="h-16 w-16 bg-slate-900 rounded-[1.5rem] flex items-center justify-center text-white shadow-2xl">
//               <Database size={32} />
//             </div>
//             <div>
//               <h2 className="text-2xl font-black text-slate-900 tracking-tight">{id ? "Edit Registry" : "Manual Registry"}</h2>
//               <div className="flex items-center gap-2 mt-1 text-blue-600">
//                 <ShieldCheck size={14} />
//                 <p className="text-[10px] font-black uppercase tracking-widest">Candidate ID: {id || "New Node"}</p>
//               </div>
//             </div>
//           </div>

//           <div className="flex-1 max-w-2xl w-full px-4">
//             <div className="relative flex justify-between items-center w-full">
//               <div className="absolute top-1/2 left-0 w-full h-0.5 bg-slate-100 -translate-y-1/2 z-0" />
//               <div className="absolute top-1/2 left-0 h-0.5 bg-blue-600 -translate-y-1/2 z-0 transition-all duration-700 ease-in-out" style={{ width: `${((step - 1) / (totalSteps - 1)) * 100}%` }} />
//               {[1, 2, 3, 4, 5, 6].map((num) => (
//                 <div key={num} className="relative z-10 flex flex-col items-center gap-2">
//                   <div className={`h-8 w-8 rounded-full flex items-center justify-center text-[10px] font-black transition-all duration-500 border-4 ${step === num ? "bg-blue-600 text-white border-blue-100 scale-110 shadow-lg shadow-blue-200" : step > num ? "bg-emerald-500 text-white border-emerald-50" : "bg-white text-slate-300 border-slate-50"}`}>
//                     {step > num ? <Check size={14} strokeWidth={4} /> : num}
//                   </div>
//                   <span className={`absolute -bottom-6 text-[8px] font-black uppercase tracking-tighter whitespace-nowrap transition-colors duration-300 ${step === num ? "text-blue-600" : step > num ? "text-emerald-600" : "text-slate-300"}`}>
//                     {num === 1 && "Identity"} {num === 2 && "Location"} {num === 3 && "Experience"} {num === 4 && "Carrer"} {num === 5 && "Inventory"} {num === 6 && "Document"}
//                   </span>
//                 </div>
//               ))}
//             </div>
//           </div>

//           <div className="bg-slate-50 border border-slate-200 rounded-2xl px-6 py-3 flex items-center gap-3">
//             <div className="text-right"><p className="text-[8px] font-black text-slate-400 uppercase tracking-widest">Complete</p><p className="text-sm font-black text-slate-900 mt-1">{Math.round((step / totalSteps) * 100)}%</p></div>
//             <div className={`h-8 w-8 rounded-lg flex items-center justify-center ${step === 6 ? 'bg-emerald-100 text-emerald-600' : 'bg-blue-100 text-blue-600'}`}><Check size={18} /></div>
//           </div>
//         </div>

//         <form onSubmit={handleSubmit}>
//           <div className="space-y-12">
//             {/* STEP 1: IDENTITY */}
//             {step === 1 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8 duration-500">
//                 <div className="flex items-center gap-4 pb-4 border-b border-slate-100"><User size={18} className="text-blue-600" /><h3 className="text-sm font-black text-slate-800 uppercase tracking-widest">Identification</h3></div>
//                 <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                   <FormField label="Full Name" required error={errors.name}><input placeholder="Legal Name" value={formData.name} onChange={(e) => { setFormData({ ...formData, name: e.target.value }); validateField("name", e.target.value); }} className={inputStyle} /></FormField>
//                   <FormField label="Email" required error={errors.email}><input type="email" placeholder="name@domain.com" value={formData.email} onChange={(e) => { setFormData({ ...formData, email: e.target.value }); validateField("email", e.target.value); }} className={inputStyle} /></FormField>
//                   <FormField label="Phone" required error={errors.phone}><div className="flex items-center bg-slate-50 border border-slate-200 rounded-xl overflow-hidden focus-within:bg-white focus-within:border-blue-500 transition-all shadow-sm"><span className="px-5 text-[11px] font-black text-slate-400 border-r border-slate-100">+91</span><input maxLength={10} value={formData.phone} onChange={(e) => { const v = e.target.value.replace(/\D/g, ""); setFormData({ ...formData, phone: v }); validateField("phone", v); }} className="w-full px-5 py-4 bg-transparent text-sm font-bold outline-none" /></div></FormField>
//                   <FormField label="Gender"><select value={formData.gender} onChange={(e) => setFormData({ ...formData, gender: e.target.value })} className={inputStyle}><option value="">Select</option><option value="male">Male</option><option value="female">Female</option></select></FormField>
//                 </div>
//                 <FormField label="Profile Bio"><textarea rows={4} placeholder="Brief summary..." value={formData.about_me} onChange={(e) => setFormData({ ...formData, about_me: e.target.value })} className={inputStyle + " resize-none"} /></FormField>
//                 <div className="flex justify-end pt-4"><button type="button" onClick={() => setStep(2)} className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest shadow-xl active:scale-95 transition-all">Next Phase <ChevronRight size={16}/></button></div>
//               </div>
//             )}

//             {/* STEP 2: GEOGRAPHY */}
//             {step === 2 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8">
//                 <div className="flex items-center gap-3 pb-4 border-b border-slate-100"><MapPin size={18} className="text-blue-600" /><h3 className="text-xs font-black text-slate-800 uppercase tracking-widest">Geolocation Registry</h3></div>
//                 <div className="space-y-8">
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                     <FormField label="Address line 1" required><input placeholder="Building/Flat/Street" value={formData.address1} onChange={(e) => setFormData({...formData, address1: e.target.value})} className={inputStyle} /></FormField>
//                     <FormField label="Address line 2" required><input placeholder="Landmark" value={formData.address2} onChange={(e) => setFormData({...formData, address2: e.target.value})} className={inputStyle} /></FormField>
//                   </div>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                     <FormField label="Location Area" required><input placeholder="City Hub" value={formData.location} onChange={(e) => setFormData({...formData, location: e.target.value})} className={inputStyle} /></FormField>
//                     <FormField label="Pincode" required><input maxLength={6} placeholder="000000" value={formData.pincode} onChange={(e) => { setFormData({ ...formData, pincode: e.target.value }); fetchPincodeDetails(e.target.value); }} className={inputStyle} /></FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-between pt-8 border-t border-slate-50"><button onClick={() => setStep(1)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase hover:text-slate-900 transition-all shadow-sm">â† Back</button><button onClick={() => setStep(3)} type="button" className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase shadow-xl transition-all">Continue â†’</button></div>
//               </div>
//             )}

//             {/* STEP 3: EXPERIENCE */}
//             {step === 3 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
//                 <div className="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-sm transition-all overflow-hidden">
//                   <div className="flex flex-col md:flex-row items-center justify-between gap-6">
//                     <div className="flex items-center gap-4 text-slate-900 font-black"><Briefcase size={24} className="text-blue-600" /><div><h3 className="text-sm uppercase tracking-widest leading-none">Are you a Fresher?</h3><p className="text-[10px] font-bold text-slate-400 uppercase tracking-wider mt-1.5">Select your current career status</p></div></div>
//                     <div className="flex bg-slate-100 p-1.5 rounded-[1.5rem] border border-slate-200 w-full md:w-auto">
//                       <button type="button" onClick={() => { setIsFresher(true); setFormData({ ...formData, experiences: [] }); }} className={`flex-1 md:flex-none px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === true ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}>Yes, I am</button>
//                       <button type="button" onClick={() => setIsFresher(false)} className={`flex-1 md:flex-none px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === false ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}>No, Experienced</button>
//                     </div>
//                   </div>
//                 </div>

//                 {isFresher === false && (
//                   <div className="bg-white p-6 md:p-10 rounded-[3.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 space-y-10 animate-in fade-in zoom-in-95 duration-500">
//                     <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center border-b border-slate-100 pb-8 gap-4">
//                       <div className="flex items-center gap-4"><div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg"><History size={20} /></div><h3 className="text-sm font-black text-slate-900 uppercase">Career Timeline</h3></div>
//                       <button type="button" onClick={() => setFormData({ ...formData, experiences: [...formData.experiences, { company_name: "", job_title: "", uploadMode: "file" }] })} className="px-6 py-3 bg-slate-900 hover:bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase transition-all shadow-lg active:scale-95">+ Add Organization</button>
//                     </div>
//                     <div className="space-y-10 max-h-[600px] overflow-y-auto pr-4 custom-scrollbar-professional">
//                       {formData.experiences.map((exp, i) => (
//                         <div key={i} className="relative bg-slate-50/50 border border-slate-200 p-6 md:p-10 rounded-[2.5rem] space-y-8 group transition-all hover:bg-white hover:shadow-xl shadow-inner">
//                           <button type="button" onClick={() => setFormData({ ...formData, experiences: formData.experiences.filter((_, idx) => idx !== i) })} className="absolute -top-3 -right-3 h-10 w-10 bg-white border border-slate-200 text-red-500 rounded-full flex items-center justify-center shadow-lg transition-all opacity-0 group-hover:opacity-100 z-20"><Trash2 size={18} /></button>
//                           <div className="grid grid-cols-1 md:grid-cols-2 gap-8"><FormField label="Employer"><input placeholder="Organization" value={exp.company_name} onChange={(e) => { const u = [...formData.experiences]; u[i].company_name = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField><FormField label="Professional Designation"><input placeholder="Job Title" value={exp.job_title} onChange={(e) => { const u = [...formData.experiences]; u[i].job_title = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField></div>
//                           <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
//                             <FormField label="Core Responsibilities"><textarea placeholder="Brief scope..." rows={5} value={exp.description} onChange={(e) => { const u = [...formData.experiences]; u[i].description = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle + " resize-none min-h-[140px]"} /></FormField>
//                             <div className="space-y-3">
//                               <div className="flex justify-between items-center px-1"><p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Experience Letter</p><div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200"><button type="button" onClick={() => { const u = [...formData.experiences]; u[i].uploadMode = "file"; setFormData({ ...formData, experiences: u }); }} className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === 'file' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>FILE</button><button type="button" onClick={() => { const u = [...formData.experiences]; u[i].uploadMode = "link"; setFormData({ ...formData, experiences: u }); }} className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === 'link' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>URL</button></div></div>
//                               <div className="bg-white/50 border border-slate-100 rounded-3xl p-4 min-h-[140px] flex flex-col justify-center">
//                                 {exp.uploadMode === 'file' ? (<label className="flex flex-col items-center justify-center gap-3 w-full h-full border-2 border-dashed border-slate-200 rounded-2xl hover:bg-blue-50/30 transition-all cursor-pointer group p-4"><FileUp size={24} className="text-slate-400 group-hover:text-blue-500" /><span className="text-[9px] font-bold text-slate-500 uppercase tracking-widest text-center">{exp.expLetterFile ? exp.expLetterFile.name : "Drop Validation PDF"}</span><input type="file" accept=".pdf" className="hidden" onChange={(e) => { const u = [...formData.experiences]; u[i].expLetterFile = e.target.files[0]; setFormData({ ...formData, experiences: u }); }} /></label>) : (<div className="relative"><LinkIcon size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input placeholder="G-Drive / Link" value={exp.exp_letter_link} onChange={(e) => { const u = [...formData.experiences]; u[i].exp_letter_link = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle + " pl-11"} /></div>)}
//                               </div>
//                             </div>
//                           </div>
//                           <div className="flex justify-end pt-2 border-t border-slate-50"><button type="button" onClick={() => toast.success("Record Saved")} className="flex items-center gap-2 px-8 py-3 bg-emerald-50 text-emerald-600 border border-emerald-100 rounded-2xl text-[10px] font-black uppercase hover:bg-emerald-500 hover:text-white transition-all active:scale-95 shadow-sm"><Check size={16} strokeWidth={3} /> Save Record</button></div>
//                         </div>
//                       ))}
//                     </div>
//                   </div>
//                 )}
//                 {isFresher === true && (<div className="text-center py-20 bg-blue-50/50 border-2 border-dashed border-blue-200 rounded-[3rem] animate-in fade-in duration-700"><Award size={32} className="mx-auto text-blue-400 mb-4" /><p className="text-xs font-black text-blue-600 uppercase tracking-widest">Graduating Node Mode</p><p className="text-[10px] font-bold text-slate-400 normal-case mt-1">Registry skipping history. Proceed to artifacts.</p></div>)}
//                 <div className="flex justify-between pt-4"><button onClick={() => setStep(2)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase hover:text-slate-900 transition-all shadow-sm">â† Back</button><button onClick={() => setStep(4)} type="button" disabled={isFresher === null} className={`px-12 py-4 rounded-2xl text-xs font-black uppercase shadow-xl transition-all active:scale-95 ${isFresher !== null ? "bg-blue-600 text-white" : "bg-slate-200 text-slate-400"}`}>Next Phase â†’</button></div>
//               </div>
//             )}

//             {/* STEP 4: CAREER */}
//             {step === 4 && (
//               <div ref={careerStepRef} className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-12 animate-in slide-in-from-right-8 overflow-visible">
//                 <div className="flex items-center gap-4 pb-4 border-b border-slate-100"><Award size={20} className="text-blue-600" /><h3 className="text-[14px] font-black text-slate-900 uppercase tracking-widest">Career Profile</h3></div>
//                 <div className="grid grid-cols-1 md:grid-cols-2 gap-12 overflow-visible">
//                   <FormField label="Assigned Position"><div className="relative overflow-visible"><div className="relative group"><input placeholder="Select role..." value={formData.position} onFocus={() => { setShowSkillDrop(true); setShowAssetDrop(false); setSkillFocused(false); }} onChange={(e) => setFormData({ ...formData, position: e.target.value })} className={inputStyle} /><ChevronDown size={16} className={`absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 transition-transform ${showSkillDrop ? 'rotate-180' : ''}`} /></div>
//                   {showSkillDrop && (<div className="absolute z-[100] w-full mt-2 bg-white border border-slate-200 rounded-3xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 max-h-60 overflow-y-auto no-scrollbar">{POSITION_OPTIONS.filter(p => p.toLowerCase().includes(formData.position.toLowerCase())).map((pos, i) => (<div key={i} onMouseDown={(e) => { e.preventDefault(); setFormData({ ...formData, position: pos }); setShowSkillDrop(false); }} className="px-6 py-4 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-700 cursor-pointer">{pos}</div>))}</div>)}</div></FormField>
//                   <FormField label="Seniority (Years)"><input type="number" placeholder="Total Exp." value={formData.experience} onFocus={() => { setShowSkillDrop(false); setShowAssetDrop(false); setSkillFocused(false); }} onChange={(e) => setFormData({ ...formData, experience: e.target.value })} className={inputStyle} /></FormField>
//                 </div>
//                 <div className="grid grid-cols-1 md:grid-cols-2 gap-12 overflow-visible">
//                   <FormField label="Education"><div className="relative overflow-visible"><div className="relative group"><input placeholder="Select degree..." value={eduSearch || formData.education} onFocus={() => { setShowAssetDrop(true); setShowSkillDrop(false); setSkillFocused(false); }} onChange={(e) => { setEduSearch(e.target.value); setFormData({ ...formData, education: e.target.value }); }} className={inputStyle} /><ChevronDown size={16} className={`absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 transition-transform ${showAssetDrop ? 'rotate-180' : ''}`} /></div>
//                   {showAssetDrop && (<div className="absolute z-[100] w-full mt-2 bg-white border border-slate-200 rounded-3xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 max-h-60 overflow-y-auto no-scrollbar">{filteredEducation.map((e, i) => (<div key={i} onMouseDown={(ev) => { ev.preventDefault(); setFormData({ ...formData, education: e }); setEduSearch(""); setShowAssetDrop(false); }} className="px-6 py-4 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-600 cursor-pointer">{e}</div>))}</div>)}</div></FormField>
//                   <FormField label="Department"><div className="relative overflow-visible"><div className="relative group"><input placeholder="Search..." value={deptSearch || formData.department} onFocus={() => { setSkillFocused(true); setShowSkillDrop(false); setShowAssetDrop(false); }} onChange={(e) => { setDeptSearch(e.target.value); setFormData({ ...formData, department: e.target.value }); }} className={inputStyle} /><ChevronDown size={16} className={`absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 transition-transform ${skillFocused ? 'rotate-180' : ''}`} /></div>
//                   {skillFocused && (<div className="absolute z-[100] w-full mt-2 bg-white border border-slate-200 rounded-3xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 max-h-60 overflow-y-auto no-scrollbar">{filteredDepartments.map((d) => (<div key={d.id} onMouseDown={(ev) => { ev.preventDefault(); setFormData({ ...formData, department: d.name }); setDeptSearch(""); setSkillFocused(false); }} className="px-6 py-4 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-700 cursor-pointer">{d.name}</div>))}</div>)}</div></FormField>
//                 </div>
//                 <div className="flex justify-between pt-8 border-t border-slate-50"><button onClick={() => setStep(3)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[11px] font-black uppercase transition-all shadow-sm">â† Back</button><button onClick={() => setStep(5)} type="button" className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-[11px] font-black uppercase shadow-xl transition-all">Next Phase â†’</button></div>
//               </div>
//             )}

//             {/* STEP 5: INVENTORY */}
//             {step === 5 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 overflow-visible">
//                 <div className="bg-white border border-slate-200 rounded-[3.5rem] shadow-xl overflow-visible shadow-slate-200/50">
//                   <div className="bg-slate-50/50 px-10 py-6 border-b border-slate-200 flex items-center justify-between rounded-t-[3.5rem]"><div className="flex items-center gap-4"><div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg shadow-blue-200"><Cpu size={20} /></div><div><h3 className="text-sm font-black text-slate-900 uppercase tracking-widest leading-none">Inventory Matrix</h3><p className="text-[10px] font-bold text-slate-400 uppercase mt-0.5">Hydrating expertise and artifact nodes</p></div></div></div>
//                   <div className="p-8 md:p-12 space-y-12 overflow-visible">
//                     <FormField label="Technical Matrix"><div className="space-y-6"><div className="flex flex-col sm:flex-row gap-4 items-end"><div className="relative max-w-md w-full"><Plus size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={skillInput} onChange={(e) => setSkillInput(e.target.value)} onKeyDown={(e) => { if(e.key === 'Enter') { e.preventDefault(); handleManualAddSkill(); } }} placeholder="New Skill..." className={inputStyle + " pl-12"} /></div><button type="button" onClick={handleManualAddSkill} className="px-6 py-3.5 bg-slate-900 hover:bg-blue-600 text-white rounded-2xl transition-all flex items-center gap-2 text-[10px] font-black shadow-lg"><Database size={14} /> Sync Registry</button></div><div className="flex flex-wrap gap-3 p-1">{dynamicSkills.map((skill) => { const isSelected = formData.skills.includes(skill); return (<button key={skill} type="button" onClick={() => setFormData({...formData, skills: isSelected ? formData.skills.filter(s => s !== skill) : [...formData.skills, skill]})} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all duration-300 border-2 active:scale-90 ${isSelected ? "bg-blue-600 border-blue-600 text-white" : "bg-white border-slate-100 text-slate-500"}`}>{skill} {isSelected && <Check size={14} strokeWidth={3} />}</button>); })}</div></div></FormField>
//                     <FormField label="Hardware Inventory"><div className="space-y-6 pt-8 border-t border-slate-100"><div className="relative max-w-md w-full"><Layers size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={assetInput} onChange={(e) => setAssetInput(e.target.value)} onKeyDown={async (e) => { if(e.key === 'Enter') { e.preventDefault(); const v = assetInput.trim(); if(v && !formData.assets.includes(v)) { const ok = await handleAddAssetAPI(v); if(ok) { setFormData({...formData, assets: [...formData.assets, v]}); setAssetInput(""); } } } }} placeholder="Register Asset..." className={inputStyle + " pl-12"} /></div><div className="flex flex-wrap gap-3 p-1">{dynamicAssets.map((asset) => { const isSelected = formData.assets.includes(asset); return (<button key={asset} type="button" onClick={async () => { if(!isSelected) { const ok = await handleAddAssetAPI(asset); if(ok) setFormData({...formData, assets: [...formData.assets, asset]}); } else { setFormData({...formData, assets: formData.assets.filter(a => a !== asset)}); } }} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black uppercase transition-all border-2 active:scale-90 ${isSelected ? "bg-slate-900 border-slate-900 text-white shadow-lg" : "bg-white border-slate-100 text-slate-500"}`}>{asset} {isSelected && <Check size={14} strokeWidth={3} />}</button>); })}</div></div></FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-between items-center pt-4"><button onClick={() => setStep(4)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase transition-all shadow-sm hover:text-slate-900 flex items-center gap-2"><ChevronLeft size={16}/> Previous Phase</button><button onClick={() => setStep(6)} type="button" className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase shadow-xl active:scale-95 flex items-center gap-2">Vault Registry <ChevronRight size={16}/></button></div>
//               </div>
//             )}

//             {/* STEP 6: DOCUMENT VAULT */}
//             {step === 6 && (
//               <div className="space-y-8 animate-in slide-in-from-bottom-12 duration-700">
//                 <div className="bg-white p-8 md:p-16 rounded-[4rem] shadow-xl shadow-slate-200/60 border border-slate-200 space-y-12 overflow-hidden relative">
//                   <div className="absolute top-0 right-0 p-12 text-slate-100 opacity-40 rotate-12 scale-150"><ShieldCheck size={240} /></div>
//                   <div className="flex items-center gap-5 pb-8 border-b border-slate-100 relative z-10"><div className="h-14 w-14 bg-blue-600 rounded-2xl flex items-center justify-center shadow-lg"><ShieldCheck size={28} className="text-white" /></div><div><h3 className="text-xl font-black text-slate-900 uppercase tracking-widest leading-none">Registry Artifacts</h3><p className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mt-2">Document Verification Matrix</p></div></div>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-16 relative z-10">
//                     <div className="space-y-8 p-1"><div className="flex justify-between items-center"><p className="text-[11px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2"><span className="h-1.5 w-1.5 rounded-full bg-blue-600" /> Resume Profile</p><div className="flex bg-slate-50 p-1 rounded-xl border border-slate-200"><button type="button" onClick={() => setResumeMode("file")} className={`px-5 py-2 text-[10px] font-black rounded-lg transition-all ${resumeMode === 'file' ? 'bg-white text-slate-900 shadow-sm' : 'text-slate-400'}`}>FILE</button><button type="button" onClick={() => setResumeMode("link")} className={`px-5 py-2 text-[10px] font-black rounded-lg transition-all ${resumeMode === 'link' ? 'bg-white text-slate-900 shadow-sm' : 'text-slate-400'}`}>URL</button></div></div>
//                     {resumeMode === 'file' ? (<label className="block p-12 border-2 border-dashed border-slate-200 rounded-[3rem] hover:border-blue-500 transition-all cursor-pointer group text-center bg-white"><FileUp size={40} className="mx-auto text-slate-300 group-hover:text-blue-500 mb-5 duration-500" /><p className="text-[10px] font-black text-slate-900 uppercase truncate px-4">{formData.cvFile ? formData.cvFile.name : "Select Resume PDF"}</p><input type="file" accept=".pdf" className="hidden" onChange={(e) => setFormData({...formData, cvFile: e.target.files[0], resume_link: ""})} /></label>) : <input placeholder="URI Storage Link" value={formData.resume_link} onChange={(e) => setFormData({...formData, resume_link: e.target.value, cvFile: null})} className={inputStyle} />}</div>
//                     <div className="space-y-8 p-1"><div className="flex justify-between items-center"><p className="text-[11px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2"><span className="h-1.5 w-1.5 rounded-full bg-slate-400" /> Validation Node</p></div><div className="text-xs text-slate-400 font-bold uppercase leading-relaxed p-6 bg-slate-50 rounded-3xl border border-dashed">Candidate data ready for PATCH synchronization. ensure all letters are legible for registry nodes. finalizing to commit candidate data to database.</div></div>
//                   </div>
//                   <div className="pt-16 border-t border-slate-100 flex flex-col items-center gap-8 relative z-10"><button type="submit" disabled={loading} className="w-full md:max-w-xl flex items-center justify-center gap-5 bg-blue-600 hover:bg-blue-700 text-white font-black py-7 rounded-[3rem] shadow-2xl active:scale-[0.98] uppercase disabled:opacity-50">{loading ? <Loader2 className="animate-spin" size={28} /> : <><Database size={24} /><span>Finalize PATCH Commit</span></>}</button><button type="button" onClick={() => setStep(5)} className="text-[10px] font-black text-slate-400 uppercase tracking-widest hover:text-slate-900 flex items-center gap-2"><ChevronLeft size={16}/> Return to Module 5</button></div>
//                 </div>
//               </div>
//             )}
//           </div>
//         </form>
//       </div>
//       <style dangerouslySetInnerHTML={{ __html: `.custom-scrollbar-professional::-webkit-scrollbar { width: 6px; }.custom-scrollbar-professional::-webkit-scrollbar-track { background: transparent; }.custom-scrollbar-professional::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 20px; }.custom-scrollbar-professional::-webkit-scrollbar-thumb:hover { background: #CBD5E1; }`}} />
//     </div>
//   );
// };

// export default ManualEntryPage;

// import React, { useState, useEffect, useRef } from "react";
// import { useParams, useNavigate } from "react-router-dom";
// import {
//   Check, FileText, Award, User, Briefcase, MapPin, Mail, Phone,
//   Loader2, Plus, Trash2, Layers, Cpu, ExternalLink, Database,
//   Globe, ShieldCheck, History, X, LinkIcon, FileUp, ChevronRight, ChevronLeft, ChevronDown
// } from "lucide-react";
// import toast from "react-hot-toast";
// import { candidateService } from "../../services/candidateService";
// import { departmentService } from "../../services/department.service";

// const FormField = ({ label, required, error, children }) => (
//   <div className="space-y-1.5 w-full">
//     <label className="text-[10px] md:text-[11px] font-black text-slate-500 uppercase tracking-widest ml-1 flex justify-between items-center">
//       <span>{label}</span>
//       <span className={`font-bold normal-case ${required ? "text-red-500" : "text-slate-300"}`}>
//         {required ? "Required" : "Optional"}
//       </span>
//     </label>
//     {children}
//     {error && <p className="text-[9px] text-red-500 font-bold uppercase tracking-tighter ml-1">{error}</p>}
//   </div>
// );

// const ManualEntryPage14 = () => {
//   // 1. INITIALIZE ALL STATES FIRST
//   const { id } = useParams(); // Capture the ID from /editentry/:id
//   const navigate = useNavigate();
//   const [step, setStep] = useState(1);
//   const [loading, setLoading] = useState(false);
//   const [errors, setErrors] = useState({});
//   const [isFetchingPincode, setIsFetchingPincode] = useState(false);
//   const [cityOptions, setCityOptions] = useState([]);
//   const [resumeMode, setResumeMode] = useState("file");
//   const [expLetterMode, setExpLetterMode] = useState("file");
//   const [skillInput, setSkillInput] = useState("");
//   const [assetInput, setAssetInput] = useState("");
//   const [isFresher, setIsFresher] = useState(null); // null = unselected, true = yes, false = no
//   const [deptSearch, setDeptSearch] = useState("");
//   const [eduSearch, setEduSearch] = useState("");
//   const [skillFocused, setSkillFocused] = useState(false);
//   const dropdownContainerRef = useRef(null);
//   const careerStepRef = useRef(null);
//   const [assetFocused, setAssetFocused] = useState(false);
//   const [dynamicSkills, setDynamicSkills] = useState([]);
//   const [dynamicAssets, setDynamicAssets] = useState([]);
//   const [showSkillDrop, setShowSkillDrop] = useState(false);
//   const [showAssetDrop, setShowAssetDrop] = useState(false);
//   const [departments, setDepartments] = useState([]);

//   const [formData, setFormData] = useState({
//     name: "", email: "", phone: "", address: "", address1: "", address2: "", location: "",
//     pincode: "", state: "", city: "", district: "", country: "India", position: "",
//     education: "", gender: "", dob: "", experience: "", about_me: "",
//     languages_spoken: [], skills: [], assets: [], department: "",
//     cvFile: null, resume_link: "", expLetterFile: null,
//     experience_letter_link: "", certificateFiles: [], certificateLinks: [""], experiences: [],
//   });

//   // 2. STATIC DATA & FILTER LOGIC
//   const totalSteps = 6;
//   const SKILL_OPTIONS = ["React", "JavaScript", "Node.js", "MongoDB", "MySQL", "HTML", "CSS", "Tailwind", "Python", "Java", "AWS", "Docker"];
//   const ASSET_OPTIONS = ["Laptop", "Mouse", "Keyboard", "Monitor", "Headset", "Mobile", "ID Card", "SIM Card"];
//   const POSITION_OPTIONS = ["Frontend Developer", "Backend Developer", "Full Stack Developer", "HR Executive", "UI/UX Designer", "DevOps Engineer", "Data Analyst"];
//   const educationOptions = ["B.Tech", "M.Tech", "B.Sc", "M.Sc", "BCA", "MCA", "MBA", "Diploma", "PhD"];

//   const filteredEducation = educationOptions.filter(e => e.toLowerCase().includes(eduSearch.toLowerCase()));
//   const filteredDepartments = departments.filter(d => (d.name || "").toLowerCase().includes(deptSearch.toLowerCase()));

//   const isStep1Valid = formData.name && /^\S+@\S+\.\S+$/.test(formData.email) && /^[6-9]\d{9}$/.test(formData.phone);

//   // 3. EFFECTS
//   useEffect(() => { window.scrollTo({ top: 0, behavior: "smooth" }); }, [step]);

//   useEffect(() => {
//     const loadData = async () => {
//       try {
//         const data = await departmentService.getAll();
//         setDepartments(data || []);
//         await fetchSkills();
//         await fetchAssets();
//       } catch (err) { toast.error("Failed to load initial data"); }
//     };
//     loadData();
//   }, []);

//   useEffect(() => {
//     const handleClickOutside = (event) => {
//       if (dropdownContainerRef.current && !dropdownContainerRef.current.contains(event.target)) {
//         setShowSkillDrop(false);
//         setShowAssetDrop(false);
//         setSkillFocused(false);
//       }
//     };
//     document.addEventListener("click", handleClickOutside);
//     return () => document.removeEventListener("click", handleClickOutside);
//   }, []);

//   // 4. HANDLERS
//   const validateField = (field, value) => {
//     let error = "";
//     if (["name", "email", "phone"].includes(field) && !value) error = "Required field";
//     if (field === "email" && value && !/^\S+@\S+\.\S+$/.test(value)) error = "Invalid format";
//     if (field === "phone" && value && !/^[6-9]\d{9}$/.test(value)) error = "Invalid number";
//     setErrors(prev => ({ ...prev, [field]: error }));
//     return !error;
//   };

//   const fetchPincodeDetails = async (pincode) => {
//     if (!/^\d{6}$/.test(pincode)) return;
//     try {
//       setIsFetchingPincode(true);
//       const res = await fetch(`https://api.postalpincode.in/pincode/${pincode}`);
//       const data = await res.json();
//       if (data[0]?.Status === "Success") {
//         const offices = data[0].PostOffice;
//         setCityOptions(offices.map(o => o.Name));
//         setFormData(prev => ({ ...prev, city: offices[0].Name, state: offices[0].State, district: offices[0].District }));
//       }
//     } catch { toast.error("Lookup failed"); }
//     finally { setIsFetchingPincode(false); }
//   };

//   // INTEGRATED PATCH METHOD
//   const handleSubmit = async (e) => {
//     e.preventDefault();
//     const loadingToast = toast.loading("Updating candidate profile...");
//     try {
//       setLoading(true);
//       const formDataApi = new FormData();

//       // Mapping fields to match your required payload
//       Object.keys(formData).forEach(key => {
//         if (formData[key] && !["experiences", "certificateFiles", "languages_spoken", "cvFile", "expLetterFile", "certificateLinks", "skills", "assets"].includes(key)) {
//           formDataApi.append(key, formData[key]);
//         }
//       });

//       formDataApi.append("full_name", formData.name);
//       formDataApi.append("languages_spoken", JSON.stringify(formData.languages_spoken));
//       formDataApi.append("experience_details", JSON.stringify(formData.experiences));
//       formDataApi.append("skills", JSON.stringify(formData.skills));
//       formDataApi.append("assets", JSON.stringify(formData.assets));

//       if (formData.cvFile) formDataApi.append("resumepdf", formData.cvFile);
//       if (formData.expLetterFile) formDataApi.append("experience_letter", formData.expLetterFile);

//       formData.certificateFiles.forEach(file => formDataApi.append("certificate_files[]", file));
//       formData.certificateLinks.filter(l => String(l).startsWith("http")).forEach(link => formDataApi.append("certificate_links", link));

//       // PATCH Request implementation
//       const response = await fetch("https://apihrr.goelectronix.co.in/candidates/588", {
//         method: "PATCH",
//         body: formDataApi,
//       });

//       if (response.ok) {
//         toast.success("Profile updated successfully via PATCH ðŸŽ‰", { id: loadingToast });
//       } else {
//         throw new Error("Update failed");
//       }
//     } catch (err) {
//       toast.error("Failed to commit changes", { id: loadingToast });
//     } finally {
//       setLoading(false);
//     }
//   };

//   const fetchSkills = async () => {
//     try {
//       const response = await fetch("https://apihrr.goelectronix.co.in/masters/skills");
//       const data = await response.json();
//       setDynamicSkills(data.map(item => item.name || item));
//     } catch { console.error("Skill sync failed"); }
//   };

//   const fetchAssets = async () => {
//     try {
//       const response = await fetch("https://apihrr.goelectronix.co.in/candidates/45/assets");
//       const data = await response.json();
//       setDynamicAssets(Array.isArray(data) ? data.map(a => a.name) : []);
//     } catch { console.error("Asset sync failed"); }
//   };

//   const handleManualAddSkill = async () => {
//     const name = skillInput.trim();
//     if (!name) { await fetchSkills(); return; }
//     const success = await handleCreateMaster("skills", name);
//     if (success) {
//       if (!formData.skills.includes(name)) setFormData(prev => ({ ...prev, skills: [...prev.skills, name] }));
//       setSkillInput("");
//       await fetchSkills();
//     }
//   };

//   const handleCreateMaster = async (type, name) => {
//     if (!name.trim()) return;
//     try {
//       const response = await fetch(`https://apihrr.goelectronix.co.in/masters/${type}`, {
//         method: "POST",
//         headers: { "Content-Type": "application/json" },
//         body: JSON.stringify({ name: name.trim() }),
//       });
//       return response.ok;
//     } catch { return false; }
//   };

//   const handleAddAssetAPI = async (assetName) => {
//     if (!assetName.trim()) return;
//     const loadingToast = toast.loading(`Assigning ${assetName}...`);
//     try {
//       const response = await fetch("https://apihrr.goelectronix.co.in/candidates/1/assets", {
//         method: "POST",
//         headers: { "Content-Type": "application/json" },
//         body: JSON.stringify({ name: assetName.trim() }),
//       });
//       if (response.ok) {
//         toast.success(`${assetName} linked`, { id: loadingToast });
//         await fetchAssets();
//         return true;
//       }
//       throw new Error();
//     } catch { toast.error("Linking failed", { id: loadingToast }); return false; }
//   };

//   const inputStyle = "w-full px-5 py-4 bg-slate-50 border border-slate-200 rounded-2xl text-xs font-bold outline-none focus:bg-white focus:border-blue-500 transition-all";

//   return (
//     <div className="min-h-screen bg-[#F8FAFC] p-4 md:p-12 antialiased">
//       <div className="max-w-5xl mx-auto space-y-8" ref={dropdownContainerRef}>

//         {/* HEADER */}
//         <div className="flex flex-col lg:flex-row justify-between items-center bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 gap-8">
//           <div className="flex items-center gap-6">
//             <div className="h-16 w-16 bg-slate-900 rounded-[1.5rem] flex items-center justify-center text-white shadow-2xl">
//               <Database size={32} />
//             </div>
//             <div>
//               <h2 className="text-2xl font-black text-slate-900 tracking-tight">Manual Registry</h2>
//               <div className="flex items-center gap-2 mt-1 text-blue-600">
//                 <ShieldCheck size={14} />
//                 <p className="text-[10px] font-black uppercase tracking-widest">Enterprise Secured</p>
//               </div>
//             </div>
//           </div>

//           <div className="flex-1 max-w-2xl w-full px-4">
//             <div className="relative flex justify-between items-center w-full">
//               <div className="absolute top-1/2 left-0 w-full h-0.5 bg-slate-100 -translate-y-1/2 z-0" />
//               <div
//                 className="absolute top-1/2 left-0 h-0.5 bg-blue-600 -translate-y-1/2 z-0 transition-all duration-700 ease-in-out"
//                 style={{ width: `${((step - 1) / (totalSteps - 1)) * 100}%` }}
//               />
//               {[1, 2, 3, 4, 5, 6].map((num) => (
//                 <div key={num} className="relative z-10 flex flex-col items-center gap-2">
//                   <div
//                     className={`h-8 w-8 rounded-full flex items-center justify-center text-[10px] font-black transition-all duration-500 border-4
//                       ${step === num
//                         ? "bg-blue-600 text-white border-blue-100 scale-110 shadow-lg shadow-blue-200"
//                         : step > num
//                         ? "bg-emerald-500 text-white border-emerald-50"
//                         : "bg-white text-slate-300 border-slate-50"}`}
//                   >
//                     {step > num ? <Check size={14} strokeWidth={4} /> : num}
//                   </div>
//                   <span className={`absolute -bottom-6 text-[8px] font-black uppercase tracking-tighter whitespace-nowrap transition-colors duration-300
//                     ${step === num ? "text-blue-600" : step > num ? "text-emerald-600" : "text-slate-300"}`}>
//                     {num === 1 && "Personal details"}
//                     {num === 2 && "Location"}
//                     {num === 3 && "Experience"}
//                     {num === 4 && "Carrer"}
//                     {num === 5 && "Asset & Skill"}
//                     {num === 6 && "Document"}
//                   </span>
//                 </div>
//               ))}
//             </div>
//           </div>

//           <div className="bg-slate-50 border border-slate-200 rounded-2xl px-6 py-3 flex items-center gap-3">
//             <div className="text-right">
//               <p className="text-[8px] font-black text-slate-400 uppercase tracking-widest leading-none">Completion</p>
//               <p className="text-sm font-black text-slate-900 leading-none mt-1">{Math.round((step / totalSteps) * 100)}%</p>
//             </div>
//             <div className={`h-8 w-8 rounded-lg flex items-center justify-center ${step === 6 ? 'bg-emerald-100 text-emerald-600' : 'bg-blue-100 text-blue-600'}`}>
//                {step === 6 ? <Check size={18} strokeWidth={3} /> : <Loader2 size={18} className="animate-spin" />}
//             </div>
//           </div>
//         </div>

//         <form onSubmit={handleSubmit}>
//           <div className="space-y-12">
//             {/* STEP 1: IDENTITY */}
//             {step === 1 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8 duration-500">
//                 <div className="flex items-center gap-4 pb-4 border-b border-slate-100"><User size={18} className="text-blue-600" /><h3 className="text-sm font-black text-slate-800 uppercase tracking-widest">Identification</h3></div>
//                 <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                   <FormField label="Full Name" required error={errors.name}><input placeholder="Legal Name" value={formData.name} onChange={(e) => { setFormData({ ...formData, name: e.target.value }); validateField("name", e.target.value); }} className={inputStyle} /></FormField>
//                   <FormField label="Email Address" required error={errors.email}><input type="email" placeholder="name@domain.com" value={formData.email} onChange={(e) => { setFormData({ ...formData, email: e.target.value }); validateField("email", e.target.value); }} className={inputStyle} /></FormField>
//                   <FormField label="Phone Number" required error={errors.phone}><div className="flex items-center bg-slate-50 border border-slate-200 rounded-xl overflow-hidden focus-within:bg-white focus-within:border-blue-500 transition-all shadow-sm"><span className="px-5 text-[11px] font-black text-slate-400 border-r border-slate-100">+91</span><input maxLength={10} value={formData.phone} onChange={(e) => { const v = e.target.value.replace(/\D/g, ""); setFormData({ ...formData, phone: v }); validateField("phone", v); }} className="w-full px-5 py-4 bg-transparent text-sm font-bold outline-none" /></div></FormField>
//                   <FormField label="Gender Selection"><select value={formData.gender} onChange={(e) => setFormData({ ...formData, gender: e.target.value })} className={inputStyle}><option value="">Select</option><option value="male">Male</option><option value="female">Female</option></select></FormField>
//                   <FormField label="Date of Birth"><input type="date" value={formData.dob} onChange={(e) => setFormData({ ...formData, dob: e.target.value })} className={inputStyle} /></FormField>
//                   <FormField label="Languages"><div className="bg-slate-50 border border-slate-200 rounded-2xl p-5 max-h-40 overflow-y-auto grid grid-cols-2 gap-4 shadow-inner">{["English", "Hindi", "Marathi", "Gujarati", "Tamil", "Telugu"].map(lang => (<label key={lang} className="flex items-center gap-3 text-[11px] font-bold text-slate-600 cursor-pointer hover:text-blue-600"><input type="checkbox" checked={formData.languages_spoken.includes(lang)} onChange={() => { const u = formData.languages_spoken.includes(lang) ? formData.languages_spoken.filter(l => l !== lang) : [...formData.languages_spoken, lang]; setFormData({ ...formData, languages_spoken: u }); }} className="w-4 h-4 accent-blue-600" /> {lang}</label>))}</div></FormField>
//                 </div>
//                 <FormField label="Profile Bio"><textarea rows={4} placeholder="Brief summary..." value={formData.about_me} onChange={(e) => setFormData({ ...formData, about_me: e.target.value })} className={inputStyle + " resize-none"} /></FormField>
//                 <div className="flex justify-end pt-4"><button type="button" disabled={!isStep1Valid} onClick={() => setStep(2)} className={`flex items-center gap-3 px-12 py-4 rounded-2xl text-xs font-black uppercase tracking-widest shadow-xl transition-all active:scale-95 ${isStep1Valid ? "bg-blue-600 text-white" : "bg-slate-200 text-slate-400"}`}>Next Phase <ChevronRight size={16}/></button></div>
//               </div>
//             )}

//             {/* STEP 2: GEOGRAPHY */}
//             {step === 2 && (
//               <div className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-10 animate-in slide-in-from-right-8">
//                 <div className="flex items-center gap-3 pb-4 border-b border-slate-100"><MapPin size={18} className="text-blue-600" /><h3 className="text-xs font-black text-slate-800 uppercase tracking-widest">Geolocation Registry</h3></div>
//                 <div className="space-y-8">
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                     <FormField label="Address line 1" required><input placeholder="Building/Flat/Street" value={formData.address1} onChange={(e) => setFormData({...formData, address1: e.target.value})} className={inputStyle} /></FormField>
//                     <FormField label="Address line 2" required><input placeholder="Landmark/Locality" value={formData.address2} onChange={(e) => setFormData({...formData, address2: e.target.value})} className={inputStyle} /></FormField>
//                   </div>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
//                     <FormField label="Location/Area Hub" required><input placeholder="City Hub/Area" value={formData.location} onChange={(e) => setFormData({...formData, location: e.target.value})} className={inputStyle} /></FormField>
//                     <FormField label="Pincode Mapping" required><div className="relative"><input maxLength={6} placeholder="000000" value={formData.pincode} onChange={(e) => { const v = e.target.value.replace(/\D/g, ""); setFormData({ ...formData, pincode: v }); if (v.length === 6) fetchPincodeDetails(v); }} className={inputStyle} />{isFetchingPincode && <Loader2 size={18} className="absolute right-4 top-1/2 -translate-y-1/2 animate-spin text-blue-500" />}</div></FormField>
//                   </div>
//                   <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
//                     <FormField label="City">
//                       <div className="relative group">
//                         {cityOptions.length > 1 ? (
//                           <><select value={formData.city} onChange={(e) => setFormData({ ...formData, city: e.target.value })} className={inputStyle + " appearance-none"}><option value="">Select City</option>{cityOptions.map((c, i) => (<option key={i} value={c}>{c}</option>))}</select><div className="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-400"><ChevronDown size={16} /></div></>
//                         ) : (<input value={formData.city} readOnly placeholder="Auto-filled" className="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl text-xs font-bold text-slate-500 shadow-inner cursor-not-allowed" />)}
//                       </div>
//                     </FormField>
//                     <FormField label="District"><input value={formData.district} readOnly className="w-full px-6 py-4 bg-slate-100 border-none rounded-2xl text-sm font-bold text-slate-500 shadow-inner" /></FormField>
//                     <FormField label="State"><input value={formData.state} readOnly className="w-full px-6 py-4 bg-slate-100 border-none rounded-2xl text-sm font-bold text-slate-500 shadow-inner" /></FormField>
//                     <FormField label="Country"><input value={formData.country} onChange={(e) => setFormData({...formData, country: e.target.value})} placeholder="India" className={inputStyle} /></FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-between pt-8 border-t border-slate-50"><button onClick={() => setStep(1)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase hover:text-slate-900"><ChevronLeft size={16} className="inline mr-2"/> Back</button><button onClick={() => setStep(3)} type="button" className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase shadow-xl">Continue â†’</button></div>
//               </div>
//             )}

//             {/* STEP 3: EMPLOYMENT */}
//             {step === 3 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 duration-500">
//                 <div className="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-200 shadow-sm transition-all overflow-hidden">
//                   <div className="flex flex-col md:flex-row items-center justify-between gap-6">
//                     <div className="flex items-center gap-4">
//                       <Briefcase size={24} className="text-blue-600" />
//                       <div><h3 className="text-sm font-black text-slate-900 uppercase">Are you a Fresher?</h3><p className="text-[10px] font-bold text-slate-400 mt-1">Select your current career status</p></div>
//                     </div>
//                     <div className="flex bg-slate-100 p-1.5 rounded-[1.5rem] border border-slate-200 w-full md:w-auto">
//                       <button type="button" onClick={() => { setIsFresher(true); setFormData({ ...formData, experiences: [] }); }} className={`px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === true ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}>Yes, I am</button>
//                       <button type="button" onClick={() => setIsFresher(false)} className={`px-8 py-2.5 rounded-2xl text-[10px] font-black uppercase transition-all ${isFresher === false ? "bg-white text-blue-600 shadow-sm border" : "text-slate-400"}`}>No, Experienced</button>
//                     </div>
//                   </div>
//                 </div>

//                 {isFresher === false && (
//                   <div className="bg-white p-6 md:p-10 rounded-[3.5rem] border border-slate-200 shadow-xl space-y-10 animate-in fade-in zoom-in-95">
//                     <div className="flex flex-col sm:flex-row justify-between items-center border-b border-slate-100 pb-8 gap-4">
//                       <div className="flex items-center gap-4"><History size={20} className="text-blue-600"/><h3 className="text-sm font-black uppercase">Career Timeline</h3></div>
//                       <button type="button" onClick={() => setFormData({ ...formData, experiences: [...formData.experiences, { company_name: "", job_title: "", uploadMode: "file" }] })} className="px-6 py-3 bg-slate-900 hover:bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase transition-all shadow-lg">+ Add Organization</button>
//                     </div>
//                     <div className="space-y-10 max-h-[600px] overflow-y-auto pr-4 custom-scrollbar-professional">
//                       {formData.experiences.map((exp, i) => (
//                         <div key={i} className="relative bg-slate-50/50 border border-slate-200 p-6 md:p-10 rounded-[2.5rem] space-y-8 group transition-all hover:bg-white hover:shadow-xl shadow-inner">
//                           <button type="button" onClick={() => setFormData({ ...formData, experiences: formData.experiences.filter((_, idx) => idx !== i) })} className="absolute -top-3 -right-3 h-10 w-10 bg-white text-red-500 rounded-full flex items-center justify-center shadow-lg hover:bg-red-500 hover:text-white transition-all opacity-0 group-hover:opacity-100 z-20"><Trash2 size={18} /></button>
//                           <div className="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12">
//                             <FormField label="Employer"><input placeholder="Organization" value={exp.company_name} onChange={(e) => { const u = [...formData.experiences]; u[i].company_name = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                             <FormField label="Designation"><input placeholder="Role" value={exp.job_title} onChange={(e) => { const u = [...formData.experiences]; u[i].job_title = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle} /></FormField>
//                           </div>
//                           <div className="grid grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8">
//                              <FormField label="Start"><input type="date" className={inputStyle} /></FormField>
//                              <FormField label="End"><input type="date" className={inputStyle} /></FormField>
//                              <FormField label="CTC"><input type="number" placeholder="â‚¹" className={inputStyle} /></FormField>
//                              <FormField label="City"><input placeholder="Loc" className={inputStyle} /></FormField>
//                           </div>
//                           <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
//                             <FormField label="Responsibilities"><textarea placeholder="Impact..." rows={5} value={exp.description} onChange={(e) => { const u = [...formData.experiences]; u[i].description = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle + " resize-none min-h-[140px]"} /></FormField>
//                             <div className="space-y-3">
//                               <div className="flex justify-between items-center px-1"><p className="text-[10px] font-black text-slate-400 uppercase">Artifact</p><div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200"><button type="button" onClick={() => { const u = [...formData.experiences]; u[i].uploadMode = "file"; setFormData({ ...formData, experiences: u }); }} className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === 'file' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>FILE</button><button type="button" onClick={() => { const u = [...formData.experiences]; u[i].uploadMode = "link"; setFormData({ ...formData, experiences: u }); }} className={`px-4 py-1.5 text-[9px] font-black rounded-lg transition-all ${exp.uploadMode === 'link' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>URL</button></div></div>
//                               <div className="bg-white/50 border border-slate-100 rounded-3xl p-4 min-h-[140px] flex flex-col justify-center">
//                                 {exp.uploadMode === 'file' ? (<label className="flex flex-col items-center justify-center gap-3 w-full h-full border-2 border-dashed border-slate-200 rounded-2xl hover:bg-blue-50/30 transition-all cursor-pointer group p-4"><FileUp size={24} className="text-slate-400 group-hover:text-blue-500" /><span className="text-[9px] font-bold text-slate-500 uppercase tracking-widest text-center">{exp.expLetterFile ? exp.expLetterFile.name : "Drop PDF"}</span><input type="file" className="hidden" onChange={(e) => { const u = [...formData.experiences]; u[i].expLetterFile = e.target.files[0]; setFormData({ ...formData, experiences: u }); }} /></label>) : (<div className="relative"><LinkIcon size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input placeholder="Storage URI" value={exp.exp_letter_link} onChange={(e) => { const u = [...formData.experiences]; u[i].exp_letter_link = e.target.value; setFormData({ ...formData, experiences: u }); }} className={inputStyle + " pl-11"} /></div>)}
//                               </div>
//                             </div>
//                           </div>
//                           <div className="flex justify-end pt-2 border-t border-slate-50"><button type="button" onClick={() => toast.success("Record updated")} className="flex items-center gap-2 px-8 py-3 bg-emerald-50 text-emerald-600 border border-emerald-100 rounded-2xl text-[10px] font-black uppercase hover:bg-emerald-500 hover:text-white transition-all active:scale-95 shadow-sm"><Check size={16} strokeWidth={3} /> Save Record</button></div>
//                         </div>
//                       ))}
//                     </div>
//                   </div>
//                 )}
//                 <div className="flex flex-col sm:flex-row justify-between items-center gap-4 pt-4"><button onClick={() => setStep(2)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase transition-all shadow-sm">â† Back</button><button onClick={() => setStep(4)} type="button" disabled={isFresher === null} className={`px-12 py-4 rounded-2xl text-xs font-black uppercase shadow-xl transition-all active:scale-95 ${isFresher !== null ? "bg-blue-600 text-white" : "bg-slate-200 text-slate-400 cursor-not-allowed"}`}>Next Phase â†’</button></div>
//               </div>
//             )}

//             {/* STEP 4: CAREER */}
//             {step === 4 && (
//               <div ref={careerStepRef} className="bg-white p-8 md:p-12 rounded-[3.5rem] border border-slate-200 shadow-sm space-y-12 animate-in slide-in-from-right-8 overflow-visible">
//                 <div className="flex items-center gap-4 pb-4 border-b border-slate-100"><Award size={20} className="text-blue-600" /><h3 className="text-[14px] font-black text-slate-900 uppercase tracking-widest">Career Profile</h3></div>
//                 <div className="grid grid-cols-1 md:grid-cols-2 gap-12 overflow-visible">
//                   <FormField label="Position"><div className="relative overflow-visible"><div className="relative group"><input placeholder="Search role..." value={formData.position} onFocus={() => { setShowSkillDrop(true); setShowAssetDrop(false); setSkillFocused(false); }} onChange={(e) => setFormData({ ...formData, position: e.target.value })} className={inputStyle} /><ChevronDown size={16} className={`absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none transition-transform ${showSkillDrop ? 'rotate-180' : ''}`} /></div>
//                   {showSkillDrop && (<div className="absolute z-[100] w-full mt-2 bg-white border border-slate-200 rounded-3xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 max-h-60 overflow-y-auto no-scrollbar">{POSITION_OPTIONS.filter(p => p.toLowerCase().includes(formData.position.toLowerCase())).map((pos, i) => (<div key={i} onMouseDown={(e) => { e.preventDefault(); setFormData({ ...formData, position: pos }); setShowSkillDrop(false); }} className="px-6 py-4 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-700 cursor-pointer">{pos}</div>))}</div>)}</div></FormField>
//                   <FormField label="Seniority Level (Years)"><input type="number" placeholder="Total Experience" value={formData.experience} onFocus={() => { setShowSkillDrop(false); setShowAssetDrop(false); setSkillFocused(false); }} onChange={(e) => setFormData({ ...formData, experience: e.target.value })} className={inputStyle} /></FormField>
//                 </div>
//                 <div className="grid grid-cols-1 md:grid-cols-2 gap-12 overflow-visible">
//                   <FormField label="Education"><div className="relative overflow-visible"><div className="relative group"><input placeholder="Search degree..." value={eduSearch || formData.education} onFocus={() => { setShowAssetDrop(true); setShowSkillDrop(false); setSkillFocused(false); }} onChange={(e) => { setEduSearch(e.target.value); setFormData({ ...formData, education: e.target.value }); }} className={inputStyle} /><ChevronDown size={16} className={`absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none transition-transform ${showAssetDrop ? 'rotate-180' : ''}`} /></div>
//                   {showAssetDrop && (<div className="absolute z-[100] w-full mt-2 bg-white border border-slate-200 rounded-3xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 max-h-60 overflow-y-auto no-scrollbar">{filteredEducation.map((e, i) => (<div key={i} onMouseDown={(ev) => { ev.preventDefault(); setFormData({ ...formData, education: e }); setEduSearch(""); setShowAssetDrop(false); }} className="px-6 py-4 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-700 cursor-pointer">{e}</div>))}</div>)}</div></FormField>
//                   <FormField label="Department"><div className="relative overflow-visible"><div className="relative group"><input placeholder="Search departments..." value={deptSearch || formData.department} onFocus={() => { setSkillFocused(true); setShowSkillDrop(false); setShowAssetDrop(false); }} onChange={(e) => { setDeptSearch(e.target.value); setFormData({ ...formData, department: e.target.value }); }} className={inputStyle} /><ChevronDown size={16} className={`absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none transition-transform ${skillFocused ? 'rotate-180' : ''}`} /></div>
//                   {skillFocused && (<div className="absolute z-[100] w-full mt-2 bg-white border border-slate-200 rounded-3xl shadow-2xl overflow-hidden animate-in fade-in zoom-in-95 max-h-60 overflow-y-auto no-scrollbar">{filteredDepartments.map((d) => (<div key={d.id} onMouseDown={(ev) => { ev.preventDefault(); setFormData({ ...formData, department: d.name }); setDeptSearch(""); setSkillFocused(false); }} className="px-6 py-4 text-sm font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-700 cursor-pointer">{d.name}</div>))}</div>)}</div></FormField>
//                 </div>
//                 <div className="flex justify-between pt-8 border-t border-slate-50"><button onClick={() => setStep(3)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-[11px] font-black uppercase transition-all shadow-sm">â† Back</button><button onClick={() => setStep(5)} type="button" className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-[11px] font-black uppercase shadow-xl active:scale-95 transition-all">Next Phase â†’</button></div>
//               </div>
//             )}

//             {/* STEP 5: SKILLS & ASSETS */}
//             {step === 5 && (
//               <div className="space-y-8 animate-in slide-in-from-right-8 overflow-visible">
//                 <div className="bg-white border border-slate-200 rounded-[3.5rem] shadow-xl overflow-visible shadow-slate-200/50">
//                   <div className="bg-slate-50/50 px-10 py-6 border-b border-slate-200 flex items-center justify-between rounded-t-[3.5rem]"><div className="flex items-center gap-4"><div className="h-10 w-10 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-lg"><Cpu size={20} /></div><div><h3 className="text-sm font-black text-slate-900 uppercase tracking-widest leading-none">Expertise Matrix</h3><p className="text-[10px] font-bold text-slate-400 uppercase mt-0.5">Manage skills and physical assets</p></div></div></div>
//                   <div className="p-8 md:p-12 space-y-12 overflow-visible">
//                     <FormField label="Technical Matrix"><div className="space-y-6"><div className="flex flex-col sm:flex-row gap-4 items-end"><div className="relative max-w-md w-full"><Plus size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={skillInput} onChange={(e) => setSkillInput(e.target.value)} onKeyDown={(e) => { if(e.key === 'Enter') { e.preventDefault(); handleManualAddSkill(); } }} placeholder="New skill..." className={inputStyle + " pl-12"} /></div><button type="button" onClick={handleManualAddSkill} className="px-6 py-3.5 bg-slate-900 hover:bg-blue-600 text-white rounded-2xl transition-all flex items-center gap-2 text-[10px] font-black shadow-lg"><Database size={14} /> Sync Registry</button></div><div className="flex flex-wrap gap-3 p-1">{dynamicSkills.map((skill) => { const isSelected = formData.skills.includes(skill); return (<button key={skill} type="button" onClick={() => setFormData({...formData, skills: isSelected ? formData.skills.filter(s => s !== skill) : [...formData.skills, skill]})} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black transition-all duration-300 border-2 active:scale-90 ${isSelected ? "bg-blue-600 border-blue-600 text-white" : "bg-white border-slate-100 text-slate-500"}`}>{skill} {isSelected && <Check size={14} strokeWidth={3} />}</button>); })}</div></div></FormField>
//                     <FormField label="Hardware Matrix"><div className="space-y-6 pt-8 border-t border-slate-100"><div className="relative max-w-md w-full"><Layers size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input value={assetInput} onChange={(e) => setAssetInput(e.target.value)} onKeyDown={async (e) => { if(e.key === 'Enter') { e.preventDefault(); const v = assetInput.trim(); if(v && !formData.assets.includes(v)) { const ok = await handleAddAssetAPI(v); if(ok) { setFormData({...formData, assets: [...formData.assets, v]}); setAssetInput(""); } } } }} placeholder="Link hardware..." className={inputStyle + " pl-12"} /></div><div className="flex flex-wrap gap-3 p-1">{dynamicAssets.map((asset) => { const isSelected = formData.assets.includes(asset); return (<button key={asset} type="button" onClick={async () => { if(!isSelected) { const ok = await handleAddAssetAPI(asset); if(ok) setFormData({...formData, assets: [...formData.assets, asset]}); } else { setFormData({...formData, assets: formData.assets.filter(a => a !== asset)}); } }} className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-[11px] font-black border-2 active:scale-90 ${isSelected ? "bg-slate-900 text-white" : "bg-white border-slate-100 text-slate-500"}`}>{asset} {isSelected && <Check size={14} strokeWidth={3} />}</button>); })}</div></div></FormField>
//                   </div>
//                 </div>
//                 <div className="flex justify-between items-center pt-4"><button onClick={() => setStep(4)} type="button" className="px-10 py-4 bg-white border border-slate-200 text-slate-400 rounded-2xl text-xs font-black uppercase transition-all shadow-sm hover:text-slate-900 flex items-center gap-2"><ChevronLeft size={16}/> Back</button><button onClick={() => setStep(6)} type="button" className="px-12 py-4 bg-blue-600 text-white rounded-2xl text-xs font-black uppercase shadow-xl active:scale-95 flex items-center gap-2">Vault Registry <ChevronRight size={16}/></button></div>
//               </div>
//             )}

//             {/* STEP 6: DOCUMENT VAULT */}
//             {step === 6 && (
//               <div className="space-y-8 animate-in slide-in-from-bottom-12 duration-700">
//                 <div className="bg-white p-8 md:p-16 rounded-[4rem] shadow-xl shadow-slate-200/60 border border-slate-200 space-y-12 overflow-hidden relative">
//                   <div className="absolute top-0 right-0 p-12 text-slate-100 opacity-40 rotate-12 scale-150"><ShieldCheck size={240} /></div>
//                   <div className="flex items-center gap-5 pb-8 border-b border-slate-100 relative z-10"><div className="h-14 w-14 bg-blue-600 rounded-2xl flex items-center justify-center shadow-lg"><ShieldCheck size={28} className="text-white" /></div><div><h3 className="text-xl font-black text-slate-900 uppercase tracking-widest">Final Artifacts</h3><p className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mt-2">Verification Matrix</p></div></div>
//                   <div className="grid grid-cols-1 md:grid-cols-2 gap-16 relative z-10">
//                     <div className="space-y-8 p-1"><div className="flex justify-between items-center"><p className="text-[11px] font-black text-slate-500 uppercase flex items-center gap-2"><span className="h-1.5 w-1.5 rounded-full bg-blue-600" /> Resume Profile</p><div className="flex bg-slate-50 p-1 rounded-xl border border-slate-200"><button type="button" onClick={() => setResumeMode("file")} className={`px-5 py-2 text-[10px] font-black rounded-lg transition-all ${resumeMode === 'file' ? 'bg-white text-slate-900 shadow-sm border' : 'text-slate-400'}`}>FILE</button><button type="button" onClick={() => setResumeMode("link")} className={`px-5 py-2 text-[10px] font-black rounded-lg transition-all ${resumeMode === 'link' ? 'bg-white text-slate-900 shadow-sm border' : 'text-slate-400'}`}>URL</button></div></div>
//                     {resumeMode === 'file' ? (<label className="block p-12 border-2 border-dashed border-slate-200 rounded-[3rem] hover:border-blue-500 transition-all cursor-pointer group text-center bg-white"><FileUp size={40} className="mx-auto text-slate-300 group-hover:text-blue-500 mb-5 duration-500" /><p className="text-[10px] font-black text-slate-900 uppercase truncate px-4">{formData.cvFile ? formData.cvFile.name : "Select Resume PDF"}</p><input type="file" accept=".pdf" className="hidden" onChange={(e) => setFormData({...formData, cvFile: e.target.files[0], resume_link: ""})} /></label>) : <input placeholder="Cloud URI Link" value={formData.resume_link} onChange={(e) => setFormData({...formData, resume_link: e.target.value, cvFile: null})} className={inputStyle} />}</div>
//                     <div className="space-y-8 p-1"><div className="flex justify-between items-center"><p className="text-[11px] font-black text-slate-500 uppercase flex items-center gap-2"><span className="h-1.5 w-1.5 rounded-full bg-slate-400" /> Validation Node</p></div><div className="text-xs text-slate-400 font-bold uppercase leading-relaxed p-6 bg-slate-50 rounded-3xl border border-dashed">Candidate data ready for synchronization. ensure all letters are legible for registry nodes. finalize to commit to candidate ID 588.</div></div>
//                   </div>
//                   <div className="pt-16 border-t border-slate-100 flex flex-col items-center gap-8 relative z-10"><button type="submit" disabled={loading} className="w-full md:max-w-xl flex items-center justify-center gap-5 bg-blue-600 hover:bg-blue-700 text-white font-black py-7 rounded-[3rem] shadow-2xl active:scale-[0.98] uppercase disabled:opacity-50">{loading ? <Loader2 className="animate-spin" size={28} /> : <><Database size={24} /><span>Finalize PATCH Synchronize</span></>}</button><button type="button" onClick={() => setStep(5)} className="text-[10px] font-black text-slate-400 uppercase tracking-widest hover:text-slate-900 flex items-center gap-2"><ChevronLeft size={16}/> Return to Module 5</button></div>
//                 </div>
//               </div>
//             )}
//           </div>
//         </form>
//       </div>
//       <style dangerouslySetInnerHTML={{ __html: `.custom-scrollbar-professional::-webkit-scrollbar { width: 6px; }.custom-scrollbar-professional::-webkit-scrollbar-track { background: transparent; }.custom-scrollbar-professional::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 20px; }.custom-scrollbar-professional::-webkit-scrollbar-thumb:hover { background: #CBD5E1; }`}} />
//     </div>
//   );
// };

// export default ManualEntryPage14;
